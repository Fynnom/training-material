{"layout":"tutorial_hands_on","title":"Debugging Galaxy","questions":["How do I debug Galaxy?"],"objectives":["Fix a broken branch","Interpret the results of failed tests on GitHub","Run individual tests locally","Fix errors identified by failing tests","Debug simple runtime errors using the Python debugger","Write tests exposing the identified bug"],"time_estimation":"4h","key_points":["Always run individual failing tests locally to minimize the feedback loop.","To fix a bug, start by looking for the precise location in the code where the unexpected result is being produced, starting from the failing test or the error message in the log. Once the location is identified, finding and correcting the error is often trivial.","When debugging an API test failure, first determine what endpoint is being utilized; then look in `lib/galaxy/webapps/galaxy/api/` to locate the controller that handles that enpoint. The controller will point you to a manager module, which is where you're most likely to find the bug.","To locate the probable cause of a Selenium test failure, run Selenium with `GALAXY_TEST_SELENIUM_HEADLESS=false` to watch the browser step through the test.","When debugging a runtime error, use pdb or any other interactive Python debugger to step through the code to identify the location of the error. Remember to use `GALAXY_CONFIG_DEBUG=1` to enable debugging.","If you find a bug in a code block that is not covered by a test, before you fix the bug, write a test exposing the bug; run the test to ensure it fails; then fix the bug; then run the test again to ensure it passes.","Write useful and property formatted commit messages.","Pdb is your friend."],"contributors":[{"name":"Assunta DeSanto","email":"assuntad23@gmail.com","joined":"2021-05","id":"assuntad23","url":"https://training.galaxyproject.org/training-material/api/contributors/assuntad23.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/assuntad23/"},{"name":"John Davis","email":"jdavcs@gmail.com","joined":"2019-06","orcid":"0000-0002-1363-1245","id":"jdavcs","url":"https://training.galaxyproject.org/training-material/api/contributors/jdavcs.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/jdavcs/"},{"name":"John Chilton","email":"jmchilton@gmail.com","joined":"2017-09","twitter":"jmchilton","matrix":"jmchilton:matrix.org","orcid":"0000-0002-6794-0756","id":"jmchilton","url":"https://training.galaxyproject.org/training-material/api/contributors/jmchilton.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/jmchilton/"}],"requirements":[{"type":"none","title":"Familiarity with basic Git commands"},{"type":"none","title":"Basic knowledge of Python and JavaScript"},{"type":"none","title":"Mac OS or Linux that can run Galaxy & your favorite IDE or editor"},{"type":"internal","topic_name":"dev","tutorials":["architecture"]}],"subtopic":"core","js_requirements":{"mathjax":null,"mermaid":false},"short_id":"T00115","url":"/topics/dev/tutorials/debugging/tutorial.html","topic_name":"dev","tutorial_name":"debugging","dir":"topics/dev/tutorials/debugging","symlink":null,"id":"dev/debugging","ref_tutorials":["<p>In this tutorial we will demonstrate how to find and fix common types of bugs you may encounter as a contributor to Galaxy. We will step you through the process of finding and fixing a bug - from locating specific errors in the logs of Galaxy’s GitHub Actions, to identifying their cause, developing a solution and committing your edits</p>\n\n<p>With the skills from this tutorial, it is our hope that you will feel more prepared to develop solutions for Galaxy and more confidently navigate any obstacles along the way.</p>\n\n<blockquote class=\"agenda\">\n  <agenda-title></agenda-title>\n\n<ol id=\"markdown-toc\">\n  <li><a href=\"#local-development-environment-setup\" id=\"markdown-toc-local-development-environment-setup\">Local development environment setup</a>    <ol>\n      <li><a href=\"#contributing-to-galaxy\" id=\"markdown-toc-contributing-to-galaxy\">Contributing to Galaxy</a></li>\n      <li><a href=\"#getting-started-pulling-the-buggy-branch\" id=\"markdown-toc-getting-started-pulling-the-buggy-branch\">Getting started: Pulling the buggy branch</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#unit-test-failure\" id=\"markdown-toc-unit-test-failure\">Unit test failure</a></li>\n  <li><a href=\"#api-test-failure\" id=\"markdown-toc-api-test-failure\">API test failure</a></li>\n  <li><a href=\"#client-linting-error\" id=\"markdown-toc-client-linting-error\">Client linting error</a></li>\n  <li><a href=\"#client-unit-test-failure\" id=\"markdown-toc-client-unit-test-failure\">Client unit test failure</a></li>\n  <li><a href=\"#selenium-test-failure\" id=\"markdown-toc-selenium-test-failure\">Selenium test failure</a></li>\n  <li><a href=\"#runtime-error\" id=\"markdown-toc-runtime-error\">Runtime error</a></li>\n  <li><a href=\"#conclusion\" id=\"markdown-toc-conclusion\">Conclusion</a></li>\n</ol>\n\n</blockquote>\n\n<h1 id=\"local-development-environment-setup\">Local development environment setup</h1>\n\n<p>For almost every type of error you encounter, there will be a relatively similar process:</p>\n\n<ol>\n  <li>Locate failing test or error on GitHub Actions</li>\n  <li>Run failing test locally</li>\n  <li>Identify issue causing failure</li>\n  <li>Develop a solution</li>\n  <li>Ensure test passes locally</li>\n  <li>Commit and push fixed branch to local fork</li>\n</ol>\n\n<p>The process for dealing with runtime errors will be somewhat different, since there will be no failed test to review initially. However, in either case, the first step is to setup your local development environment.</p>\n\n<h2 id=\"contributing-to-galaxy\">Contributing to Galaxy</h2>\n\n<!--SNIPPET-->\n<blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-how-to-contribute-to-galaxy\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-how-to-contribute-to-galaxy\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: How to Contribute to Galaxy</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p>To contribute to galaxy, a GitHub account is required. Changes are proposed via a <a href=\"https://docs.github.com/en/github/collaborating-with-pull-requests\">pull request</a>. This allows the project maintainers to review the changes and suggest improvements.</p>   <p>The general steps are as follows:</p>   <ol>   <li>Fork the Galaxy repository</li>   <li>Clone your fork</li>   <li>Make changes in a new branch</li>   <li>Commit your changes, push branch to your fork</li>   <li>Open a pull request for this branch in the upstream Galaxy repository</li> </ol>   <blockquote class=\"details\">   <details-title>Git, Github, and Galaxy Core</details-title>   <p>For a lot more information about Git branching and managing a repository on Github,  see the <a href=\"/training-material/topics/contributing/tutorials/github-command-line-contribution/tutorial.html\">Contributing with GitHub via command-line</a> tutorial.</p>   <p>The <a href=\"/training-material/topics/dev/tutorials/architecture/slides.html\">Galaxy Core Architecture slides</a> have a lot of important Galaxy core-related information related to branches,  project management, and contributing to Galaxy - under the Project Management section of the slides.</p> </blockquote> </blockquote>\n<p><!--END_SNIPPET--></p>\n\n<p>In this tutorial, instead of cloning Galaxy’s default branch, we will clone a branch that has been created for this tutorial and contains several bugs that you’ll need to identify and fix. Also, we won’t be opening a pull request in the upstream Galaxy repository.</p>\n\n<h2 id=\"getting-started-pulling-the-buggy-branch\">Getting started: Pulling the buggy branch</h2>\n\n<p>Good news! All of the failing tests are on the same Galaxy branch! That means you only need to download and work off of one branch. The downside is that this is one buggy branch with issues all over the place. We have no doubts that you can solve them though!</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Setup your local Galaxy instance</hands-on-title>\n\n  <ol>\n    <li>Use GitHub UI to fork Galaxy’s repository at <code class=\"language-plaintext highlighter-rouge\">galaxyproject/galaxy</code>.</li>\n    <li>\n      <p>Clone your forked repository to a local path, further referred to as <code class=\"language-plaintext highlighter-rouge\">GALAXY_ROOT</code> and <code class=\"language-plaintext highlighter-rouge\">cd</code> into <code class=\"language-plaintext highlighter-rouge\">GALAXY_ROOT</code>. Note that we specify the tutorial branch with the <code class=\"language-plaintext highlighter-rouge\">-b</code> option:</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>git clone <span class=\"nt\">-b</span> training2022 https://github.com/&lt;your-username&gt;/galaxy GALAXY_ROOT\n<span class=\"nb\">cd </span>GALAXY_ROOT\n</code></pre></div>        </div>\n      </blockquote>\n\n      <p>Note: In the future, when you contribute to Galaxy, you’ll need to clone the <code class=\"language-plaintext highlighter-rouge\">dev</code> branch, which is the default, so you don’t need to specify the <code class=\"language-plaintext highlighter-rouge\">-b</code> option in the <code class=\"language-plaintext highlighter-rouge\">git clone</code> command).</p>\n    </li>\n    <li>\n      <p>Before we can use Galaxy, we need to create a virtual environment and install the required dependencies. This is generally done with the <code class=\"language-plaintext highlighter-rouge\">common_startup.sh</code> script:</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>bash scripts/common_startup.sh <span class=\"nt\">--dev-wheels</span>\n</code></pre></div>        </div>\n      </blockquote>\n\n      <p>Make sure your Python version is at least 3.6 (you can check your Python version with <code class=\"language-plaintext highlighter-rouge\">python --version</code>). If your system uses an older version, you may specify an alternative Python interpreter using the <code class=\"language-plaintext highlighter-rouge\">GALAXY_PYTHON</code> environment variable (<code class=\"language-plaintext highlighter-rouge\">GALAXY_PYTHON=/path/to/alt/python bash scripts/common_startup.sh --dev-wheels</code>).</p>\n    </li>\n    <li>\n      <p>Activate your new virtual environment:</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">.</span> .venv/bin/activate\n</code></pre></div>        </div>\n      </blockquote>\n\n      <p>Once activated, you’ll see the name of the virtual environment prepended to your shell prompt: <code class=\"language-plaintext highlighter-rouge\">(.venv)$</code>.</p>\n    </li>\n    <li>\n      <p>Finally, let’s create a new branch for your edits:</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>git checkout <span class=\"nt\">-b</span> my-training\n</code></pre></div>        </div>\n      </blockquote>\n\n      <p>Now when you run <code class=\"language-plaintext highlighter-rouge\">git branch</code> you’ll see that your new branch is activated:</p>\n\n      <blockquote class=\"code-2col\">\n        <blockquote class=\"code-in\">\n          <code-in-title>Bash</code-in-title>\n          <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>git branch\n</code></pre></div>          </div>\n        </blockquote>\n\n        <blockquote class=\"code-out\">\n          <code-out-title></code-out-title>\n          <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>  training2022\n<span class=\"k\">*</span> my-training\n</code></pre></div>          </div>\n        </blockquote>\n      </blockquote>\n\n      <p>Note: <code class=\"language-plaintext highlighter-rouge\">my-training</code> is just an example; you can call your new branch anything you like.</p>\n    </li>\n  </ol>\n</blockquote>\n\n<h1 id=\"unit-test-failure\">Unit test failure</h1>\n\n<p>Most of Galaxy unit tests are designed to test a separate component or function, are very fast, and do not require a running Galaxy instance. Finding the issue causing a unit test to fail is relatively straightforward.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Fixing a failing unit test</hands-on-title>\n\n  <ol>\n    <li>\n      <p><strong>Finding the failing test on GitHub</strong></p>\n\n      <p>Head over to the <a href=\"https://github.com/galaxyproject/galaxy\">Galaxy repository on GitHub</a> and in the branch drop-down select the “training” branch. Click the red “x” next to the last commit, you’ll get a drop-down listing of workflow results; find “Unit tests / Test (3…” and click “Details”. This will display a detailed report that includes information about the failed tests. Try to find the failed tests.</p>\n\n      <blockquote class=\"solution\">\n        <solution-title></solution-title>\n        <p>The log lists 2 failed tests:</p>\n        <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>- FAILED lib/galaxy/model/tags.py::galaxy.model.tags.TagHandler.parse_tags\n- FAILED test/unit/util/test_utils.py::test_strip_control_characters\n</code></pre></div>        </div>\n        <p>The first is a doctest. While it will provide us with hints on what may have caused the error, the unit test is generally more helpful.</p>\n      </blockquote>\n    </li>\n    <li>\n      <p><strong>Running the test locally</strong></p>\n\n      <p>An essential requirement for productive development is a fast feedback loop: we want to make a change, run a test, and get immediate feedback. If we push our edits to the remote fork (or submit a pull request to the upstream repository) and wait for the the tests to run remotely, it could take hours before we get any feedback, which is very inefficient (and detrimental to sustaining the joy of programming).</p>\n\n      <p>Instead, we will run the tests locally. Furthermore, we will run a specific test that we know is failing: this will give us the instant feedback we need.</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <p>Make sure you are in <code class=\"language-plaintext highlighter-rouge\">GALAXY_ROOT</code> and your virtual environment is activated. If not, activate it:</p>\n        <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">.</span> .venv/bin/activate\n</code></pre></div>        </div>\n      </blockquote>\n\n      <p>The simplest way to run the failing test locally is using pytest directly:</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>pytest <span class=\"nb\">test</span>/unit/util/test_utils.py\n</code></pre></div>        </div>\n      </blockquote>\n\n      <p>Do you see the error message?</p>\n\n      <blockquote class=\"solution\">\n        <solution-title></solution-title>\n        <p>The test gives us a very specific error message:</p>\n        <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>AssertionError: assert 'b l a' == 'bla'\n- bla\n+ b l a\n?  + +\n</code></pre></div>        </div>\n        <p>This means that instead of the expected <code class=\"language-plaintext highlighter-rouge\">bla</code> we got <code class=\"language-plaintext highlighter-rouge\">b l a</code> (with spaces).</p>\n      </blockquote>\n    </li>\n    <li>\n      <p><strong>Finding and fixing the issue</strong></p>\n\n      <p>Our next step is to open the test file and see what part of the codebase (i.e., what module, class + method or function) is failing to provide the expected result.</p>\n\n      <p>The failing test is calling the <code class=\"language-plaintext highlighter-rouge\">strip_control_characters</code> function in the <code class=\"language-plaintext highlighter-rouge\">util</code> module. That function, apparently, is not producing the expected output. Let’s head over to <code class=\"language-plaintext highlighter-rouge\">lib/galaxy/util/__init__.py</code>, where we’ll find the function definition:</p>\n\n      <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">def</span> <span class=\"nf\">strip_control_characters</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">):</span>\n    <span class=\"sh\">\"\"\"</span><span class=\"s\">Strip unicode control characters from a string.</span><span class=\"sh\">\"\"\"</span>\n    <span class=\"k\">return</span> <span class=\"sh\">\"</span><span class=\"s\"> </span><span class=\"sh\">\"</span><span class=\"p\">.</span><span class=\"nf\">join</span><span class=\"p\">(</span><span class=\"n\">c</span> <span class=\"k\">for</span> <span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"nf\">unicodify</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"n\">unicodedata</span><span class=\"p\">.</span><span class=\"nf\">category</span><span class=\"p\">(</span><span class=\"n\">c</span><span class=\"p\">)</span> <span class=\"o\">!=</span> <span class=\"sh\">\"</span><span class=\"s\">Cc</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n</code></pre></div>      </div>\n\n      <p>The function takes a string as input, and, in theory, returns a copy of that string with certain characters stripped away (it doesn’t really matter what characters are stripped away). However, from the test we see that the string is modified in a different way: spaces have been added between the characters.</p>\n\n      <p>Can you see what’s causing this behavior?</p>\n\n      <blockquote class=\"solution\">\n        <solution-title></solution-title>\n        <p>The genexp is evaluated and subsequently joined using a space as a delimiter. The space is, obviously, a typo: we don’t want to <em>add</em> anything to the string, so the delimiter should be the empty string instead:</p>\n        <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">return</span> <span class=\"sh\">\"\"</span><span class=\"p\">.</span><span class=\"nf\">join</span><span class=\"p\">(</span><span class=\"n\">c</span> <span class=\"k\">for</span> <span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"nf\">unicodify</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"n\">unicodedata</span><span class=\"p\">.</span><span class=\"nf\">category</span><span class=\"p\">(</span><span class=\"n\">c</span><span class=\"p\">)</span> <span class=\"o\">!=</span> <span class=\"sh\">\"</span><span class=\"s\">Cc</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n</code></pre></div>        </div>\n      </blockquote>\n\n      <p>Make the change, save the file, run the same test. Now it should pass.</p>\n    </li>\n    <li>\n      <p><strong>Finishing up</strong></p>\n\n      <p>Now you are ready to commit your edits and push the branch to your fork. So, <code class=\"language-plaintext highlighter-rouge\">git add [your modified files]</code> and <code class=\"language-plaintext highlighter-rouge\">git commit -m \"[insert your commit message here]\"</code>. Please consult <a href=\"https://github.com/galaxyproject/galaxy/blob/dev/CONTRIBUTING.md#how-to-contribute\">Galaxy’s contributor’s guide</a> for details on how to write a useful and properly formatted commit message, and why it matters.</p>\n\n      <p>Congratulations - you found and fixed a unit test failure!</p>\n    </li>\n  </ol>\n</blockquote>\n\n<h1 id=\"api-test-failure\">API test failure</h1>\n\n<p>API tests test various aspects of the Galaxy API, as well as general backend aspects of Galaxy using the API. These tests require a Galaxy instance.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Fixing a failing API test</hands-on-title>\n\n  <ol>\n    <li>\n      <p><strong>Finding the failing test on GitHub</strong></p>\n\n      <p>We’ll follow the same process we used in the unit test section. On GitHub, click the same red “x” and select the “API tests / Test (3…” workflow and click “Details”. Try to find the failed tests.</p>\n\n      <blockquote class=\"solution\">\n        <solution-title></solution-title>\n        <p>The log lists multiple failed tests. Some of them were caused by bugs you’ll be fixing in later sections of this tutorial. For this exercise, we care about these two failed tests:</p>\n        <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>FAILED lib/galaxy_test/api/test_licenses.py::LicensesApiTestCase::test_404_on_unknown_license\nFAILED lib/galaxy_test/api/test_licenses.py::LicensesApiTestCase::test_get_license\n</code></pre></div>        </div>\n        <p>Note: occasionally, there could be more failing tests; however, for the purposes of this exercise we are concerned with the licenses tests.</p>\n      </blockquote>\n    </li>\n    <li>\n      <p><strong>Running the test locally</strong></p>\n\n      <p>Again, we will run the individual test locally. While it is possible to run the test directly with pytest, in this case we will use Galaxy’s script <code class=\"language-plaintext highlighter-rouge\">run_tests.sh</code>. The script optimizes test runs by sharing the same instance of Galaxy across multiple tests; without the script a new Galaxy will be started for each TestCase class. There are other reasons to run the script; for more information check the documentation block at the top of the script.</p>\n\n      <p>Make sure you are in <code class=\"language-plaintext highlighter-rouge\">GALAXY_ROOT</code> (if your virtual environment is not activated, the script will do it for you).</p>\n\n      <p>Let’s run the failed test:</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>./run_tests.sh <span class=\"nt\">-api</span> lib/galaxy_test/api/test_licenses.py\n</code></pre></div>        </div>\n      </blockquote>\n\n      <p>Two tests are failing. Do you see the error messages?</p>\n\n      <blockquote class=\"solution\">\n        <solution-title></solution-title>\n        <p>We see the following error messages:</p>\n        <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>FAILED lib/galaxy_test/api/test_licenses.py::LicensesApiTestCase::test_404_on_unknown_license - AssertionError: Request status code (500) was not expected value 404. Body was INVALID JSON RESPONSE &lt;Internal Server Error&gt;\nFAILED lib/galaxy_test/api/test_licenses.py::LicensesApiTestCase::test_get_license - AssertionError: Request status code (404) was not expected value 200. Body was {'err_msg': \"License 'Apache-2.0' not found\", 'err_code': 404001}\n</code></pre></div>        </div>\n        <p>This means that instead of HTTP status code 200 (OK/success) we got a 500 (server error) and 404 (resource not found). Sometimes multiple test failures may be caused by the same error; this is the case here.</p>\n      </blockquote>\n    </li>\n    <li>\n      <p><strong>Finding and fixing the issue</strong></p>\n\n      <p>We can use either one of the failing tests to start debugging. Let’s use <code class=\"language-plaintext highlighter-rouge\">test_get_license</code>. As with the unit test, first let’s take a look at the test function definition (located in <code class=\"language-plaintext highlighter-rouge\">lib/galaxy_test/api/test_licenses.py</code>):</p>\n\n      <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">def</span> <span class=\"nf\">test_get_license</span><span class=\"p\">(</span><span class=\"n\">self</span><span class=\"p\">):</span>\n    <span class=\"n\">licenseId</span> <span class=\"o\">=</span> <span class=\"sh\">\"</span><span class=\"s\">Apache-2.0</span><span class=\"sh\">\"</span>\n    <span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"nf\">_get</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">licenses/</span><span class=\"si\">{</span><span class=\"n\">licenseId</span><span class=\"si\">}</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n    <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"nf\">_assert_status_code_is</span><span class=\"p\">(</span><span class=\"n\">response</span><span class=\"p\">,</span> <span class=\"mi\">200</span><span class=\"p\">)</span>\n    <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"nf\">_assert_matches_license_id</span><span class=\"p\">(</span><span class=\"n\">licenseId</span><span class=\"p\">,</span> <span class=\"n\">response</span><span class=\"p\">.</span><span class=\"nf\">json</span><span class=\"p\">())</span>\n</code></pre></div>      </div>\n\n      <p>The important line here is line 3: it tells us what API endpoint is called: <code class=\"language-plaintext highlighter-rouge\">licenses/{licenseId}</code>.</p>\n\n      <p>Our next step is to examine the controller for this endpoint. For that, we head over to <code class=\"language-plaintext highlighter-rouge\">lib/galaxy/webapps/galaxy/api/licenses.py</code>.</p>\n\n      <p>If you look at the FastAPI controller, you’ll see the <code class=\"language-plaintext highlighter-rouge\">get</code> method that is responsible for fetching the data in response to a <code class=\"language-plaintext highlighter-rouge\">GET</code> HTTP request received at the <code class=\"language-plaintext highlighter-rouge\">licenses/{licenseId}</code> endpoint:</p>\n\n      <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>    <span class=\"nd\">@router.get</span><span class=\"p\">(</span><span class=\"sh\">'</span><span class=\"s\">/api/licenses/{id}</span><span class=\"sh\">'</span><span class=\"p\">,</span>\n        <span class=\"n\">summary</span><span class=\"o\">=</span><span class=\"sh\">\"</span><span class=\"s\">Gets the SPDX license metadata associated with the short identifier</span><span class=\"sh\">\"</span><span class=\"p\">,</span>\n        <span class=\"n\">response_description</span><span class=\"o\">=</span><span class=\"sh\">\"</span><span class=\"s\">SPDX license metadata</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n    <span class=\"k\">async</span> <span class=\"k\">def</span> <span class=\"nf\">get</span><span class=\"p\">(</span><span class=\"n\">self</span><span class=\"p\">,</span> <span class=\"nb\">id</span><span class=\"o\">=</span><span class=\"n\">LicenseIdPath</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">LicenseMetadataModel</span><span class=\"p\">:</span>\n        <span class=\"sh\">\"\"\"</span><span class=\"s\">Returns the license metadata associated with the given\n        [SPDX license short ID](https://spdx.github.io/spdx-spec/appendix-I-SPDX-license-list/).</span><span class=\"sh\">\"\"\"</span>\n        <span class=\"k\">return</span> <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"n\">licenses_manager</span><span class=\"p\">.</span><span class=\"nf\">get_license_by_id</span><span class=\"p\">(</span><span class=\"nb\">id</span><span class=\"p\">)</span>\n</code></pre></div>      </div>\n\n      <p>The only thing in this method that matters to us is the last line:</p>\n\n      <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">return</span> <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"n\">licenses_manager</span><span class=\"p\">.</span><span class=\"nf\">get_license_by_id</span><span class=\"p\">(</span><span class=\"nb\">id</span><span class=\"p\">)</span>\n</code></pre></div>      </div>\n\n      <p>Why? Because despite all this syntax, the method simply redirects the request to <code class=\"language-plaintext highlighter-rouge\">self.licenses_manager</code>. If we read the code, we’ll quickly see that this variable holds an instance of <code class=\"language-plaintext highlighter-rouge\">LicencesManager</code>, which (look at the import statements at the top of the file) is located in <code class=\"language-plaintext highlighter-rouge\">lib/galaxy/managers/licenses.py</code>. Which is where we should look next.</p>\n\n      <p>If we carefully trace the code in <code class=\"language-plaintext highlighter-rouge\">LicensesManager</code>, we’ll find the error. Do you see it?</p>\n\n      <blockquote class=\"solution\">\n        <solution-title></solution-title>\n        <p>The <code class=\"language-plaintext highlighter-rouge\">get_license_by_id()</code> method raises an <code class=\"language-plaintext highlighter-rouge\">ObjectNotFound</code> error (which results in the 404 status code we see in the test result). This error is a direct result of the LicensesManager <code class=\"language-plaintext highlighter-rouge\">get</code> method called on the previous line (<code class=\"language-plaintext highlighter-rouge\">license = self.get(id)</code>) - take a look at that method:</p>\n        <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>    <span class=\"k\">def</span> <span class=\"nf\">get</span><span class=\"p\">(</span><span class=\"n\">self</span><span class=\"p\">,</span> <span class=\"n\">uri</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"n\">uri</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"n\">_by_index</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"n\">_by_index</span><span class=\"p\">[</span><span class=\"n\">uri</span><span class=\"p\">]</span>\n            <span class=\"bp\">...</span>\n</code></pre></div>        </div>\n        <p>Let’s rewrite the first clause in pseudo code to expose the problem:</p>\n        <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>if key not in dictionary:\n    return dictionary[key]\n</code></pre></div>        </div>\n        <p>Well, that makes no sense whatsoever! It should be the opposite: if key <strong>is</strong> in dictionary, then get the item with that key. The <code class=\"language-plaintext highlighter-rouge\">not</code> is clearly a typo (or, more accurately, a wicked edit made for the purpose of setting up a learning experience). Remove this negation and rerun the test.</p>\n      </blockquote>\n    </li>\n    <li>\n      <p><strong>Finishing up</strong></p>\n\n      <p>Well, that was fun. Congratulations! Now commit your edit (don’t forget to supply a useful commit message), and move on to client errors.</p>\n    </li>\n  </ol>\n</blockquote>\n\n<h1 id=\"client-linting-error\">Client linting error</h1>\n\n<p>Client Linting is important to reduce errors, improve quality of the codebase, and enforce common rules. These rules are defined by the eslinter defined with Vue best practices, primarily. On Github, the command <code class=\"language-plaintext highlighter-rouge\">eslint</code> is run to start the process for linting code on the client side.</p>\n\n<blockquote class=\"comment\">\n  <comment-title>Python Linting</comment-title>\n  <p>For backend consistency, we also have a Python linter. While we won’t be running you through that exercise today, you may encounter a Python linting issue in the future. The way to diagnose and treat these is very similar to the way to do it for the front end.</p>\n</blockquote>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Fixing client linting error</hands-on-title>\n\n  <ol>\n    <li>\n      <p><strong>Finding the failing test on GitHub</strong></p>\n\n      <p>With this error, one of the failing test workflows on GitHub would normally be “get_code_and_test”. However, since we are working on a branch that contains multiple bugs by design, some of the test failures overlap, as a result of which the “get_code_and_test” workflow has been skipped in the last commit.</p>\n\n      <p>Therefore, in this section, for the remote results, we’ll have to describe what would have been displayed.</p>\n\n      <p>One of the failing tests on GitHub says “get_code_and_test”. Clicking on the word “Details” assocated with this failure will open a brief view of the CircleCI Checks, with a list of tests that are run as part of that command. You’ll see that the one that is failing is js_lint. And if you click that, you’ll be navigated to the CicleCI app, where you can see much more information about the failures.</p>\n\n      <p>Here you can see the exact command that ran to lint our codebase:</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>cd client &amp;&amp; yarn run eslint\n</code></pre></div>      </div>\n\n      <p>We can also see that it has found 1 error, where that error is located, and a description of the problem.</p>\n    </li>\n    <li>\n      <p><strong>Running the linter locally</strong></p>\n\n      <p>Alright, so we’ve seen the failure, but we want to verify it locally now. For this, you’ll need to open up a terminal.</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <p>Make sure you are in <code class=\"language-plaintext highlighter-rouge\">GALAXY_ROOT</code> and your virtual environment is activated. If not, activate it:</p>\n        <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">.</span> .venv/bin/activate\n</code></pre></div>        </div>\n      </blockquote>\n\n      <p>Then you’ve got two options. You can run the same exact command that CircleCI uses, <code class=\"language-plaintext highlighter-rouge\">cd client &amp;&amp; yarn run eslint</code> or <code class=\"language-plaintext highlighter-rouge\">make client-lint</code>, which does <code class=\"language-plaintext highlighter-rouge\">cd client &amp;&amp; yarn run eslint &amp;&amp; yarn run prettier-check</code>. This will also make sure your code conforms to formatting standards.</p>\n\n      <p>After running that, you should see the same linting error from CircleCI; you should know where it is and how to fix it too!</p>\n    </li>\n    <li>\n      <p><strong>Finding and fixing the issue</strong></p>\n\n      <blockquote class=\"solution\">\n        <solution-title></solution-title>\n\n        <p>You are currently in <code class=\"language-plaintext highlighter-rouge\">GALAXY_ROOT/client</code>.\nIn the file <code class=\"language-plaintext highlighter-rouge\">src/components/RuleBuilder/RuleComponent.vue</code>, there is an unused import. Simply delete the line that says <code class=\"language-plaintext highlighter-rouge\">import Vue from \"vue\";</code></p>\n\n        <p>Alternatively, you can run <code class=\"language-plaintext highlighter-rouge\">yarn eslint --fix</code> or <code class=\"language-plaintext highlighter-rouge\">yarn run prettier</code>.</p>\n      </blockquote>\n\n      <p>If you think you’ve got it, try running the test locally again to be sure.</p>\n    </li>\n    <li>\n      <p><strong>Finishing up</strong></p>\n\n      <p>Whoo-hoo! If you’re here, you’ve identified the error, ran the appropriate command locally, found the problem, fixed it, confirmed that the command runs without errors, and are ready to commit your change. Write a useful commit message like <code class=\"language-plaintext highlighter-rouge\">Fix a client linting issue in RuleComponent</code> or something similar, making sure it is clear what you’ve done.\n(See <a href=\"https://github.com/galaxyproject/galaxy/blob/dev/CONTRIBUTING.md#how-to-contribute\">Galaxy’s contributor’s guide</a> for details on how to write a useful and properly formatted commit message.)</p>\n\n      <p>Awesome work - you now understand how to solve client linting issues!</p>\n    </li>\n  </ol>\n</blockquote>\n\n<h1 id=\"client-unit-test-failure\">Client unit test failure</h1>\n\n<p>Client tests are tests written by developers to test front-end code. In the case of the test we’re going to walk through right now, we’re looking at a Vue test failure, which means the component that it’s testing is definitely a Vue component.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Fixing a failing client unit test</hands-on-title>\n\n  <ol>\n    <li>\n      <p><strong>Finding the failing test on GitHub</strong>\nIn this section we, again, can’t demonstrate the remote output, so we descibe it instead.\nOne of the failing tests on GitHub says “Client Unit Testing / jest”. Clicking on Details beside that failure, will open up a the terminal output from that test. Here you should be able to see what test is failing.</p>\n\n      <blockquote class=\"solution\">\n        <solution-title></solution-title>\n\n        <p>The failing test file is <code class=\"language-plaintext highlighter-rouge\">src/components/RuleBuilder/SavedRulesSelector.test.js</code>, and the failing test in that file is <code class=\"language-plaintext highlighter-rouge\">SavedRulesSelector › disables history icon if there is no history</code>.</p>\n      </blockquote>\n    </li>\n    <li>\n      <p><strong>Running the test locally</strong></p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <p>Make sure you are in <code class=\"language-plaintext highlighter-rouge\">GALAXY_ROOT</code> and your virtual environment is activated. If not, activate it:</p>\n        <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">.</span> .venv/bin/activate\n</code></pre></div>        </div>\n      </blockquote>\n\n      <p>To run the client tests locally, you must be in the client directory; if you’re just in the galaxy directory, <code class=\"language-plaintext highlighter-rouge\">cd client</code> should take you to the right place.</p>\n\n      <p>Next, type <code class=\"language-plaintext highlighter-rouge\">yarn run test</code> or <code class=\"language-plaintext highlighter-rouge\">yarn jest</code> to run all the client tests.</p>\n\n      <p>The output should match what you found on Github.</p>\n    </li>\n    <li>\n      <p><strong>Finding and fixing the issue</strong></p>\n\n      <p>Next up, finding the error. Here are some tips:</p>\n\n      <ul>\n        <li>Take a look at the failing test and the imports to find out which Vue component the test correlates to.</li>\n        <li>Look at the test to see what it does. Is there an error in the test?</li>\n        <li>Look at the Vue component where the failure seems to be taking place. Is the error located there?</li>\n      </ul>\n\n      <p>The solution is hidden below, but try your hand at fixing it first:</p>\n\n      <blockquote class=\"solution\">\n        <solution-title></solution-title>\n        <p>The failure is only happening on the disabled test case, so take a look in the template of <code class=\"language-plaintext highlighter-rouge\">SavedRulesSelector</code> where the conditions for adding disabled are defined.</p>\n\n        <p>The way it’s worded in the test (and the way one could think about it logically), is that if there is no history, the button should be disabled, but the code says</p>\n\n        <div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"p\">:</span><span class=\"kd\">class</span><span class=\"o\">=</span><span class=\"dl\">\"</span><span class=\"s2\">{ disabled: numOfSavedRules == 1 }</span><span class=\"dl\">\"</span>\n</code></pre></div>        </div>\n\n        <p>– whoops! A very silly off by one error. On that very same line, change the 1 to a 0, and run the test again.</p>\n      </blockquote>\n\n      <p>If you think you’ve got it, try running the test locally again to be sure.</p>\n\n      <blockquote class=\"comment\">\n        <comment-title>Running fewer client tests</comment-title>\n        <p>If you don’t want to run the whole suite of client tests, you can add keywords that match the test path/name. For example both <code class=\"language-plaintext highlighter-rouge\">yarn run jest rule</code> and <code class=\"language-plaintext highlighter-rouge\">yarn jest selector</code> will work, but the former will run other tests with rule in the path/module name.</p>\n      </blockquote>\n    </li>\n    <li>\n      <p><strong>Finishing up</strong></p>\n\n      <p>Nice Job! If you’re here, you’ve found the problem, ran it locally, fixed the problem, ran it locally again without errors, and are ready to commit your change. Write a useful commit message like <code class=\"language-plaintext highlighter-rouge\">Fix logic error in SavedRuleSelector</code> or something similar, making sure it is clear what you’ve done.</p>\n\n      <p>(See <a href=\"https://github.com/galaxyproject/galaxy/blob/dev/CONTRIBUTING.md#how-to-contribute\">Galaxy’s contributor’s guide</a> for details on how to write a useful and properly formatted commit message.)</p>\n\n      <p>Awesome work - you now understand how to solve client linting issues!- you now have a handle on client tests!</p>\n    </li>\n  </ol>\n</blockquote>\n\n<h1 id=\"selenium-test-failure\">Selenium test failure</h1>\n\n<p>Selenium is the end-to-end or integration testing framework that we use; so these tests often are designed to test both frontend and backend code. This makes fixing them a little difficult, but we are sure you can do it!</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Fixing a failing Selenium test</hands-on-title>\n\n  <ol>\n    <li>\n      <p><strong>Finding the failing test on GitHub</strong></p>\n\n      <p>There may be actually a few failing Selenium tests, but the good news is, they are the result of only one little error. The failing tests on GitHub are in the “Selenium Test 3.7,0” and “Selenium Test 3.7,1” workflows. When you click on the details of this one, it’s not always very clear which test is causing the failure, but if you download the artifacts, it’s very clear which tests have failed.</p>\n\n      <p>Try to identify which tests are failing based on artifacts you downloaded.</p>\n\n      <blockquote class=\"solution\">\n        <solution-title></solution-title>\n\n        <p>The failing tests are:</p>\n\n        <ul>\n          <li><code class=\"language-plaintext highlighter-rouge\">test_build_list_and_show_items</code></li>\n          <li><code class=\"language-plaintext highlighter-rouge\">test_upload_pair_specify_extension</code></li>\n        </ul>\n      </blockquote>\n    </li>\n    <li>\n      <p><strong>Running the tests locally</strong></p>\n\n      <p>Make sure you are in <code class=\"language-plaintext highlighter-rouge\">GALAXY_ROOT</code> (if your virtual environment is not activated, the script will do it for you).</p>\n\n      <p>We do not want to run the full suite of Selenium tests here - that would take a lot of time and we already know that most of them passed.</p>\n\n      <p>Instead, we can build our commands to only run a subset of the tests. Here’s an example: <code class=\"language-plaintext highlighter-rouge\">./run_tests.sh -selenium lib/galaxy_test/selenium/test_sign_out.py</code></p>\n\n      <p>A command like that will still run all of the tests defined in that python file, so we need to find out where the tests that failed are defined. Try seaching the baseline for our three failing Selenium tests; what files are they in?</p>\n\n      <blockquote class=\"solution\">\n        <solution-title></solution-title>\n\n        <p>The failing tests are defined in these files:</p>\n\n        <ul>\n          <li><code class=\"language-plaintext highlighter-rouge\">lib/galaxy_test/selenium/test_collection_builders.py</code></li>\n          <li><code class=\"language-plaintext highlighter-rouge\">lib/galaxy_test/selenium/test_uploads.py</code></li>\n        </ul>\n      </blockquote>\n\n      <p>Now that we have the files, we can run the selenium tests. The command to do this should be very similar to <code class=\"language-plaintext highlighter-rouge\">./run_tests.sh -selenium lib/galaxy_test/selenium/test_sign_out.py</code>. The only difference should be the python file where the tests are defined. Try it yourself, before checking out the solution.</p>\n\n      <blockquote class=\"solution\">\n        <solution-title></solution-title>\n\n        <p>Either of these two commands will work:</p>\n\n        <blockquote class=\"code-in\">\n          <code-in-title>Bash</code-in-title>\n          <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>./run_tests.sh <span class=\"nt\">-selenium</span> lib/galaxy_test/selenium/test_collection_builders.py\n</code></pre></div>          </div>\n          <p>or</p>\n          <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>./run_tests.sh <span class=\"nt\">-selenium</span> lib/galaxy_test/selenium/test_uploads.py\n</code></pre></div>          </div>\n        </blockquote>\n      </blockquote>\n\n      <p>Running any of these tests will show us that the tests are still failing on our local machine. So, you should see a failing test that matches one of the three we identified from the downloaded artifacts. Onward to fixing them!</p>\n    </li>\n    <li>\n      <p><strong>Finding and fixing the issue</strong></p>\n\n      <p>Good news - there’s an easy way to figure out what’s going wrong with a selenium test!</p>\n\n      <p>In your terminal type <code class=\"language-plaintext highlighter-rouge\">export GALAXY_TEST_SELENIUM_HEADLESS=false</code>. This will allow you to see the test running in real time.</p>\n\n      <p>Re-run the selenium test to watch the headless browser step through the test.</p>\n\n      <p>Looking at the test run in the headless browser, alongside the definition for the test should help you understand what might be going wrong. Try and figure out where the problem is on your own, before looking at the solution.</p>\n\n      <blockquote class=\"solution\">\n        <solution-title></solution-title>\n\n        <p>The problem is that the tests are expecting a different HID (history identifier) than what is being made available to them. Since all the failing tests have to do with Lists, you might want to check out the ListCollectionCreator.</p>\n\n        <p>For comparisons sake, open one of the other CollectionCreators, as well and see if you can spot anything that is amiss.</p>\n\n        <p>Pay careful attention in the template to the <collection-creator> props.</collection-creator></p>\n\n        <p>Here you should notice that in the PairCollectionCreator or in the PairedListCollectionCreator, <code class=\"language-plaintext highlighter-rouge\">:hide-source-items=\"hideSourceItems\"</code> instead of <code class=\"language-plaintext highlighter-rouge\">:hide-source-items=\"!hideSourceItems\"</code>. It’s a little change, just flipping the boolean, but it makes a big difference!</p>\n      </blockquote>\n\n      <p>Awesome! If you’re here, you’ve found and fixed the problem, at least, in theory.</p>\n\n      <p>If you think you’ve got it, try running the tests locally again to be sure. In this simulated case, you can get by with just running one of the tests, but in reality, you should probably run all three Selenium tests to be sure that it’s totally fixed.</p>\n    </li>\n    <li>\n      <p><strong>Finishing up</strong></p>\n\n      <p>Excellent! If you’re here, you’ve found the problem, ran it locally, fixed the problem, ran it locally again without errors, and are ready to commit your change. Write a useful commit message like <code class=\"language-plaintext highlighter-rouge\">Fix logic error in ListCollectionCreator</code> or something similar, making sure it is clear what you’ve done.\n(See <a href=\"https://github.com/galaxyproject/galaxy/blob/dev/CONTRIBUTING.md#how-to-contribute\">Galaxy’s contributor’s guide</a> for details on how to write a useful and properly formatted commit message.)</p>\n\n      <p>Selenium tests are in the bag!</p>\n    </li>\n  </ol>\n</blockquote>\n\n<h1 id=\"runtime-error\">Runtime error</h1>\n\n<p>Our last error happens at runtime, which means we don’t have a failing test; instead we have a bug report describing the error. Our goal is to fix the error. Our steps are as follows:</p>\n\n<ol>\n  <li>Reproduce the error</li>\n  <li>Locate the error</li>\n  <li>Identify the problem</li>\n  <li>Write a test exposing the bug. The test must fail.</li>\n  <li>Fix the error.</li>\n  <li>Ensure the error no longer occurs.</li>\n</ol>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Fixing a runtime error</hands-on-title>\n\n  <ol>\n    <li>\n      <p><strong>Reproduce the error</strong></p>\n\n      <p>Here’s the bug report:</p>\n\n      <blockquote class=\"quote\">\n        <p>In the User menu, clicking the Datasets option causes an error message to be displayed on the page: “Uncaught exception in exposed API method”.</p>\n      </blockquote>\n\n      <p>Make sure you are in <code class=\"language-plaintext highlighter-rouge\">GALAXY_ROOT</code>. Then start your local Galaxy using the <code class=\"language-plaintext highlighter-rouge\">uvicorn</code> command*:</p>\n\n      <blockquote class=\"code-2col\">\n        <blockquote class=\"code-in\">\n          <code-in-title>Bash</code-in-title>\n          <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">GALAXY_CONFIG_FILE</span><span class=\"o\">=</span>config/galaxy.yml uvicorn <span class=\"nt\">--app-dir</span> lib <span class=\"nt\">--factory</span> galaxy.webapps.galaxy.fast_factory:factory\n</code></pre></div>          </div>\n        </blockquote>\n\n        <blockquote class=\"code-out\">\n          <code-out-title></code-out-title>\n          <p>The first startup may take a few minutes. Eventually, you’ll see the following output (the PID will be different):</p>\n\n          <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\n</code></pre></div>          </div>\n        </blockquote>\n      </blockquote>\n\n      <p>*NOTE: We are not using <code class=\"language-plaintext highlighter-rouge\">run.sh</code> because that would prevent us from using the Python interactive debugger, which we will be utilizing in this section.</p>\n\n      <p>Now you can access your Galaxy instance from the browser at <a href=\"http://127.0.0.1:8000\"><code class=\"language-plaintext highlighter-rouge\">http://127.0.0.1:8000</code></a>.</p>\n\n      <p>To reproduce this error, we need to access the User menu. For this, we need to be logged in to Galaxy:</p>\n\n      <ol>\n        <li>Click on “Login or Register:</li>\n        <li>At the bottom of the form, click “Register here”</li>\n        <li>Fill out the form. You may use any data, as long as the email you provide is a valid email format and the password is at least 6 characters long. For this exercise, it doesn’t matter what email, name or password you use.</li>\n        <li>Click “Create”</li>\n      </ol>\n\n      <p>Now the User menu is available to us. Click “User”, then select “Datasets” from the dropdown menu. You should be able to see the error message displayed on the page: “Uncaught exception in exposed API method”.</p>\n\n      <p>Being able to reproduce a bug is good: this means you’re on your way to fixing it, and you know what to look for! In a real scenario, it is not uncommon that a bug is not easily reproduceable, which makes fixing it a much more complicated task.</p>\n    </li>\n    <li>\n      <p><strong>Locate the problem</strong></p>\n\n      <p>To figure out what’s happening, our best bet is to look at the Galaxy log (look at the terminal window from which you launched Galaxy). Can you see the error message?</p>\n\n      <blockquote class=\"solution\">\n        <solution-title></solution-title>\n\n        <p>You should see something like this:</p>\n\n        <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>galaxy.web.framework.decorators ERROR 2021-06-08 17:52:08,350 [pN:main.web.1,p:1583948,w:1,m:0,tN:uWSGIWorker1Core1] Uncaught exception in exposed API method:\nTraceback (most recent call last):\n  File \"lib/galaxy/web/framework/decorators.py\", line 312, in decorator\n    rval = func(self, trans, *args, **kwargs)\n  File \"lib/galaxy/webapps/galaxy/api/datasets.py\", line 100, in index\n    raise Exception('This should not happen!')\nException: This should not happen!\n</code></pre></div>        </div>\n\n        <p>From this error log, we can easily tell that the error happens in the <code class=\"language-plaintext highlighter-rouge\">lib/galaxy/webapps/galaxy/api/datasets.py</code> file on line 100. The specific error message doesn’t tell us much - which is often what happens in the wild.</p>\n      </blockquote>\n\n      <p>Let’s head over to the <code class=\"language-plaintext highlighter-rouge\">datasets'py</code> file, line 100:</p>\n\n      <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> <span class=\"mi\">97</span>         <span class=\"k\">if</span> <span class=\"nf\">str_as_bool</span><span class=\"p\">(</span><span class=\"n\">trans</span><span class=\"p\">.</span><span class=\"n\">app</span><span class=\"p\">.</span><span class=\"n\">config</span><span class=\"p\">.</span><span class=\"nf\">get</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">show_datasets</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">True</span><span class=\"sh\">\"</span><span class=\"p\">)):</span>\n <span class=\"mi\">98</span>             <span class=\"k\">return</span> <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"n\">service</span><span class=\"p\">.</span><span class=\"nf\">index</span><span class=\"p\">(</span><span class=\"n\">trans</span><span class=\"p\">,</span> <span class=\"n\">history_id</span><span class=\"p\">,</span> <span class=\"n\">serialization_params</span><span class=\"p\">,</span> <span class=\"n\">filter_query_params</span><span class=\"p\">)</span>\n <span class=\"mi\">99</span>         <span class=\"k\">else</span><span class=\"p\">:</span>\n<span class=\"mi\">100</span>             <span class=\"k\">raise</span> <span class=\"nc\">Exception</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">This should not happen!</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n</code></pre></div>      </div>\n\n      <p>The good news is that the error happens inside an <code class=\"language-plaintext highlighter-rouge\">if/else</code> block, which narrows down our search to line 97: that line evaluates to <code class=\"language-plaintext highlighter-rouge\">False</code>, causing the <code class=\"language-plaintext highlighter-rouge\">else</code> clause to execute. The bad news is that we have no idea what causes that line to evaluate to <code class=\"language-plaintext highlighter-rouge\">False</code>.</p>\n    </li>\n    <li>\n      <p><strong>Identify the problem</strong></p>\n\n      <p>We will investigate using pdb - our trusted Python debugger!</p>\n\n      <p>pdb offers a wide range of functionality and is exceptionally useful for debugging at runtime. We encourage you to read its <a href=\"https://docs.python.org/3/library/pdb.html\">documentation</a>; however for this exercise we will only use the built-in <a href=\"https://docs.python.org/3/library/functions.html#breakpoint\">breakpoint()</a> function, that drops us into pdb.</p>\n\n      <p>Add a <code class=\"language-plaintext highlighter-rouge\">breakpoint()</code> statement to your code, right above the <code class=\"language-plaintext highlighter-rouge\">if/else</code> block.</p>\n\n      <blockquote class=\"solution\">\n        <solution-title></solution-title>\n\n        <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"mi\">126</span>         <span class=\"nf\">breakpoint</span><span class=\"p\">()</span>\n <span class=\"mi\">97</span>         <span class=\"k\">if</span> <span class=\"nf\">str_as_bool</span><span class=\"p\">(</span><span class=\"n\">trans</span><span class=\"p\">.</span><span class=\"n\">app</span><span class=\"p\">.</span><span class=\"n\">config</span><span class=\"p\">.</span><span class=\"nf\">get</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">show_datasets</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">True</span><span class=\"sh\">\"</span><span class=\"p\">)):</span>\n <span class=\"mi\">98</span>             <span class=\"k\">return</span> <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"n\">service</span><span class=\"p\">.</span><span class=\"nf\">index</span><span class=\"p\">(</span><span class=\"n\">trans</span><span class=\"p\">,</span> <span class=\"n\">history_id</span><span class=\"p\">,</span> <span class=\"n\">serialization_params</span><span class=\"p\">,</span> <span class=\"n\">filter_query_params</span><span class=\"p\">)</span>\n <span class=\"mi\">99</span>         <span class=\"k\">else</span><span class=\"p\">:</span>\n<span class=\"mi\">100</span>             <span class=\"k\">raise</span> <span class=\"nc\">Exception</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">This should not happen!</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n</code></pre></div>        </div>\n\n      </blockquote>\n\n      <p>Now we need to restart Galaxy. However, to use pdb, we need to enable Galaxy’s debug configuration option. In general, it may be a good idea to enable this in your <code class=\"language-plaintext highlighter-rouge\">galaxy.yml</code> configuration file (just copy or rename <code class=\"language-plaintext highlighter-rouge\">config/galaxy.yml.sample</code> and uncomment the option you want to set). However, for the purposes of this exercise, it’s enough to set the <code class=\"language-plaintext highlighter-rouge\">GALAXY_CONFIG_DEBUG</code> environment variable when running Galaxy:</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">GALAXY_CONFIG_DEBUG</span><span class=\"o\">=</span>1 <span class=\"nv\">GALAXY_CONFIG_FILE</span><span class=\"o\">=</span>config/galaxy.yml uvicorn <span class=\"nt\">--app-dir</span> lib <span class=\"nt\">--factory</span> galaxy.webapps.galaxy.fast_factory:factory\n</code></pre></div>        </div>\n      </blockquote>\n\n      <blockquote class=\"comment\">\n        <comment-title>Why we set the debug option</comment-title>\n\n        <p>The reason for setting the <code class=\"language-plaintext highlighter-rouge\">debug</code> option for releases prior to 22.05 was quite esoteric: among other things, it prevents uWSGI (no longer used as of 22.05) from remapping <code class=\"language-plaintext highlighter-rouge\">stdin</code> to <code class=\"language-plaintext highlighter-rouge\">dev/null</code> which would prevent tools like pdb from running.</p>\n      </blockquote>\n\n      <p>Now your Galaxy is running in debug mode. Repeat your steps that reproduced the error. When you click “Datasets”, head over to your terminal. At the bottom of the log you’ll see something like this:</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>&gt; /home/sergey/2sandbox/galaxy/dev_training/lib/galaxy/webapps/galaxy/api/datasets.py(97)index()\n-&gt; if str_as_bool(trans.app.config.get('show_datasets', 'True')):\n(Pdb)\n</code></pre></div>      </div>\n\n      <p>You’re at the pdb prompt. From here you can execute Python code interactively. The logs printed to <code class=\"language-plaintext highlighter-rouge\">stdout</code> can be distracting, so try to ignore them. Let’s explore what’s happening in the next line:</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Pdb</code-in-title>\n        <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>(Pdb) trans\n&lt;galaxy.webapps.base.webapp.GalaxyWebTransaction object at 0x7f3664eee2b0&gt;\n(Pdb) trans.app\n&lt;galaxy.app.UniverseApplication object at 0x7f36ccc18790&gt;\n(Pdb) trans.app.config\n&lt;galaxy.config.GalaxyAppConfiguration object at 0x7f369addcac0&gt;\n(Pdb) trans.app.config.get\n&lt;bound method CommonConfigurationMixin.get of &lt;galaxy.config.GalaxyAppConfiguration object at 0x7f369addcac0&gt;&gt;\n(Pdb)\n</code></pre></div>        </div>\n      </blockquote>\n\n      <p>We could have just typed <code class=\"language-plaintext highlighter-rouge\">trans.app.config.get</code>, of course; the steps above give us some additional context.</p>\n\n      <p>Now let’s take a look at the definition of the <code class=\"language-plaintext highlighter-rouge\">get</code> method. We need to find <code class=\"language-plaintext highlighter-rouge\">CommonConfigurationMixin</code> which is used by <code class=\"language-plaintext highlighter-rouge\">galaxy.config.GalaxyAppConfiguration</code>.</p>\n\n      <p>Head over to <code class=\"language-plaintext highlighter-rouge\">lib/galaxy/config/__init__.py</code> and look for the class <code class=\"language-plaintext highlighter-rouge\">CommonConfigurationMixin</code>. Once you find it, look for the definition of its <code class=\"language-plaintext highlighter-rouge\">get</code> method. When you find it, look at the method signature. What is the meaning of the argument <code class=\"language-plaintext highlighter-rouge\">'True'</code> that is passed to this method in <code class=\"language-plaintext highlighter-rouge\">datasets.py</code> on line 97?</p>\n\n      <blockquote class=\"solution\">\n        <solution-title></solution-title>\n\n        <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"mi\">584</span>     <span class=\"k\">def</span> <span class=\"nf\">get</span><span class=\"p\">(</span><span class=\"n\">self</span><span class=\"p\">,</span> <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">):</span>\n<span class=\"mi\">585</span>         <span class=\"c1\"># Warning: the value of self.config_dict['foo'] may be different from self.foo\n</span><span class=\"mi\">586</span>         <span class=\"k\">return</span> <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"n\">config_dict</span><span class=\"p\">.</span><span class=\"nf\">get</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"p\">)</span>\n</code></pre></div>        </div>\n\n        <p>The argument <code class=\"language-plaintext highlighter-rouge\">True</code> corresponds to the parameter <code class=\"language-plaintext highlighter-rouge\">default</code>. In the method’s body, we see that this value will be passed to <code class=\"language-plaintext highlighter-rouge\">self.config_dict.get()</code>; <code class=\"language-plaintext highlighter-rouge\">self.config_dict</code> is a Python dictionary, so the second argument to <code class=\"language-plaintext highlighter-rouge\">get()</code> is the default value that will be retuned if <code class=\"language-plaintext highlighter-rouge\">key</code> is not in <code class=\"language-plaintext highlighter-rouge\">self.config_dict</code>.</p>\n      </blockquote>\n\n      <p>Back to <code class=\"language-plaintext highlighter-rouge\">datasets.py</code>, line 97. Now we know that <code class=\"language-plaintext highlighter-rouge\">True</code> is the default value that will be returned if the key <code class=\"language-plaintext highlighter-rouge\">show_datasets</code> does not exist in the <code class=\"language-plaintext highlighter-rouge\">config_dict</code> dictionary. Moving on:</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Pdb</code-in-title>\n        <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>(Pdb) trans.app.config.get('show_datasets')\n(Pdb) trans.app.config.get('show_datasets', 'True')\n'True'\n</code></pre></div>        </div>\n      </blockquote>\n\n      <p>So, we see that <code class=\"language-plaintext highlighter-rouge\">show_datasets</code> does not exist and we get the default value, which is the string <code class=\"language-plaintext highlighter-rouge\">'True'</code>.</p>\n\n      <p>Next step: <code class=\"language-plaintext highlighter-rouge\">str_to_bool</code>. First, let’s pass it the value <code class=\"language-plaintext highlighter-rouge\">'True'</code>:</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Pdb</code-in-title>\n        <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>(Pdb) str_as_bool('True')\nFalse\n</code></pre></div>        </div>\n      </blockquote>\n\n      <p>That doesn’t look right! Exit the debugger (type in <code class=\"language-plaintext highlighter-rouge\">q</code>, then <code class=\"language-plaintext highlighter-rouge\">Enter</code>, then <code class=\"language-plaintext highlighter-rouge\">CTRL-C </code> to exit Galaxy.\nHead over to the function’s definition (you can tell from the import statement at the top of the file that it’s in <code class=\"language-plaintext highlighter-rouge\">lib/galaxy/util/__init__.py</code>) and try to figure out if there is an error.</p>\n\n      <blockquote class=\"solution\">\n        <solution-title></solution-title>\n\n        <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"mi\">117</span> <span class=\"k\">def</span> <span class=\"nf\">str_as_bool</span><span class=\"p\">(</span><span class=\"n\">string</span><span class=\"p\">):</span>\n<span class=\"mi\">118</span>     <span class=\"sh\">\"\"\"</span><span class=\"s\">This is for training only.</span><span class=\"sh\">\"\"\"</span>\n<span class=\"mi\">119</span>     <span class=\"k\">if</span> <span class=\"nf\">str</span><span class=\"p\">(</span><span class=\"n\">string</span><span class=\"p\">)</span> <span class=\"ow\">in</span> <span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">true</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">yes</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">on</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">1</span><span class=\"sh\">\"</span><span class=\"p\">):</span>\n<span class=\"mi\">120</span>         <span class=\"k\">return</span> <span class=\"bp\">True</span>\n<span class=\"mi\">121</span>     <span class=\"k\">else</span><span class=\"p\">:</span>\n<span class=\"mi\">122</span>         <span class=\"k\">return</span> <span class=\"bp\">False</span>\n</code></pre></div>        </div>\n\n        <p>At first glance, everything seems right. But think of what value we are passing: <code class=\"language-plaintext highlighter-rouge\">'True'</code> - it is <em>not</em> in the <code class=\"language-plaintext highlighter-rouge\">('true', 'yes', 'on', '1')</code> tuple! Aparently, the developer did not account for upper vs. lower case!</p>\n\n        <p>Do NOT fix the error just yet.</p>\n      </blockquote>\n    </li>\n    <li>\n      <p><strong>Write a test exposing the bug</strong></p>\n\n      <p>Before you fix code that was not covered by a test, write the test to expose the bug! In this case we have a simple, completely isolated function - a simple unit test should do. Your test should go into this module: <code class=\"language-plaintext highlighter-rouge\">test/unit/util/test_utils.py</code>.</p>\n\n      <p>Start with a blank test function. Then call the funtion under test (<code class=\"language-plaintext highlighter-rouge\">str_as_bool</code>) and assert that when you pass it the value <code class=\"language-plaintext highlighter-rouge\">'True'</code>, it returns <code class=\"language-plaintext highlighter-rouge\">True</code>. Can you think of more cases to test?</p>\n\n      <blockquote class=\"solution\">\n        <solution-title></solution-title>\n\n        <p>Your first step could be something like this:</p>\n\n        <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">def</span> <span class=\"nf\">test_str_as_bool</span><span class=\"p\">():</span>\n    <span class=\"k\">assert</span> <span class=\"n\">util</span><span class=\"p\">.</span><span class=\"nf\">str_as_bool</span><span class=\"p\">(</span><span class=\"sh\">'</span><span class=\"s\">True</span><span class=\"sh\">'</span><span class=\"p\">)</span>\n</code></pre></div>        </div>\n\n        <p>However, keep in mind that there may be other cases of mixed or uppercase values. You should also test for lowercase values - to make sure that while fixing the bug you don’t break the current functionality. And remember to test for the <code class=\"language-plaintext highlighter-rouge\">False</code> cases as well.</p>\n\n        <p>There are many ways to implement this, feel free to write your own. Here’s one option:</p>\n\n        <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">def</span> <span class=\"nf\">test_str_as_bool</span><span class=\"p\">():</span>\n    <span class=\"k\">for</span> <span class=\"n\">value</span> <span class=\"ow\">in</span> <span class=\"p\">(</span><span class=\"sh\">'</span><span class=\"s\">true</span><span class=\"sh\">'</span><span class=\"p\">,</span> <span class=\"sh\">'</span><span class=\"s\">yes</span><span class=\"sh\">'</span><span class=\"p\">,</span> <span class=\"sh\">'</span><span class=\"s\">on</span><span class=\"sh\">'</span><span class=\"p\">,</span> <span class=\"sh\">'</span><span class=\"s\">1</span><span class=\"sh\">'</span><span class=\"p\">,</span> <span class=\"sh\">'</span><span class=\"s\">True</span><span class=\"sh\">'</span><span class=\"p\">,</span> <span class=\"sh\">'</span><span class=\"s\">Yes</span><span class=\"sh\">'</span><span class=\"p\">,</span> <span class=\"sh\">'</span><span class=\"s\">On</span><span class=\"sh\">'</span><span class=\"p\">,</span><span class=\"sh\">'</span><span class=\"s\">TRUE</span><span class=\"sh\">'</span><span class=\"p\">,</span> <span class=\"sh\">'</span><span class=\"s\">YES</span><span class=\"sh\">'</span><span class=\"p\">,</span> <span class=\"sh\">'</span><span class=\"s\">ON</span><span class=\"sh\">'</span><span class=\"p\">):</span>\n        <span class=\"k\">assert</span> <span class=\"n\">util</span><span class=\"p\">.</span><span class=\"nf\">str_as_bool</span><span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)</span>\n    <span class=\"k\">for</span> <span class=\"n\">value</span> <span class=\"ow\">in</span> <span class=\"p\">(</span><span class=\"sh\">'</span><span class=\"s\">false</span><span class=\"sh\">'</span><span class=\"p\">,</span> <span class=\"sh\">'</span><span class=\"s\">0</span><span class=\"sh\">'</span><span class=\"p\">,</span> <span class=\"sh\">'</span><span class=\"s\">something else</span><span class=\"sh\">'</span><span class=\"p\">):</span>\n        <span class=\"k\">assert</span> <span class=\"ow\">not</span> <span class=\"n\">util</span><span class=\"p\">.</span><span class=\"nf\">str_as_bool</span><span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</code></pre></div>        </div>\n\n      </blockquote>\n\n      <p>Run your test. Does it fail? Good! Now it’s time to fix the error.</p>\n    </li>\n    <li>\n      <p><strong>Fix the error</strong></p>\n\n      <p>Can you think of a simple way to fix the function so that our test passes?</p>\n\n      <blockquote class=\"solution\">\n        <solution-title></solution-title>\n\n        <p>One way to do it is to simply convert the input value to lowercase:</p>\n\n        <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"mi\">117</span> <span class=\"k\">def</span> <span class=\"nf\">str_as_bool</span><span class=\"p\">(</span><span class=\"n\">string</span><span class=\"p\">):</span>\n<span class=\"mi\">118</span>     <span class=\"sh\">\"\"\"</span><span class=\"s\">This is for training only.</span><span class=\"sh\">\"\"\"</span>\n<span class=\"mi\">119</span>     <span class=\"k\">if</span> <span class=\"nf\">str</span><span class=\"p\">(</span><span class=\"n\">string</span><span class=\"p\">).</span><span class=\"nf\">lower</span><span class=\"p\">()</span> <span class=\"ow\">in</span> <span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">true</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">yes</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">on</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">1</span><span class=\"sh\">\"</span><span class=\"p\">):</span>\n<span class=\"mi\">120</span>         <span class=\"k\">return</span> <span class=\"bp\">True</span>\n<span class=\"mi\">121</span>     <span class=\"k\">else</span><span class=\"p\">:</span>\n<span class=\"mi\">122</span>         <span class=\"k\">return</span> <span class=\"bp\">False</span>\n</code></pre></div>        </div>\n\n        <p>In fact, that’s exactly what the real function does! Check line 1017 - you’ll see almost the exact same function, named <code class=\"language-plaintext highlighter-rouge\">string_as_bool</code>: we didn’t modify it because that might have broken other parts of Galaxy which would have been a distraction from the core aspects of the exercise.</p>\n      </blockquote>\n\n      <p>Run the test - now it should pass!</p>\n    </li>\n    <li>\n      <p><strong>Ensure the error no longer occurs</strong></p>\n\n      <p>Now that we have the <code class=\"language-plaintext highlighter-rouge\">str_as_bool</code> function covered by test, as a bonus, we can safely do some minor refactoring: the test will prevent us from breaking things. Can you simplify the function’s code?</p>\n\n      <blockquote class=\"solution\">\n        <solution-title></solution-title>\n\n        <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"mi\">117</span> <span class=\"k\">def</span> <span class=\"nf\">str_as_bool</span><span class=\"p\">(</span><span class=\"n\">string</span><span class=\"p\">):</span>\n<span class=\"mi\">118</span>     <span class=\"sh\">\"\"\"</span><span class=\"s\"> This is for training only.</span><span class=\"sh\">\"\"\"</span>\n<span class=\"mi\">119</span>     <span class=\"k\">return</span> <span class=\"nf\">str</span><span class=\"p\">(</span><span class=\"n\">string</span><span class=\"p\">).</span><span class=\"nf\">lower</span><span class=\"p\">()</span> <span class=\"ow\">in</span> <span class=\"p\">(</span><span class=\"sh\">'</span><span class=\"s\">true</span><span class=\"sh\">'</span><span class=\"p\">,</span> <span class=\"sh\">'</span><span class=\"s\">yes</span><span class=\"sh\">'</span><span class=\"p\">,</span> <span class=\"sh\">'</span><span class=\"s\">on</span><span class=\"sh\">'</span><span class=\"p\">,</span> <span class=\"sh\">'</span><span class=\"s\">1</span><span class=\"sh\">'</span><span class=\"p\">)</span>\n</code></pre></div>        </div>\n\n        <p>Much better!</p>\n      </blockquote>\n\n      <p>Finally, head back to your local Galaxy and verify that the runtime error no longer occurs:</p>\n\n      <ol>\n        <li>Remove the <code class=\"language-plaintext highlighter-rouge\">breakpoint()</code> statement you added to <code class=\"language-plaintext highlighter-rouge\">lib/galaxy/webapps/galaxy/api/datasets.py</code>.</li>\n        <li>Start Galaxy and repeat the steps from the bug report (select “User” &gt; “Datasets”). You should see the Datasets page now - no more error message!</li>\n      </ol>\n\n      <p>Congratulations - you’ve completed the last and, possibly, most challenging section of this tutorial!</p>\n    </li>\n  </ol>\n</blockquote>\n\n<h1 id=\"conclusion\">Conclusion</h1>\n\n<p>Finally, we’re back in the Green - all tests pass!</p>\n\n<p>First of all, thank you for completing this tutorial. We hope you feel more confident debugging Galaxy code and understanding how to navigate the testing frameworks we utilize. Of course, we are always available to help answer questions and support you!</p>\n"],"ref_slides":[],"hands_on":true,"slides":false,"mod_date":"2024-05-29 15:37:52 +0000","pub_date":"2021-06-15 10:13:45 +0000","version":43,"api":"https://training.galaxyproject.org/training-material/api/topics/dev/tutorials/debugging/tutorial.json","tools":[],"supported_servers":[],"topic_name_human":"Development in Galaxy","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools: []\n","tours":false,"video":false,"slides_recordings":false,"translations":{"tutorial":[],"slides":[],"video":false},"license":"CC-BY-4.0","type":"tutorial"}