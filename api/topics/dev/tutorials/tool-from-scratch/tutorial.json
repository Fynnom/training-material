{"layout":"tutorial_hands_on","title":"Creating Galaxy tools from Conda Through Deployment","zenodo_link":"","questions":["How do you create a conda package used as a dependency in a Galaxy tool wrapper?","How do you create a Galaxy tool wrapper and all of its requirements?","How do you test a Galaxy tool wrapper after it's written?","How do you deploy a Galaxy tool wrapper?","How to do you make a Galaxy tool wrapper publicly available?"],"objectives":["Learn how to make and deploy a conda package","Understand how to write a Galaxy tool wrapper","Be able to use a tool wrapper locally","Be able to test the tool wrapper","Learn how to add tools to the Galaxy toolshed and make them available to any user"],"time_estimation":"3H","key_points":["Galaxy tools are made in 3 parts -- Conda, tool wrappers, and planemo","Anyone can write and deploy a tool wrapper!"],"subtopic":"tooldev","contributors":[{"name":"Alex Ostrovsky","email":"a.ostrovsky@mac.com","orcid":"0000-0002-7901-7109","joined":"2019-06","id":"astrovsky01","url":"https://training.galaxyproject.org/training-material/api/contributors/astrovsky01.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/astrovsky01/"},{"name":"Dave B.","joined":"2021-06","id":"davebx","url":"https://training.galaxyproject.org/training-material/api/contributors/davebx.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/davebx/"},{"name":"Matthias Bernt","joined":"2017-09","elixir_node":"de","id":"bernt-matthias","url":"https://training.galaxyproject.org/training-material/api/contributors/bernt-matthias.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/bernt-matthias/"}],"recordings":[{"captioners":["gallardoalba","astrovsky01"],"date":"2023-05-18","galaxy_version":"22.01","length":"50M","youtube_id":"QRoY1pFUY30","speakers":["gallardoalba","astrovsky01"]},{"captioners":["gallardoalba"],"date":"2022-03-11","galaxy_version":"22.01","length":"40M","youtube_id":"33L4B9ir0aQ","speakers":["gallardoalba"]},{"captioners":["davebx","astrovsky01","bernt-matthias"],"date":"2021-02-15","galaxy_version":"21.01","length":"1H40M","youtube_id":"videoseries?list=PLNFLKDpdM3B9GhA0FryVV2YX3YL35rENK","speakers":["davebx","astrovsky01","bernt-matthias"]}],"js_requirements":{"mathjax":null,"mermaid":false},"short_id":"T00117","url":"/topics/dev/tutorials/tool-from-scratch/tutorial.html","topic_name":"dev","tutorial_name":"tool-from-scratch","dir":"topics/dev/tutorials/tool-from-scratch","symlink":null,"id":"dev/tool-from-scratch","ref_tutorials":["<p>Tools wrappers allow any command line runnable code or programs to be run inside a galaxy environment.\nAlthough Galaxy has thousands of tools readily available, new software and packages will always be useful.\nThis tutorial is designed to allow anyone to create, run, and deploy new tools in a Galaxy environment.</p>\n\n<p>This tutorial is intended to instruct the reader in the full process of integrating a tool into Galaxy.\nIn three parts, it will cover the creation of a bioconda recipe for a new tool, writing a Galaxy tool\nwrapper, and finally the testing and deployment of this tool into both a local and public Galaxy environment.\nAlthough this will include specific tools, the training is generalizable.</p>\n\n<blockquote class=\"agenda\">\n  <agenda-title></agenda-title>\n\n  <p>In this tutorial, we will cover:</p>\n\n<ol id=\"markdown-toc\">\n  <li><a href=\"#galaxy-tools-and-conda\" id=\"markdown-toc-galaxy-tools-and-conda\">Galaxy Tools and Conda</a>    <ol>\n      <li><a href=\"#writing-a-bioconda-recipe\" id=\"markdown-toc-writing-a-bioconda-recipe\">Writing a Bioconda Recipe</a></li>\n      <li><a href=\"#building-the-recipe-locally\" id=\"markdown-toc-building-the-recipe-locally\">Building the recipe locally</a></li>\n      <li><a href=\"#creating-a-pull-request\" id=\"markdown-toc-creating-a-pull-request\">Creating a Pull Request</a></li>\n      <li><a href=\"#installing-a-conda-package\" id=\"markdown-toc-installing-a-conda-package\">Installing a Conda Package</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#galaxy-tool-wrappers\" id=\"markdown-toc-galaxy-tool-wrappers\">Galaxy Tool Wrappers</a>    <ol>\n      <li><a href=\"#installing-planemo\" id=\"markdown-toc-installing-planemo\">Installing Planemo</a></li>\n      <li><a href=\"#initializing-a-tool-wrapper\" id=\"markdown-toc-initializing-a-tool-wrapper\">Initializing a Tool Wrapper</a></li>\n      <li><a href=\"#galaxy-tool-wrappers-1\" id=\"markdown-toc-galaxy-tool-wrappers-1\">Galaxy Tool Wrappers</a></li>\n      <li><a href=\"#final-wrapper\" id=\"markdown-toc-final-wrapper\">Final wrapper</a></li>\n      <li><a href=\"#toolshed-file\" id=\"markdown-toc-toolshed-file\">Toolshed file</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#testing-galaxy-tool-with-planemo\" id=\"markdown-toc-testing-galaxy-tool-with-planemo\">Testing Galaxy tool with <code class=\"language-plaintext highlighter-rouge\">planemo</code></a>    <ol>\n      <li><a href=\"#using-planemo-to-lint-tools\" id=\"markdown-toc-using-planemo-to-lint-tools\">Using <code class=\"language-plaintext highlighter-rouge\">planemo</code> to lint tools</a></li>\n      <li><a href=\"#using-planemo-to-test-tools\" id=\"markdown-toc-using-planemo-to-test-tools\">Using <code class=\"language-plaintext highlighter-rouge\">planemo</code> to test tools</a></li>\n      <li><a href=\"#using-planemo-to-serve-tools\" id=\"markdown-toc-using-planemo-to-serve-tools\">Using <code class=\"language-plaintext highlighter-rouge\">planemo</code> to serve tools</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#publishing-galaxy-tools\" id=\"markdown-toc-publishing-galaxy-tools\">Publishing Galaxy tools</a>    <ol>\n      <li><a href=\"#fork-and-clone-the-github-repository\" id=\"markdown-toc-fork-and-clone-the-github-repository\">Fork and clone the github repository</a></li>\n      <li><a href=\"#create-a-pull-request-for-a-new-tool\" id=\"markdown-toc-create-a-pull-request-for-a-new-tool\">Create a pull request for a new tool</a></li>\n      <li><a href=\"#the-iuc-style-continuous-integration-workflows\" id=\"markdown-toc-the-iuc-style-continuous-integration-workflows\">The IUC style continuous integration workflows</a></li>\n      <li><a href=\"#create-your-own-iuc-style-tool-repository\" id=\"markdown-toc-create-your-own-iuc-style-tool-repository\">Create your own IUC style tool repository</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#conclusion\" id=\"markdown-toc-conclusion\">Conclusion</a></li>\n</ol>\n\n</blockquote>\n\n<h1 id=\"galaxy-tools-and-conda\">Galaxy Tools and Conda</h1>\n\n<p>Galaxy tools run within a conda environment, and are able to run any tool capable of running inside\nthat type of environment. The wrapper includes a set of conda packages available from either bioconda\nor conda forge, and retrieves them on tool installation. Sometimes this may be a single package, as\nwith many command line tools, other times, there may be several. The first part of this tutorial discusses\nthe creation and deployment of these packages, making them available for Galaxy to retrieve.</p>\n\n<h2 id=\"writing-a-bioconda-recipe\">Writing a Bioconda Recipe</h2>\n\n<p>Bioconda is a repository of conda packages for software and tools relevant to the life sciences. Using conda\npackages ensures better reproducibility, since each conda package is usually immutable, an exception being\nif it is later discovered that the software in the package had always been non-functional and should be replaced.\nRecipes should always define the following 6 sections in the <code class=\"language-plaintext highlighter-rouge\">meta.yaml</code> file:</p>\n\n<ul>\n  <li>package</li>\n  <li>source</li>\n  <li>build</li>\n  <li>requirements</li>\n  <li>test</li>\n  <li>about</li>\n</ul>\n\n<p>Let’s write a Bioconda recipe for the tool we want to package: <a href=\"https://github.com/davebx/bellerophon\">bellerophon</a></p>\n\n<blockquote class=\"warning\">\n  <warning-title>Naming collision</warning-title>\n  <p>As this tool is already packaged in Bioconda, to prevent any naming collision, we will slightly modify its name from <code class=\"language-plaintext highlighter-rouge\">bellerophon</code> to <code class=\"language-plaintext highlighter-rouge\">bellerophon_bis</code> in the recipe.\n<strong>This should never be done in real life, we only do it for this exercise!</strong></p>\n</blockquote>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Writing a Bioconda Recipe</hands-on-title>\n\n  <ol>\n    <li>\n      <p>The first thing we should do is prepare our workspace. <a href=\"https://help.github.com/articles/fork-a-repo/\">Create a fork</a> of the <a href=\"https://github.com/bioconda/bioconda-recipes/\">Bioconda repository</a> on GitHub</p>\n    </li>\n    <li>\n      <p>Clone your fork of this repository to create a local copy on your computer</p>\n    </li>\n    <li>\n      <p>We create a branch in git, a conda environment with pip and\nconda-build preinstalled, and a folder for the meta.yaml file.</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>git checkout <span class=\"nt\">-b</span> bellerophon_bioconda\nconda create <span class=\"nt\">-y</span> <span class=\"nt\">--name</span> bellerophon_bioconda pip python conda-build\nconda activate bellerophon_bioconda\n<span class=\"nb\">mkdir </span>recipes/bellerophon_bis\n</code></pre></div>        </div>\n      </blockquote>\n    </li>\n    <li>\n      <p>Next we determine the SHA-256 checksum of the source tarball.</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>wget <span class=\"nt\">-O</span> bellerophon.tar.gz https://github.com/davebx/bellerophon/archive/1.0.tar.gz\n<span class=\"nb\">sha256sum </span>bellerophon.tar.gz <span class=\"c\"># Copy the 64-character hexadecimal number that this outputs.</span>\n</code></pre></div>        </div>\n      </blockquote>\n\n      <blockquote class=\"code-out\">\n        <code-out-title></code-out-title>\n        <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>036c5e23f53ed5b612525d3a32095acca073a9c8d2bf73883deb852c89f40dcf  bellerophon.tar.gz\n</code></pre></div>        </div>\n      </blockquote>\n    </li>\n    <li>\n      <p>Using the above information, we create the meta.yaml file where we’ll then define the\nparameters that tell conda-build how to build this package, starting with variables for the name, version, and checksum.\nWith these definitions, Bioconda’s automatic version updater should recognize when a new version has been released and\ncreate a pull request to update the Bioconda package.</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>vim recipes/bellerophon_bis/meta.yaml <span class=\"c\"># vim can of course be replaced with any other editor.</span>\n</code></pre></div>        </div>\n      </blockquote>\n\n      <p>and set the following content:</p>\n\n      <div class=\"language-yaml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"pi\">{</span><span class=\"err\">%</span> <span class=\"nv\">set name = \"bellerophon_bis\" %</span><span class=\"pi\">}</span>\n<span class=\"pi\">{</span><span class=\"err\">%</span> <span class=\"nv\">set version = \"1.0\" %</span><span class=\"pi\">}</span>\n<span class=\"pi\">{</span><span class=\"err\">%</span> <span class=\"nv\">set sha256 = \"036c5e23f53ed5b612525d3a32095acca073a9c8d2bf73883deb852c89f40dcf\" %</span><span class=\"pi\">}</span>\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p>Now we define the conda package metadata. This will be shown as bellerophon_bis-1.0 in anaconda and <code class=\"language-plaintext highlighter-rouge\">conda search</code>. We\nplug in the relevant variables from the top of the file, lowering the name since conda package names should always be\nlowercase.</p>\n\n      <div class=\"language-yaml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"na\">package</span><span class=\"pi\">:</span>\n  <span class=\"na\">name</span><span class=\"pi\">:</span> <span class=\"pi\">{{</span> <span class=\"nv\">name|lower</span> <span class=\"pi\">}}</span>\n  <span class=\"na\">version</span><span class=\"pi\">:</span> <span class=\"pi\">{{</span> <span class=\"nv\">version</span> <span class=\"pi\">}}</span>\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p>Of course conda-build needs to know where to get the source code for bellerophon. Since the recipe we are creating is on\ngithub, updates can be automated with the variables we defined in the second step, while the SHA-256 checksum ensures\nthat conda-build is getting the right source code every time.</p>\n\n      <div class=\"language-yaml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"na\">source</span><span class=\"pi\">:</span>\n  <span class=\"na\">url</span><span class=\"pi\">:</span> <span class=\"s\">https://github.com/davebx/bellerophon/archive/{{ version }}.tar.gz</span>\n  <span class=\"na\">sha256</span><span class=\"pi\">:</span> <span class=\"pi\">{{</span> <span class=\"nv\">sha256</span> <span class=\"pi\">}}</span>\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p>Next, we move on to the build metadata. Since this is the first version of the conda recipe, the build number is 0.\nWe use the externally defined <code class=\"language-plaintext highlighter-rouge\">{{ PYTHON }}</code> variable, which defines which python conda-build is using, to install it\nto the build prefix. The –no-deps and –ignore-installed flags are needed to ensure that conda-build only packages\nbellerophon itself. In this section, if necessary, we can also define patches that should be applied to the source code,\nwith the <code class=\"language-plaintext highlighter-rouge\">patches:</code> token under <code class=\"language-plaintext highlighter-rouge\">build:</code>, and specify that the package should not be built for a given architecture with\nthe <code class=\"language-plaintext highlighter-rouge\">skip:</code> directive.</p>\n\n      <div class=\"language-yaml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"na\">build</span><span class=\"pi\">:</span>\n  <span class=\"na\">noarch</span><span class=\"pi\">:</span> <span class=\"s\">python</span>\n  <span class=\"na\">number</span><span class=\"pi\">:</span> <span class=\"m\">0</span>\n  <span class=\"na\">script</span><span class=\"pi\">:</span> <span class=\"pi\">{{</span> <span class=\"nv\">PYTHON</span> <span class=\"pi\">}}</span> <span class=\"s\">-m pip install . --no-deps --ignore-installed -vv</span>\n  <span class=\"c1\">#patches: /dev/null # Not used in this tutorial</span>\n  <span class=\"c1\">#skip: True [osx] # Not used in this tutorial</span>\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p>After the build metadata has been defined, we need to specify dependencies for at least building and running, with\nbuild-time dependencies specified in the <code class=\"language-plaintext highlighter-rouge\">host:</code> section, and runtime dependencies in the <code class=\"language-plaintext highlighter-rouge\">run:</code> section. With\nbellerophon, we know that it’s a python package that uses pysam to operate on SAM/BAM files, so the only runtime\ndependencies we need are python and pysam.</p>\n\n      <div class=\"language-yaml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"na\">requirements</span><span class=\"pi\">:</span>\n  <span class=\"na\">host</span><span class=\"pi\">:</span>\n    <span class=\"pi\">-</span> <span class=\"s\">python</span>\n    <span class=\"pi\">-</span> <span class=\"s\">pip</span>\n  <span class=\"na\">run</span><span class=\"pi\">:</span>\n    <span class=\"pi\">-</span> <span class=\"s\">python</span>\n    <span class=\"pi\">-</span> <span class=\"s\">pysam</span>\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p>No recipe is complete without tests, and this recipe is no exception. Normally, it’s sufficient to confirm that the\nprogram actually runs, e.g. with a <code class=\"language-plaintext highlighter-rouge\">--version</code> command. Some software also has a self-test flag or parameter, though\nbellerophon is not among them, and we could even define a test script that uses test data either from the recipe or from\nthe source archive.</p>\n\n      <div class=\"language-yaml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"na\">test</span><span class=\"pi\">:</span>\n  <span class=\"na\">commands</span><span class=\"pi\">:</span>\n    <span class=\"pi\">-</span> <span class=\"s\">bellerophon --version</span>\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p>Finally, we add information about the software, such as code’s is license type, the program’s\nhomepage, and optionally the github username of the person responsible for maintaining the recipe.</p>\n\n      <div class=\"language-yaml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"na\">about</span><span class=\"pi\">:</span>\n  <span class=\"na\">home</span><span class=\"pi\">:</span> <span class=\"s\">https://github.com/davebx/bellerophon/</span>\n  <span class=\"na\">license</span><span class=\"pi\">:</span> <span class=\"s\">MIT</span>\n  <span class=\"na\">license_file</span><span class=\"pi\">:</span> <span class=\"s\">LICENSE</span>\n  <span class=\"na\">summary</span><span class=\"pi\">:</span> <span class=\"s2\">\"</span><span class=\"s\">Filter</span><span class=\"nv\"> </span><span class=\"s\">reads</span><span class=\"nv\"> </span><span class=\"s\">that</span><span class=\"nv\"> </span><span class=\"s\">span</span><span class=\"nv\"> </span><span class=\"s\">a</span><span class=\"nv\"> </span><span class=\"s\">mapping</span><span class=\"nv\"> </span><span class=\"s\">junction,</span><span class=\"nv\"> </span><span class=\"s\">retaining</span><span class=\"nv\"> </span><span class=\"s\">the</span><span class=\"nv\"> </span><span class=\"s\">5'-side.\"</span>\n  <span class=\"na\">maintainer</span><span class=\"pi\">:</span> <span class=\"s\">davebx</span> <span class=\"c1\"># Optional</span>\n</code></pre></div>      </div>\n    </li>\n  </ol>\n\n  <p>Putting all these parts together, we end up with a complete conda recipe for version 1.0 of bellerophon.</p>\n\n  <blockquote class=\"question\">\n    <question-title></question-title>\n\n    <p>What does your final file look like?</p>\n\n    <blockquote class=\"solution\">\n      <solution-title></solution-title>\n\n      <div class=\"language-yaml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"pi\">{</span><span class=\"err\">%</span> <span class=\"nv\">set name = \"bellerophon_bis\" %</span><span class=\"pi\">}</span>\n<span class=\"pi\">{</span><span class=\"err\">%</span> <span class=\"nv\">set version = \"1.0\" %</span><span class=\"pi\">}</span>\n<span class=\"pi\">{</span><span class=\"err\">%</span> <span class=\"nv\">set sha256 = \"036c5e23f53ed5b612525d3a32095acca073a9c8d2bf73883deb852c89f40dcf\" %</span><span class=\"pi\">}</span>\n\n<span class=\"na\">package</span><span class=\"pi\">:</span>\n  <span class=\"na\">name</span><span class=\"pi\">:</span> <span class=\"pi\">{{</span> <span class=\"nv\">name|lower</span> <span class=\"pi\">}}</span>\n  <span class=\"na\">version</span><span class=\"pi\">:</span> <span class=\"pi\">{{</span> <span class=\"nv\">version</span> <span class=\"pi\">}}</span>\n\n<span class=\"na\">source</span><span class=\"pi\">:</span>\n  <span class=\"na\">url</span><span class=\"pi\">:</span> <span class=\"s\">https://github.com/davebx/bellerophon/archive/{{ version }}.tar.gz</span>\n  <span class=\"na\">sha256</span><span class=\"pi\">:</span> <span class=\"pi\">{{</span> <span class=\"nv\">sha256</span> <span class=\"pi\">}}</span>\n\n<span class=\"na\">build</span><span class=\"pi\">:</span>\n  <span class=\"na\">noarch</span><span class=\"pi\">:</span> <span class=\"s\">python</span>\n  <span class=\"na\">number</span><span class=\"pi\">:</span> <span class=\"m\">0</span>\n  <span class=\"na\">script</span><span class=\"pi\">:</span> <span class=\"pi\">{{</span> <span class=\"nv\">PYTHON</span> <span class=\"pi\">}}</span> <span class=\"s\">-m pip install . --no-deps --ignore-installed -vv</span>\n\n<span class=\"na\">requirements</span><span class=\"pi\">:</span>\n  <span class=\"na\">host</span><span class=\"pi\">:</span>\n    <span class=\"pi\">-</span> <span class=\"s\">python</span>\n    <span class=\"pi\">-</span> <span class=\"s\">pip</span>\n  <span class=\"na\">run</span><span class=\"pi\">:</span>\n    <span class=\"pi\">-</span> <span class=\"s\">python</span>\n    <span class=\"pi\">-</span> <span class=\"s\">pysam</span>\n\n<span class=\"na\">test</span><span class=\"pi\">:</span>\n  <span class=\"na\">commands</span><span class=\"pi\">:</span>\n    <span class=\"pi\">-</span> <span class=\"s\">bellerophon --version</span>\n\n<span class=\"na\">about</span><span class=\"pi\">:</span>\n  <span class=\"na\">home</span><span class=\"pi\">:</span> <span class=\"s\">https://github.com/davebx/bellerophon/</span>\n  <span class=\"na\">license</span><span class=\"pi\">:</span> <span class=\"s\">MIT</span>\n  <span class=\"na\">license_file</span><span class=\"pi\">:</span> <span class=\"s\">LICENSE</span>\n  <span class=\"na\">summary</span><span class=\"pi\">:</span> <span class=\"s2\">\"</span><span class=\"s\">Filter</span><span class=\"nv\"> </span><span class=\"s\">reads</span><span class=\"nv\"> </span><span class=\"s\">that</span><span class=\"nv\"> </span><span class=\"s\">span</span><span class=\"nv\"> </span><span class=\"s\">a</span><span class=\"nv\"> </span><span class=\"s\">mapping</span><span class=\"nv\"> </span><span class=\"s\">junction,</span><span class=\"nv\"> </span><span class=\"s\">retaining</span><span class=\"nv\"> </span><span class=\"s\">the</span><span class=\"nv\"> </span><span class=\"s\">5'-side.\"</span>\n\n</code></pre></div>      </div>\n\n    </blockquote>\n  </blockquote>\n</blockquote>\n\n<blockquote class=\"comment\">\n  <comment-title>Using build.sh</comment-title>\n\n  <p>In this recipe, the command to execute for installing the package is very short, that’s why we write it directly in the <code class=\"language-plaintext highlighter-rouge\">meta.yaml</code> file. When you need to run more complex commands (like compilation steps), it is preferable to remove the <code class=\"language-plaintext highlighter-rouge\">build &gt; script</code> entry in the <code class=\"language-plaintext highlighter-rouge\">meta.yaml</code> file, and write all the commands in a script named <code class=\"language-plaintext highlighter-rouge\">build.sh</code> in the same directory.</p>\n\n</blockquote>\n\n<h2 id=\"building-the-recipe-locally\">Building the recipe locally</h2>\n\n<p>Now that your recipe is written, you can try to build it locally.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Building the recipe locally</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Run conda-build</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>conda build recipes/bellerophon_bis\n</code></pre></div>        </div>\n      </blockquote>\n    </li>\n    <li>\n      <p>Conda build will try to build the recipe locally and will run the the test to check if the package was successfully built.\nAt the end, you should see something like this:</p>\n\n      <blockquote class=\"code-out\">\n        <code-out-title></code-out-title>\n\n        <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>TEST END: /home/abretaud/miniconda3/conda-bld/noarch/bellerophon-1.0-py_0.tar.bz2\nRenaming work directory [...]\n# Automatic uploading is disabled\n# If you want to upload package(s) to anaconda.org later, type:\n\n# To have conda build upload to anaconda.org automatically, use\n# conda config --set anaconda_upload yes\nanaconda upload \\\n   /home/xxxxx/miniconda3/conda-bld/noarch/bellerophon_bis-1.0-py_0.tar.bz2\nanaconda_upload is not set.  Not uploading wheels: []\n</code></pre></div>        </div>\n      </blockquote>\n    </li>\n    <li>\n      <p>In this example, the build was successful, and the resulting package is placed in <code class=\"language-plaintext highlighter-rouge\">/home/xxxxx/miniconda3/conda-bld/noarch/bellerophon_bis-1.0-py_0.tar.bz2</code>. This is the file that gets uploaded to the bioconda channel when you create a Pull Request on the Bioconda GitHub repository.</p>\n    </li>\n  </ol>\n</blockquote>\n\n<blockquote class=\"comment\">\n  <comment-title>Note on building locally</comment-title>\n\n  <p>While building locally is a quick way to check if a recipe is working, it’s not the most reliable way.\nThat’s because the build is occurring directly on your system, which means you might get interference between the conda requirements in the recipe and your system-wide installed libraries and system configuration.\nThe automatic testing of your recipe on GitHub when you create a Pull Request is more reliable as it is performed in a controlled and isolated environment.</p>\n\n</blockquote>\n\n<h2 id=\"creating-a-pull-request\">Creating a Pull Request</h2>\n\n<p>After the recipe is complete, and when we have checked that it builds locally, we can commit and push to our fork, so that the recipe can eventually be integrated into Bioconda.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Creating the PR</hands-on-title>\n\n  <ol>\n    <li>\n      <p>We start by making sure we’re on a branch, and that <code class=\"language-plaintext highlighter-rouge\">recipes/bellerophon/meta.yaml</code> is the only modified file.</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>git status\n</code></pre></div>        </div>\n      </blockquote>\n\n      <blockquote class=\"code-out\">\n        <code-out-title></code-out-title>\n\n        <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>On branch bellerophon_bioconda\nUntracked files:\n  (use \"git add &lt;file&gt;...\" to include in what will be committed)\n\n\trecipes/bellerophon_bis/\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")\n</code></pre></div>        </div>\n      </blockquote>\n    </li>\n    <li>\n      <p>Add your recipes folder, commit, and push it.</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>git add recipes/bellerophon_bis\ngit commit <span class=\"nt\">-m</span> <span class=\"s1\">'Add recipe for bellerophon 1.0'</span>\ngit push origin <span class=\"nt\">-u</span> bellerophon_bioconda\n</code></pre></div>        </div>\n      </blockquote>\n\n      <p>Git will give you a url for creating the pull request, which can be clicked to be taken to github.</p>\n\n      <blockquote class=\"code-out\">\n        <code-out-title></code-out-title>\n        <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>git push origin <span class=\"nt\">-u</span> bellerophon_bioconda\nTotal 0 <span class=\"o\">(</span>delta 0<span class=\"o\">)</span>, reused 0 <span class=\"o\">(</span>delta 0<span class=\"o\">)</span>\nremote:\nremote: Create a pull request <span class=\"k\">for</span> <span class=\"s1\">'bellerophon_bioconda'</span> on GitHub by visiting:\nremote:      https://github.com/davebx/bioconda-recipes/pull/new/bellerophon_bioconda\nremote:\nTo ssh://github.com/davebx/bioconda-recipes.git\n <span class=\"k\">*</span> <span class=\"o\">[</span>new branch]      bellerophon_bioconda -&gt; bellerophon_bioconda\nBranch bellerophon_bioconda <span class=\"nb\">set </span>up to track remote branch bellerophon_bioconda from origin.\n</code></pre></div>        </div>\n      </blockquote>\n    </li>\n  </ol>\n\n  <blockquote class=\"warning\">\n    <warning-title>Don't create the Pull request for real!</warning-title>\n\n    <p>You can click on the link to see the diff of what would be included in the Pull Request, and how the form looks like. But please don’t click on the <code class=\"language-plaintext highlighter-rouge\">Create pull request</code> button! We don’t want to get duplicate versions of this recipe integrated in bioconda everytime someone follows this tutorial!</p>\n\n  </blockquote>\n\n  <p>Once on the github pull request page, you see a preview of the changes we propose, and you can write a short description of the recipe we want to merge. Have a look at the guidelines in the text box to understand how to properly fill the form, and get your Pull Request merged in the end. In real life, when creating a real new recipe, you would then click the <code class=\"language-plaintext highlighter-rouge\">Create pull request</code> button.</p>\n\n  <figure id=\"figure-1\" style=\"max-width: 90%;\"><img src=\"../../images/create_pr.png\" alt=\"Github PR. \" width=\"927\" height=\"612\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/create_pr.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 1</strong>:</span> An open pull request for the bellerophon conda recipe</figcaption></figure>\n</blockquote>\n\n<h2 id=\"installing-a-conda-package\">Installing a Conda Package</h2>\n\n<p>Once our new recipe has been merged, installing the package should be fairly painless. Galaxy, if configured to do so,\nwill automatically install any conda dependencies a tool asks for, whereas manual installation can be as easy as using\nthe <code class=\"language-plaintext highlighter-rouge\">conda create</code> command to install python, bellerophon, and pysam into a conda environment named <code class=\"language-plaintext highlighter-rouge\">bellerophon</code>. The\n<code class=\"language-plaintext highlighter-rouge\">-y</code> flag tells conda not to ask for confirmation before installing the software and its dependencies into the named\nenvironment.</p>\n\n<div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>conda create <span class=\"nt\">-y</span> <span class=\"nt\">--name</span> bellerophon <span class=\"nv\">bellerophon</span><span class=\"o\">=</span>1.0 <span class=\"nt\">-c</span> conda-forge <span class=\"nt\">-c</span> bioconda\n</code></pre></div></div>\n\n<h1 id=\"galaxy-tool-wrappers\">Galaxy Tool Wrappers</h1>\n\n<p>Galaxy tool wrappers convert the available command line inputs and parameters of a given tool into a grapical\nuser interface, then translate the user’s selections back into the command to be run. This section will focus\non writing a wrapper. Although this section will cover the full process and many of the options available to\nanyone wrapping a tool, a more complete list is available in <a href=\"https://docs.galaxyproject.org/en/latest/dev/schema.html\">the Galaxy tool docs</a>.</p>\n\n<h2 id=\"installing-planemo\">Installing Planemo</h2>\n\n<p>Planemo is an important tool within the Galaxy development workflow. Although it will be covered in greater detail in the\nnext section of this tutorial, one of its functions is necessary for the tool wrapper development. <code class=\"language-plaintext highlighter-rouge\">planemo</code> is available\nvia the python package manager <code class=\"language-plaintext highlighter-rouge\">pip</code>. To that end, before beginning this section, please install <code class=\"language-plaintext highlighter-rouge\">planemo</code> locally by running\n<code class=\"language-plaintext highlighter-rouge\">planemo</code>. To that end, before beginning this section, please install planemo locally by running</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Installing `planemo` via pip</hands-on-title>\n\n  <p>It is advised to install <code class=\"language-plaintext highlighter-rouge\">planemo</code> in a virtual environment (step 1-2).</p>\n\n  <ol>\n    <li>Create a virtual environment: <code class=\"language-plaintext highlighter-rouge\">virtualenv -p python3 ~/.venv/</code>. Here <code class=\"language-plaintext highlighter-rouge\">~/.venv/</code> is the path where the virtual environment should be crated and you may adapt the path to your needs. With <code class=\"language-plaintext highlighter-rouge\">-p python3</code> we make sure that a <code class=\"language-plaintext highlighter-rouge\">python</code> intepreter version 3 is used.</li>\n    <li>Activate the virtual environment: <code class=\"language-plaintext highlighter-rouge\">. ~/.venv/bin/activate</code></li>\n    <li>Install <code class=\"language-plaintext highlighter-rouge\">planemo</code> <code class=\"language-plaintext highlighter-rouge\">pip install planemo</code></li>\n  </ol>\n</blockquote>\n\n<p>Note that for using <code class=\"language-plaintext highlighter-rouge\">planemo</code>from a new shell you will need to activate the python virtual environment again.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Testing `planemo` and getting help</hands-on-title>\n\n  <ol>\n    <li>\n      <p>In order to test if the installation worked execute</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Input: Bash</code-in-title>\n        <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>planemo <span class=\"nt\">--version</span>\n</code></pre></div>        </div>\n      </blockquote>\n\n      <blockquote class=\"code-out\">\n        <code-in-title>Output</code-in-title>\n        <p>This should output the version of <code class=\"language-plaintext highlighter-rouge\">planemo</code>, e.g.</p>\n        <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>planemo, version 0.74.3\n</code></pre></div>        </div>\n      </blockquote>\n    </li>\n    <li><code class=\"language-plaintext highlighter-rouge\">planemo --help</code> will show the available commands with a short desctiption (lint, test, and serve will be part of this tutorial)</li>\n    <li><code class=\"language-plaintext highlighter-rouge\">planemo SUBCOMMAND --help</code> will show the usage information for the corresponding subcommand. Try to obtain the information for the <code class=\"language-plaintext highlighter-rouge\">lint</code> subcommand.</li>\n  </ol>\n</blockquote>\n\n<h2 id=\"initializing-a-tool-wrapper\">Initializing a Tool Wrapper</h2>\n\n<p>Initializing a tool wrapper to be run in Galaxy is simple</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Creating a Tool Wrapper Skeleton</hands-on-title>\n  <ol>\n    <li>Go to the “tools” directory in your Galaxy instance.</li>\n    <li>Make a new directory for tools you will be wrapping.</li>\n    <li>Use <code class=\"language-plaintext highlighter-rouge\">planemo</code> to initialize a new tool wrapper with basic formatting.\n      <ul>\n        <li>Here we will be using bellerophon, but the parameters can be set for any tool.</li>\n        <li>The tool ID is the internal reference id for the tool, and may contain no spaces or capitalized letters</li>\n        <li>The tool name is the text that will be visible to the user.</li>\n      </ul>\n\n      <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> <span class=\"nb\">cd </span>galaxy/tools\n <span class=\"nb\">mkdir</span> <span class=\"nt\">-p</span> myTools/bellerophon\n <span class=\"nb\">cd </span>myTools/bellerophon\n planemo tool_init <span class=\"nt\">--id</span> bellerophon <span class=\"nt\">--name</span> bellerophon\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p>You can now open the new xml file that has been generated to begin the wrapping. It should look something like this:</p>\n\n      <div class=\"language-xml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nt\">&lt;tool</span> <span class=\"na\">id=</span><span class=\"s\">\"bellerophon\"</span> <span class=\"na\">name=</span><span class=\"s\">\"bellerophon\"</span> <span class=\"na\">version=</span><span class=\"s\">\"0.1.0\"</span> <span class=\"na\">python_template_version=</span><span class=\"s\">\"3.5\"</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;requirements&gt;</span>\n    <span class=\"nt\">&lt;/requirements&gt;</span>\n    <span class=\"nt\">&lt;command</span> <span class=\"na\">detect_errors=</span><span class=\"s\">\"exit_code\"</span><span class=\"nt\">&gt;</span><span class=\"cp\">&lt;![CDATA[\n        TODO: Fill in command template.\n    ]]&gt;</span><span class=\"nt\">&lt;/command&gt;</span>\n    <span class=\"nt\">&lt;inputs&gt;</span>\n    <span class=\"nt\">&lt;/inputs&gt;</span>\n    <span class=\"nt\">&lt;outputs&gt;</span>\n    <span class=\"nt\">&lt;/outputs&gt;</span>\n    <span class=\"nt\">&lt;help&gt;</span><span class=\"cp\">&lt;![CDATA[\n        TODO: Fill in help.\n    ]]&gt;</span><span class=\"nt\">&lt;/help&gt;</span>\n<span class=\"nt\">&lt;/tool&gt;</span>\n</code></pre></div>      </div>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h2 id=\"galaxy-tool-wrappers-1\">Galaxy Tool Wrappers</h2>\n\n<p>Galaxy tool wrapper xml files are made up of several sections:</p>\n\n<ul>\n  <li>Tool</li>\n  <li>Description</li>\n  <li>Requirements</li>\n  <li>Macros</li>\n  <li>Command</li>\n  <li>Inputs</li>\n  <li>Outputs</li>\n  <li>Tests</li>\n  <li>Citations</li>\n  <li>Help</li>\n</ul>\n\n<p>While many of those are present in the wrapper by default, others need to be added.</p>\n\n<h3 id=\"tool-section\">Tool section</h3>\n\n<p>The tool section at the head of the file defines several key pieces of information for both the user and Galaxy.\nThe tool ID and name are defined here as well as which minimum version of Galaxy is required to run it.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Defining the tool section:</hands-on-title>\n  <p>For this section, the following is necessary:</p>\n\n  <ul>\n    <li>Tool ID</li>\n    <li>Tool name</li>\n    <li>Version (Version of the Galaxy wrapper)\n      <ul>\n        <li>This is set as <code class=\"language-plaintext highlighter-rouge\">'&lt;Conda wrapper version&gt;'+'galaxy&lt;galaxy wrapper version&gt;'</code></li>\n      </ul>\n    </li>\n    <li>Profile\n      <ul>\n        <li>This is the minimum version of Galaxy required to run the tool</li>\n      </ul>\n    </li>\n    <li>Unset python_template version</li>\n  </ul>\n\n  <p>when complete, the line should appear as follows:</p>\n\n  <div class=\"language-xml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nt\">&lt;tool</span> <span class=\"na\">id=</span><span class=\"s\">\"bellerophon\"</span> <span class=\"na\">name=</span><span class=\"s\">\"bellerophon\"</span> <span class=\"na\">version=</span><span class=\"s\">\"@TOOL_VERSION@+galaxy@VERSION_SUFFIX@\"</span> <span class=\"na\">profile=</span><span class=\"s\">\"20.01\"</span><span class=\"nt\">&gt;</span>\n</code></pre></div>  </div>\n</blockquote>\n\n<p>The @TOOL_VERSION@ and @VERSION_SUFFIX@ are what are referred to as “tokens”, and will be furter discussed in the “Macros” section.</p>\n\n<h3 id=\"description-section\">Description section</h3>\n\n<p>This section adds help text to easily identify the tool. It is not intended as in-depth help, which should be in the <code class=\"language-plaintext highlighter-rouge\">help</code> section.\nThe description is simply presented as plaintext between the tags. Bellerophon’s would look like this:</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Adding a description</hands-on-title>\n  <p>Add the following description to your tool</p>\n  <div class=\"language-xml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nt\">&lt;description&gt;</span>chimeric reads from Arima Genomics<span class=\"nt\">&lt;/description&gt;</span>\n</code></pre></div>  </div>\n</blockquote>\n\n<p>Which would present the tool’s in the toolbar and at the top of the tool form as</p>\n\n<pre><code class=\"language-txt\">bellerophon: chimeric reads from Arima Genomics\n</code></pre>\n\n<h3 id=\"macros-section\">Macros section</h3>\n\n<p>The macros section serves two functions – to create meta-variables for inside both the xml text and the command text, called\ntokens, and xml sections that can be slotted in repeatedly. In this section we will only use tokens, but xml macros are very\nuseful for tools which have multiple options/modes that reuse parameters. We will use a simple xml macro in the following section.</p>\n\n<p>The @TOOL_VERSION@ and @VERSION_SUFFIX@ used in the Tool line are defined here. Each need their own ‘token’ line, resulting in</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Macros</hands-on-title>\n  <p>Add the following macros section to your tool:</p>\n  <div class=\"language-xml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nt\">&lt;macros&gt;</span>\n    <span class=\"nt\">&lt;token</span> <span class=\"na\">name=</span><span class=\"s\">\"@TOOL_VERSION@\"</span><span class=\"nt\">&gt;</span>1.0<span class=\"nt\">&lt;/token&gt;</span>\n    <span class=\"nt\">&lt;token</span> <span class=\"na\">name=</span><span class=\"s\">\"@VERSION_SUFFIX@\"</span><span class=\"nt\">&gt;</span>0<span class=\"nt\">&lt;/token&gt;</span>\n<span class=\"nt\">&lt;/macros&gt;</span>\n</code></pre></div>  </div>\n</blockquote>\n\n<p>This will cause the version string at the beginning to read “1.0+galaxy0”, and set the conda package that is pulled to be bellerophon version 1.0.\nAs versions are incremented, this will change. Any updates to the galaxy wrapper should iterate <code class=\"language-plaintext highlighter-rouge\">@VERSION_SUFFIX@</code>, while any changes to the version\nof the requirement would change the value for <code class=\"language-plaintext highlighter-rouge\">@TOOL_VERSION@</code> (and reset the <code class=\"language-plaintext highlighter-rouge\">@VERSION_SUFFIX@</code> to 0).</p>\n\n<p>A basic example of the xml macros would look like this</p>\n\n<div class=\"language-xml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nt\">&lt;macros&gt;</span>\n    <span class=\"nt\">&lt;xml</span> <span class=\"na\">name=</span><span class=\"s\">\"example_parameter\"</span><span class=\"nt\">&gt;</span>\n        <span class=\"nt\">&lt;param</span> <span class=\"na\">name=</span><span class=\"s\">\"ex_1\"</span> <span class=\"na\">type=</span><span class=\"s\">\"integer\"</span> <span class=\"na\">label=</span><span class=\"s\">\"Example help text\"</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;param</span> <span class=\"na\">name=</span><span class=\"s\">\"ex_2\"</span> <span class=\"na\">type=</span><span class=\"s\">\"text\"</span> <span class=\"na\">label=</span><span class=\"s\">\"Example help text\"</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/xml&gt;</span>\n<span class=\"nt\">&lt;/macros&gt;</span>\n</code></pre></div></div>\n\n<p>One would then use that macro at any point in the xml it is relevant using the <code class=\"language-plaintext highlighter-rouge\">&lt;expand/&gt;</code> tag like so:</p>\n\n<div class=\"language-xml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nt\">&lt;expand</span> <span class=\"na\">macro=</span><span class=\"s\">\"example_parameter\"</span> <span class=\"nt\">/&gt;</span>\n</code></pre></div></div>\n\n<p>This would add both of the <code class=\"language-plaintext highlighter-rouge\">&lt;param/&gt;</code> tags at that location. Though inputs are used as an example macro here, any tag or group of tags can be made into a macro.</p>\n\n<h3 id=\"biotools-id\">Bio.tools ID</h3>\n\n<p>We will now add a useful macro entry. With the Galaxy ecosystem is becoming more reliant on metadata, a bio.tools ID can help Galaxy to pull standardized metadata for your tool. This enables users to find and use the tool more easily from across the web, so we highly recommend setting a bio.tools identifier. If an entry already exists on <a href=\"https://bio.tools\">https://bio.tools</a>, it’s a simple task.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Setting a bio.tools ID:</hands-on-title>\n\n  <p>If we go to <a href=\"https://bio.tools\">https://bio.tools</a> and search “Bellerophon”, we find that it already has a bio.tools entry:</p>\n\n  <p><a href=\"../../images/biotools-profile.png\" rel=\"noopener noreferrer\"><img src=\"../../images/biotools-profile.png\" alt=\"Bellerophon bio.tools webpage. \" width=\"610\" height=\"274\" loading=\"lazy\" /></a></p>\n\n  <p>We just have to add the biotools ID as a <code class=\"language-plaintext highlighter-rouge\">&lt;macro&gt;</code> tag.</p>\n\n  <p>Let’s create a macro xml file next to our tool xml: <code class=\"language-plaintext highlighter-rouge\">bellerophon_macros.xml</code></p>\n\n  <div class=\"language-xml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nt\">&lt;macros&gt;</span>\n  <span class=\"nt\">&lt;xml</span> <span class=\"na\">name=</span><span class=\"s\">\"bio_tools\"</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;xrefs&gt;</span>\n        <span class=\"nt\">&lt;xref</span> <span class=\"na\">type=</span><span class=\"s\">\"bio.tools\"</span><span class=\"nt\">&gt;</span>Bellerophon<span class=\"nt\">&lt;/xref&gt;</span>\n    <span class=\"nt\">&lt;/xrefs&gt;</span>\n  <span class=\"nt\">&lt;/xml&gt;</span>\n<span class=\"nt\">&lt;/macros&gt;</span>\n</code></pre></div>  </div>\n\n  <p>Now we can expand the <code class=\"language-plaintext highlighter-rouge\">bio_tools</code> macro in our tool XML, beneath the tokens:</p>\n\n  <div class=\"language-xml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nt\">&lt;macros&gt;</span>\n    <span class=\"nt\">&lt;token</span> <span class=\"na\">name=</span><span class=\"s\">\"@TOOL_VERSION@\"</span><span class=\"nt\">&gt;</span>1.0<span class=\"nt\">&lt;/token&gt;</span>\n    <span class=\"nt\">&lt;token</span> <span class=\"na\">name=</span><span class=\"s\">\"@VERSION_SUFFIX@\"</span><span class=\"nt\">&gt;</span>0<span class=\"nt\">&lt;/token&gt;</span>\n<span class=\"nt\">&lt;/macros&gt;</span>\n\n<span class=\"nt\">&lt;import&gt;</span>bellerophon_macros.xml<span class=\"nt\">&lt;/import&gt;</span>\n<span class=\"nt\">&lt;expand</span> <span class=\"na\">macro=</span><span class=\"s\">\"bio_tools\"</span><span class=\"nt\">/&gt;</span>\n\n</code></pre></div>  </div>\n\n  <p>If your tool does not yet have an entry in bio.tools, we highly encourage you to create one!\nIt takes just 5 minutes to register with bio.tools to start contributing towards this global registry of computational resources.</p>\n\n</blockquote>\n\n<h3 id=\"requirements-section\">Requirements section</h3>\n\n<p>The requirement section is where conda packages and docker/singularity containers are set. As this is a very basic tutorial,\nthe container requirements will not be discussed here.</p>\n\n<p>For each conda package added to the environment in which the tool will run, a <code class=\"language-plaintext highlighter-rouge\">&lt;requirement/&gt;</code> tag needs to be included in the <code class=\"language-plaintext highlighter-rouge\">&lt;requirements/&gt;</code> section.\nThis specifies the</p>\n\n<ul>\n  <li>Bioconda or Conda Forge package ID\n    <ul>\n      <li>This is set as plain text betweeh the <code class=\"language-plaintext highlighter-rouge\">&lt;requirement/&gt;</code> tags</li>\n    </ul>\n  </li>\n  <li>Specific Bioconda/Conda Forge package version\n    <ul>\n      <li>This does not have to be the most recent version</li>\n    </ul>\n  </li>\n</ul>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Adding requirements</hands-on-title>\n  <p>In the case of bellerophon, which requires two dependencies, bellerophon and samtools, the requirements section appears like so. Add them to your tool XML.</p>\n\n  <div class=\"language-xml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>  <span class=\"nt\">&lt;requirements&gt;</span>\n        <span class=\"nt\">&lt;requirement</span> <span class=\"na\">type=</span><span class=\"s\">\"package\"</span> <span class=\"na\">version=</span><span class=\"s\">\"@TOOL_VERSION@\"</span><span class=\"nt\">&gt;</span>bellerophon<span class=\"nt\">&lt;/requirement&gt;</span>\n        <span class=\"nt\">&lt;requirement</span> <span class=\"na\">type=</span><span class=\"s\">\"package\"</span> <span class=\"na\">version=</span><span class=\"s\">\"1.12\"</span><span class=\"nt\">&gt;</span>samtools<span class=\"nt\">&lt;/requirement&gt;</span>\n  <span class=\"nt\">&lt;/requirements&gt;</span>\n</code></pre></div>  </div>\n</blockquote>\n\n<p>This uses the macro token for @TOOL_VERSION@ for the Bioconda package version to retrieve the version number for bellerophon, while samtools’ version is set manually.</p>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <p>If you wanted to add a requirement for the Seurat package of version 3.2, what would that look like?</p>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <div class=\"language-xml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>  <span class=\"nt\">&lt;requirements&gt;</span>\n        <span class=\"nt\">&lt;requirement</span> <span class=\"na\">type=</span><span class=\"s\">\"package\"</span> <span class=\"na\">version=</span><span class=\"s\">\"3.2\"</span><span class=\"nt\">&gt;</span>seurat<span class=\"nt\">&lt;/requirement&gt;</span>\n  <span class=\"nt\">&lt;/requirements&gt;</span>\n</code></pre></div>    </div>\n\n  </blockquote>\n</blockquote>\n\n<h3 id=\"input-section\">Input section</h3>\n\n<p>Although the next section in the tool script is actually be the command section, the input section will be discussed first, as it sets variables that are used in the command.\nThe input section has three possible xml tags at the highest level – <code class=\"language-plaintext highlighter-rouge\">&lt;conditional/&gt;</code>, ` &lt;section/&gt;<code class=\"language-plaintext highlighter-rouge\">, and </code><param />`. Param will set any variable, conditional allows different available\nparameters based on previous selections, and section simply breaks up the GUI into multiple parts that can be viewed or hidden at the user’s discression.</p>\n\n<h4 id=\"param\"><em>Param</em></h4>\n\n<p>The param tag sets the value of variables, and has several attributes associated with it:</p>\n\n<ul>\n  <li>Name\n    <ul>\n      <li>The name of the variable to be used in the command. Cannot include spaces.</li>\n    </ul>\n  </li>\n  <li>Argument\n    <ul>\n      <li>The actual flag being set in the tool. If the name and the flag is the same as what the name attribute would be, only Argument needs to be set.</li>\n    </ul>\n  </li>\n  <li>Label\n    <ul>\n      <li>The name of the parameter as shown to the user. Can include spaces.</li>\n    </ul>\n  </li>\n  <li>Type\n    <ul>\n      <li>Sets the variable type. Available options are:\n        <ul>\n          <li>Text\n            <ul>\n              <li>A string input with a built-in sanitizer.</li>\n            </ul>\n          </li>\n          <li>Integer\n            <ul>\n              <li>Also allows for a minimum and maximum value to be set.</li>\n            </ul>\n          </li>\n          <li>Float\n            <ul>\n              <li>Like integer, also allows for a minimum and maximum value to be set.</li>\n            </ul>\n          </li>\n          <li>Select\n            <ul>\n              <li>Allows the user to choose from a pre-set list of options.</li>\n            </ul>\n          </li>\n          <li>Boolean\n            <ul>\n              <li>Allows the user to select between two options, not simply True or False.</li>\n            </ul>\n          </li>\n          <li>Data\n            <ul>\n              <li>Input file, with required file format specified.</li>\n            </ul>\n          </li>\n        </ul>\n      </li>\n    </ul>\n  </li>\n  <li>Help\n    <ul>\n      <li>Help text shown below the input for the parameter (optional).</li>\n    </ul>\n  </li>\n  <li>Optional\n    <ul>\n      <li>Boolean flag that allows the user to leave the parameter blank to either use the default value or to not use the parameter at all (optional).</li>\n    </ul>\n  </li>\n</ul>\n\n<h4 id=\"conditional\"><em>Conditional</em></h4>\n\n<p>Conditionals are used alongside param tags to change available options based on what has been selected and is used with select-type params. Writing\nconditionals, then, is a three-tag or four-tag process – the <code class=\"language-plaintext highlighter-rouge\">&lt;conditional/&gt;</code> tag, the <code class=\"language-plaintext highlighter-rouge\">&lt;param/&gt;</code> of select type, and the <code class=\"language-plaintext highlighter-rouge\">&lt;when/&gt;</code> tag,\nused to specify the new paramaters available only on the selection of certain options. The param is of type “select”, a tag <code class=\"language-plaintext highlighter-rouge\">&lt;option/&gt;</code> is used to specify\neach possible value. A very generic select-type conditional might look like this:</p>\n\n<div class=\"language-xml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nt\">&lt;conditional</span> <span class=\"na\">name=</span><span class=\"s\">\"example_conditional\"</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;param</span> <span class=\"na\">name=</span><span class=\"s\">\"example_select\"</span> <span class=\"na\">label=</span><span class=\"s\">\"Example Select\"</span> <span class=\"na\">type=</span><span class=\"s\">\"select\"</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;option</span> <span class=\"na\">value=</span><span class=\"s\">\"ex1\"</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;option</span> <span class=\"na\">value=</span><span class=\"s\">\"ex2\"</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/param&gt;</span>\n    <span class=\"nt\">&lt;when</span> <span class=\"na\">value=</span><span class=\"s\">\"ex1\"</span><span class=\"nt\">&gt;</span>\n        <span class=\"nt\">&lt;param</span> <span class=\"na\">name=</span><span class=\"s\">\"example_input\"</span> <span class=\"na\">label=</span><span class=\"s\">\"Example input\"</span> <span class=\"na\">type=</span><span class=\"s\">\"integer\"</span> <span class=\"na\">min=</span><span class=\"s\">\"0\"</span> <span class=\"na\">help=</span><span class=\"s\">\"Example help text\"</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/when&gt;</span>\n    <span class=\"nt\">&lt;when</span> <span class=\"na\">value=</span><span class=\"s\">\"ex2\"</span><span class=\"nt\">&gt;</span>\n        <span class=\"nt\">&lt;param</span> <span class=\"na\">name=</span><span class=\"s\">\"example_input2\"</span> <span class=\"na\">label=</span><span class=\"s\">\"Example input 2\"</span> <span class=\"na\">type=</span><span class=\"s\">\"boolean\"</span> <span class=\"na\">truevalue=</span><span class=\"s\">\"--flag\"</span> <span class=\"na\">falsevalue=</span><span class=\"s\">\"--otherflag\"</span> <span class=\"na\">help=</span><span class=\"s\">\"Example help text\"</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/when&gt;</span>\n<span class=\"nt\">&lt;/conditional&gt;</span>\n</code></pre></div></div>\n\n<h4 id=\"section\"><em>Section</em></h4>\n\n<p>Section tags are useful for visually separating the parameters. They can make a long tool with many parameters more simple to navigate by breaking it into\ngroups of parameters with similar functions. Alternatively, it can hide “advanced” or optional parameters, so that the user doesn’t have to deal with\notherwise-irrelevant parameters if they don’t need to. There are only 4 attributes:</p>\n\n<ul>\n  <li>Name\n    <ul>\n      <li>Sets the internal reference name for the section. Cannot contain spaces.</li>\n    </ul>\n  </li>\n  <li>Title\n    <ul>\n      <li>Sets the visible name of the section for the user. Can contain spaces.</li>\n    </ul>\n  </li>\n  <li>Expanded\n    <ul>\n      <li>A boolean value that sets the default starting position of the section. If false, the section will begin collapsed, and only the title will be visible by default.</li>\n    </ul>\n  </li>\n  <li>Help\n    <ul>\n      <li>Help text visible to the user that explains the purpose of the section.</li>\n    </ul>\n  </li>\n</ul>\n\n<h4 id=\"inputs-section-in-practice\"><em>Inputs Section in Practice</em></h4>\n\n<p>The bellerophon tool’s help section reads</p>\n\n<pre><code class=\"language-txt\">optional arguments:\n  -h, --help            show this help message and exit\n  --forward FORWARD, -f FORWARD\n                        SAM/BAM/CRAM file with the first set of reads.\n  --reverse REVERSE, -r REVERSE\n                        SAM/BAM/CRAM file with the second set of reads.\n  --output OUTPUT, -o OUTPUT\n                        Output BAM file for filtered and paired reads.\n  --quality QUALITY, -q QUALITY\n                        Minimum mapping quality.\n  --threads THREADS, -t THREADS\n                        Threads.\n  --log-level {CRITICAL,ERROR,WARNING,INFO,DEBUG}, -l {CRITICAL,ERROR,WARNING,INFO,DEBUG}\n                        Log level.\n  --version             show program's version number and exit\n</code></pre>\n\n<p>This means that there are 6 total functional flags, –forward, –reverse, –output, –quality, –threads and –log-level.\nAmong these flags, two are file inputs, or ‘data’ type params, one is an integer type param, and three are parameters not\nnecessary for the user to have direct access to. As Galaxy uses specific file names or patterns to find output files, the\noutput file names need to be specific to the wrapper, not the actual running step. Since the user doesn’t know the capability\nof the resources on which the tool will be running, they should not be given access to the threads flag. And since the log level\ngoes to the stderr instead of an output file, this can also be skipped. All three of these flags can be coded in the command,\nbut not exposed to the user.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Adding parameters to your tool</hands-on-title>\n  <ol>\n    <li>Using information in the above sections, add parameters for the forward, reverse, and quality flags to your tool xml.</li>\n  </ol>\n\n  <blockquote class=\"question\">\n    <question-title></question-title>\n\n    <p>What does your <code class=\"language-plaintext highlighter-rouge\">&lt;inputs/&gt;</code> section look like?</p>\n\n    <blockquote class=\"solution\">\n      <solution-title></solution-title>\n      <p>To include all of the necessary parameters, then, the inputs section would appear like this</p>\n\n      <div class=\"language-xml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nt\">&lt;inputs&gt;</span>\n    <span class=\"nt\">&lt;param</span> <span class=\"na\">argument=</span><span class=\"s\">\"--forward\"</span> <span class=\"na\">type=</span><span class=\"s\">\"data\"</span> <span class=\"na\">format=</span><span class=\"s\">\"qname_sorted.bam,sam\"</span> <span class=\"na\">label=</span><span class=\"s\">\"First set of reads\"</span> <span class=\"na\">help=</span><span class=\"s\">\"This is usually the forward reads in your experiment.\"</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;param</span> <span class=\"na\">argument=</span><span class=\"s\">\"--reverse\"</span> <span class=\"na\">type=</span><span class=\"s\">\"data\"</span> <span class=\"na\">format=</span><span class=\"s\">\"qname_sorted.bam,sam\"</span> <span class=\"na\">label=</span><span class=\"s\">\"Second set of reads\"</span> <span class=\"na\">help=</span><span class=\"s\">\"This is usually the reverse reads in your experiment.\"</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;param</span> <span class=\"na\">argument=</span><span class=\"s\">\"--quality\"</span> <span class=\"na\">type=</span><span class=\"s\">\"integer\"</span> <span class=\"na\">value=</span><span class=\"s\">\"20\"</span> <span class=\"na\">min=</span><span class=\"s\">\"0\"</span> <span class=\"na\">label=</span><span class=\"s\">\"Minimum mapping quality\"</span><span class=\"nt\">/&gt;</span>\n<span class=\"nt\">&lt;/inputs&gt;</span>\n</code></pre></div>      </div>\n    </blockquote>\n  </blockquote>\n</blockquote>\n\n<p>This makes the variables “forward”, “reverse” and “quality” available in the command section and lets the users set them in the Galaxy interface. The “min” attribute prevents\na user from inputting a value below a specified number. Here, the quality flag cannot be set below 0.</p>\n\n<h3 id=\"outputs-section\">Outputs section</h3>\n\n<p>The outputs section defines the files that Galaxy makes available in the history after running a tool using the <code class=\"language-plaintext highlighter-rouge\">&lt;data/&gt;</code> and\n<code class=\"language-plaintext highlighter-rouge\">&lt;collection/&gt;</code> tags. In general, it tells Galaxy to look for a specific file after the job completes, and return it to the user.\nIt also defines the format of that file and the name shown to the user in the history.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Adding your outputs</hands-on-title>\n  <p>As Bellerophon has a single output file, add the following outputs section to your tool:</p>\n\n  <div class=\"language-xml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nt\">&lt;outputs&gt;</span>\n    <span class=\"nt\">&lt;data</span> <span class=\"na\">name=</span><span class=\"s\">\"outfile\"</span> <span class=\"na\">label=</span><span class=\"s\">\"${tool.name} on ${on_string}\"</span> <span class=\"na\">format=</span><span class=\"s\">\"bam\"</span> <span class=\"nt\">/&gt;</span>\n<span class=\"nt\">&lt;/outputs&gt;</span>\n</code></pre></div>  </div>\n</blockquote>\n\n<p>This generates a history item called “bellerophon on <code class=\"language-plaintext highlighter-rouge\">&lt;input file name&gt;</code>”, as the ${tool.name} and ${on_string} are reserved values\nfor the tool’s label and the input file labels.</p>\n\n<p>As the name is hard-set using the output flag, and is output into the working directory, the name attribute can be used for the file\nsearch. Alternatively, the attribute “from_work_dir” allows a lower directory to be specified.</p>\n\n<h4 id=\"filtering-the-output\"><em>Filtering the output</em></h4>\n\n<p>In the case where a certain output only appears when certain parameters are set, the <code class=\"language-plaintext highlighter-rouge\">&lt;filter/&gt;</code> flag can help. Though not used in this\ntool, a user might have a boolean or select that generate new output files. In this case, the data tag would appear like this</p>\n\n<div class=\"language-xml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>      <span class=\"nt\">&lt;data</span> <span class=\"na\">format=</span><span class=\"s\">\"bam\"</span> <span class=\"na\">label=</span><span class=\"s\">\"example\"</span> <span class=\"na\">name=</span><span class=\"s\">\"output_bam\"</span><span class=\"nt\">&gt;</span>\n          <span class=\"nt\">&lt;filter&gt;</span>options['selection_mode'] == 'advanced' and options['bam_output']<span class=\"nt\">&lt;/filter&gt;</span>\n      <span class=\"nt\">&lt;/data&gt;</span>\n</code></pre></div></div>\n\n<p>Meaning that file only appears in the history if the user specified the “advanced” mode of the tool, and requested a bam output file.</p>\n\n<h4 id=\"output-collections\"><em>Output collections</em></h4>\n\n<p>Collections are also useful for groups of output files, or simply data meant to be kept together like paired-end files.\nIn this case, the data to be grouped in the history like this.</p>\n\n<div class=\"language-xml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nt\">&lt;collection</span> <span class=\"na\">name=</span><span class=\"s\">\"paired_output\"</span> <span class=\"na\">type=</span><span class=\"s\">\"paired\"</span> <span class=\"na\">label=</span><span class=\"s\">\"Split Pair\"</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;data</span> <span class=\"na\">name=</span><span class=\"s\">\"forward\"</span> <span class=\"na\">format=</span><span class=\"s\">\"txt\"</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;data</span> <span class=\"na\">name=</span><span class=\"s\">\"reverse\"</span> <span class=\"na\">format_source=</span><span class=\"s\">\"txt\"</span> <span class=\"na\">from_work_dir=</span><span class=\"s\">\"reverse.txt\"</span> <span class=\"nt\">/&gt;</span>\n<span class=\"nt\">&lt;/collection&gt;</span>\n</code></pre></div></div>\n\n<p>Though paired-end data is used here, the type can also be ‘list’ or ‘paired list’, specifying a larger group of data, or a group of\npaired-end data respectively.</p>\n\n<h4 id=\"discover-datasets\"><em>Discover datasets</em></h4>\n\n<p>Datasets can also be found automatically, in the case where the number of output files is unknown.</p>\n\n<div class=\"language-xml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nt\">&lt;data</span> <span class=\"na\">format=</span><span class=\"s\">\"tsv\"</span> <span class=\"na\">name=</span><span class=\"s\">\"sample\"</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;discover_datasets</span> <span class=\"na\">pattern=</span><span class=\"s\">\"__name_and_ext__\"</span> <span class=\"na\">directory=</span><span class=\"s\">\"outputs\"</span><span class=\"nt\">/&gt;</span>&gt;\n<span class=\"nt\">&lt;/data&gt;</span>\n</code></pre></div></div>\n\n<p>This, for example finds a tabuar dataset in a directory named “outputs” that follows the naming convention of “<code class=\"language-plaintext highlighter-rouge\">&lt;filename&gt;.&lt;extension&gt;</code>”,\nwhere the extension is .tsv. This method is also able to be used in a collection, where the same function would find all datasets that\nfit the pattern in the specified directory.</p>\n\n<h3 id=\"command-section\">Command section</h3>\n\n<p>Returning to before the inputs section, the command section is written in bash with a built-in python interpreter called Cheetah. Because of that, the command section is, for the most part,\na list of bash commands connected by ‘&amp;&amp;’, with the conda packages listed in the requirement available to run.</p>\n\n<h4 id=\"cheetah-commands\"><em>Cheetah commands</em></h4>\n\n<p>Cheetah allows loops, logic gates, and assignments of variables in a command section. Creation of a logic gate is as simple as this</p>\n\n<div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\">#if ${parameter} == \"value\":</span>\n  &lt;<span class=\"nb\">command</span><span class=\"o\">&gt;</span>\n<span class=\"c\">#end if</span>\n</code></pre></div></div>\n\n<p>For an “else”:</p>\n\n<div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\">#if ${parameter} == \"value\":</span>\n    &lt;<span class=\"nb\">command</span><span class=\"o\">&gt;</span>\n<span class=\"c\">#else:</span>\n    &lt;command_2&gt;\n<span class=\"c\">#end if</span>\n</code></pre></div></div>\n\n<p>For an “else if”:</p>\n\n<div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\">#if ${parameter} == \"value\":</span>\n    &lt;<span class=\"nb\">command</span><span class=\"o\">&gt;</span>\n<span class=\"c\">#else if ${parameter} == \"other value\":</span>\n    &lt;command_2&gt;\n<span class=\"c\">#else:</span>\n    &lt;command_3&gt;\n<span class=\"c\">#end if</span>\n</code></pre></div></div>\n\n<p>Similarly, loops would appear as</p>\n\n<div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\">#for value in ${param}</span>\n    &lt;Loop commands&gt;\n<span class=\"c\">#end for</span>\n</code></pre></div></div>\n\n<p>For all open loops and gates, an “#end” must be used to close.</p>\n\n<p>Finally, to define a variable within the command section, use</p>\n\n<div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\">#set $variable = value</span>\n</code></pre></div></div>\n\n<h4 id=\"using-other-scripts\"><em>Using other scripts</em></h4>\n\n<p>In the case where languages other than bash are necessary, such as R or python, by listing the languages in the requirements,\nthey can be called in this section. Any scripts present in the tools folder can also be called.\nFor example</p>\n\n<div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>python helloworld.py <span class=\"o\">&amp;&amp;</span>\n<span class=\"nb\">echo</span> <span class=\"k\">${</span><span class=\"nv\">variable</span><span class=\"k\">}</span>\n</code></pre></div></div>\n\n<p>runs the helloworld.py script present in the same folder as the tool xml, then echoes the value of the param named “variable” from the input section.</p>\n\n<h4 id=\"in-practice\"><em>In practice</em></h4>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Writing the command block</hands-on-title>\n\n  <p>The bellerophon command section, based on the variables set previously, would be as follows. Please add it to your tool XML.</p>\n\n  <div class=\"language-xml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>    <span class=\"nt\">&lt;command</span> <span class=\"na\">detect_errors=</span><span class=\"s\">\"exit_code\"</span><span class=\"nt\">&gt;</span><span class=\"cp\">&lt;![CDATA[\n        #if $forward.is_of_type(\"sam\"):\n            #set $forward_input = 'forward_input.sam'\n            ln -s '${forward}' '$forward_input' &amp;&amp;\n        #else:\n            #set $forward_input = 'forward_input.bam'\n            ln -s '${forward}' '$forward_input' &amp;&amp;\n        #end if\n        #if $reverse.is_of_type(\"sam\"):\n            #set $reverse_input = 'reverse_input.sam'\n            ln -s '${reverse}' '$reverse_input' &amp;&amp;\n        #else:\n            #set $reverse_input = 'reverse_input.bam'\n            ln -s '${reverse}' '$reverse_input' &amp;&amp;\n        #end if\n        bellerophon\n        --forward $forward_input\n        --reverse $reverse_input\n        --quality $quality\n        --output 'merged_out.bam'\n        &amp;&amp; samtools sort --no-PG -O BAM -o '$outfile' -@ \\${GALAXY_SLOTS:-1} merged_out.bam\n        ]]&gt;</span>\n    <span class=\"nt\">&lt;/command&gt;</span>\n</code></pre></div>  </div>\n</blockquote>\n\n<p>The variables set in the inputs and output sections generate a full command to be run inside the Galaxy environment. When inside a conditional or\nsection, the hierarchy is preserved using a period. For example</p>\n\n<pre><code class=\"language-txt\">'$example.forward'\n</code></pre>\n\n<p>would look for the variable ‘forward’ within the section or conditional named ‘example’.</p>\n\n<p>This command will run, assuming two sam input files, as:</p>\n\n<div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">ln</span> <span class=\"nt\">-s</span> <span class=\"sb\">`</span>&lt;forward input sam file&gt;<span class=\"sb\">`</span> <span class=\"s1\">'$forward_input'</span> <span class=\"o\">&amp;&amp;</span>\n<span class=\"nb\">ln</span> <span class=\"nt\">-s</span> <span class=\"sb\">`</span>&lt;reverse input sam file&gt;<span class=\"sb\">`</span> <span class=\"s1\">'$reverse_input'</span> <span class=\"o\">&amp;&amp;</span>\nbellerophon <span class=\"nt\">--forward</span> <span class=\"nv\">$forward_input</span> <span class=\"nt\">--reverse</span> <span class=\"nv\">$reverse_input</span> <span class=\"nt\">--quality</span> <span class=\"nv\">$quality</span> <span class=\"nt\">--output</span> <span class=\"s1\">'merged_out.bam'</span>\n<span class=\"o\">&amp;&amp;</span> samtools <span class=\"nb\">sort</span> <span class=\"nt\">--no-PG</span> <span class=\"nt\">-O</span> BAM <span class=\"nt\">-o</span> <span class=\"sb\">`</span>&lt;outfile name generated by Galaxy&gt;<span class=\"sb\">`</span> -@ <span class=\"sb\">`</span>&lt;number of threads allocated&gt;<span class=\"sb\">`</span> merged_out.bam\n</code></pre></div></div>\n\n<h4 id=\"symlinks\">Symlinks</h4>\n\n<p>The symlinks in the first two parts of this command serve to standardize the naming of files passed to the bellerophon command.\nFor tools which require specific naming conventions, such as a standard prefix across all input files, or which require specified\nfile extensions, this is necessary. When using non-symlinked files, Galaxy uses metadata for filetypes, but, by default, refers to\nfiles using a <code class=\"language-plaintext highlighter-rouge\">.dat</code> etension. For example, had the symlinks not been used here, the command actually given would look like this:</p>\n\n<div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>bellerophon <span class=\"nt\">--forward</span> &lt;Galaxy_internal_reference_string&gt;.dat <span class=\"nt\">--reverse</span> &lt;Galaxy_internal_reference_string&gt;.dat ...\n</code></pre></div></div>\n\n<p>By adding the symlinks, the files are specified and will use proper names in the command. Although not strictly necessary for\nbellerophon, it is best practice for command legibility.</p>\n\n<h3 id=\"test-section\">Test section</h3>\n\n<p>The test section is an easy way to ensure your tool wrapper functions as intended. It runs the tool and compares the output Galaxy returns against a\nspecified output. The output can be a specific file, a check against the stdout/err, or simply a search to see if the output contains specific\ntext. There can be any number of tests for a given tool, and it is preferred that all parameters are tested at some point in these tests.</p>\n\n<p>When writing a test, the <code class=\"language-plaintext highlighter-rouge\">&lt;param&gt;</code> tag functions slightly differently. It finds the variable with the same name, and then provides a value to be input\nfor the test. These params can also be placed inside a conditional, simulating the same conditional present in the inputs section.</p>\n\n<p>As all parameters in bellerophon are accessible at once, and do not contradict one another, only one test is necessary.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Adding a test</hands-on-title>\n  <p>Add the following test case to your tool:</p>\n  <div class=\"language-xml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>    <span class=\"nt\">&lt;tests&gt;</span>\n        <span class=\"nt\">&lt;test</span> <span class=\"na\">expect_num_outputs=</span><span class=\"s\">\"1\"</span><span class=\"nt\">&gt;</span>\n            <span class=\"nt\">&lt;param</span> <span class=\"na\">name=</span><span class=\"s\">\"forward\"</span> <span class=\"na\">value=</span><span class=\"s\">\"forward.bam\"</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;param</span> <span class=\"na\">name=</span><span class=\"s\">\"reverse\"</span> <span class=\"na\">value=</span><span class=\"s\">\"reverse.bam\"</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;output</span> <span class=\"na\">name=</span><span class=\"s\">\"outfile\"</span> <span class=\"na\">file=</span><span class=\"s\">\"merged-out.bam\"</span> <span class=\"na\">ftype=</span><span class=\"s\">\"bam\"</span> <span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/test&gt;</span>\n    <span class=\"nt\">&lt;/tests&gt;</span>\n</code></pre></div>  </div>\n</blockquote>\n\n<p>This runs the tool with the files forward.bam and reverse.bam from a folder named test-data in the tool’s directory. Since no quality parameter was specified, it uses the default of 20. The parameter can also be manually set with the same param tag and value attribute, just inputting an applicable value such as “21”. It then\ncompares the defined output called “outfile” from the outputs section against a file called “merged-out.bam” in the same test-data directory. It also\ndouble checks that Galaxy only finds one output to put in the history with the “expect_num_outputs” attribute. This is very useful for tests on tools\nthat have filtered outputs or that use ‘discover_datasets’.</p>\n\n<h4 id=\"collections-and-sections-in-tests\"><em>Collections and sections in tests</em></h4>\n\n<p>Though not used in this example, the sections and conditionals from the input section are used in tests as well. For example</p>\n\n<div class=\"language-xml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nt\">&lt;conditional</span> <span class=\"na\">name=</span><span class=\"s\">\"example_conditional\"</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;param</span> <span class=\"na\">name=</span><span class=\"s\">\"select_example\"</span> <span class=\"na\">value=</span><span class=\"s\">\"first\"</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;param</span> <span class=\"na\">name=</span><span class=\"s\">\"when_first\"</span> <span class=\"na\">value=</span><span class=\"s\">\"1\"</span><span class=\"nt\">/&gt;</span>\n<span class=\"nt\">&lt;/conditional&gt;</span>\n</code></pre></div></div>\n\n<p>simulates the selection of value 1 inside of a conditional when the initial select parameter is set to “first”.</p>\n\n<h3 id=\"help-section\">Help section</h3>\n\n<p>This is help text to be shown at the bottom of the tool form. It uses standard markdown format.</p>\n\n<h3 id=\"citations-section\">Citations section</h3>\n\n<p>The citation section gives proper credit to the tool’s writers. Here, using either DOI format or a bibtex citation, the tool form will automatically\nlink out to the relevant papers/repositories. The format in this section is simple, and as bellerophon was written by a Galaxy team member as a translation\nof an Arima Genomics tool in association with the Vertebrate Genomes project, that is the paper that will be cited.</p>\n\n<p>There are two ways to write this section</p>\n\n<p>DOI:</p>\n\n<div class=\"language-xml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nt\">&lt;citations&gt;</span>\n    <span class=\"nt\">&lt;citation</span> <span class=\"na\">type=</span><span class=\"s\">\"doi\"</span><span class=\"nt\">&gt;</span>10.1038/s41586-021-03451-0<span class=\"nt\">&lt;/citation&gt;</span>\n<span class=\"nt\">&lt;/citations&gt;</span>\n</code></pre></div></div>\n\n<p>and Bibtex:</p>\n\n<div class=\"language-xml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nt\">&lt;citations&gt;</span>\n    <span class=\"nt\">&lt;citation</span> <span class=\"na\">type=</span><span class=\"s\">\"bibtex\"</span><span class=\"nt\">&gt;</span>@article{Butler2018,\n    abstract = {A new computational approach enables integrative analysis of disparate single-cell RNA–sequencing data sets by identifying shared patterns of variation between cell subpopulations.},\n    author = {Butler, Andrew and Hoffman, Paul and Smibert, Peter and Papalexi, Efthymia and Satija, Rahul},\n    doi = {10.1038/nbt.4096},\n    issn = {1546-1696},\n    journal = {Nature Biotechnology},\n    number = {5},\n    pages = {411--420},\n    title = {{Integrating single-cell transcriptomic data across different conditions, technologies, and species}},\n    url = {https://doi.org/10.1038/nbt.4096},\n    volume = {36},\n    year = {2018}\n    }<span class=\"nt\">&lt;/citation&gt;</span>\n<span class=\"nt\">&lt;/citations&gt;</span>\n</code></pre></div></div>\n\n<p>Multiple citations can be added by using additional citation tags.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Adding a citation</hands-on-title>\n  <p>Add the citation above using either method (but not both!)</p>\n</blockquote>\n\n<h2 id=\"final-wrapper\">Final wrapper</h2>\n\n<p>With all sections complete, the final wrapper for bellerophon can be found <a href=\"https://github.com/galaxyproject/tools-iuc/blob/master/tools/bellerophon/bellerophon.xml\">in the IUC GitHub repository</a>.</p>\n\n<h2 id=\"toolshed-file\">Toolshed file</h2>\n\n<p>The .shed.yml file is placed in the same directory as the tool’s xml file and saves metadata for the tool. It enables\ntoolshed organization and search by using tags and descriptions.</p>\n\n<p>It is made up of the following sections:</p>\n\n<table>\n  <thead>\n    <tr>\n      <th>Field</th>\n      <th>YAML key</th>\n      <th>Description</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>Name</td>\n      <td><code class=\"language-plaintext highlighter-rouge\">name</code></td>\n      <td>the tool’s name</td>\n    </tr>\n    <tr>\n      <td>Owner</td>\n      <td><code class=\"language-plaintext highlighter-rouge\">owner</code></td>\n      <td>username of the person who wrapped the tool to be represented in the Galaxy Toolshed. If submitted through the Intergalactic Utilities Comission (IUC), can be set to <code class=\"language-plaintext highlighter-rouge\">iuc</code>.</td>\n    </tr>\n    <tr>\n      <td>Description</td>\n      <td><code class=\"language-plaintext highlighter-rouge\">description</code></td>\n      <td>short help text for the tool/package.</td>\n    </tr>\n    <tr>\n      <td>Homepage URL</td>\n      <td><code class=\"language-plaintext highlighter-rouge\">homepage_url</code></td>\n      <td>URL of the tool’s website. Can also just be the Github repository for the tool.</td>\n    </tr>\n    <tr>\n      <td>Long Description</td>\n      <td><code class=\"language-plaintext highlighter-rouge\">long_description</code></td>\n      <td>longer, more in-depth help section.</td>\n    </tr>\n    <tr>\n      <td>Remote Reposity URL</td>\n      <td><code class=\"language-plaintext highlighter-rouge\">remote_repository_url</code></td>\n      <td>link to the repository for the tool’s files.</td>\n    </tr>\n    <tr>\n      <td>Type</td>\n      <td><code class=\"language-plaintext highlighter-rouge\">type</code></td>\n      <td>kind of files in the directory. Can be set as unrestricted (tool), tool_dependency_definition, or repository_suite_definition.</td>\n    </tr>\n    <tr>\n      <td>Categories</td>\n      <td><code class=\"language-plaintext highlighter-rouge\">categories</code></td>\n      <td>toolshed categories that are relevant to the tool or package.</td>\n    </tr>\n  </tbody>\n</table>\n\n<p>For Bellerophon, the .shed.yml file would be:</p>\n\n<div class=\"language-yaml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"na\">name</span><span class=\"pi\">:</span> <span class=\"s\">bellerophon</span>\n<span class=\"na\">owner</span><span class=\"pi\">:</span> <span class=\"s\">iuc</span>\n<span class=\"na\">description</span><span class=\"pi\">:</span> <span class=\"s\">Filter mapped reads where the mapping spans a junction, retaining the 5-prime read.</span>\n<span class=\"na\">homepage_url</span><span class=\"pi\">:</span> <span class=\"s\">https://github.com/davebx/bellerophon</span>\n<span class=\"na\">long_description</span><span class=\"pi\">:</span> <span class=\"pi\">|</span>\n  <span class=\"s\">Filter mapped reads where the mapping spans a junction, retaining the 5-prime read.</span>\n<span class=\"na\">remote_repository_url</span><span class=\"pi\">:</span> <span class=\"s\">https://github.com/davebx/bellerophon</span>\n<span class=\"na\">categories</span><span class=\"pi\">:</span>\n<span class=\"pi\">-</span> <span class=\"s\">Sequence Analysis</span>\n</code></pre></div></div>\n\n<p>In the case where the directory represents a group of tools or a ‘suite’, there are additional overarching sections into which the above tags fall:</p>\n\n<ul>\n  <li>Auto Tool Repositories</li>\n  <li>Suite</li>\n</ul>\n\n<p>For more information on how to write automatic tool suites, visit the <a href=\"https://galaxy-iuc-standards.readthedocs.io/en/latest/best_practices/shed_yml.html\">Galaxy docs</a>.</p>\n\n<h1 id=\"testing-galaxy-tool-with-planemo\">Testing Galaxy tool with <code class=\"language-plaintext highlighter-rouge\">planemo</code></h1>\n\n<p><code class=\"language-plaintext highlighter-rouge\">planemo</code> is a command line utility that helps developing Galaxy tools.\nAmong many other tasks it can:</p>\n\n<ol>\n  <li>Lint the tool source errors and conformance to best practices.</li>\n  <li>Test tools, i.e. executing the tool with the tests described in the tool’s test section.</li>\n  <li>Serve tools, i.e. crate an ad-hoc Galaxy server running the tool.</li>\n</ol>\n\n<p>For more information on <code class=\"language-plaintext highlighter-rouge\">planemo</code> see its extensive <a href=\"https://planemo.readthedocs.io/\">documentation</a>.</p>\n\n<p>In this part of the tutorial we will be looking at <code class=\"language-plaintext highlighter-rouge\">planemo</code> and\nsee it in action linting, testing, and serving the tool.</p>\n\n<h2 id=\"using-planemo-to-lint-tools\">Using <code class=\"language-plaintext highlighter-rouge\">planemo</code> to lint tools</h2>\n\n<p>When linting a Galaxy tool <code class=\"language-plaintext highlighter-rouge\">planemo</code> checks the sources for common errors and violations of best practice rules. Examples are:</p>\n\n<ul>\n  <li>Presence to “TODO” in the help section</li>\n  <li>Absence of tests or citations</li>\n  <li>Missing when clauses in conditionals or the use of a boolean parameter as the selector in a conditional</li>\n</ul>\n\n<p>If <code class=\"language-plaintext highlighter-rouge\">planemo</code> finds a problem it outputs warnings or errors depending on the severity of the problem.\nBy default <code class=\"language-plaintext highlighter-rouge\">planemo</code> will fail if any warning or error is found, i.e. return a non-zero exit code.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Lint a tool with `planemo`</hands-on-title>\n\n  <ol>\n    <li>Change into the directory containing the tool</li>\n    <li>Run <code class=\"language-plaintext highlighter-rouge\">planemo lint</code></li>\n    <li>Inspect the output for any warnings or errors</li>\n    <li>Fix the problem(s) and rerun from step 2 until all problems are solved</li>\n  </ol>\n</blockquote>\n\n<p>By default <code class=\"language-plaintext highlighter-rouge\">planemo</code> will lint all tools contained in the current working directory (including subdirectories).\nYou can also specify a directory or a tool by giving its path as additional argument.</p>\n\n<h2 id=\"using-planemo-to-test-tools\">Using <code class=\"language-plaintext highlighter-rouge\">planemo</code> to test tools</h2>\n\n<p>Using <code class=\"language-plaintext highlighter-rouge\">planemo</code> to execute the tests defined in a tool is probably the most frequently used feature.\nIn order to do so <code class=\"language-plaintext highlighter-rouge\">planemo</code> will:</p>\n\n<ul>\n  <li>Start a local Galaxy instance</li>\n  <li>Stage all input data defined in the tests</li>\n  <li>Run the tool using the datasets and parameters defined in the tests (this also involves the installation of all requirements which is done with conda by default)</li>\n  <li>Check if the test assumptions are met, e.g. non-zero exit code, equivalence of the output files, number of outputs, …</li>\n</ul>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Test a tool with `planemo`</hands-on-title>\n\n  <ol>\n    <li>Change into the directory containing the tool</li>\n    <li>\n      <p>Run <code class=\"language-plaintext highlighter-rouge\">planemo test</code> (as with <code class=\"language-plaintext highlighter-rouge\">planemo lint</code> you can also specify a path to a tool explicitly as extra argument)</p>\n\n      <p>The most important output of <code class=\"language-plaintext highlighter-rouge\">planemo</code> is found at the end and looks like:</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>Testing complete. HTML report is in \"PATH/tool_test_output.html\".\nAll X test(s) executed passed.\nTOOL_NAME (Test #1): passed\nTOOL_NAME (Test #2): passed\n...\n</code></pre></div>      </div>\n\n      <p>The last part lists for each test if it failed or passed. In case of a failure you can open the file <code class=\"language-plaintext highlighter-rouge\">tool_test_output.html</code> (the path to this file is in the output) with a browser to get more information.</p>\n    </li>\n    <li>\n      <p>Open the HTML report <code class=\"language-plaintext highlighter-rouge\">firefox PATH/tool_test_output.html</code> (replace the PATH as in <code class=\"language-plaintext highlighter-rouge\">planemo</code>’s output).</p>\n\n      <p>The HTML report contains a table on the top giving the number of executed, successful, and failed tests:</p>\n\n      <figure id=\"figure-2\" style=\"max-width: 90%;\"><img src=\"../../images/planemo_html.png\" alt=\"Planemo HTML report. \" width=\"704\" height=\"565\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/planemo_html.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 2</strong>:</span> Planemo HTML report</figcaption></figure>\n\n      <p>If there are passed or failed tests you will find the text <code class=\"language-plaintext highlighter-rouge\">Passed tests</code>, <code class=\"language-plaintext highlighter-rouge\">Failed tests</code>, resp., below the table.\nClicking on this text will unfold the list of passed or failed tests, resp. Clicking again on one of the tests\nWill show additional information like stdout, stderr and the executed command line. In most cases this is sufficient\nto determine the source of the test failure.</p>\n    </li>\n  </ol>\n</blockquote>\n\n<blockquote class=\"tip\">\n  <tip-title>Useful parameters for `planemo test`</tip-title>\n\n  <ul>\n    <li><code class=\"language-plaintext highlighter-rouge\">--failed</code> Will make <code class=\"language-plaintext highlighter-rouge\">planemo</code> rerun only the tests that failed in the previous execution.</li>\n    <li><code class=\"language-plaintext highlighter-rouge\">--update_test_data</code> If there are differences to output files defined in the tests these will be updated (and the tests will run again).</li>\n    <li><code class=\"language-plaintext highlighter-rouge\">--no_cleanup</code> <code class=\"language-plaintext highlighter-rouge\">Planemo</code> will not cleanup the created Galaxy clone or the job working dir (see the details box below).</li>\n  </ul>\n</blockquote>\n\n<blockquote class=\"details\">\n  <details-title>Understanding `planemo`'s output in more detail</details-title>\n\n  <p>Sometimes it can be helpful to understand the <code class=\"language-plaintext highlighter-rouge\">planemo</code> output in more detail.</p>\n\n  <ul>\n    <li>The first lines show some <code class=\"language-plaintext highlighter-rouge\">git</code> commands that create a local clone of the Galaxy sources (by default the <code class=\"language-plaintext highlighter-rouge\">master</code> branch) and the command to start Galaxy. The end of the part is marked by the line <code class=\"language-plaintext highlighter-rouge\">Activated a virtualenv for Galaxy</code>.</li>\n    <li>Then the python virtual environment used to run Galaxy is created and the requirements are installed</li>\n    <li>Then the worker threads and the Galaxy database are initialized, look for lines containing <code class=\"language-plaintext highlighter-rouge\">Initializing main Galaxy Queue Worker on</code> and <code class=\"language-plaintext highlighter-rouge\">Install database targetting Galaxy's database configuration</code>. The completion of the startup of Galaxy is indicated by the line <code class=\"language-plaintext highlighter-rouge\">INFO:     Application startup complete.</code></li>\n  </ul>\n\n  <p>The first two steps can take a while on the first run of <code class=\"language-plaintext highlighter-rouge\">planemo test</code> (in particular on slow internet connections). Subsequent runs will be faster since the Galaxy sources as well as the virtual environment are cached in your home directory (<code class=\"language-plaintext highlighter-rouge\">~/.planemo/</code>).</p>\n\n  <ul>\n    <li>After this <code class=\"language-plaintext highlighter-rouge\">planemo</code> will execute one test after the other. The start of a test is indicted by a line <code class=\"language-plaintext highlighter-rouge\">( TOOL_ID ) &gt; Test-TEST_NUMBER</code></li>\n    <li>For each test a number of Galaxy jobs are triggered (one upload job for each input dataset and the actual tool execution). Each job is indicated by a line <code class=\"language-plaintext highlighter-rouge\">Built script [JOB_WORKING_DIR/tool_script.sh] for tool command [COMMAND_LINE]</code> which tell you the working directory of the job and the executed command line.</li>\n    <li>Suceccful tests will be marked with a line containing the text <code class=\"language-plaintext highlighter-rouge\">ok</code>. Otherwise stdout and stderr and potentially a description of the test problem is shown.</li>\n  </ul>\n\n  <p>Note that the first execution of the tool job can take longer since also the conda environment containing the requirements of the tool is created.</p>\n\n  <p>As an exercise</p>\n\n  <ul>\n    <li>Start <code class=\"language-plaintext highlighter-rouge\">planemo test</code> with the extra parameter <code class=\"language-plaintext highlighter-rouge\">--no_cleanup</code> (this will prevent the deletion of the Galaxy clone and its job working directories after <code class=\"language-plaintext highlighter-rouge\">planemo</code> finished).</li>\n    <li>Change into one job working directory (not an upload job)</li>\n    <li>Inspect <code class=\"language-plaintext highlighter-rouge\">tool_script.sh</code> and find the command to activate the conda environment for the job and the executed command line.</li>\n    <li>Execute these commands from within the <code class=\"language-plaintext highlighter-rouge\">working</code> dir in the jobs working dir (You may need to remove all files that are already existing there).</li>\n  </ul>\n\n  <p>This procedure can be really helpful for debugging Galaxy tools.</p>\n</blockquote>\n\n<h2 id=\"using-planemo-to-serve-tools\">Using <code class=\"language-plaintext highlighter-rouge\">planemo</code> to serve tools</h2>\n\n<p>It can be very useful to check how Galaxy renders a tool and if this meets the expectations of the developer. For instance this is the best way to check if the help section is rendered as expected.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Serve a tool with `planemo`</hands-on-title>\n\n  <ol>\n    <li>Change into the directory containing the tool</li>\n    <li>\n      <p>Run <code class=\"language-plaintext highlighter-rouge\">planemo serve</code> (as with <code class=\"language-plaintext highlighter-rouge\">lint</code> and test you can also specify a path to a tool explicitly as extra argument)</p>\n\n      <p><code class=\"language-plaintext highlighter-rouge\">Planemo</code> will again start a Galaxy instance that contains your tool. Note that starting the ad-hoc Galaxy might need longer than for <code class=\"language-plaintext highlighter-rouge\">planemo test</code> since JavaScript components need to be initialized as well.</p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"tip\">\n  <tip-title>Useful parameters for `planemo test`</tip-title>\n\n  <p>In order to stop <code class=\"language-plaintext highlighter-rouge\">planemo serve</code> just press <kbd>Ctrl-C</kbd></p>\n</blockquote>\n\n<h1 id=\"publishing-galaxy-tools\">Publishing Galaxy tools</h1>\n\n<p>Galaxy tools are installed from the <a href=\"https://toolshed.g2.bx.psu.edu/\">Galaxy toolshed</a>. With the help of <code class=\"language-plaintext highlighter-rouge\">planemo</code> tools can be added to the toolshed (<a href=\"https://planemo.readthedocs.io/en/latest/publishing.html\">documentation</a>). But usually the sources of the tools are maintained in public source code repositories, for instance:</p>\n\n<ul>\n  <li><a href=\"https://github.com/galaxyproject/tools-iuc/\">IUC</a></li>\n  <li><a href=\"https://github.com/galaxyproject/tools-devteam/\">devteam</a></li>\n  <li><a href=\"https://github.com/bgruening/galaxytools\">Bjoern Gruenings repo</a></li>\n  <li><a href=\"https://github.com/galaxyproteomics/tools-galaxyp/\">GalaxyP</a> for proteomics tools</li>\n  <li><a href=\"https://github.com/workflow4metabolomics/\">W4M</a> for metabolomics tools</li>\n</ul>\n\n<p>These tool source repositories have continuous integration workflows:</p>\n\n<ul>\n  <li>lint and test tools</li>\n  <li>lint supplementary python and R scripts</li>\n  <li>and publish tools to the toolshed</li>\n</ul>\n\n<p>In addition the repositories run weekly workflows testing all tools in order to keep them working.\nAnother advantage of these repositories is that new tools and improvements to tools are subject to review of experienced tool developers.</p>\n\n<p>The repository is structured as follows:</p>\n\n<ul>\n  <li><code class=\"language-plaintext highlighter-rouge\">tools/</code>: the main directory of the repository containing the tool descriptions. One directory for a tool repository (a directory with a <code class=\"language-plaintext highlighter-rouge\">.shed.yaml</code> file that describes the tools) which can contain one or more set of tools.</li>\n  <li><code class=\"language-plaintext highlighter-rouge\">tool_collections/</code> and <code class=\"language-plaintext highlighter-rouge\">suites/</code>: Like <code class=\"language-plaintext highlighter-rouge\">tools/</code> but reserved for larger collections of tools like <code class=\"language-plaintext highlighter-rouge\">samtools</code> or <code class=\"language-plaintext highlighter-rouge\">bedtools</code>.</li>\n  <li><code class=\"language-plaintext highlighter-rouge\">data_managers/</code>: a directory containing data managers. These need to be in a separate directory since tool tests with <code class=\"language-plaintext highlighter-rouge\">planemo</code> need to be ececuted slightly different from tests of normal tools.</li>\n  <li><code class=\"language-plaintext highlighter-rouge\">deprecated/</code>: deprecated tools. Tools in this directory are excluded from weekly CI.</li>\n  <li><code class=\"language-plaintext highlighter-rouge\">macros/</code>: macros that can be used by multiple tools.</li>\n</ul>\n\n<p>In addition there are some important directories containing configurarion:</p>\n\n<ul>\n  <li><code class=\"language-plaintext highlighter-rouge\">.github/</code>: contains the CI workflows and other documents for the maintenance of the repository.</li>\n  <li><code class=\"language-plaintext highlighter-rouge\">.tt_skip</code>: a text file containing a list of tool repositories that are excluded from weekly CI as well as CI running in PR.</li>\n  <li><code class=\"language-plaintext highlighter-rouge\">.tt_biocontainer_skip</code>: a text file containing a list of tool repositories that should not be tested with containerized tool tests but use <code class=\"language-plaintext highlighter-rouge\">conda</code> for resolving tool requirements.</li>\n  <li><code class=\"language-plaintext highlighter-rouge\">setup.cfg</code>: configuration for <code class=\"language-plaintext highlighter-rouge\">flake8</code> python linting in CI.</li>\n</ul>\n\n<p>Furthermore there are <code class=\"language-plaintext highlighter-rouge\">README.md</code>, <code class=\"language-plaintext highlighter-rouge\">CONTRIBUTING.md</code>, and <code class=\"language-plaintext highlighter-rouge\">LICENSE</code> that might be worth considering as contributor or adapting if you use the repository as template.</p>\n\n<p>The workflow to add or update a tool in such a repository to open a pull request (PR) from a branch of a personal fork of the repository. In the following it will be demonstrated how this is done for the IUC repository</p>\n\n<h2 id=\"fork-and-clone-the-github-repository\">Fork and clone the github repository</h2>\n\n<p>For the following we will use a sandbox tool repository and not one of the main repositories.\nBut, the steps can be adapted easily by exchanging the repository URLs. Note that for some repositories\nthe development branch may have the name <code class=\"language-plaintext highlighter-rouge\">master</code> instead of <code class=\"language-plaintext highlighter-rouge\">main</code>.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Fork and clone the IUC github repository</hands-on-title>\n\n  <ol>\n    <li>If you don’t have an account on github you need to sign up at first.</li>\n    <li>Open the <a href=\"https://github.com/mvdbeek/galaxy-tools-mvdbeek/\">Sandbox tool repository</a> in a browser.</li>\n  </ol>\n\n  <ul>\n    <li>Click the <code class=\"language-plaintext highlighter-rouge\">fork</code> button on the top right\n      <figure id=\"figure-3\" style=\"max-width: 90%;\"><img src=\"../../images/iuc-github.png\" alt=\"IUC github repository. \" width=\"1264\" height=\"660\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/iuc-github.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 3</strong>:</span> IUC github repository</figcaption></figure>\n    </li>\n    <li>In the following dialog select your account</li>\n    <li>After a short while you will be redirected to your fork of the sandbox repository\n(i.e. a 1:1 copy of the original repository)</li>\n  </ul>\n\n  <ol>\n    <li>\n      <p>In order to obtain a clone (i.e. a local copy of your fork) click the green button with text “Code” and copy the link. And execute the following commands on your computer</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">cd </span>A_DIR_WHERE_YOU_WANT_TO_CREATE_THE_CLONE\ngit clone LINK_TO_YOUR_FORK\n<span class=\"nb\">cd </span>tools-iuc/\ngit remote add upstream https://github.com/mvdbeek/galaxy-tools-mvdbeek.git\n</code></pre></div>        </div>\n      </blockquote>\n\n      <p>The first command creates the clone in the current working dir, i.e. it will create a directory <code class=\"language-plaintext highlighter-rouge\">galaxy-tools-mvdbeek</code> containing the copy.\nThe last command will add the original sandbox repository as a remote with the name <code class=\"language-plaintext highlighter-rouge\">upstream</code>. This is necessary in order to keep your fork of the repository in sync with the original repository.</p>\n    </li>\n    <li>\n      <p>Check that <code class=\"language-plaintext highlighter-rouge\">git remote -v</code> lists your fork under the name <code class=\"language-plaintext highlighter-rouge\">origin</code> and the original repository unter the name <code class=\"language-plaintext highlighter-rouge\">upstream</code>.</p>\n    </li>\n  </ol>\n</blockquote>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Keeping your fork in sync</hands-on-title>\n\n  <p>You should execute the following steps always before creating a new branch:</p>\n\n  <ol>\n    <li><code class=\"language-plaintext highlighter-rouge\">git checkout main</code>: change to the main branch</li>\n    <li><code class=\"language-plaintext highlighter-rouge\">git pull upstream main</code>: get the most recent changes from the <code class=\"language-plaintext highlighter-rouge\">upstream</code> repository to your local clone</li>\n    <li><code class=\"language-plaintext highlighter-rouge\">git push origin main</code>: publish the most recent changes from your local clone to your fork, i.e. <code class=\"language-plaintext highlighter-rouge\">origin</code></li>\n  </ol>\n</blockquote>\n\n<h2 id=\"create-a-pull-request-for-a-new-tool\">Create a pull request for a new tool</h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Create a pull request</hands-on-title>\n  <ol>\n    <li><code class=\"language-plaintext highlighter-rouge\">git checkout main</code></li>\n    <li><code class=\"language-plaintext highlighter-rouge\">git checkout -b NAME_OF_THE_BRANCH</code>: create a new feature branch and change to this branch. The branch name should not contain names and should be short and if possible descriptive, e.g. the tool name.</li>\n    <li>Introduce changes, e.g. created a directory under <code class=\"language-plaintext highlighter-rouge\">tools/</code>, add the tool XML file, the <code class=\"language-plaintext highlighter-rouge\">.shed.yml</code> file, and the <code class=\"language-plaintext highlighter-rouge\">test-data</code> directory with the files needed for the test.</li>\n    <li><code class=\"language-plaintext highlighter-rouge\">git add TOOL_DIRECTORY</code> add all files in <code class=\"language-plaintext highlighter-rouge\">TOOL_DIRECTORY</code> under version control</li>\n    <li><code class=\"language-plaintext highlighter-rouge\">git commit -m 'COMMIT MESSAGE'</code> commit the changes. The commit message should contain a short description of the changes. You can also use multiple lines: ommit the final quote and continue after pressing enter – finish by adding the single quote again and press enter.</li>\n    <li>Push to your fork <code class=\"language-plaintext highlighter-rouge\">git push --set-upstream origin NAME_OF_THE_BRANCH</code></li>\n    <li>Create a Pull Request (PR): in the output of the previous command you will find an URL that you can copy paste to your browser. Add a suitable title to you PR and describe the changes. The PR will be created after you click the button “Create pull request”</li>\n  </ol>\n</blockquote>\n\n<p>After you created a PR your changes will be reviewed and improvements will be requested. You can add changes to the PR as follows.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Adding changes to a PR</hands-on-title>\n  <ol>\n    <li><code class=\"language-plaintext highlighter-rouge\">git checkout NAME_OF_THE_BRANCH</code></li>\n    <li>Make changes as requested.</li>\n    <li><code class=\"language-plaintext highlighter-rouge\">git add SPACE_SEPARATED_LIST_OF_CHANGED_FILES</code></li>\n    <li><code class=\"language-plaintext highlighter-rouge\">git commit -m 'COMMIT MESSAGE'</code></li>\n    <li><code class=\"language-plaintext highlighter-rouge\">git push origin NAME_OF_THE_BRANCH</code></li>\n  </ol>\n</blockquote>\n\n<h2 id=\"the-iuc-style-continuous-integration-workflows\">The IUC style continuous integration workflows</h2>\n\n<p>When a new PR is created or new commits are added to the PR the <a href=\"https://github.com/bernt-matthias/galaxy-tool-repository-template/blob/main/.github/workflows/pr.yaml\">continuous integration workflow</a> starts and executes the following steps:</p>\n\n<ol>\n  <li>Setup: this mainly determines the list of changed tools and repositories (here repository refers to a set of tools with <code class=\"language-plaintext highlighter-rouge\">.shed.yaml</code>). In addition some caches for <code class=\"language-plaintext highlighter-rouge\">pip</code> and <code class=\"language-plaintext highlighter-rouge\">planemo</code> are setup that are reused in the following jobs are maintained.</li>\n  <li>Tool linting: this essentially runs <code class=\"language-plaintext highlighter-rouge\">planemo shed_lint</code> which does the same as <code class=\"language-plaintext highlighter-rouge\">planemo lint</code> plus additional checks.</li>\n  <li>Python linting: run <code class=\"language-plaintext highlighter-rouge\">flake8</code> linting on all python scripts contained in changed repositories</li>\n  <li>R linting: run <code class=\"language-plaintext highlighter-rouge\">lintr</code> linting on all R scripts contained in changed repositories</li>\n  <li>Tool testing: this runs <code class=\"language-plaintext highlighter-rouge\">planemo test</code> on all tested repositories using containerized tests, i.e. docker containers are used to execute the tool tests instead of <code class=\"language-plaintext highlighter-rouge\">conda</code> environments. Depending on the number of changed tools up to four parallel jobs execute the tool tests. Note that these jobs will always be reported as sucessful even if tool tests failed. Tool test failures will be reported in the subsequent job. The same version of these tests can be run locally by adding <code class=\"language-plaintext highlighter-rouge\">--docker</code> to the planemo test command.</li>\n  <li>Combine tool test results: the results of the parallel tool test jobs are merged.</li>\n  <li>Determine success of the steps: this is just an auxilliary step needed for PR that do not change tools, but the framework (e.g. the worflows).</li>\n</ol>\n\n<p>The same workflow runs once again when the PR is merged. In addition another job runs which deploys the tool(s) to the toolshed (and testtoolshed).</p>\n\n<p>The CI jobs are listed on the bottom of the PR. Colored icons indicate the state of the jobs:</p>\n\n<ul>\n  <li>yellow circle: running</li>\n  <li>grey circled /: skipped</li>\n  <li>red x: failed job</li>\n  <li>green checkmark: successful job</li>\n</ul>\n\n<p>The link “Details” on the right of the job brings you to a page showing the detailed output of the jobs (Alternatively the “Checks” tab on top of the PR page brings you to the CI output page.)</p>\n\n<figure id=\"figure-4\" style=\"max-width: 90%;\"><img src=\"../../images/iuc-ci.png\" alt=\"IUC output of the CI workflow. \" width=\"1599\" height=\"1061\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/iuc-ci.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 4</strong>:</span> output of the CI workflow</figcaption></figure>\n\n<p>The image above shows the CI page for a PR:</p>\n\n<ul>\n  <li>Green box: clicking this brings you to an overview page showing the CI workflow and listing errors and produced artifacts below.</li>\n  <li>Red box: the executed CI jobs. Clicking a job will show the outputs of the CI steps in the main (gray panel). The outputs of each step can be show by clicking on the corresponding step.</li>\n  <li>Blue box: direct link to the artifacts. This is currently the output of the “Combine tool test results” job: “All tool test results” (and the outputs of the separate tool test jobs which are a technical necessity and usually not relevant). Clicking “All tool test results” will trigger the download of a zip file that contains the <code class=\"language-plaintext highlighter-rouge\">planemo test</code> html output. If the linting jobs have found errors then also their output will be provided as additional output.</li>\n</ul>\n\n<p>Most of the steps executed in the jobs are boilerplate and only one/two steps in each stop are really relevant for the users:</p>\n\n<ul>\n  <li>Setup: show repository list – show tool list: here you can check if all repositories and tools that are changed in the PR are listed.\nLint tool-list: planemo lint – this contains the linter output of <code class=\"language-plaintext highlighter-rouge\">planemo test</code>. Check here for non critical warning that would be good to fix.\nLint python scripts: flake8 – contains the output of the python linter <code class=\"language-plaintext highlighter-rouge\">flake8</code>.\nLint R scripts: lintr – contains the output of the python linter <code class=\"language-plaintext highlighter-rouge\">lintr</code>.\nTest tools: planemo test – contains the output of <code class=\"language-plaintext highlighter-rouge\">planemo test</code>.</li>\n</ul>\n\n<h2 id=\"create-your-own-iuc-style-tool-repository\">Create your own IUC style tool repository</h2>\n\n<p>It is also easy to setup a github tool repository on your own that has the same structure and functionality as the IUC repository. This allows you to maintain the tools that you are developing on your own, but keep in mind the advantages of having tools in one of the community driven repositories (like long term support).</p>\n\n<p>In order to setup your own tool repository the Galaxy community created a <a href=\"https://github.com/bernt-matthias/galaxy-tool-repository-template\">template repository</a>. By clicking <code class=\"language-plaintext highlighter-rouge\">Use this template</code> and follow the instructions in the README file you get you own tool repository.</p>\n\n<h1 id=\"conclusion\">Conclusion</h1>\n\n"],"ref_slides":[],"hands_on":true,"slides":false,"mod_date":"2024-05-29 14:28:52 +0000","pub_date":"2021-06-15 15:07:18 +0000","version":39,"api":"https://training.galaxyproject.org/training-material/api/topics/dev/tutorials/tool-from-scratch/tutorial.json","tools":[],"supported_servers":[],"topic_name_human":"Development in Galaxy","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools: []\n","tours":false,"video":false,"slides_recordings":false,"translations":{"tutorial":[],"slides":[],"video":false},"license":"CC-BY-4.0","type":"tutorial"}