{"layout":"tutorial_hands_on","title":"Contributing to BioBlend as a developer","questions":["How to get started making contributions to BioBlend?"],"objectives":["Learn the basics behind BioBlend and the Galaxy API from a developer perspective.","Learn how to implement a simple method in BioBlend.","Learn how to run the BioBlend test suite."],"requirements":[{"title":"Basic command line knowledge","type":"none"},{"title":"Familiarity with git and access to a GitHub account","type":"none"},{"title":"Familiarity with the Python programming language","type":"none"},{"title":"Familiarity with HTTP methods and JavaScript Object Notation (JSON)","type":"none"}],"time_estimation":"3h","key_points":["BioBlend is a Python library that provides methods for easy interaction with the Galaxy API.","Implementing BioBlend methods is generally quite an easy process, making it well suited to beginners and a viable stepping stone into Galaxy development."],"subtopic":"api","contributors":[{"name":"Erik Schill","joined":"2021-05","id":"rikeshi","url":"https://training.galaxyproject.org/training-material/api/contributors/rikeshi.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/rikeshi/"},{"name":"Simon Bray","joined":"2019-05","elixir_node":"de","former_affiliations":["uni-freiburg","elixir-europe"],"id":"simonbray","url":"https://training.galaxyproject.org/training-material/api/contributors/simonbray.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/simonbray/"}],"abbreviations":{"LDA":"Library Dataset Association","HDA":"History Dataset Association","LDCA":"Library Dataset Collection Association","HDCA":"History Dataset Collection Association","API":"Application Programming Interface","PR":"Pull Request"},"js_requirements":{"mathjax":null,"mermaid":false},"short_id":"T00112","url":"/topics/dev/tutorials/bioblend-dev/tutorial.html","topic_name":"dev","tutorial_name":"bioblend-dev","dir":"topics/dev/tutorials/bioblend-dev","symlink":null,"id":"dev/bioblend-dev","ref_tutorials":["<p>BioBlend (<span class=\"citation\"><a href=\"#Sloggett2013\">Sloggett <i>et al.</i> 2013</a></span>) is a Python library to enable simple interaction with Galaxy (<span class=\"citation\"><a href=\"#Afgan2018\">Afgan <i>et al.</i> 2018</a></span>) via the command line or scripts.</p>\n\n<p>Galaxy is a data analysis platform for accessible, reproducible and transparent computational research. It includes a web interface through which users can design and perform tasks in a visual and interactive manner. The Galaxy server also exposes this functionality through its REST-based Application Programming Interface (API).</p>\n\n<p>Computer programs can communicate with the Galaxy server through this <abbr title=\"Application Programming Interface\">API</abbr> and perform similar tasks as can be achieved manually via the web interface. The program sends a network request to a URL of an <abbr title=\"Application Programming Interface\">API</abbr> endpoint. The server then computes the result for this request and sends back a response to the program.</p>\n\n<p>BioBlend provides classes and methods that handle the specific details of this communication for Python programs. Similar libraries also exist for interacting with Galaxy via other programming languages:</p>\n\n<ul>\n  <li>blend4j (Java): <a href=\"https://github.com/galaxyproject/blend4j\">https://github.com/galaxyproject/blend4j</a></li>\n  <li>blend4php (PHP): <a href=\"https://github.com/galaxyproject/blend4php\">https://github.com/galaxyproject/blend4php</a></li>\n  <li>clj-blend (Clojure): <a href=\"https://github.com/chapmanb/clj-blend\">https://github.com/chapmanb/clj-blend</a></li>\n</ul>\n\n<blockquote class=\"agenda\">\n  <agenda-title></agenda-title>\n\n  <p>In this tutorial, we will learn the basics of BioBlend development:</p>\n\n<ol id=\"markdown-toc\">\n  <li><a href=\"#development-on-github\" id=\"markdown-toc-development-on-github\">Development on GitHub</a>    <ol>\n      <li><a href=\"#contributing-on-github\" id=\"markdown-toc-contributing-on-github\">Contributing on GitHub</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#downloading-galaxy-and-bioblend\" id=\"markdown-toc-downloading-galaxy-and-bioblend\">Downloading Galaxy and BioBlend</a></li>\n  <li><a href=\"#interacting-with-the-api\" id=\"markdown-toc-interacting-with-the-api\">Interacting with the API</a>    <ol>\n      <li><a href=\"#structure-of-the-galaxy-api\" id=\"markdown-toc-structure-of-the-galaxy-api\">Structure of the Galaxy API</a></li>\n      <li><a href=\"#core-concepts-of-the-galaxy-interface\" id=\"markdown-toc-core-concepts-of-the-galaxy-interface\">Core concepts of the Galaxy interface</a></li>\n      <li><a href=\"#structure-of-the-bioblend-library\" id=\"markdown-toc-structure-of-the-bioblend-library\">Structure of the BioBlend library</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#communicating-with-the-galaxy-api\" id=\"markdown-toc-communicating-with-the-galaxy-api\">Communicating with the Galaxy API</a></li>\n  <li><a href=\"#creating-a-simple-bioblend-method\" id=\"markdown-toc-creating-a-simple-bioblend-method\">Creating a simple BioBlend method</a>    <ol>\n      <li><a href=\"#identifying-the-relevant-galaxy-endpoint\" id=\"markdown-toc-identifying-the-relevant-galaxy-endpoint\">Identifying the relevant Galaxy endpoint</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#running-the-bioblend-tests\" id=\"markdown-toc-running-the-bioblend-tests\">Running the BioBlend tests</a>    <ol>\n      <li><a href=\"#running-the-tests-directly\" id=\"markdown-toc-running-the-tests-directly\">Running the tests directly</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#conclusion\" id=\"markdown-toc-conclusion\">Conclusion</a></li>\n</ol>\n\n</blockquote>\n\n<h1 id=\"development-on-github\">Development on GitHub</h1>\n\n<p>Galaxy and BioBlend are developed as open source projects on GitHub and contributions are welcome!</p>\n\n<p>The GitHub repositories can be found at:</p>\n<ul>\n  <li>Galaxy: <a href=\"https://github.com/galaxyproject/galaxy\">https://github.com/galaxyproject/galaxy</a></li>\n  <li>BioBlend: <a href=\"https://github.com/galaxyproject/bioblend\">https://github.com/galaxyproject/bioblend</a></li>\n</ul>\n\n<h2 id=\"contributing-on-github\">Contributing on GitHub</h2>\n\n<p>To contribute to BioBlend, a GitHub account is required.</p>\n\n<p>Changes are proposed via a Pull Request (PR). This allows the project maintainers to review the changes and suggest improvements.</p>\n\n<p>The general steps are as follows:</p>\n\n<ol>\n  <li>Fork the BioBlend repository</li>\n  <li>Make changes in a new branch</li>\n  <li>Open a pull request for this branch in the upstream BioBlend repository</li>\n</ol>\n\n<p>It is generally a good idea to enable the “Allow edits and access to secrets by maintainers” option for the <abbr title=\"Pull Request\">PR</abbr>. Enabling this option gives maintainers more freedom to help out.</p>\n\n<h1 id=\"downloading-galaxy-and-bioblend\">Downloading Galaxy and BioBlend</h1>\n\n<p>Now we are ready to set up our development environment! Since BioBlend communicates with the Galaxy <abbr title=\"Application Programming Interface\">API</abbr>, we must also set up a local Galaxy server in order to test BioBlend functionality.\nWe use the <a href=\"https://git-scm.com\">git</a> versioning tool to download the repositories.</p>\n\n<p>For this we require a public SSH key associated with our GitHub account. It makes sense to set this up now, since pushing changes to GitHub without a public key will prompt for credentials every time. See the <a href=\"https://docs.github.com/en/github-ae@latest/github/authenticating-to-github/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent\">GitHub Docs</a> for information on setting up an SSH key.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Downloading repositories</hands-on-title>\n  <p>Download Galaxy and set it up as a local repository:</p>\n\n  <div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>git clone git@github.com:galaxyproject/galaxy.git\n</code></pre></div>  </div>\n\n  <p>Likewise, download BioBlend:</p>\n\n  <div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>git clone git@github.com:galaxyproject/bioblend.git\n</code></pre></div>  </div>\n\n  <p>If you have already forked these repositories, you probably want to replace the links in the commands above to point to the forks.</p>\n</blockquote>\n\n<h1 id=\"interacting-with-the-api\">Interacting with the API</h1>\n\n<h2 id=\"structure-of-the-galaxy-api\">Structure of the Galaxy API</h2>\n\n<p>The source code for the <abbr title=\"Application Programming Interface\">API</abbr> endpoints is contained in various files under <a href=\"https://github.com/galaxyproject/galaxy/tree/dev/lib/galaxy/webapps/galaxy/api\">lib/galaxy/webapps/galaxy/api/</a> in the Galaxy source code. Each of these files contains a controller which exposes functionality for a specific entity. For example, the dataset-related functionality is contained in the <code class=\"language-plaintext highlighter-rouge\">DatasetsController</code> class in the <a href=\"https://github.com/galaxyproject/galaxy/blob/v21.01/lib/galaxy/webapps/galaxy/api/datasets.py#L33\">datasets.py</a> file.</p>\n\n<p>Additionally, the <a href=\"https://github.com/galaxyproject/galaxy/blob/dev/lib/galaxy/webapps/galaxy/buildapp.py\">buildapp.py</a> file contains a complete listing of all the endpoints.</p>\n\n<blockquote class=\"comment\">\n  <comment-title>Note</comment-title>\n  <p>Different versions of Galaxy differ in the functionality that is implemented. The development version is named <code class=\"language-plaintext highlighter-rouge\">dev</code> and includes the most recent changes. Release versions are named according to their release date. These Galaxy releases can be accessed via git branches, e.g. <code class=\"language-plaintext highlighter-rouge\">release_20.01</code>. At the time of writing BioBlend supports Galaxy releases 17.09 and later, although some functionality is not supported by all of these versions.</p>\n</blockquote>\n\n<blockquote class=\"tip\">\n  <tip-title>Going deeper into the Galaxy back-end code</tip-title>\n  <p>The various Galaxy <abbr title=\"Application Programming Interface\">API</abbr> methods that are exposed to the outside are contained in controller classes. These contain the endpoint methods corresponding to the URLs of the Galaxy <abbr title=\"Application Programming Interface\">API</abbr>. These endpoint methods handle the incoming requests from BioBlend.</p>\n\n  <p>A focus for development of the Galaxy <abbr title=\"Application Programming Interface\">API</abbr> is to make these controllers as “terse” as possible. This basically means that any logic not strictly required by the <abbr title=\"Application Programming Interface\">API</abbr> endpoint method is moved to a corresponding manager class. This approach separates the <abbr title=\"Application Programming Interface\">API</abbr> more cleanly from internal functionality. The manager classes should contain as much of the functionality as possible. An example is the <a href=\"https://github.com/galaxyproject/galaxy/blob/v21.01/lib/galaxy/managers/datasets.py#L26\"><code class=\"language-plaintext highlighter-rouge\">DatasetManager</code></a>, referenced to regularly by the <code class=\"language-plaintext highlighter-rouge\">DatasetsController</code> which is exposed directly to the <abbr title=\"Application Programming Interface\">API</abbr>.</p>\n\n  <p>At the time of writing this transition is ongoing. Therefore, source code of methods for one controller might look and function differently than those of another controller. This might be encountered when debugging a failing request in BioBlend.</p>\n\n</blockquote>\n\n<h2 id=\"core-concepts-of-the-galaxy-interface\">Core concepts of the Galaxy interface</h2>\n\n<p>This section provides brief descriptions of the core concepts of the Galaxy interface, from the perspective of a BioBlend/Galaxy developer, rather than the typical Galaxy user. This list is by no means complete, but it should help those not already familiar with Galaxy.</p>\n\n<p>BioBlend provides separate clients for interacting with each of these entities. For example, the BioBlend client for jobs is the <code class=\"language-plaintext highlighter-rouge\">JobsClient</code> class. The source code for each <code class=\"language-plaintext highlighter-rouge\">Client</code> can be found under <a href=\"https://github.com/galaxyproject/bioblend/tree/main/bioblend/galaxy\">bioblend/galaxy/</a>.</p>\n\n<!-- This is the syntax for a definition list in markdown, it's semantically the most correct option here -->\n\n<dl>\n  <dt>Tool</dt>\n  <dd>A Galaxy tool packages a particular piece of scientific software, keeping track of its required dependencies. It also contains additional metadata such as the BibTex references to the associated research paper(s). Tools generally take datasets and/or dataset collections as inputs and produce new datasets and/or collections as outputs.</dd>\n  <dt>Dataset</dt>\n  <dd>A dataset represents digital data that can serve as input for a job. It can be associated with (contained in) a history or a library. A dataset can be shared between users. Each time a dataset is copied between histories or libraries, a new History Dataset Association (HDA) or Library Dataset Association (LDA) is created. This naming scheme is used internally by the Galaxy relational database, but the terms might be encountered during BioBlend development as well.</dd>\n  <dt>Dataset Collection</dt>\n  <dd>A dataset collection represents a group of related datasets. Like a dataset, it can be associated with a history or a library. Each time it is copied or shared, a new History Dataset Collection Association (HDCA) or a Library Dataset Collection Association (LDCA) is created.<br /><br />There are two kinds of dataset collections, <code class=\"language-plaintext highlighter-rouge\">list</code> and <code class=\"language-plaintext highlighter-rouge\">paired</code>. The former is a simple list of elements. The latter has a particular application in bioinformatics; it contains only two elements, corresponding to the <code class=\"language-plaintext highlighter-rouge\">forward</code> and <code class=\"language-plaintext highlighter-rouge\">reverse</code> strands of a piece of DNA.<br /><br /> Collection elements can be other collections; in other words, collections can be nested. These are designated (for example) as <code class=\"language-plaintext highlighter-rouge\">list:list</code> or <code class=\"language-plaintext highlighter-rouge\">list:paired</code>.</dd>\n  <dt>Job</dt>\n  <dd>Jobs are associated with the execution of a tool on the Galaxy server. Each dataset is created by running a tool and therefore has an associated job. The computation of each step in a workflow has an associated job as well.<br /><br />Jobs run as background processes on the Galaxy server. This is relevant because reading results before the appropriate jobs have finished can lead to missing data in the output. BioBlend methods must handle this by waiting for relevant jobs to finish before returning a response to the user.<br /><br />Job creation can be different when dealing with dataset collections. If a tool input receives a collection instead of a dataset, it will create a separate job for each element, resulting in an output collection with the same structure as the input. This is referred to as ‘mapping over’ a collection.</dd>\n  <dt>History</dt>\n  <dd>A history represents a container that keeps track of actions performed on its contents. Datasets are associated with a particular history; tools and workflows also need to be run in a particular history, which keeps track of the outputs produced by each of the resulting jobs or invocations. While the history is a very important concept to users of the graphical user interface, as it provides a constantly visible workspace to organize individual analyses or projects, it is slightly less relevant for BioBlend users.</dd>\n  <dt>Workflow</dt>\n  <dd>A workflow represents a computation pipeline, made up of multiple tools chained together. It is created and contained in a history. A workflow is comprised of steps, which can be either inputs or tools. Its structure can be imagined as a directed graph of nodes that process inputs and pass on their outputs to the next nodes. The initial input to a workflow is commonly one or multiple datasets or dataset collections, as well as input parameters.</dd>\n  <dt>Invocation</dt>\n  <dd>Just like a job represents a tool executed on certain inputs, an invocation represents the execution of a workflow on specified inputs and with certain specified parameters. Every invocation corresponds to only one workflow, and every step of the workflow has an associated invocation step. Each invocation step has jobs associated with it.</dd>\n  <dt>Library</dt>\n  <dd>A library represents a container for datasets and dataset collections. Datasets that are contained in a library can be shared between multiple Galaxy users.</dd>\n</dl>\n\n<h2 id=\"structure-of-the-bioblend-library\">Structure of the BioBlend library</h2>\n\n<p>BioBlend methods for the Galaxy API are associated with the various <code class=\"language-plaintext highlighter-rouge\">Clients</code> already mentioned, stored under <a href=\"https://github.com/galaxyproject/bioblend/tree/main/bioblend/galaxy\">bioblend/galaxy/</a> in the BioBlend GitHub repository. The functionality for each Galaxy entity is in a separate folder. For example, the methods for interacting with workflows are stored under <a href=\"https://github.com/galaxyproject/bioblend/tree/main/bioblend/galaxy/workflows\">bioblend/galaxy/workflows</a> in the <code class=\"language-plaintext highlighter-rouge\">WorkflowsClient</code> class.</p>\n\n<p>The tests for these methods are stored under <a href=\"https://github.com/galaxyproject/bioblend/tree/main/bioblend/_tests\">tests/</a>. For example, the tests related to workflows are in the file <a href=\"https://github.com/galaxyproject/bioblend/blob/main/bioblend/_tests/TestGalaxyWorkflows.py\">tests/TestGalaxyWorkflows.py</a>.</p>\n\n<p>The classic approach for accessing the Galaxy API is using the various clients and their methods. Each of these methods corresponds to one of the API endpoints. They send a request to the Galaxy server and return a Python object representing the parsed JSON response. Alternatively, there is also BioBlend.objects (<span class=\"citation\"><a href=\"#Leo2014\">Leo <i>et al.</i> 2014</a></span>), which provides an object-oriented API. Interaction with the API occurs via wrapper classes. These wrappers represent entity instances and provide methods to interact with and manipulate them. For example, a wrapper could represent a single workflow.</p>\n\n<blockquote class=\"question\">\n  <question-title>What is the difference between BioBlend and BioBlend.objects?</question-title>\n\n  <p>Look at the following code:</p>\n  <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\"># classic BioBlend\n</span><span class=\"kn\">from</span> <span class=\"n\">bioblend.galaxy</span> <span class=\"kn\">import</span> <span class=\"n\">GalaxyInstance</span>\n<span class=\"n\">gi</span> <span class=\"o\">=</span> <span class=\"nc\">GalaxyInstance</span><span class=\"p\">(</span><span class=\"n\">url</span><span class=\"o\">=</span><span class=\"n\">galaxy_url</span><span class=\"p\">,</span> <span class=\"n\">key</span><span class=\"o\">=</span><span class=\"n\">galaxy_key</span><span class=\"p\">)</span>\n<span class=\"n\">workflows</span> <span class=\"o\">=</span> <span class=\"n\">gi</span><span class=\"p\">.</span><span class=\"n\">workflows</span><span class=\"p\">.</span><span class=\"nf\">get_workflows</span><span class=\"p\">()</span>\n<span class=\"k\">for</span> <span class=\"n\">wf_dict</span> <span class=\"ow\">in</span> <span class=\"n\">workflows</span><span class=\"p\">:</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"si\">{</span><span class=\"n\">wf_dict</span><span class=\"p\">[</span><span class=\"sh\">'</span><span class=\"s\">name</span><span class=\"sh\">'</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s\"> : </span><span class=\"si\">{</span><span class=\"n\">wf_dict</span><span class=\"p\">[</span><span class=\"sh\">'</span><span class=\"s\">id</span><span class=\"sh\">'</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"sh\">\"</span><span class=\"p\">))</span>\n\n<span class=\"c1\"># BioBlend.objects\n</span><span class=\"kn\">from</span> <span class=\"n\">bioblend.galaxy.objects</span> <span class=\"kn\">import</span> <span class=\"n\">GalaxyInstance</span>\n<span class=\"n\">gi</span> <span class=\"o\">=</span> <span class=\"nc\">GalaxyInstance</span><span class=\"p\">(</span><span class=\"n\">galaxy_url</span><span class=\"p\">,</span> <span class=\"n\">galaxy_key</span><span class=\"p\">)</span>\n<span class=\"n\">workflows</span> <span class=\"o\">=</span> <span class=\"n\">gi</span><span class=\"p\">.</span><span class=\"n\">workflows</span><span class=\"p\">.</span><span class=\"nf\">get_previews</span><span class=\"p\">()</span>\n<span class=\"k\">for</span> <span class=\"n\">wf</span> <span class=\"ow\">in</span> <span class=\"n\">workflows</span><span class=\"p\">:</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"si\">{</span><span class=\"n\">wf</span><span class=\"p\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s\"> : </span><span class=\"si\">{</span><span class=\"n\">wf</span><span class=\"p\">.</span><span class=\"nb\">id</span><span class=\"si\">}</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n</code></pre></div>  </div>\n  <p>It does the same thing (prints all available workflows) using both BioBlend and BioBlend.objects. What differences can you see?</p>\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <p>The output of the classic BioBlend code is provided as JSON, which the user can continue to manipulate themselves. The BioBlend.objects code provides the same information, but in the format of a Python object. This has various properties which the user can access, using for example <code class=\"language-plaintext highlighter-rouge\">name</code> or <code class=\"language-plaintext highlighter-rouge\">id</code>.</p>\n\n    <p>You can view <a href=\"https://github.com/galaxyproject/bioblend/tree/main/docs/examples\">numerous examples of both here</a>.</p>\n  </blockquote>\n</blockquote>\n\n<blockquote class=\"comment\">\n  <comment-title>Note</comment-title>\n  <p>BioBlend also provides methods for interacting with the Galaxy <a href=\"https://galaxyproject.org/toolshed/\">ToolShed</a> and <a href=\"https://galaxyproject.org/cloudman/\">Cloudman</a>. However, this tutorial focuses on the part of BioBlend which provides access to the Galaxy API.</p>\n</blockquote>\n\n<h1 id=\"communicating-with-the-galaxy-api\">Communicating with the Galaxy API</h1>\n\n<p>We will make some manual requests to get a better feel for the Galaxy API. But first we need a valid API key in order to communicate with the Galaxy server through the API.</p>\n\n<!--SNIPPET-->\n<blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-getting-your-api-key\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-getting-your-api-key\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Getting your API key</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p>A quick way to get an API key is to create a new user on our local Galaxy server. Navigate to the Galaxy base directory and execute the <a href=\"https://github.com/galaxyproject/galaxy/blob/dev/run.sh\">run.sh</a> script. This starts the Galaxy server.</p>   <ol>   <li>In your browser, open your Galaxy homepage</li>   <li>Log in, or register a new account, if it’s the first time you’re logging in</li>   <li>Go to <code class=\"language-plaintext highlighter-rouge\">User -&gt; Preferences</code> in the top menu bar, then click on <code class=\"language-plaintext highlighter-rouge\">Manage API key</code></li>   <li>If there is no current API key available, click on <code class=\"language-plaintext highlighter-rouge\">Create a new key</code> to generate it</li>   <li>Copy your API key to somewhere convenient, you will need it throughout this tutorial</li> </ol> </blockquote>\n<p><!--END_SNIPPET--></p>\n\n<p>In the following examples we make use of a simple networking tool named <a href=\"https://curl.se\">curl</a>. Each command is listed together with the corresponding BioBlend and BioBlend.objects code.</p>\n\n<p>We assume basic familiarity with HTTP request methods. For an overview, see the Mozilla Developer Network <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods\">documentation</a>.</p>\n\n<p>Now, open a terminal window and let’s make a few manual requests! In each case, the corresponding BioBlend and BioBlend.objects code is also provided for comparison.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Making requests to the API</hands-on-title>\n  <ol>\n    <li>\n      <p><strong>GET request</strong></p>\n\n      <p>This is a simplest type of request. We request data from a specific URL, but we do not provide any further information apart from our API key. In this example we request a listing of all our invocations.</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>curl</code-in-title>\n        <div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>curl <span class=\"nt\">-X</span> GET <span class=\"nt\">-H</span> <span class=\"s1\">'x-api-key: &lt;API_KEY&gt;'</span> <span class=\"s1\">'localhost:8080/api/invocations'</span>\n</code></pre></div>        </div>\n\n        <p>The <code class=\"language-plaintext highlighter-rouge\">-X</code> flag specifies the HTTP method of our request. In this case we are making a GET request. GET is the default method, so we could also simply omit it here.</p>\n\n        <p>The <code class=\"language-plaintext highlighter-rouge\">-H</code> flag is used to specify HTTP headers. We authenticate our requests by specifying our API key in the <code class=\"language-plaintext highlighter-rouge\">x-api-key</code> header.</p>\n      </blockquote>\n\n      <blockquote class=\"code-out\">\n        <code-out-title>Example JSON response</code-out-title>\n        <div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"p\">[{</span>\n    <span class=\"dl\">'</span><span class=\"s1\">history_id</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">2f94e8ae9edff68a</span><span class=\"dl\">'</span><span class=\"p\">,</span>\n    <span class=\"dl\">'</span><span class=\"s1\">id</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">df7a1f0c02a5b08e</span><span class=\"dl\">'</span><span class=\"p\">,</span>\n    <span class=\"dl\">'</span><span class=\"s1\">model_class</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">WorkflowInvocation</span><span class=\"dl\">'</span><span class=\"p\">,</span>\n    <span class=\"dl\">'</span><span class=\"s1\">state</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">new</span><span class=\"dl\">'</span><span class=\"p\">,</span>\n    <span class=\"dl\">'</span><span class=\"s1\">update_time</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">2015-10-31T22:00:22</span><span class=\"dl\">'</span><span class=\"p\">,</span>\n    <span class=\"dl\">'</span><span class=\"s1\">uuid</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">c8aa2b1c-801a-11e5-a9e5-8ca98228593c</span><span class=\"dl\">'</span><span class=\"p\">,</span>\n    <span class=\"dl\">'</span><span class=\"s1\">workflow_id</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">03501d7626bd192f</span><span class=\"dl\">'</span><span class=\"p\">,</span>\n<span class=\"p\">}]</span>\n</code></pre></div>        </div>\n\n        <p>The above response would mean that our user has only invoked a workflow once. The workflow’s encoded ID is listed (<code class=\"language-plaintext highlighter-rouge\">workflow_id</code>), as well as the encoded ID of the history containing this workflow (<code class=\"language-plaintext highlighter-rouge\">history_id</code>), and the ID of the invocation itself (<code class=\"language-plaintext highlighter-rouge\">id</code>). The state <code class=\"language-plaintext highlighter-rouge\">new</code> indicates that the request to invoke this workflow is still pending and that the invocation has not been scheduled yet.</p>\n      </blockquote>\n\n      <p>BioBlend code:</p>\n\n      <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">from</span> <span class=\"n\">bioblend.galaxy</span> <span class=\"kn\">import</span> <span class=\"n\">GalaxyInstance</span>\n<span class=\"n\">gi</span> <span class=\"o\">=</span> <span class=\"nc\">GalaxyInstance</span><span class=\"p\">(</span><span class=\"sh\">'</span><span class=\"s\">http://localhost:8080</span><span class=\"sh\">'</span><span class=\"p\">,</span> <span class=\"n\">key</span><span class=\"o\">=&lt;</span><span class=\"n\">API_KEY</span><span class=\"o\">&gt;</span><span class=\"p\">)</span>\n<span class=\"n\">invs</span> <span class=\"o\">=</span> <span class=\"n\">gi</span><span class=\"p\">.</span><span class=\"n\">invocations</span><span class=\"p\">.</span><span class=\"nf\">get_invocations</span><span class=\"p\">()</span>\n<span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">invs</span><span class=\"p\">)</span>\n</code></pre></div>      </div>\n\n      <p>BioBlend.objects code:</p>\n\n      <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">from</span> <span class=\"n\">bioblend.galaxy.objects</span> <span class=\"kn\">import</span> <span class=\"n\">GalaxyInstance</span>\n<span class=\"n\">obj_gi</span> <span class=\"o\">=</span> <span class=\"nc\">GalaxyInstance</span><span class=\"p\">(</span><span class=\"sh\">'</span><span class=\"s\">http://localhost:8080</span><span class=\"sh\">'</span><span class=\"p\">,</span> <span class=\"n\">key</span><span class=\"o\">=&lt;</span><span class=\"n\">API_KEY</span><span class=\"o\">&gt;</span><span class=\"p\">)</span>\n<span class=\"n\">previews</span> <span class=\"o\">=</span> <span class=\"n\">obj_gi</span><span class=\"p\">.</span><span class=\"n\">invocations</span><span class=\"p\">.</span><span class=\"nf\">get_previews</span><span class=\"p\">()</span>\n<span class=\"k\">for</span> <span class=\"n\">preview</span> <span class=\"ow\">in</span> <span class=\"n\">previews</span><span class=\"p\">:</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">preview</span><span class=\"p\">.</span><span class=\"nb\">id</span><span class=\"p\">)</span>\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p><strong>GET request with query parameters</strong></p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>curl</code-in-title>\n        <p>In this example we include two query parameters in our request, <code class=\"language-plaintext highlighter-rouge\">limit</code> and <code class=\"language-plaintext highlighter-rouge\">include_terminal</code>.</p>\n\n        <div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>curl <span class=\"nt\">-X</span> GET <span class=\"nt\">-H</span> <span class=\"s1\">'x-api-key: &lt;API_KEY&gt;'</span> <span class=\"se\">\\</span>\n     <span class=\"s1\">'localhost:8080/api/invocations?limit=5&amp;include_terminal=False'</span>\n</code></pre></div>        </div>\n\n        <p>With <code class=\"language-plaintext highlighter-rouge\">limit=5</code> we limit the result to at most 5 invocations. With <code class=\"language-plaintext highlighter-rouge\">include_terminal=False</code> we indicate that invocations in a terminal state should be excluded from the results.</p>\n      </blockquote>\n\n      <blockquote class=\"code-out\">\n        <code-out-title>Example JSON response</code-out-title>\n        <div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"p\">[]</span>\n</code></pre></div>        </div>\n\n        <p>The above response would mean that there are no workflows in a non-terminal state - any workflows which have been invoked have been successfully scheduled.</p>\n      </blockquote>\n\n      <p>BioBlend code:</p>\n      <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">invs</span> <span class=\"o\">=</span> <span class=\"n\">gi</span><span class=\"p\">.</span><span class=\"n\">invocations</span><span class=\"p\">.</span><span class=\"nf\">get_invocations</span><span class=\"p\">(</span><span class=\"n\">limit</span><span class=\"o\">=</span><span class=\"mi\">5</span><span class=\"p\">,</span> <span class=\"n\">include_terminal</span><span class=\"o\">=</span><span class=\"bp\">False</span><span class=\"p\">)</span>\n<span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">invs</span><span class=\"p\">)</span>\n</code></pre></div>      </div>\n\n      <p>BioBlend.objects code:</p>\n      <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">invs</span> <span class=\"o\">=</span> <span class=\"n\">obj_gi</span><span class=\"p\">.</span><span class=\"n\">invocations</span><span class=\"p\">.</span><span class=\"nf\">list</span><span class=\"p\">(</span><span class=\"n\">limit</span><span class=\"o\">=</span><span class=\"mi\">5</span><span class=\"p\">,</span> <span class=\"n\">include_terminal</span><span class=\"o\">=</span><span class=\"bp\">False</span><span class=\"p\">)</span>\n<span class=\"k\">for</span> <span class=\"n\">invocation</span> <span class=\"ow\">in</span> <span class=\"n\">invs</span><span class=\"p\">:</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">invocation</span><span class=\"p\">.</span><span class=\"nb\">id</span><span class=\"p\">)</span>\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p><strong>POST request with a payload</strong></p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>curl</code-in-title>\n        <div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>curl <span class=\"nt\">-X</span> POST <span class=\"se\">\\</span>\n    <span class=\"nt\">-H</span> <span class=\"s1\">'x-api-key: &lt;API_KEY&gt;'</span> <span class=\"se\">\\</span>\n    <span class=\"nt\">-H</span> <span class=\"s1\">'Content-Type: application/json'</span> <span class=\"se\">\\</span>\n    <span class=\"nt\">-d</span> <span class=\"s1\">'{\"name\":\"MyNewHistory\"}'</span> <span class=\"se\">\\</span>\n    <span class=\"s1\">'localhost:8080/api/histories'</span>\n</code></pre></div>        </div>\n\n        <p>This creates a new history with the name ‘MyNewHistory’.</p>\n      </blockquote>\n\n      <blockquote class=\"code-out\">\n        <code-out-title>Example JSON response</code-out-title>\n        <div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"p\">{</span><span class=\"dl\">'</span><span class=\"s1\">update_time</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">2021-05-24T13:04:05.393590</span><span class=\"dl\">'</span><span class=\"p\">,</span>\n<span class=\"dl\">'</span><span class=\"s1\">user_id</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">e9376175b7f708de</span><span class=\"dl\">'</span><span class=\"p\">,</span>\n<span class=\"dl\">'</span><span class=\"s1\">name</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">MyNewHistory</span><span class=\"dl\">'</span><span class=\"p\">,</span>\n<span class=\"dl\">'</span><span class=\"s1\">genome_build</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"nx\">None</span><span class=\"p\">,</span>\n<span class=\"dl\">'</span><span class=\"s1\">username_and_slug</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"nx\">None</span><span class=\"p\">,</span>\n<span class=\"dl\">'</span><span class=\"s1\">deleted</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"nx\">False</span><span class=\"p\">,</span>\n<span class=\"dl\">'</span><span class=\"s1\">published</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"nx\">False</span><span class=\"p\">,</span>\n<span class=\"dl\">'</span><span class=\"s1\">slug</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"nx\">None</span><span class=\"p\">,</span>\n<span class=\"dl\">'</span><span class=\"s1\">model_class</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">History</span><span class=\"dl\">'</span><span class=\"p\">,</span>\n<span class=\"dl\">'</span><span class=\"s1\">state</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">new</span><span class=\"dl\">'</span><span class=\"p\">,</span>\n<span class=\"dl\">'</span><span class=\"s1\">id</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">464411b81613694d</span><span class=\"dl\">'</span><span class=\"p\">,</span>\n<span class=\"dl\">'</span><span class=\"s1\">empty</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"nx\">True</span><span class=\"p\">,</span>\n<span class=\"dl\">'</span><span class=\"s1\">annotation</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"nx\">None</span><span class=\"p\">,</span>\n<span class=\"dl\">'</span><span class=\"s1\">importable</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"nx\">False</span><span class=\"p\">,</span>\n<span class=\"dl\">'</span><span class=\"s1\">state_ids</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"dl\">'</span><span class=\"s1\">new</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"p\">[],</span>\n <span class=\"dl\">'</span><span class=\"s1\">upload</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"p\">[],</span>\n <span class=\"dl\">'</span><span class=\"s1\">queued</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"p\">[],</span>\n <span class=\"dl\">'</span><span class=\"s1\">running</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"p\">[],</span>\n <span class=\"dl\">'</span><span class=\"s1\">ok</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"p\">[],</span>\n <span class=\"dl\">'</span><span class=\"s1\">empty</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"p\">[],</span>\n <span class=\"dl\">'</span><span class=\"s1\">error</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"p\">[],</span>\n <span class=\"dl\">'</span><span class=\"s1\">discarded</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"p\">[],</span>\n <span class=\"dl\">'</span><span class=\"s1\">paused</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"p\">[],</span>\n <span class=\"dl\">'</span><span class=\"s1\">setting_metadata</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"p\">[],</span>\n <span class=\"dl\">'</span><span class=\"s1\">failed_metadata</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"p\">[]},</span>\n<span class=\"dl\">'</span><span class=\"s1\">create_time</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">2021-05-24T13:04:05.393579</span><span class=\"dl\">'</span><span class=\"p\">,</span>\n<span class=\"dl\">'</span><span class=\"s1\">purged</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"nx\">False</span><span class=\"p\">,</span>\n<span class=\"dl\">'</span><span class=\"s1\">tags</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"p\">[],</span>\n<span class=\"dl\">'</span><span class=\"s1\">contents_url</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">/api/histories/464411b81613694d/contents</span><span class=\"dl\">'</span><span class=\"p\">,</span>\n<span class=\"dl\">'</span><span class=\"s1\">size</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n<span class=\"dl\">'</span><span class=\"s1\">state_details</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"dl\">'</span><span class=\"s1\">new</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"dl\">'</span><span class=\"s1\">upload</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"dl\">'</span><span class=\"s1\">queued</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"dl\">'</span><span class=\"s1\">running</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"dl\">'</span><span class=\"s1\">ok</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"dl\">'</span><span class=\"s1\">empty</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"dl\">'</span><span class=\"s1\">error</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"dl\">'</span><span class=\"s1\">discarded</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"dl\">'</span><span class=\"s1\">paused</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"dl\">'</span><span class=\"s1\">setting_metadata</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"dl\">'</span><span class=\"s1\">failed_metadata</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">},</span>\n<span class=\"dl\">'</span><span class=\"s1\">url</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">/api/histories/464411b81613694d</span><span class=\"dl\">'</span><span class=\"p\">}</span>\n</code></pre></div>        </div>\n\n        <p>The response contains some basic information about the newly created history, including the <code class=\"language-plaintext highlighter-rouge\">history_id</code>, which we would need for further API calls.</p>\n      </blockquote>\n\n      <p>BioBlend code:</p>\n      <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">history</span> <span class=\"o\">=</span> <span class=\"n\">gi</span><span class=\"p\">.</span><span class=\"n\">histories</span><span class=\"p\">.</span><span class=\"nf\">create_history</span><span class=\"p\">(</span><span class=\"sh\">'</span><span class=\"s\">MyNewHistory</span><span class=\"sh\">'</span><span class=\"p\">)</span>\n<span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">history</span><span class=\"p\">)</span>\n</code></pre></div>      </div>\n\n      <p>BioBlend.objects code:</p>\n\n      <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">history</span> <span class=\"o\">=</span> <span class=\"n\">obj_gi</span><span class=\"p\">.</span><span class=\"n\">histories</span><span class=\"p\">.</span><span class=\"nf\">create</span><span class=\"p\">(</span><span class=\"sh\">'</span><span class=\"s\">MyNewHistory</span><span class=\"sh\">'</span><span class=\"p\">)</span>\n<span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">history</span><span class=\"p\">.</span><span class=\"n\">name</span><span class=\"p\">)</span>\n</code></pre></div>      </div>\n    </li>\n  </ol>\n</blockquote>\n\n<blockquote class=\"tip\">\n  <tip-title>Encoded and non-encoded IDs in Galaxy</tip-title>\n  <p>While making the API calls now, we encountered various IDs - for example, we created a history with ID <code class=\"language-plaintext highlighter-rouge\">464411b81613694d</code>. How do Galaxy IDs work?</p>\n\n  <p>The Galaxy server assigns a numeric (integer) ID to every entity, which serves as its unique identifier. (The exception are tools, which have a predefined string ID specified in the <a href=\"https://docs.galaxyproject.org/en/latest/dev/schema.html#attributes\">XML wrapper</a> defining the tool.) For example, each workflow, invocation, history and dataset is assigned a unique ID. If you access the Galaxy database directly, using a tool such as <a href=\"https://github.com/usegalaxy-eu/gxadmin\">gxadmin</a>, these integers are the IDs that you will see.</p>\n\n  <p>However, these IDs are not (or should not be!) exposed through the API. The Galaxy server encodes the numeric IDs into hexadecimal strings before sending them to external API clients. These are referred to as encoded IDs. BioBlend only deals with these encoded IDs.</p>\n\n</blockquote>\n\n<blockquote class=\"tip\">\n  <tip-title>Params versus payload: what's the difference?</tip-title>\n\n  <p>In BioBlend, the <code class=\"language-plaintext highlighter-rouge\">Client._get()</code> helper method is used for GET requests. It takes a <code class=\"language-plaintext highlighter-rouge\">params</code> argument. The <code class=\"language-plaintext highlighter-rouge\">Client._post()</code> and <code class=\"language-plaintext highlighter-rouge\">Client._put()</code> helper methods make POST and PUT requests respectively. They expect a <code class=\"language-plaintext highlighter-rouge\">payload</code> argument. In this section we briefly explain the difference.</p>\n\n  <p>An HTTP request is comprised of (1) a request line, (2) headers with metadata, (3) an empty line and (4) an optional message body. The HTTP GET method uses query parameters to specify which resource should be retrieved from the server. These parameters are included in the request line as part of the URL. The HTTP POST and PUT methods create or update resources. This data is specified in the payload, which is included in the message body of the request.</p>\n\n  <p>We can see the difference using <a href=\"https://curl.se\">curl</a> and <a href=\"https://nmap.org/ncat/\">ncat</a>.</p>\n\n  <p>Open a terminal and run the <code class=\"language-plaintext highlighter-rouge\">ncat</code> command in listen mode on port 8080. The loop will print out any incoming requests; each request is separated by a line containing <code class=\"language-plaintext highlighter-rouge\">---</code>.</p>\n\n  <div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">while </span>ncat <span class=\"nt\">--listen</span> 8080<span class=\"p\">;</span> <span class=\"k\">do </span><span class=\"nb\">printf</span> <span class=\"s2\">\"</span><span class=\"se\">\\n</span><span class=\"s2\">---</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span><span class=\"p\">;</span> <span class=\"k\">done</span>\n</code></pre></div>  </div>\n\n  <blockquote class=\"comment\">\n    <comment-title>Note</comment-title>\n    <p>The <code class=\"language-plaintext highlighter-rouge\">ncat</code> command is a low-level networking tool that does not respond to any incoming connections. Since HTTP is done over <a href=\"https://en.wikipedia.org/wiki/Transmission_Control_Protocol\">TCP</a>, the <code class=\"language-plaintext highlighter-rouge\">curl</code> command will hang expecting a response. Simply press <kbd>CTRL</kbd> + <kbd>C</kbd> to terminate the <code class=\"language-plaintext highlighter-rouge\">curl</code> command.</p>\n  </blockquote>\n\n  <h4 id=\"parameters\">Parameters</h4>\n\n  <p>Open a second terminal and send a GET request with a query parameter:</p>\n\n  <blockquote class=\"code-in\">\n    <code-in-title>curl</code-in-title>\n    <div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>curl <span class=\"nt\">-X</span> GET localhost:8080/?message<span class=\"o\">=</span>Hello\n</code></pre></div>    </div>\n  </blockquote>\n\n  <blockquote class=\"code-out\">\n    <code-out-title>ncat</code-out-title>\n    <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>GET /?message=Hello HTTP/1.1\nHost: localhost:8080\nUser-Agent: curl/7.76.1\nAccept: */*\n\n\n</code></pre></div>    </div>\n\n    <p>The two blank lines indicate that the payload is empty.</p>\n  </blockquote>\n\n  <h4 id=\"payload\">Payload</h4>\n\n  <p>Send a POST request with the payload ‘My name is curl’.</p>\n\n  <blockquote class=\"code-in\">\n    <code-in-title>curl</code-in-title>\n    <div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>curl <span class=\"nt\">-X</span> POST <span class=\"nt\">-d</span> <span class=\"s1\">'My name is curl'</span> localhost:8080\n</code></pre></div>    </div>\n  </blockquote>\n\n  <blockquote class=\"code-out\">\n    <code-out-title>ncat</code-out-title>\n    <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>POST / HTTP/1.1\nHost: localhost:8080\nUser-Agent: curl/7.76.1\nAccept: */*\nContent-Length: 15\nContent-Type: application/x-www-form-urlencoded\n\nMy name is curl\n</code></pre></div>    </div>\n\n    <p>The message body now contains our payload.</p>\n  </blockquote>\n</blockquote>\n\n<h1 id=\"creating-a-simple-bioblend-method\">Creating a simple BioBlend method</h1>\n\n<p>As an introduction to BioBlend development, we will extend the BioBlend <code class=\"language-plaintext highlighter-rouge\">ToolsClient</code> class by adding a new method named <code class=\"language-plaintext highlighter-rouge\">uninstall_dependencies()</code>. This method will send a request to the Galaxy server to uninstall any dependencies for the specified tool.</p>\n\n<blockquote class=\"comment\">\n  <comment-title>Note</comment-title>\n  <p>This example is based on the pull request “<a href=\"https://github.com/galaxyproject/bioblend/pull/390\">Improving Tools API coverage</a>” in the BioBlend repository.</p>\n</blockquote>\n\n<h2 id=\"identifying-the-relevant-galaxy-endpoint\">Identifying the relevant Galaxy endpoint</h2>\n\n<p>We should check the Galaxy controller to verify whether this functionality is already implemented in the Galaxy API. Let’s check the <code class=\"language-plaintext highlighter-rouge\">dev</code> version of Galaxy. Our method interacts with the tools API, so let’s check the <a href=\"https://github.com/galaxyproject/galaxy/blob/dev/lib/galaxy/webapps/galaxy/api/tools.py\">api/tools.py</a> file.</p>\n\n<p>As it turns out, a corresponding <a href=\"https://github.com/galaxyproject/galaxy/blob/v21.01/lib/galaxy/webapps/galaxy/api/tools.py#L293\"><code class=\"language-plaintext highlighter-rouge\">uninstall_dependencies()</code></a> endpoint method is already available in the Galaxy <code class=\"language-plaintext highlighter-rouge\">dev</code> branch. Lucky us! If this was not the case, then we would have first had to implement the endpoint in Galaxy, before writing a BioBlend method to interact with it.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Creating the method and a simple test</hands-on-title>\n  <ol>\n    <li>\n      <p><strong>Constructing the correct method signature</strong></p>\n\n      <p>Let’s look at the signature of the endpoint method:</p>\n\n      <p><strong>File <a href=\"https://github.com/galaxyproject/galaxy/blob/v21.01/lib/galaxy/webapps/galaxy/api/tools.py#L293\">api/tools.py</a>, line 291</strong>:</p>\n      <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">def</span> <span class=\"nf\">uninstall_dependencies</span><span class=\"p\">(</span><span class=\"n\">self</span><span class=\"p\">,</span> <span class=\"n\">trans</span><span class=\"p\">:</span> <span class=\"n\">GalaxyWebTransaction</span><span class=\"p\">,</span> <span class=\"nb\">id</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwds</span><span class=\"p\">):</span>\n</code></pre></div>      </div>\n      <p>The <code class=\"language-plaintext highlighter-rouge\">GalaxyWebTransaction</code> is an object which represents our API request. It is internal to the Galaxy server. We do not specify it as a parameter in BioBlend.</p>\n\n      <p>We can see that it also expects an <code class=\"language-plaintext highlighter-rouge\">id</code> parameter, which is the tool ID. The <code class=\"language-plaintext highlighter-rouge\">kwds</code> argument indicates that the endpoint might accept additional keyword arguments as well.</p>\n\n      <p>Let’s check the method documentation:</p>\n      <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"sh\">\"\"\"</span><span class=\"s\">\nDELETE /api/tools/{tool_id}/dependencies\nAttempts to uninstall requirements via the dependency resolver\n\nparameters:\n\n    index:\n        index of dependency resolver to use when installing dependency.\n        Defaults to using the highest ranking resolver\n\n    resolver_type:\n        Use the dependency resolver of this resolver_type to install\n        dependency\n</span><span class=\"sh\">\"\"\"</span>\n</code></pre></div>      </div>\n      <p>The endpoint expects a DELETE request at URL <code class=\"language-plaintext highlighter-rouge\">/api/tools/{tool_id}/dependencies</code>. The <code class=\"language-plaintext highlighter-rouge\">id</code> parameter in the method signature corresponds to the variable <code class=\"language-plaintext highlighter-rouge\">{tool_id}</code> present in the endpoint URL.</p>\n\n      <p>There are two additional parameters: <code class=\"language-plaintext highlighter-rouge\">index</code> and <code class=\"language-plaintext highlighter-rouge\">resolver_type</code>. These parameters specify how the server should resolve the tool dependencies. For an average API user these options are probably too specific as they require knowledge of the resolvers used by the Galaxy server back end. We will skip these parameters for this example.</p>\n\n      <p>Lastly, we need to find out what the endpoint returns. Unfortunately the return type is not listed in the method documentation. It is a reality that various parts of the Galaxy API lack complete documentation, although this is being worked on.</p>\n\n      <p>Let’s look at the return statement of the endpoint:</p>\n      <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">return</span> <span class=\"n\">tool</span><span class=\"p\">.</span><span class=\"n\">tool_requirements_status</span>\n</code></pre></div>      </div>\n      <p>Here the tool API controller calls the <code class=\"language-plaintext highlighter-rouge\">tool_requirements_status</code> property of the <code class=\"language-plaintext highlighter-rouge\">Tool</code> class instance, which represents the tool corresponding to the <code class=\"language-plaintext highlighter-rouge\">id</code> parameter. Let’s also check the definition of this property.</p>\n\n      <p><strong>File <a href=\"https://github.com/galaxyproject/galaxy/blob/v21.01/lib/galaxy/tools/__init__.py#L1833\">tools/__init__.py</a>, line 1833</strong>:</p>\n      <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">def</span> <span class=\"nf\">tool_requirements_status</span><span class=\"p\">(</span><span class=\"n\">self</span><span class=\"p\">):</span>\n    <span class=\"sh\">\"\"\"</span><span class=\"s\">\n    Return a list of dictionaries for all tool dependencies with their\n    associated status\n    </span><span class=\"sh\">\"\"\"</span>\n    <span class=\"k\">return</span> <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"n\">_view</span><span class=\"p\">.</span><span class=\"nf\">get_requirements_status</span><span class=\"p\">(</span>\n        <span class=\"p\">{</span><span class=\"n\">self</span><span class=\"p\">.</span><span class=\"nb\">id</span><span class=\"p\">:</span> <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"n\">tool_requirements</span><span class=\"p\">},</span>\n        <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"n\">installed_tool_dependencies</span>\n    <span class=\"p\">)</span>\n</code></pre></div>      </div>\n      <p>The documentation of this method mentions that it returns a list of dictionaries for all tool dependencies with their associated status. Now we know the return type of the endpoint method!</p>\n\n      <p>Our BioBlend method will receive this list of dictionaries encoded as JSON in the server response. It will parse the JSON and return the list. Thus, the signature of our new <code class=\"language-plaintext highlighter-rouge\">uninstall_dependencies()</code> method will be as follows:</p>\n\n      <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">def</span> <span class=\"nf\">uninstall_dependencies</span><span class=\"p\">(</span><span class=\"n\">self</span><span class=\"p\">,</span> <span class=\"n\">tool_id</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"nb\">dict</span><span class=\"p\">]:</span>\n</code></pre></div>      </div>\n\n      <p>The <code class=\"language-plaintext highlighter-rouge\">self</code> parameter corresponds to the <code class=\"language-plaintext highlighter-rouge\">ToolsClient</code> instance. The parameter <code class=\"language-plaintext highlighter-rouge\">tool_id</code> corresponds to the encoded ID for a given tool. This ID will be substituted in place of <code class=\"language-plaintext highlighter-rouge\">{tool_id}</code> in the request URL.</p>\n    </li>\n    <li>\n      <p><strong>Adding the method body</strong></p>\n\n      <p>Our method is part of the <code class=\"language-plaintext highlighter-rouge\">ToolsClient</code> class. This means that our method has access to all its helper methods.\nLet’s recall that the endpoint expects a DELETE request at URL <code class=\"language-plaintext highlighter-rouge\">/api/tools/{tool_id}/dependencies</code>.</p>\n\n      <p>To translate this into BioBlend source code, we do the following:</p>\n\n      <ul>\n        <li>\n          <p>We use the <code class=\"language-plaintext highlighter-rouge\">self._make_url()</code> helper method to construct a valid URL with the supplied <code class=\"language-plaintext highlighter-rouge\">tool_id</code> parameter. Finally, we need to append <code class=\"language-plaintext highlighter-rouge\">'/dependencies'</code> for our endpoint.</p>\n\n          <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>  <span class=\"n\">url</span> <span class=\"o\">=</span> <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"nf\">_make_url</span><span class=\"p\">(</span><span class=\"n\">tool_id</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"sh\">'</span><span class=\"s\">/dependencies</span><span class=\"sh\">'</span>\n</code></pre></div>          </div>\n        </li>\n        <li>\n          <p>BioBlend clients also include helper methods for making requests of various types. In this case we want to make a DELETE request, so we use the <code class=\"language-plaintext highlighter-rouge\">self._delete()</code> helper method with our constructed URL as argument. These helper methods are inherited from the <code class=\"language-plaintext highlighter-rouge\">Client</code> class located at <a href=\"https://github.com/galaxyproject/bioblend/blob/v0.16.0/bioblend/galaxy/client.py#L19\">bioblend/galaxy/client.py</a>.</p>\n        </li>\n      </ul>\n\n      <p>The <code class=\"language-plaintext highlighter-rouge\">_delete()</code> method also expects a <code class=\"language-plaintext highlighter-rouge\">payload</code> argument. Our payload will be empty (<code class=\"language-plaintext highlighter-rouge\">{}</code>), since we use <code class=\"language-plaintext highlighter-rouge\">tool_id</code> only to construct the URL and there are no additional parameters to pass. This helper method automatically parses the JSON response into a Python object, so we can directly return its result.</p>\n\n      <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">return</span> <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"nf\">_delete</span><span class=\"p\">(</span><span class=\"n\">payload</span><span class=\"o\">=</span><span class=\"p\">{},</span> <span class=\"n\">url</span><span class=\"o\">=</span><span class=\"n\">url</span><span class=\"p\">)</span>\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p><strong>Adding the docstring</strong></p>\n\n      <p>We should document the method and its parameter for the user.</p>\n      <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"sh\">\"\"\"</span><span class=\"s\">\nUninstall dependencies for a given tool via a resolver.\n\n:type tool_id: str\n:param tool_id: id of the requested tool\n\n:rtype: list of dicts\n:return: Tool requirement statuses\n</span><span class=\"sh\">\"\"\"</span>\n</code></pre></div>      </div>\n\n      <p>This is the docstring format used in BioBlend. At the top we provide a short general description of the method. Then we document each parameter with its type and a short description. The return value of the method is documented last. After the PR is merged, the docstring will be rendered as part of the <a href=\"https://bioblend.readthedocs.io/en/latest/api_docs/galaxy/all.html\">BioBlend documentation</a>.</p>\n    </li>\n    <li>\n      <p><strong>Checking Galaxy version compatibility</strong></p>\n\n      <p>In case certain versions of Galaxy do not support our method’s functionality, we should append a note to the method’s docstring.</p>\n\n      <p><strong>Example</strong>:</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>.. note::\n    This method is only supported by Galaxy 19.09 or later.\n</code></pre></div>      </div>\n\n      <p>Previously we made sure that the <code class=\"language-plaintext highlighter-rouge\">dev</code> version of Galaxy supported our method. Let’s now check if older versions of Galaxy also support it. At the time of writing, Galaxy 17.09 is the earliest version supported by BioBlend, so it makes sense to check it first.</p>\n\n      <p>It turns out that Galaxy 17.09 also <a href=\"https://github.com/galaxyproject/galaxy/blob/v17.09/lib/galaxy/webapps/galaxy/api/tools.py#L159\">supports</a> our method! It’s safe to assume that all later versions do as well, and thus we do not need to add a note.</p>\n\n      <blockquote class=\"tip\">\n        <tip-title>Determining the Galaxy version from within BioBlend</tip-title>\n        <p>In certain situations it might be useful to determine the version of the Galaxy server from BioBlend. We can determine the version using the <code class=\"language-plaintext highlighter-rouge\">self.gi.config.get_version()</code> method.</p>\n\n        <p><strong>Example</strong>:</p>\n\n        <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">if</span> <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"n\">gi</span><span class=\"p\">.</span><span class=\"n\">config</span><span class=\"p\">.</span><span class=\"nf\">get_version</span><span class=\"p\">()[</span><span class=\"sh\">'</span><span class=\"s\">version_major</span><span class=\"sh\">'</span><span class=\"p\">]</span> <span class=\"o\">&gt;=</span> <span class=\"sh\">'</span><span class=\"s\">21.01</span><span class=\"sh\">'</span><span class=\"p\">:</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sh\">'</span><span class=\"s\">Newer version of Galaxy!</span><span class=\"sh\">'</span><span class=\"p\">)</span>\n<span class=\"k\">else</span><span class=\"p\">:</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sh\">'</span><span class=\"s\">Older version of Galaxy!</span><span class=\"sh\">'</span><span class=\"p\">)</span>\n</code></pre></div>        </div>\n        <p>An example where this is useful is the <a href=\"https://github.com/galaxyproject/bioblend/blob/v0.16.0/bioblend/galaxy/dataset_collections/__init__.py#L125\"><code class=\"language-plaintext highlighter-rouge\">download_dataset_collection()</code></a> method. It downloads a dataset collection as an archive file. Early versions of Galaxy return a ‘tar.gz’ archive. Later versions return a ‘zip’ archive. The BioBlend method uses the Galaxy version to determine the archive type.</p>\n      </blockquote>\n    </li>\n    <li>\n      <p><strong>Putting it all together</strong></p>\n\n      <p>In the end, our new method should look something like this:</p>\n\n      <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">def</span> <span class=\"nf\">uninstall_dependencies</span><span class=\"p\">(</span><span class=\"n\">self</span><span class=\"p\">,</span> <span class=\"n\">tool_id</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"nb\">dict</span><span class=\"p\">]:</span>\n    <span class=\"sh\">\"\"\"</span><span class=\"s\">\n    Uninstall dependencies for a given tool via a resolver.\n\n    :type tool_id: str\n    :param tool_id: id of the requested tool\n\n    :rtype: list of dicts\n    :return: Tool requirement statuses\n    </span><span class=\"sh\">\"\"\"</span>\n    <span class=\"n\">url</span> <span class=\"o\">=</span> <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"nf\">_make_url</span><span class=\"p\">(</span><span class=\"n\">tool_id</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"sh\">'</span><span class=\"s\">/dependencies</span><span class=\"sh\">'</span>\n    <span class=\"k\">return</span> <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"nf\">_delete</span><span class=\"p\">(</span><span class=\"n\">payload</span><span class=\"o\">=</span><span class=\"p\">{},</span> <span class=\"n\">url</span><span class=\"o\">=</span><span class=\"n\">url</span><span class=\"p\">)</span>\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p><strong>Writing a test for our new method</strong></p>\n\n      <p>It is best to keep BioBlend tests simple. We need to check that we get an expected response, but testing minute details is unnecessary, since those are the responsibility of the Galaxy server itself.<br /></p>\n\n      <p>Therefore, let’s check that, when run on a given tool ID, the returned status indicates that the dependencies are null. We can reuse a tool ID from an existent test method. Let’s take <code class=\"language-plaintext highlighter-rouge\">CONVERTER_fasta_to_bowtie_color_index</code>, which has only one dependency.</p>\n\n      <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">def</span> <span class=\"nf\">test_tool_dependency_uninstall</span><span class=\"p\">(</span><span class=\"n\">self</span><span class=\"p\">):</span>\n    <span class=\"n\">statuses</span> <span class=\"o\">=</span> <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"n\">gi</span><span class=\"p\">.</span><span class=\"n\">tools</span><span class=\"p\">.</span><span class=\"nf\">uninstall_dependencies</span><span class=\"p\">(</span>\n         <span class=\"sh\">'</span><span class=\"s\">CONVERTER_fasta_to_bowtie_color_index</span><span class=\"sh\">'</span>\n    <span class=\"p\">)</span>\n    <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"nf\">assertEqual</span><span class=\"p\">(</span><span class=\"n\">statuses</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">][</span><span class=\"sh\">'</span><span class=\"s\">model_class</span><span class=\"sh\">'</span><span class=\"p\">],</span> <span class=\"sh\">'</span><span class=\"s\">NullDependency</span><span class=\"sh\">'</span><span class=\"p\">)</span>\n</code></pre></div>      </div>\n\n      <blockquote class=\"tip\">\n        <tip-title>Skip tests with the `@test_util.skip_unless_galaxy` decorator</tip-title>\n        <p>On our local machine we normally test our changes against a single version of Galaxy, for example <code class=\"language-plaintext highlighter-rouge\">dev</code>. However, GitHub Actions continuous integration runs the BioBlend tests against all supported versions of Galaxy.</p>\n\n        <p>At the time of writing BioBlend supports Galaxy 17.09 and later. However, certain functionality might not be available in all these versions. For example, <code class=\"language-plaintext highlighter-rouge\">download_dataset_collection</code> is only supported by Galaxy 18.01 and later. We don’t want to run tests specific to this functionality on earlier versions of Galaxy. They would simply fail. We can skip a test for specific versions of Galaxy by adding the <code class=\"language-plaintext highlighter-rouge\">@test_util.skip_unless_galaxy</code> decorator above the test method in question.</p>\n\n        <p><strong>Example</strong>:</p>\n        <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nd\">@test_util.skip_unless_galaxy</span><span class=\"p\">(</span><span class=\"sh\">'</span><span class=\"s\">release_19.09</span><span class=\"sh\">'</span><span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">test_some_functionality</span><span class=\"p\">(</span><span class=\"n\">self</span><span class=\"p\">):</span>\n</code></pre></div>        </div>\n        <p>This test will only be run against Galaxy 19.09 and later.</p>\n      </blockquote>\n    </li>\n  </ol>\n</blockquote>\n\n<blockquote class=\"tip\">\n  <tip-title>Galaxy API parameter formats</tip-title>\n\n  <p>Implementing a BioBlend method often requires knowledge about the parameters which are accepted by the corresponding Galaxy API endpoint. At the time of writing there are a few different formats in which endpoints might accept their input parameters.</p>\n\n  <h4 id=\"direct-parameters\">Direct parameters</h4>\n  <p>A parameter can be specified explicitly in the signature of the endpoint method.</p>\n\n  <p><strong>Example</strong>:</p>\n\n  <p>In the histories API <a href=\"https://github.com/galaxyproject/galaxy/blob/v21.01/lib/galaxy/webapps/galaxy/api/histories.py#L384\"><code class=\"language-plaintext highlighter-rouge\">delete()</code></a> endpoint method, the <code class=\"language-plaintext highlighter-rouge\">id</code> parameter is specified explicitly.</p>\n\n  <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">def</span> <span class=\"nf\">delete</span><span class=\"p\">(</span><span class=\"n\">self</span><span class=\"p\">,</span> <span class=\"n\">trans</span><span class=\"p\">,</span> <span class=\"nb\">id</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwd</span><span class=\"p\">):</span>\n</code></pre></div>  </div>\n\n  <h4 id=\"keyword-parameters\">Keyword parameters</h4>\n\n  <p>Other parameters might get passed to the endpoint as an element of <code class=\"language-plaintext highlighter-rouge\">kwd</code>. If the documentation of the endpoint is lacking, these keyword parameters can be difficult to identify.</p>\n\n  <h4 id=\"the-q-and-qv-format\">The <code class=\"language-plaintext highlighter-rouge\">q</code> and <code class=\"language-plaintext highlighter-rouge\">qv</code> format</h4>\n\n  <p>Filtering parameters might also be expected as pairs of <code class=\"language-plaintext highlighter-rouge\">q</code> and <code class=\"language-plaintext highlighter-rouge\">qv</code> values. These are then parsed into filters by the Galaxy server.</p>\n\n  <p>The general format is <code class=\"language-plaintext highlighter-rouge\">q={filter}-{operation}</code> and <code class=\"language-plaintext highlighter-rouge\">qv={value}</code>. The accepted values for these parameters must be identified in order to construct valid <code class=\"language-plaintext highlighter-rouge\">q</code> and <code class=\"language-plaintext highlighter-rouge\">qv</code> pairs.</p>\n\n  <p><strong>Example</strong>:</p>\n\n  <p>The Datasets API <a href=\"https://github.com/galaxyproject/galaxy/blob/v21.01/lib/galaxy/webapps/galaxy/api/datasets.py#L54\"><code class=\"language-plaintext highlighter-rouge\">index()</code> method</a> uses this format. The <code class=\"language-plaintext highlighter-rouge\">q</code> and <code class=\"language-plaintext highlighter-rouge\">qv</code> parameters are passed to the endpoint as part of <code class=\"language-plaintext highlighter-rouge\">kwd</code>. They are not used in the endpoint itself, but rather implicitly passed into the <code class=\"language-plaintext highlighter-rouge\">self.parse_filter_params()</code> helper method as part of <code class=\"language-plaintext highlighter-rouge\">kwd</code>. See <a href=\"https://github.com/galaxyproject/bioblend/blob/v0.16.0/bioblend/galaxy/datasets/__init__.py#L146\">the corresponding method</a> of the <code class=\"language-plaintext highlighter-rouge\">DatasetClient</code> to get a feeling how this can be handled in BioBlend.</p>\n\n</blockquote>\n\n<h1 id=\"running-the-bioblend-tests\">Running the BioBlend tests</h1>\n\n<p>Finally, we should run our test to make sure that it passes. This would indicate that our method works correctly. After testing we will be ready to push our changes to GitHub and open a pull request!</p>\n\n<p>This section outlines two approaches for running BioBlend tests: A simple approach that should suffice for basic testing, and a more involved approach that speeds up testing.</p>\n\n<p>It makes sense to test our method against the most recent changes of Galaxy, so let’s use Galaxy <code class=\"language-plaintext highlighter-rouge\">dev</code>.</p>\n\n<blockquote class=\"comment\">\n  <comment-title>Note</comment-title>\n  <p>On our local machine we generally only test against Galaxy <code class=\"language-plaintext highlighter-rouge\">dev</code>, so it might happen that tests on GitHub still fail because there tests are run against all supported Galaxy versions. When this happens we simply need to update our changes to fix those errors as well, and we might need to check out older Galaxy versions for debugging locally.</p>\n</blockquote>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Using the `run_bioblend_tests.sh` script</hands-on-title>\n\n  <p>This script is provided in the repository. It will lint the Python code and run the BioBlend tests. It works well for running all BioBlend tests at once, or for small tests that require little to no debugging or experimentation.</p>\n\n  <p>Since BioBlend requires a Galaxy server, we must specify the path to the Galaxy server directory:</p>\n\n  <ul>\n    <li><code class=\"language-plaintext highlighter-rouge\">-g &lt;galaxy_path&gt;</code></li>\n  </ul>\n\n  <p>Two useful optional parameters:</p>\n\n  <ul>\n    <li><code class=\"language-plaintext highlighter-rouge\">-e &lt;python_version&gt;</code></li>\n    <li>\n      <p><code class=\"language-plaintext highlighter-rouge\">-t &lt;path_to_test&gt;</code></p>\n\n      <p>We can specify a subset of tests to run by supplying this argument. This is specified in <a href=\"https://pytest.org/\">pytest</a> format. See the <a href=\"https://docs.pytest.org/en/latest/how-to/usage.html#specifying-which-tests-to-run\">documentation</a> for more information.</p>\n    </li>\n  </ul>\n\n  <p><strong>Examples</strong>:</p>\n\n  <p>Let’s assume that our galaxy directory is located at <code class=\"language-plaintext highlighter-rouge\">../galaxy</code>.</p>\n\n  <p>Then this command runs all BioBlend tests:</p>\n  <div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>./run_bioblend_tests <span class=\"nt\">-g</span> ../galaxy <span class=\"nt\">-e</span> py39\n</code></pre></div>  </div>\n  <p>And this command runs only the test named <code class=\"language-plaintext highlighter-rouge\">test_get_jobs</code>:</p>\n  <div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>./run_bioblend_tests.sh <span class=\"se\">\\</span>\n    <span class=\"nt\">-g</span> ../galaxy <span class=\"se\">\\</span>\n    <span class=\"nt\">-e</span> py39 <span class=\"se\">\\</span>\n    <span class=\"nt\">-t</span> tests/TestGalaxyJobs.py::TestGalaxyJobs::test_get_jobs\n</code></pre></div>  </div>\n  <p><strong>Downside of the <code class=\"language-plaintext highlighter-rouge\">run_bioblend_tests.sh</code> script</strong>:</p>\n\n  <p>The script starts and stops a new instance of the Galaxy server every time it is run. This makes it robust. However, it also means we have to wait for the server to start up every time. This makes it painful to debug more complicated tests.</p>\n</blockquote>\n\n<h2 id=\"running-the-tests-directly\">Running the tests directly</h2>\n\n<p>We can speed up our test environment by controlling the Galaxy server and the BioBlend tests directly. The initial setup will be more involved, but this way we can keep the server running in the background while we do our testing.</p>\n\n<blockquote class=\"warning\">\n  <warning-title>Caveat</warning-title>\n\n  <p>When the Galaxy server is not reset between test runs, tests that implicitly depend on a clean server state might start failing after the first run.</p>\n\n  <p>For example, let’s assume there is only a single test that creates a new history and checks that the total number of histories is equal to 1. This test will pass for a new Galaxy server because no histories exist yet. However, the next run there would be two histories and thus the test would fail.</p>\n\n  <p>Although this is generally not a big issue, it is something to watch out for. There are a few BioBlend tests that will fail in this manner. Most of these tests measure an array length property that increases with every run and therefore fail after the first run.</p>\n\n  <p>It is preferable to write tests that are robust in this regard!</p>\n</blockquote>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Starting the Galaxy server with a custom configuration</hands-on-title>\n\n  <p>Open a terminal in the Galaxy base directory and execute the following commands:</p>\n\n  <ol>\n    <li>\n      <p><strong>Declare an API key of our choosing to use for testing</strong></p>\n\n      <p>We will include this key in the Galaxy server configuration. The server will then accept incoming requests that use this key.</p>\n\n      <div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">API_KEY</span><span class=\"o\">=</span>LetMeIn\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p><strong>Create a temporary directory</strong></p>\n\n      <div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">TEMP_DIR</span><span class=\"o\">=</span><span class=\"si\">$(</span><span class=\"nb\">mktemp</span> <span class=\"nt\">-d</span><span class=\"si\">)</span>\n<span class=\"nb\">echo</span> <span class=\"s2\">\"Galaxy directory: </span><span class=\"nv\">$TEMP_DIR</span><span class=\"s2\">\"</span>\n</code></pre></div>      </div>\n\n      <p>The temporary directory will contain useful information for debugging tests, such as the ‘main.log’ file and the ‘universe.sqlite’ database.</p>\n    </li>\n    <li>\n      <p><strong>Export environment variables required by the Galaxy server</strong></p>\n\n      <div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">export </span><span class=\"nv\">SKIP_GALAXY_CLIENT_BUILD</span><span class=\"o\">=</span>1\n<span class=\"nb\">export </span><span class=\"nv\">GALAXY_LOG_FILE</span><span class=\"o\">=</span><span class=\"nv\">$TEMP_DIR</span>/main.log\n<span class=\"nb\">export </span><span class=\"nv\">GALAXY_CONFIG_FILE</span><span class=\"o\">=</span><span class=\"nv\">$TEMP_DIR</span>/test_galaxy.ini\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p><strong>Copy a sample tool configuration</strong></p>\n\n      <div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">cp </span>config/tool_conf.xml.sample <span class=\"nv\">$TEMP_DIR</span>/tool_conf.xml.sample\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p><strong>Declare the desired logging level</strong></p>\n\n      <div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">LOG_LEVEL</span><span class=\"o\">=</span>DEBUG\n</code></pre></div>      </div>\n\n      <p>The available logging levels can be found in the <a href=\"https://docs.python.org/3/library/logging.html#logging-levels\">documentation</a> of the Python <a href=\"https://docs.python.org/3/library/logging.html\">logging</a> library.</p>\n    </li>\n    <li>\n      <p><strong>Create the Galaxy configuration file</strong></p>\n\n      <div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">cat</span> <span class=\"o\">&lt;&lt;</span> <span class=\"no\">EOF</span><span class=\"sh\"> &gt; </span><span class=\"nv\">$GALAXY_CONFIG_FILE</span><span class=\"sh\">\n[server:main]\n\nuse = egg:Paste#http\nport = 8080\n\n[app:main]\n\nlog_level = </span><span class=\"nv\">$LOG_LEVEL</span><span class=\"sh\">\npaste.app_factory = galaxy.web.buildapp:app_factory\ndatabase_connection = sqlite:///</span><span class=\"nv\">$TEMP_DIR</span><span class=\"sh\">/universe.sqlite?isolation_level=IMMEDIATE\nfile_path = </span><span class=\"nv\">$TEMP_DIR</span><span class=\"sh\">/files\nnew_file_path = </span><span class=\"nv\">$TEMP_DIR</span><span class=\"sh\">/tmp\ntool_config_file = </span><span class=\"nv\">$TEMP_DIR</span><span class=\"sh\">/tool_conf.xml.sample\nconda_auto_init = True\njob_working_directory = </span><span class=\"nv\">$TEMP_DIR</span><span class=\"sh\">/jobs_directory\nallow_library_path_paste = True\nadmin_users = test@test.test\nallow_user_deletion = True\nallow_user_dataset_purge = True\nenable_beta_workflow_modules = True\nmaster_api_key = </span><span class=\"nv\">$API_KEY</span><span class=\"sh\">\nenable_quotas = True\ncleanup_job = onsuccess\n</span><span class=\"no\">EOF\n</span></code></pre></div>      </div>\n    </li>\n    <li>\n      <p><strong>Start the Galaxy server</strong></p>\n\n      <div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>./run.sh\n</code></pre></div>      </div>\n    </li>\n  </ol>\n</blockquote>\n\n<p>Now we have a Galaxy server running with our specified configuration. We can run tests against this server in a separate terminal.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Running the tests</hands-on-title>\n\n  <p>Navigate to the BioBlend base directory and execute the following commands:</p>\n\n  <ol>\n    <li>\n      <p><strong>Declare the same API key we used for the Galaxy server</strong></p>\n\n      <div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">API_KEY</span><span class=\"o\">=</span>LetMeIn\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p><strong>Export environment variables required by BioBlend</strong></p>\n\n      <div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">export </span><span class=\"nv\">BIOBLEND_GALAXY_API_KEY</span><span class=\"o\">=</span><span class=\"nv\">$API_KEY</span>\n<span class=\"nb\">export </span><span class=\"nv\">BIOBLEND_GALAXY_URL</span><span class=\"o\">=</span>http://localhost:8080/\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p><strong>Activate the virtual environment</strong></p>\n\n      <div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">source</span> &lt;GALAXY_DIRECTORY&gt;/.venv/bin/activate\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p><strong>Declare the desired test logging level</strong></p>\n\n      <div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">LOG_LEVEL</span><span class=\"o\">=</span>WARNING\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p><strong>Run the desired BioBlend test(s)</strong></p>\n\n      <div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># selection format: tests/&lt;file&gt;::&lt;module&gt;::&lt;test&gt;</span>\npytest <span class=\"nt\">--override-ini</span> <span class=\"nv\">log_cli_level</span><span class=\"o\">=</span><span class=\"nv\">$LOG_LEVEL</span> <span class=\"se\">\\</span>\n    tests/TestGalaxyWorkflows.py::TestGalaxyWorkflows::test_show_versions\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p><strong>Lint our code to detect bad practices and potential errors</strong></p>\n\n      <div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>tox <span class=\"nt\">-e</span> lint\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p><strong>Leave the virtual environment when we are done testing</strong></p>\n\n      <div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>deactivate\n</code></pre></div>      </div>\n    </li>\n  </ol>\n</blockquote>\n\n<p>You may find your tests do not pass straight away. In this case, you need to identify the issue and modify the code to fix it. This might take several iterations.</p>\n\n<p>Once tests are passing, the final step would be to <a href=\"https://github.com/galaxyproject/bioblend/compare\">open a PR</a> at the BioBlend GitHub repository! This will trigger automatic tests and after some time your new code will be reviewed by the BioBlend maintainers. After any concerns are addressed and all tests are passing, your PR will be merged into the <code class=\"language-plaintext highlighter-rouge\">main</code> branch and incorporated into the next BioBlend release.</p>\n\n<h1 id=\"conclusion\">Conclusion</h1>\n\n<p>We covered the basics of BioBlend development. We also touched briefly on some key concepts relating to the Galaxy API and the structure of the Galaxy back-end code.</p>\n\n<p>Compared to Galaxy, BioBlend is a smaller project with limited complexity. Changes are generally not very hard to implement, which makes it a good candidate for contributions from those not yet familiar with Galaxy in its entirety.</p>\n\n<p>Good luck!</p>\n"],"ref_slides":[],"video_library":{"tutorial":null,"slides":null,"demo":null,"both":null,"session":null},"hands_on":true,"slides":false,"mod_date":"2023-11-03 14:30:27 +0000","pub_date":"2021-05-25 10:02:52 +0000","version":17,"api":"https://training.galaxyproject.org/training-material/api/topics/dev/tutorials/bioblend-dev/tutorial.json","tools":[],"supported_servers":[],"topic_name_human":"Development in Galaxy","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools: []\n","tours":false,"video":false,"translations":{"tutorial":[],"slides":[],"video":false},"license":"CC-BY-4.0","type":"tutorial"}