{"layout":"tutorial_hands_on","title":"Finding the muon stopping site with pymuon-suite in Galaxy","level":"Introductory","zenodo_link":"https://zenodo.org/records/10219558","questions":["What are stopping sites and why is finding them important?","What computational techniques can be used to find stopping sites?","How can Galaxy help me with my analysis?"],"objectives":["Understand why finding stopping sites is useful","Use pymuon-suite in Galaxy to find stopping sites","Understand the limitations of these tools and techniques"],"time_estimation":"1H","key_points":["Galaxy supports multiple PyMuonSuite tools which can be used together to find muon stopping sites","The workflow for finding the stopping site involves three stages - structure generation, structure optimisation, and structure clustering","Within the UEP, the optimisation stage is based on analytically calculating the electrostatic forces applied to the muon, which can be performed via Galaxy.","The approach requires a CASTEP DFT calculation to be completed as a starting point"],"contributions":{"authorship":["leandro-liborio","elichad","patrick-austin"],"editing":["leandro-liborio"],"funding":["eurosciencegateway"]},"subtopic":"muon-spectroscopy","priority":2,"abbreviations":{"AIRSS":"Ab Initio Random Structure Search","DFT":"Density Functional Theory","UEP":"Unperturbed Electrostatic Potential"},"recordings":[{"youtube_id":"rFPtDmq7uO8","date":"2024-01-26","length":"22M","speakers":["leandro-liborio"],"captioners":["leandro-liborio"]}],"js_requirements":{"mathjax":null,"mermaid":false},"short_id":"T00402","url":"/topics/materials-science/tutorials/muon-stopping-sites-muairss-uep/tutorial.html","topic_name":"materials-science","tutorial_name":"muon-stopping-sites-muairss-uep","dir":"topics/materials-science/tutorials/muon-stopping-sites-muairss-uep","symlink":null,"id":"materials-science/muon-stopping-sites-muairss-uep","ref_tutorials":["<p>The problem of identifying the stopping site of the muon is often key in the\ninterpretation of muon experimental results. As it was mentioned in the lecture,\nthe problem of finding the muon stopping site has been previously\ntackled using computational tools, and one of the most common methods is the so-called\nUnperturbed Electrostatic Potential (UEP) method, which identifies proposes that\nthe muon stops at the minima of the <abbr title=\"Unperturbed Electrostatic Potential\">UEP</abbr> of a crystalline host material.</p>\n\n<p>pymuon-suite in Galaxy implements a variant of the <abbr title=\"Unperturbed Electrostatic Potential\">UEP</abbr>, that allows the\nusers to efficiently scan the <abbr title=\"Unperturbed Electrostatic Potential\">UEP</abbr> of the host material and use a clustering procedure\nto classify those minima as potential stopping sites. But, before moving into the details\nof how the method works, it is useful to revisit some of the key assumptions\nbehind what happens in a muon experiment.</p>\n\n<p>At the atomic level, muon spectroscopy experiments go something like this:</p>\n\n<ul>\n  <li>A spin-polarized muon beam of positive muons is fired at the sample</li>\n  <li>Through inelastic collisions with the atoms of the crystalline host material,\n muons shed their kinetic energy, which turns into heat or causes small amounts\n of damage to the crystal. This continues until the muons’ kinetic energy becomes low enough\nthat it is comparable to their potential energy in the electrostatic potential\ngenerated by electrons and nuclei alike.</li>\n  <li>At that point, Coulomb forces start driving the muon, until it eventually\nloses as much energy as possible and comes to a stop in a position that\nsometimes represents a local (and possibly global) minimum for the sample’s\n<abbr title=\"Unperturbed Electrostatic Potential\">UEP</abbr> energy. Once it stopped, the muon may spend\nthe rest of its time in that position until it decays.</li>\n</ul>\n\n<p><a href=\"../../images/muon_spectroscopy_diagram.png\" rel=\"noopener noreferrer\"><img src=\"../../images/muon_spectroscopy_diagram.png\" alt=\"Graphical illustration of muons being implanted in a sample, then decaying to a positron and being detected. \" width=\"957\" height=\"478\" loading=\"lazy\" /></a></p>\n\n<p>Where these minima of the potential actually are isn’t always obvious and,\nalthough the our version of the <abbr title=\"Unperturbed Electrostatic Potential\">UEP</abbr> method has proven to be quite efficient and useful,\n there are certain crystalline materials where predicting the minima of the <abbr title=\"Unperturbed Electrostatic Potential\">UEP</abbr>\n potential can be a lot harder. For instance, in lithium fluoride <span class=\"citation\"><a href=\"#Liborio2018\">Liborio <i>et al.</i> 2018</a></span>,\n the potential’s minima are flat and\nwide and current computer simulations fail to predict the muon stopping site.\nHence, users must exercise scientific criteria when analyzing results form the method</p>\n\n<p>This tutorial goes into the details of how to estimate the muon stopping\nsite in crystalline copper, as described in the lecture, and it assumes\n that some basic Galaxy concepts such as: how to upload a file;\nhow to use a Galaxy tool; how to create, view and share a history and how to extract\n and run a Galaxy workflow, are known. Hence,\nas stated in the requirements at the beginning of this tutorial please, before starting\n have a look at this: <a href=\"/training-material/topics/introduction/tutorials/galaxy-intro-short/tutorial.html\">A short introduction to Galaxy</a></p>\n\n<blockquote class=\"agenda\">\n  <agenda-title></agenda-title>\n\n  <p>In this tutorial, we will cover:</p>\n\n<ol id=\"markdown-toc\">\n  <li><a href=\"#workflow-for-finding-the-µ-stopping-site\" id=\"markdown-toc-workflow-for-finding-the-µ-stopping-site\">Workflow for Finding the µ+ stopping site</a>    <ol>\n      <li><a href=\"#import-workflow\" id=\"markdown-toc-import-workflow\">Import workflow</a></li>\n      <li><a href=\"#dft-calculation-of-the-pure-host-material\" id=\"markdown-toc-dft-calculation-of-the-pure-host-material\"><abbr title=\"Density Functional Theory\">DFT</abbr> calculation of the Pure Host Material</a></li>\n      <li><a href=\"#create-randomly-populated-muonated-structures\" id=\"markdown-toc-create-randomly-populated-muonated-structures\">Create Randomly Populated Muonated Structures</a></li>\n      <li><a href=\"#relax-electrostatic-forces-on-muons\" id=\"markdown-toc-relax-electrostatic-forces-on-muons\">Relax Electrostatic Forces on Muons</a></li>\n      <li><a href=\"#cluster-relaxed-structures---µ-stopping-sites\" id=\"markdown-toc-cluster-relaxed-structures---µ-stopping-sites\">Cluster Relaxed Structures - µ+ Stopping Sites</a></li>\n    </ol>\n  </li>\n</ol>\n\n</blockquote>\n\n<h1 id=\"workflow-for-finding-the-µ-stopping-site\">Workflow for Finding the µ+ stopping site</h1>\n<p>As described in the lecture, the full workflow associated with finding\npotential muon stopping sites in crystalline copper is shown in the figure below:</p>\n\n<p><a href=\"../../images/Workflow_for_finding_mu+.png\" rel=\"noopener noreferrer\"><img src=\"../../images/Workflow_for_finding_mu+.png\" alt=\"Graphical illustration of the steps in finding the muon stopping site for a Silicon crystal lattice. (1) Start with a pure host, (2) randomly populate with muons, (3) relax electrostatic forces, (4) cluster structures to give the stopping site in either (5) a conventional unit cell or (6) a supercell.\" width=\"720\" height=\"405\" loading=\"lazy\" /></a></p>\n\n<p>It comprises 6 steps that will be described in detail in the next sections.  Steps 1 and 6\nare performed outside of the Galaxy platform, usually in an external computer cluster that can\nrun the necessary Density Functional Theory (DFT) simulations. Steps 2, 3, 4, and 5 of this workflow are are carried out\nin Galaxy using two Galaxy tools: <code class=\"language-plaintext highlighter-rouge\">PyMuonSuite AIRSS UEP Optimise</code> and <code class=\"language-plaintext highlighter-rouge\">PyMuonSuite AIRSS Cluster</code>.</p>\n\n<p><a href=\"../../images/2GalaxyTools.png\" rel=\"noopener noreferrer\"><img src=\"../../images/2GalaxyTools.png\" alt=\"Screenshots of the Galaxy UI showing the two tools, PyMuonSuite AIRSS UEP Optimise and PyMuonSuite AIRSS Cluster, and which steps of the described process they correspond to (1,2,3 and 4,5,6 respectively).\" width=\"720\" height=\"405\" loading=\"lazy\" /></a></p>\n\n<p>Hence, there is a difference between the full workflow and the specific Galaxy part of this workflow, which can be\nsaved, shared and edited in the Galaxy platform. For the case of finding potential muon stopping sites in\ncrystalline Cu, the components of Galaxy workflow are shown below:</p>\n\n<p><a href=\"../../images/GalaxyWorkflow.png\" rel=\"noopener noreferrer\"><img src=\"../../images/GalaxyWorkflow.png\" alt=\"Screenshot of the Galaxy workflow editor showing the three input files (Copper-out.cell, Copper.den_fmt, Copper.castep) needed for the tool PyMuonSuite AIRSS UEP Optimise, and how that output connects to the PyMuonSuite AIRSS Cluster tool.\" width=\"985\" height=\"406\" loading=\"lazy\" /></a></p>\n\n<p>And this is the workflow that can be imported for this tutorial.</p>\n\n<h2 id=\"import-workflow\">Import workflow</h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Import workflow</hands-on-title>\n\n  <ol>\n    <li>Import the workflow for this tutorial using <a href=\"workflows/\">these instructions</a>.</li>\n    <li>Open the editor for the workflow, and verify that all the required tools\nare installed on your Galaxy instance, and have the same version(s) as the\ntools in workflow. If this is not the case a dialogue box will warn you.</li>\n  </ol>\n\n</blockquote>\n\n<h2 id=\"dft-calculation-of-the-pure-host-material\"><abbr title=\"Density Functional Theory\">DFT</abbr> calculation of the Pure Host Material</h2>\n\n<p>This method requires only a single <abbr title=\"Density Functional Theory\">DFT</abbr> calculation for the host material.\n This calculation could be a geometry optimisation, which uses\n a self-consistent methodology to estimate the electronic\n structure of the material and relax the structure. Pymuon_suite uses the\n CASTEP code for running its <abbr title=\"Density Functional Theory\">DFT</abbr> calculations, and some basic information\n  about how to run a geometry optimisation is available in the <a href=\"https://castep-docs.github.io/castep-docs/\">CASTEP documentation</a>.</p>\n\n<p>Once the relaxed structure and its corresponding electronic structure are obtained,\na set of CASTEP output files is generated. We need to load just three of these files\ninto Galaxy.  These are the relaxed CASTEP structural file <code class=\"language-plaintext highlighter-rouge\">*-out.cell</code>, the\ncharge density file <code class=\"language-plaintext highlighter-rouge\">*.den_fmt</code> and the CASTEP output file <code class=\"language-plaintext highlighter-rouge\">*.castep</code>.</p>\n\n<p>The CASTEP files for this example have all been pre-generated for this tutorial,\nbut in general you would need to create these yourself by running CASTEP simulations\noutside of Galaxy.</p>\n\n<p>To run the first part of the workflow, on the left menu of the Galaxy web-page\nwe look for the <code class=\"language-plaintext highlighter-rouge\">FIND MUON STOPPING SITES</code> header and first click on <code class=\"language-plaintext highlighter-rouge\">UEP method</code> and then\nselect the <code class=\"language-plaintext highlighter-rouge\">PyMuonSuite AIRSS UEP Optimise</code> Galaxy tool. This brings up the central panel of the Galaxy\nweb-page, where can load the CASTEP files; complete the <em>Generation</em> parameters to set up the\ncreation of randomly populated muonated structures; and complete the <em>Optimisation</em> parameters to set up the relaxation the\nelectrostatic forces of the muon in each of the randomly populated muonated structures.</p>\n\n<h3 id=\"how-to-load-castep-files-into-galaxy\">How to load CASTEP files into Galaxy</h3>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Data upload</hands-on-title>\n\n  <ol>\n    <li>Create a new history for this tutorial</li>\n    <li>\n      <p>Import the files from <a href=\"https://zenodo.org/records/10219558\">Zenodo</a>, from you computer, or from\nthe shared data library (<code class=\"language-plaintext highlighter-rouge\">GTN - Material</code> -&gt; <code class=\"language-plaintext highlighter-rouge\">materials-science</code>\n -&gt; <code class=\"language-plaintext highlighter-rouge\">Finding the muon stopping site with pymuon-suite in Galaxy</code>):</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>https://zenodo.org/records/10219558/files/Cu-out.cell\nhttps://zenodo.org/records/10219558/files/Cu.castep\nhttps://zenodo.org/records/10219558/files/Cu.den_fmt\n</code></pre></div>      </div>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-importing-via-links\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-importing-via-links\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Importing via links</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Copy the link location</li>   <li>     <p>Click <i class=\"fas fa-upload\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-upload</span> <strong>Upload Data</strong> at the top of the tool panel</p>   </li>   <li>Select <i class=\"fa fa-edit\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-wf-edit</span> <strong>Paste/Fetch Data</strong></li>   <li>     <p>Paste the link(s) into the text field</p>   </li>   <li>     <p>Press <strong>Start</strong></p>   </li>   <li><strong>Close</strong> the window</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-importing-data-from-a-data-library\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-importing-data-from-a-data-library\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Importing data from a data library</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p>As an alternative to uploading the data from a URL or your computer, the files may also have been made available from a <em>shared data library</em>:</p>   <ol>   <li>Go into <strong>Shared data</strong> (top panel) then <strong>Data libraries</strong></li>   <li>Navigate to  the correct folder as indicated by your instructor.     <ul>       <li>On most Galaxies tutorial data will be provided in a folder named <strong>GTN - Material –&gt; Topic Name -&gt; Tutorial Name</strong>.</li>     </ul>   </li>   <li>Select the desired files</li>   <li>Click on <strong>Add to History</strong> <i class=\"fas fa-caret-down\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-dropdown</span> near the top and select <strong>as Datasets</strong> from the dropdown menu</li>   <li>     <p>In the pop-up window, choose</p>     <ul>       <li><em>“Select history”</em>: the history you want to import the data to (or create a new one)</li>     </ul>   </li>   <li>Click on <strong>Import</strong></li> </ol> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>Rename the datasets to match their file names, if needed.</li>\n    <li>\n      <p>Check that the datatype is correct for each dataset.</p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-changing-the-datatype\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-changing-the-datatype\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Changing the datatype</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Click on the <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>   <li>In the central panel, click <i class=\"fas fa-database\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-chart-select-data</span> <strong>Datatypes</strong> tab on the top</li>   <li>In the <i class=\"fas fa-database\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-chart-select-data</span> <strong>Assign Datatype</strong>, select <code class=\"language-plaintext highlighter-rouge\">datatypes</code> from “<em>New type</em>” dropdown     <ul>       <li>Tip: you can start typing the datatype into the field to filter the dropdown menu</li>     </ul>   </li>   <li>Click the <strong>Save</strong> button</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h2 id=\"create-randomly-populated-muonated-structures\">Create Randomly Populated Muonated Structures</h2>\n\n<p>The first step within the Galaxy platform is the population of the\nhost material’s interstitial spaces with muons that are\nrandomly distributed in accordance with certain physical constraints.</p>\n\n<p><a href=\"../../images/Create-random-structures.png\" rel=\"noopener noreferrer\"><img src=\"../../images/Create-random-structures.png\" alt=\"Graphical illustration of how the parameters Gaussian Width affects the potential of atoms, Van der Waals Scale increases the distance between atoms and muons, and Poisson Radius increases the starting distance between muons.\" width=\"720\" height=\"405\" loading=\"lazy\" /></a></p>\n\n<p>Essentially, the muons are randomly distributed while respecting\na minimum distance between them and between the atoms\nin the host material. The <code class=\"language-plaintext highlighter-rouge\">Poisson radius</code> parameter sets the minimum spacing\nbetween the muons that are randomly implanted in the sample, while the\n<code class=\"language-plaintext highlighter-rouge\">Van der Waals scale</code> parameter sets the minimum spacing between randomly\nimplanted muons and the atoms in the host material.  Two of the images in the figure\nabove show how the density of distributed muons changes for different values of\nthe Poisson radius. These images are just for visualization purposes, what\nthe method really does is generate a set of muonated structures, where each one has a muon\nin a different place, and place each muonated structure in a corresponding folder.</p>\n\n<h2 id=\"relax-electrostatic-forces-on-muons\">Relax Electrostatic Forces on Muons</h2>\n\n<p>As stated in the lecture, the method minimizes the electrostatic forces acting on the muon in each of the\nmuonated structures generated in the previous step.  In this relaxation procedure,\nthe forces are calculated analytically using data obtained from the <abbr title=\"Density Functional Theory\">DFT</abbr> simulation of the unperturbed host material:\nthe charge density file <code class=\"language-plaintext highlighter-rouge\">*.den_fmt</code>, the relaxed CASTEP structural file <code class=\"language-plaintext highlighter-rouge\">*-out.cell</code>, the and the CASTEP output file <code class=\"language-plaintext highlighter-rouge\">*.castep</code>,\nand then the muon is displaced in a direction\nthat minimizes the forces acting upon it. This is a self-consistent procedure, which is repeated until the\nforces on each muon are below the value specified in the <code class=\"language-plaintext highlighter-rouge\">geometry optimisation tolerance</code> parameter, or until\nthe maximum number of <code class=\"language-plaintext highlighter-rouge\">geometry optimisation steps</code> is reached.</p>\n\n<p><a href=\"../../images/relax_electrostatic_forces_on_muons.png\" rel=\"noopener noreferrer\"><img src=\"../../images/relax_electrostatic_forces_on_muons.png\" alt=\"Graphical illustration of how muon positions might move during geometry optimisation to concentrate in one or more areas in the structure, and the equation defining the electrostatics of this process.\" width=\"720\" height=\"405\" loading=\"lazy\" /></a></p>\n\n<p>This workflow’s step could be computationally expensive. The larger the\nthe size of the host material’s unit cell, and the smaller the values of <code class=\"language-plaintext highlighter-rouge\">Poisson radius</code> and\n<code class=\"language-plaintext highlighter-rouge\">Van der Waals scale</code> parameters, the larger number of muonated structures created, and the\nmore expensive this step will be.  In any case: the relaxation procedure is run in the Galaxy\nserver, so the user can just start it and leave it running in the Galaxy instance. The status of\nthe relaxation will be indicated in the history panel on the right menu of the Galaxy web-page, where\nall the processes run by the Galaxy instance are numbered.</p>\n\n<p>Below, a hands-on example on how to run these workflow steps.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>PyMuonSuite AIRSS UEP Optimise</hands-on-title>\n\n  <ol>\n    <li>Run the <span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/muon-spectroscopy-computational-project/pm_uep_opt/pm_uep_opt/0.3.0+galaxy1\" title=\"PyMuonSuite AIRSS UEP Optimise tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>PyMuonSuite AIRSS UEP Optimise</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.3.0+galaxy1)</span> tool with the following parameters:\n      <ul>\n        <li><em>“Tool Parameters”</em>:\n          <ul>\n            <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Structure file”</em>: <code class=\"language-plaintext highlighter-rouge\">Cu-out.cell</code> relaxed CASTEP structural file</li>\n            <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Charge density file”</em>: <code class=\"language-plaintext highlighter-rouge\">Cu.den_fmt</code> CASTEP file with charge density of host material</li>\n            <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“CASTEP log file”</em>: <code class=\"language-plaintext highlighter-rouge\">Cu.castep</code> The CASTEP output file for the initial <abbr title=\"Density Functional Theory\">DFT</abbr> simulation</li>\n          </ul>\n        </li>\n        <li><em>“Generation Parameters”</em>:\n          <ul>\n            <li><em>“Poisson radius”</em>: <code class=\"language-plaintext highlighter-rouge\">0.6</code> Sets the minimum spacing between the muons that are randomly implanted in the sample</li>\n            <li><em>“Van der Waals scale”</em>: <code class=\"language-plaintext highlighter-rouge\">0.5</code> Sets the minimum spacing between randomly implanted muons atoms in host material</li>\n            <li><em>“Random seed”</em>: <code class=\"language-plaintext highlighter-rouge\">optional</code> this is if we want to re-use a set of generated structures.  Rarely used</li>\n            <li><em>“Format for file containing all muon positions (optional)”</em>: <code class=\"language-plaintext highlighter-rouge\">cell</code> Generates an extra output file containing all the muon positions</li>\n          </ul>\n        </li>\n        <li><em>“Optimisation parameters Parameters”</em>:\n          <ul>\n            <li><em>“Geometry optimization steps”</em>: <code class=\"language-plaintext highlighter-rouge\">300</code> Maximum number of geometry optimisation steps</li>\n            <li><em>“Geometry optimization tolerance”</em>: <code class=\"language-plaintext highlighter-rouge\">0.05</code> Tolerance on geometry optimisation in eV/AA</li>\n            <li><em>“Gaussian width factor”</em>: <code class=\"language-plaintext highlighter-rouge\">5.0</code> Adjusts how atom potentials are modelled</li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n  </ol>\n</blockquote>\n\n<h2 id=\"cluster-relaxed-structures---µ-stopping-sites\">Cluster Relaxed Structures - µ+ Stopping Sites</h2>\n\n<p>Once the relaxation is over, there will appear a new item on the history panel denominated\n<em>PyMuonSuite AIRSS UEP Optimise on data X, data Y and data Z</em>. This item\ncontains a <code class=\"language-plaintext highlighter-rouge\">*.zip</code> file with all the optimised muonated structures, where <em>X</em>, <em>Y</em> and <em>Z</em> are\nthe numbers of the processes, in the history panel, that were used for running the relaxation\nof the electrostatic forces on muons.</p>\n\n<p><a href=\"../../images/cluster_relaxed_structures_mu+_stopping_sites.png\" rel=\"noopener noreferrer\"><img src=\"../../images/cluster_relaxed_structures_mu+_stopping_sites.png\" alt=\"Graphical illustration of muons clustered in two possible sites for a structure, how this is represented in the tool output report, and the original structure within that cluster which has minimal energy.\" width=\"720\" height=\"405\" loading=\"lazy\" /></a></p>\n\n<p>The first step for running the clustering procedure is to select the <code class=\"language-plaintext highlighter-rouge\">PyMuonSuite AIRSS Cluster</code> Galaxy tool on\nthe left menu of the Galaxy web-page . This brings up the corresponding central panel of the Galaxy\nweb-page, where can load the optimised muonated structures <code class=\"language-plaintext highlighter-rouge\">*.zip</code> contained in the\n<em>PyMuonSuite AIRSS UEP Optimise on data X, data Y and data Z</em> item.</p>\n\n<p>Then we need to select the <em>clustering method</em> and it corresponding parameters. There are two clustering methodologies\navailable: <code class=\"language-plaintext highlighter-rouge\">hierarchical</code> and <code class=\"language-plaintext highlighter-rouge\">k-means</code> clustering. We recommend using the hierarchical clustering first, choosing different\nvalues of the <code class=\"language-plaintext highlighter-rouge\">t parameter for hierarchical clustering</code>, until a consistent number of clusters is found.  Once that\nnumber is found, we can perform a k-means clustering analysis, using the number of hierarchical clustering clusters as\nthe value for the <code class=\"language-plaintext highlighter-rouge\">Number of clusters for k-means clustering</code> parameter.</p>\n\n<p>Finally, we need to choose the <em>Clustering Save Format</em>. This allows for the visualisation of the potential stopping sites\nassociated to each of the clusters found, but it can also be used to prepare the <code class=\"language-plaintext highlighter-rouge\">*.cell</code> supercell file that is needed to\nrun the last step of the workflow: the <abbr title=\"Density Functional Theory\">DFT</abbr> relaxation of each of the muonated structures associated to each of\nthe potential stopping sites.  The <code class=\"language-plaintext highlighter-rouge\">*.cell</code> supercell file can then be downloaded from Galaxy and used to run\na CASTEP <abbr title=\"Density Functional Theory\">DFT</abbr> simulation, which can be used to analyse things such as the distortions caused by the muon in the host\nmaterial.</p>\n\n<p><a href=\"../../images/DFT_supercell_muonated_structures.png\" rel=\"noopener noreferrer\"><img src=\"../../images/DFT_supercell_muonated_structures.png\" alt=\"Graphical illustration of how a muon within a conventional unit cell can be converted to a larger 3 by 3 by 3 supercell, still containing only one muon but with more of the original atoms of the lattice.\" width=\"720\" height=\"405\" loading=\"lazy\" /></a></p>\n\n<p>Below, a hands-on example on how to run this workflow step.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>PyMuonSuite AIRSS Cluster</hands-on-title>\n\n  <ol>\n    <li>Run the <span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/muon-spectroscopy-computational-project/pm_muairss_read/pm_muairss_read/0.3.0+galaxy0\" title=\"PyMuonSuite AIRSS Cluster tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>PyMuonSuite AIRSS Cluster</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.3.0+galaxy0)</span> tool with the following parameters:\n      <ul>\n        <li><em>“Tool Parameters”</em>:\n          <ul>\n            <li><em>“optimised muonated structures”</em>: <code class=\"language-plaintext highlighter-rouge\">PyMuonSuite AIRSS UEP Optimise on data X, data Y and data Z</code> load the optimised muonated structures <code class=\"language-plaintext highlighter-rouge\">*.zip</code> file</li>\n            <li><em>“Clustering method”</em>: <code class=\"language-plaintext highlighter-rouge\">hierarchical</code> Performs hierarchical clustering</li>\n            <li><em>“t parameter for hierarchical clustering”</em>: <code class=\"language-plaintext highlighter-rouge\">0.2</code> Threshold value for clusters</li>\n            <li><em>“Clustering method”</em>: <code class=\"language-plaintext highlighter-rouge\">k-means</code> Performs k-means clustering.  Needs guess for number of clusters</li>\n            <li><em>“Number of clusters for k-means clustering “</em>: <code class=\"language-plaintext highlighter-rouge\">2</code> Proposed number of clusters for k-means. Usually the clusters found with <code class=\"language-plaintext highlighter-rouge\">hierarchical</code> clustering</li>\n            <li><em>“Clustering Save Format”</em>: <code class=\"language-plaintext highlighter-rouge\">cell</code>  Creates a structural file for each cluster, corresponding to the structure in the cluster with minimal energy, with  the specified format</li>\n            <li><em>“Supercell”</em>: <code class=\"language-plaintext highlighter-rouge\">3</code> Supercell size and shape to use when saving cluster structures</li>\n            <li><em>“Muon symbol”</em>: <code class=\"language-plaintext highlighter-rouge\">H:mu</code> The symbol to use for the muon when writing out the CASTEP custom species. H:mu is the default.</li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h3 id=\"analysis-of-the-cluster-report\">Analysis of the Cluster report</h3>\n\n<p>Once the clustering procedure is over, there will appear a new item on the history panel denominated\n<em>Cluster report for PyMuonSuite AIRSS UEP Optimise on data X, data Y, and data Z</em>, which contains a\nhuman-readable summary of the clustering results, with the underlying raw data also provided. The top of the\nreport contains a summary of the settings used to run the clustering, and when it was run.</p>\n\n<blockquote class=\"code-out\">\n  <code-out-title>MuAirss Clusters report</code-out-title>\n  <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>****************************\n|                          |\n|       PYMUON-SUITE       |\n|  MuAirss Clusters report |\n|                          |\n****************************\n\nName: struct\nDate: 2023-11-06 09:41:00.787599\nStructure file(s): input_structure.cell\nParameter file: params.yaml\n\nClustering method: Hierarchical\n    t = 0.4\n\n*******************\n</code></pre></div>  </div>\n</blockquote>\n\n<p>The remainder of the report details the clusters and the individual muonated\nstructures composing each cluster. In\naddition to showing the relative numbers of structures forming each cluster,\nwe also report the structure with the minimum energy, the average energy for all the structures\nand the corresponding standard deviation for that average energy. By analysing of these\nquantities for different values of the <code class=\"language-plaintext highlighter-rouge\">Poisson radius</code>, <code class=\"language-plaintext highlighter-rouge\">Van der Waals scale</code> and\n<code class=\"language-plaintext highlighter-rouge\">t parameter for hierarchical clustering</code> parameters, we can determine which\nare the “stable” clusters, which are the ones associated to potential stopping sites.</p>\n\n<blockquote class=\"code-out\">\n  <code-out-title>MuAirss Clusters report</code-out-title>\n  <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>Clusters for struct:\nCALCULATOR: uep\n\t2 clusters found\n\n\n\t-----------\n\tCluster 1\n\t-----------\n\tStructures: 7\n\n\tEnergy (eV):\n\tMinimum\t\tAverage\t\tStDev\n\t-10.30\t\t-10.30\t\t0.00\n\n\tMinimum energy structure: struct_7\n\n\n\tStructure list:\n\tstruct_1\tstruct_3\tstruct_5\tstruct_6\n\tstruct_7\tstruct_8\tstruct_12\n\n\t-----------\n\tCluster 2\n\t-----------\n\tStructures: 7\n\n\tEnergy (eV):\n\tMinimum\t\tAverage\t\tStDev\n\t-11.93\t\t-11.93\t\t0.00\n\n\tMinimum energy structure: struct_14\n\n\n\tStructure list:\n\tstruct_2\tstruct_4\tstruct_9\tstruct_10\n\tstruct_11\tstruct_13\tstruct_14\n\n\t----------\n\n\tSimilarity (ranked):\n\t1 &lt;--&gt; 2 (distance = 1.681)\n\n--------------------------\n</code></pre></div>  </div>\n</blockquote>\n\n<p>The classical <abbr title=\"Unperturbed Electrostatic Potential\">UEP</abbr> method scans the electrostatic potential looking for minima in it, which\nare associated to potential muon stopping sites. This method further classifies those minima\nby estimating their “attractor size”.  If you look at the picture in the figure below, the two\nminima have similar values, but the capacity to “attract” a muon is greater for the minima on the left,\nwhich makes it more likely to be a muon stopping site. The probability of a potential stopping site is\ngiven by the size of the cluster that forms around its associated minima.</p>\n\n<p><a href=\"../../images/theoretical_basis_of_our_variant_of_the_UEP_method.png\" rel=\"noopener noreferrer\"><img src=\"../../images/theoretical_basis_of_our_variant_of_the_UEP_method.png\" alt=\"Graphical illustration of how muons may be clustered in two different potential minima that have similar energies with a simple 1D plot, and two real examples (CaF and YF3) showing the potential energy in a 3D structure.\" width=\"720\" height=\"405\" loading=\"lazy\" /></a></p>\n"],"ref_slides":[],"hands_on":true,"slides":false,"mod_date":"2024-05-31 14:27:26 +0000","pub_date":"2024-01-22 20:44:48 +0000","version":14,"workflows":[{"workflow":"muairss-uep.ga","tests":true,"url":"https://training.galaxyproject.org/training-material/topics/materials-science/tutorials/muon-stopping-sites-muairss-uep/workflows/muairss-uep.ga","path":"topics/materials-science/tutorials/muon-stopping-sites-muairss-uep/workflows/muairss-uep.ga","wfid":"materials-science-muon-stopping-sites-muairss-uep","wfname":"muairss-uep","trs_endpoint":"https://training.galaxyproject.org/training-material/api/ga4gh/trs/v2/tools/materials-science-muon-stopping-sites-muairss-uep/versions/muairss-uep","license":"MIT","creators":[{"class":"Organization","name":"Muon Spectroscopy Computational Project","url":"https://muon-spectroscopy-computational-project.github.io/"}],"name":"Finding the Muon Stopping Site: pymuon-suite in Galaxy","title":"Finding the Muon Stopping Site: pymuon-suite in Galaxy","test_results":null,"modified":"2024-06-24 07:46:41 +0000","mermaid":"flowchart TD\n  0[\"ℹ️ Input Dataset\\nCopper-out.cell\"];\n  style 0 stroke:#2c3143,stroke-width:4px;\n  1[\"ℹ️ Input Dataset\\nCopper.den_fmt\"];\n  style 1 stroke:#2c3143,stroke-width:4px;\n  2[\"ℹ️ Input Dataset\\nCopper.castep\"];\n  style 2 stroke:#2c3143,stroke-width:4px;\n  3[\"PyMuonSuite AIRSS UEP Optimise\"];\n  2 -->|output| 3;\n  1 -->|output| 3;\n  0 -->|output| 3;\n  f3be7cd2-3974-49f2-aa0e-96c79b4ab34c[\"Output\\nAll muons in host material\"];\n  3 --> f3be7cd2-3974-49f2-aa0e-96c79b4ab34c;\n  style f3be7cd2-3974-49f2-aa0e-96c79b4ab34c stroke:#2c3143,stroke-width:4px;\n  4[\"PyMuonSuite AIRSS Cluster\"];\n  3 -->|uep_results| 4;"}],"api":"https://training.galaxyproject.org/training-material/api/topics/materials-science/tutorials/muon-stopping-sites-muairss-uep/tutorial.json","tools":["toolshed.g2.bx.psu.edu/repos/muon-spectroscopy-computational-project/pm_muairss_read/pm_muairss_read/0.3.0+galaxy0","toolshed.g2.bx.psu.edu/repos/muon-spectroscopy-computational-project/pm_uep_opt/pm_uep_opt/0.3.0+galaxy1"],"supported_servers":{"exact":[{"url":"https://usegalaxy.cz/","name":"UseGalaxy.cz","usegalaxy":false},{"url":"https://usegalaxy.eu","name":"UseGalaxy.eu","usegalaxy":true}],"inexact":[]},"topic_name_human":"Materials Science","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[{"name":"pm_muairss_read","owner":"muon-spectroscopy-computational-project","revisions":"40071ff77285","tool_panel_section_label":"Muon Spectroscopy","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"pm_uep_opt","owner":"muon-spectroscopy-computational-project","revisions":"eea73e1f65cb","tool_panel_section_label":"Muon Spectroscopy","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"}]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools:\n- name: pm_muairss_read\n  owner: muon-spectroscopy-computational-project\n  revisions: 40071ff77285\n  tool_panel_section_label: Muon Spectroscopy\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: pm_uep_opt\n  owner: muon-spectroscopy-computational-project\n  revisions: eea73e1f65cb\n  tool_panel_section_label: Muon Spectroscopy\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n","tours":false,"video":false,"slides_recordings":false,"translations":{"tutorial":[],"slides":[],"video":false},"license":"CC-BY-4.0","type":"tutorial","contributors":[{"name":"Leandro Liborio","email":"leandro.liborio@stfc.ac.uk","joined":"2022-11","id":"leandro-liborio","url":"https://training.galaxyproject.org/training-material/api/contributors/leandro-liborio.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/leandro-liborio/"},{"name":"Eli Chadwick","email":"eli.chadwick@manchester.ac.uk","orcid":"0000-0002-0035-6475","joined":"2022-11","id":"elichad","url":"https://training.galaxyproject.org/training-material/api/contributors/elichad.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/elichad/"},{"name":"Patrick Austin","email":"patrick.austin@stfc.ac.uk","joined":"2022-11","id":"patrick-austin","url":"https://training.galaxyproject.org/training-material/api/contributors/patrick-austin.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/patrick-austin/"},{"name":"Leandro Liborio","email":"leandro.liborio@stfc.ac.uk","joined":"2022-11","id":"leandro-liborio","url":"https://training.galaxyproject.org/training-material/api/contributors/leandro-liborio.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/leandro-liborio/"},{"name":"EuroScienceGateway","github":false,"joined":"2023-10","avatar":"/training-material/assets/images/eurosciencegateway.png","url":"https://training.galaxyproject.org/training-material/api/funders/eurosciencegateway.json","funder":true,"funding_id":"101057388","funding_system":"cordis","funding_statement":"EuroScienceGateway was funded by the European Union programme Horizon Europe (HORIZON-INFRA-2021-EOSC-01-04) under grant agreement number 101057388 and by UK Research and Innovation (UKRI) under the UK government’s Horizon Europe funding guarantee grant number 10038963.","members":["abretaud","anuprulez","bgruening","erxleben","pauldg","rlibouba"],"id":"eurosciencegateway","page":"https://training.galaxyproject.org/training-material/hall-of-fame/eurosciencegateway/"}]}