{"layout":"tutorial_hands_on","title":"Library Generation for DIA Analysis","zenodo_link":"https://zenodo.org/record/4293493","level":"Intermediate","questions":["How does the peptide identification work in data independent acquisition (DIA) mass spectrometry (MS) data?","What is a spectral library and how to generate a spectral library using Maxquant, diapysef and OpenSwath tools?"],"objectives":["Generating a spectral library from data dependent acquisition (DDA) MS data","Understanding DIA data principles and characteristics","Optimizing and refining a spectral library for the analysis of DIA data"],"time_estimation":"1H","key_points":["MaxQuant, diapysef and OpenSwath tools enable the generation of spectral libraries from DDA data","Generated spectral libraries can be used for the analysis of DIA data"],"contributors":[{"name":"Matthias Fahrner","email":"matthias.fahrner@uniklinik-freiburg.de","twitter":"mfahrner313","orcid":"0000-0001-7955-2518","joined":"2019-03","affiliations":["uni-freiburg"],"id":"matthias313","url":"https://training.galaxyproject.org/training-material/api/contributors/matthias313.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/matthias313/"},{"name":"Melanie Föll","email":"melanie.foell@mol-med.uni-freiburg.de","twitter":"MCFoell","matrix":"foellmelanie:matrix.org","orcid":"0000-0002-1887-7543","joined":"2018-10","affiliations":["uni-freiburg"],"id":"foellmelanie","url":"https://training.galaxyproject.org/training-material/api/contributors/foellmelanie.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/foellmelanie/"}],"subtopic":"id-quant","tags":["DIA"],"js_requirements":{"mathjax":null,"mermaid":false},"short_id":"T00212","url":"/topics/proteomics/tutorials/DIA_lib_OSW/tutorial.html","topic_name":"proteomics","tutorial_name":"DIA_lib_OSW","dir":"topics/proteomics/tutorials/DIA_lib_OSW","symlink":null,"id":"proteomics/DIA_lib_OSW","ref_tutorials":["<p>The proteome refers to the entirety of proteins in a biological system (e.g cell, tissue, organism). Proteomics is the large-scale experimental analysis of proteins and proteomes, most often performed by mass spectrometry that enables great sensitivity and throughput. Especially for complex protein mixtures, bottom-up mass spectrometry is the standard approach. In bottom-up proteomics, proteins are digested with a specific protease into peptides and the measured peptides are in silico reassembled into the corresponding proteins. Inside the mass spectrometer, not only the peptides are measured (MS1 level), but the peptides are also fragmented into smaller peptides which are measured again (MS2 level). This is referred to as tandem-mass spectrometry (MS/MS). Identification of peptides is performed by peptide spectrum matching of the theoretical spectra generated from the input protein database (fasta file) with the measured MS2 spectra. Peptide quantification is most often performed by measuring the area under the curve of the MS1 level peptide peaks, but special techniques such as TMT and DIA allow to quantify peptides on MS2 level. Nowadays, bottom-up tandem-mass spectrometry approaches allow for the identification and quantification of several thousand proteins.</p>\n\n<p>To enable the identification and quantification of such high numbers of proteins in a time-wise limited measurement there has been a lot of MS method and data acquisition optimization. The most commonly used technique is the data dependent acquisition (DDA). Here only the most abundant (top N) peptides from each MS1 scan are selected for subsequent fragmentation, with the most promising chance for successful identifications due to high intensity signals. Afterwards the respective mass over charge (m/z) values are set on an exclusion list enabling the selection of less abundant peptides from the following MS1 scan for the next cycle of top N fragmentation (MS2) scans. However, since this acquisition method is highly dependent on the abundance of the respective peptides at a given retention time this method is referred to as data dependent acquisition (DDA). This dependency on both time as well as intensity leads to measurement specific identifications between multiple measurements.</p>\n\n<p>Another more recently developed method is the so called data independent acquisition (DIA). However due to some unique characteristics of this acquisition method it requieres spectral libraries, which contain the peptide sequences as well as their respective fragment spectrum (MS2) information.\nHere we will use DDA data from the same samples to build a spectral library which can than be used for the identification of peptides in data independent acquisition (DIA) data from the same samples using e.g. OpenSwathWorkflow <a href=\"/training-material/topics/proteomics/tutorials/DIA_Analysis_OSW/tutorial.html\">OpenSwathworkflow tutorial</a>.</p>\n\n<figure id=\"figure-1\" style=\"max-width: 90%;\"><img src=\"../../images/DIA_lib_gen_basic.png\" alt=\"DDA_lib_gen. \" width=\"1436\" height=\"628\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/DIA_lib_gen_basic.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 1</strong>:</span> Labelfree proteomics using liquid chromatography tandem-mass spectrometry (LC-MS/MS). Principles of data dependent acquisition (DDA).</figcaption></figure>\n\n<p>High quality spectral libraries can be generated by fractionation and separate measurment of a representative sample or mixture for a cohort. During the analysis the peptide and protein identifications of all fractions can than be combined into comprehensive spectral libraries. Here the spectral libraries tend to be relativly large offering great sensitivity (even to low abundant peptides), but also contain peptides which are only observable due to the prior fractionation.\nAnother way of generating spectral libraries is by measuring the same samples using DDA as well as using DIA. Here the DDA results will be analyzed and sample specific spectral library is generated which can than be used for the analysis of the DIA data. The resulting spectral libraries are often smaller and contain only peptides which are observable in complex and non-fractionated samples.</p>\n\n<p>A plethora of software solutions were developed for the analysis of DDA proteomics data. MaxQuant is one of the most popular proteomics softwares because it is an easy to use and free software that offers functionalities for nearly all kinds of proteomics data analysis challenges <span class=\"citation\"><a href=\"#Cox2008\">Cox and Mann 2008</a></span>. Mass spectrometry raw data is normally obtained in a vendor specific, proprietary file format. MaxQuant can directly take those raw files as input. For peptide identification MaxQuant uses a search engine called “Andromeda”.</p>\n\n<p>The dataset in this training consists of different Spike-in mixtures of stable amounts of human peptides and different amounts of Ecoli peptides. Each sample reflects a non-fractionated MS measurement (DDA) of different Spike-in ratios. To faciliate the analysis and directly combine the identifications of all measurements, we will define the different measurements as fractions of one sample, as it would be the case for e.g. high pH, SCX or HILIC fractionated samples.</p>\n\n<blockquote class=\"agenda\">\n  <agenda-title></agenda-title>\n\n  <p>In this tutorial, we will cover:</p>\n\n<ol id=\"markdown-toc\">\n  <li><a href=\"#get-data\" id=\"markdown-toc-get-data\">Get data</a></li>\n  <li><a href=\"#maxquant-analysis-of-dda-data\" id=\"markdown-toc-maxquant-analysis-of-dda-data\"><strong>MaxQuant</strong> Analysis of DDA data</a>    <ol>\n      <li><a href=\"#quality-control-results\" id=\"markdown-toc-quality-control-results\">Quality control results</a></li>\n      <li><a href=\"#filter-for-unique-peptides-in-the-evidence-and-msms-output\" id=\"markdown-toc-filter-for-unique-peptides-in-the-evidence-and-msms-output\"><strong>Filter</strong> for unique peptides in the <em>evidence</em> and <em>msms</em> output</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#diapysef-library-generation\" id=\"markdown-toc-diapysef-library-generation\"><strong>diapysef library generation</strong></a></li>\n  <li><a href=\"#spectral-library-refinement-with-openswathassaygenerator\" id=\"markdown-toc-spectral-library-refinement-with-openswathassaygenerator\">Spectral library refinement with <strong>OpenSwathAssayGenerator</strong></a></li>\n  <li><a href=\"#adding-decoy-sequences-with-openswathdecoygenerator\" id=\"markdown-toc-adding-decoy-sequences-with-openswathdecoygenerator\">Adding decoy sequences with <strong>OpenSwathDecoyGenerator</strong></a></li>\n  <li><a href=\"#converting-the-spectral-library-with-targetedfileconverter\" id=\"markdown-toc-converting-the-spectral-library-with-targetedfileconverter\">Converting the spectral library with <strong>TargetedFileConverter</strong></a></li>\n  <li><a href=\"#conclusion\" id=\"markdown-toc-conclusion\">Conclusion</a></li>\n</ol>\n\n</blockquote>\n\n<h2 id=\"get-data\">Get data</h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Data upload</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Create a new history for this tutorial and give it a meaningful name</p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-creating-a-new-history\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-creating-a-new-history\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Creating a new history</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p>Click the <i class=\"fas fa-plus\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">new-history</span> icon at the top of the history panel:</p>   <p><img src=\"/training-material/shared/images/history_create_new.svg\" alt=\"UI for creating new history\" /></p>   <!-- the original drawing can be found here https://docs.google.com/drawings/d/1cCBrLAo4kDGic5QyB70rRiWJAKTenTU8STsKDaLcVU8/edit?usp=sharing --> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>Import the fasta and raw files as well as the experimental annotation and the iRTassays file from <a href=\"https://zenodo.org/record/4293493\">Zenodo</a>\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>https://zenodo.org/record/4293493/files/Human_database_plus_iRT.fasta\nhttps://zenodo.org/record/4293493/files/Ecoli_database.fasta\nhttps://zenodo.org/record/4293493/files/iRTassays.tsv\nhttps://zenodo.org/record/4293493/files/HEK_Ecoli_exp_design.txt\nhttps://zenodo.org/record/4293493/files/Sample1.raw\nhttps://zenodo.org/record/4293493/files/Sample2.raw\nhttps://zenodo.org/record/4293493/files/Sample3.raw\nhttps://zenodo.org/record/4293493/files/Sample4.raw\nhttps://zenodo.org/record/4293493/files/Sample5.raw\n</code></pre></div>      </div>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-importing-via-links\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-importing-via-links\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Importing via links</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Copy the link location</li>   <li>     <p>Click <i class=\"fas fa-upload\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-upload</span> <strong>Upload Data</strong> at the top of the tool panel</p>   </li>   <li>Select <i class=\"fa fa-edit\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-wf-edit</span> <strong>Paste/Fetch Data</strong></li>   <li>     <p>Paste the link(s) into the text field</p>   </li>   <li>     <p>Press <strong>Start</strong></p>   </li>   <li><strong>Close</strong> the window</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>\n      <p>Once the files are green, rename the experimental design file in ‘HEK_Ecoli_exp_design’, the iRT transition file in ‘iRTassays’ and all of the the raw files in ‘Sample1.raw’, ‘Sample2.raw’, ‘Sample3.raw’, ‘Sample4.raw’ and ‘Sample5.raw’</p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-renaming-a-dataset\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-renaming-a-dataset\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Renaming a dataset</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Click on the <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>   <li>In the central panel, change the <strong>Name</strong> field</li>   <li>Click the <strong>Save</strong> button</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>\n      <p>Once the files are green, generate a collection for all .raw files (and name it DDA_data) as well as for both .fasta files (and name it FASTA)</p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-creating-a-dataset-collection\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-creating-a-dataset-collection\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Creating a dataset collection</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Click on <i class=\"far fa-check-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-selector</span> <strong>Select Items</strong> at the top of the history panel <img src=\"/training-material/topics/galaxy-interface/images/historyItemControls.png\" alt=\"Select Items button\" /></li>   <li>Check all the datasets in your history you would like to include</li>   <li>     <p>Click <strong>n of N selected</strong> and choose <strong>Build Dataset List</strong></p>     <p><img src=\"/training-material/topics/galaxy-interface/images/buildList.png\" alt=\"build list collection menu item\" width=\"15%\" /></p>   </li>   <li>Enter a name for your collection</li>   <li>Click <strong>Create collection</strong> to build your collection</li>   <li>Click on the checkmark icon at the top of your history again</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h1 id=\"maxquant-analysis-of-dda-data\"><strong>MaxQuant</strong> Analysis of DDA data</h1>\n\n<p>The MaxQuant Galaxy implementation contains the most important MaxQuant parameters. As an alternative, <strong>MaxQuant (using mqpar.xml)</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> can be used with a preconfigured mqpar.xml file.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>MaxQuant Analysis</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/galaxyp/maxquant/maxquant/1.6.10.43+galaxy3\" title=\"MaxQuant tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>MaxQuant</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.6.10.43+galaxy3)</span> with the following parameters:\n      <ul>\n        <li>In <em>“Input Options”</em>:\n          <ul>\n            <li><i class=\"far fa-folder\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-collection</span> <em>“FASTA files”</em>: <code class=\"language-plaintext highlighter-rouge\">FASTA</code> collection</li>\n            <li><em>“identifier parse rule”</em>: <code class=\"language-plaintext highlighter-rouge\">&gt;([^ ]*)</code></li>\n            <li><em>“description parse rule”</em>: <code class=\"language-plaintext highlighter-rouge\">^&gt;.*\\|.*\\|[^ ]+ (.*) OS.*$</code></li>\n          </ul>\n        </li>\n        <li>In <em>“Search Options”</em>:\n          <ul>\n            <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Specify an experimental design template”</em>: <code class=\"language-plaintext highlighter-rouge\">HEK_Ecoli_exp_design.txt</code></li>\n            <li><em>“minimum unique peptides”</em>: <code class=\"language-plaintext highlighter-rouge\">1</code></li>\n            <li><em>“Match between runs”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n          </ul>\n        </li>\n        <li>In <em>“Protein quantification”</em>:\n          <ul>\n            <li><em>“Use only unmodified peptides”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n          </ul>\n        </li>\n        <li>In <em>“Parameter Group”</em>:\n          <ul>\n            <li><i class=\"far fa-folder\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-collection</span> <em>“Infiles”</em>: <code class=\"language-plaintext highlighter-rouge\">DDA_data</code> collection\n              <ul>\n                <li><em>“missed cleavages”</em>: <code class=\"language-plaintext highlighter-rouge\">1</code></li>\n                <li><em>“variable modifications”</em>: <code class=\"language-plaintext highlighter-rouge\">Oxidation (M)</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n        <li><em>“Generate PTXQC (proteomics quality control pipeline) report? (experimental setting)”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n        <li>In <em>“Output Options”</em>:\n          <ul>\n            <li><em>“Select the desired outputs.”</em>: <code class=\"language-plaintext highlighter-rouge\">Protein Groups</code> <code class=\"language-plaintext highlighter-rouge\">Peptides</code> <code class=\"language-plaintext highlighter-rouge\">mqpar.xml</code> <code class=\"language-plaintext highlighter-rouge\">Evidence</code> <code class=\"language-plaintext highlighter-rouge\">MSMS</code></li>\n          </ul>\n        </li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title>Protein Groups</comment-title>\n        <p>Proteins that share all their peptides with other proteins cannot be unambiguously identified. Therefore, MaxQuant groups such proteins into one protein group and only one common quantification will be calculated. The different protein properties are separated by semicolon.</p>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>Here we used a variation of the <em>“identifier parse rule”</em> to allow for the organism label to be present in the spectral library. For investigations of single organisms and to keep only the Uniprot identifier one can adjust the <em>“identifier parse rule”</em> accordingly\nMore details on the different <strong>MaxQuant</strong> parameters can be found in this <a href=\"/training-material/topics/proteomics/tutorials/maxquant-label-free/tutorial.html\">MaxQuant tutorial</a>.</p>\n\n<blockquote class=\"tip\">\n  <tip-title>Continue with results from Zenodo</tip-title>\n\n  <p>In case the MaxQuant run is not yet finished, the results can be downloaded from Zenodo to be able to continue the tutorial</p>\n  <ol>\n    <li>Import the files from <a href=\"https://zenodo.org/record/4293493\">Zenodo</a>\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>https://zenodo.org/record/4293493/files/MaxQuant_PTXQC_report.pdf\nhttps://zenodo.org/record/4293493/files/MaxQuant_Protein_Groups.tabular\nhttps://zenodo.org/record/4293493/files/MaxQuant_Peptides.tabular\nhttps://zenodo.org/record/4293493/files/MaxQuant_Evidence.tabular\nhttps://zenodo.org/record/4293493/files/MaxQuant_MSMS.tabular\nhttps://zenodo.org/record/4293493/files/MaxQuant_mqpar.xml\n</code></pre></div>      </div>\n    </li>\n  </ol>\n</blockquote>\n\n<h2 id=\"quality-control-results\">Quality control results</h2>\n\n<p>To get a first overview of the MaxQuant results, the PTXQC report is helpful. Click on the <i class=\"far fa-eye\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-eye</span> eye of the PTXQC pdf file to open it in Galaxy. Screening through the different plots might already give you a hint on how many peptides and proteins were identified as well as some of the data quality.</p>\n\n<p>The PTXQC software (<span class=\"citation\"><a href=\"#Bielow2015\">Bielow <i>et al.</i> 2015</a></span>) was built to enable direct proteomcs quality control from MaxQuant result files. This quality control can be directly used in the Galaxy MaxQuant wrapper by setting <em>“Generate PTXQC”</em> to <code class=\"language-plaintext highlighter-rouge\">yes</code>. This will generate a pdf file with multiple quality control plots. Be aware that the cutoffs set in PTXQC might not be applicable to your experiment and mass spectrometer type and therefore “under performing” and “fail” do not necessarily mean that the quality is poor.</p>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <ol>\n    <li>How many proteins were found in total?</li>\n    <li>How many peptides were found in total?</li>\n  </ol>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n    <ol>\n      <li>Approximately 5,370 proteins were found (see ProteinGroups output)</li>\n      <li>Approximately 34,970 peptides were found (see Peptides output)</li>\n    </ol>\n\n  </blockquote>\n\n</blockquote>\n\n<h2 id=\"filter-for-unique-peptides-in-the-evidence-and-msms-output\"><strong>Filter</strong> for unique peptides in the <em>evidence</em> and <em>msms</em> output</h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Filtering the <b>MaxQuant</b> search results for unique peptides</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"Filter1\" title=\"Filter tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Filter</strong></span> with the following parameters:\n    - <i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Infile”</em>: <code class=\"language-plaintext highlighter-rouge\">MaxQuant_Evidence</code>\n      <ul>\n        <li><em>“With following condition”</em>: <code class=\"language-plaintext highlighter-rouge\">len(c9.split(';')) &lt; 2</code></li>\n        <li><em>“Number of header lines to skip”</em>: <code class=\"language-plaintext highlighter-rouge\">1</code></li>\n      </ul>\n    </li>\n    <li><span class=\"tool\" data-tool=\"Filter1\" title=\"Filter tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Filter</strong></span> with the following parameters:\n    - <i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Infile”</em>: <code class=\"language-plaintext highlighter-rouge\">MaxQuant_MSMS</code>\n      <ul>\n        <li><em>“With following condition”</em>: <code class=\"language-plaintext highlighter-rouge\">len(c12.split(';')) &lt; 2</code></li>\n        <li><em>“Number of header lines to skip”</em>: <code class=\"language-plaintext highlighter-rouge\">1</code></li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title>Unique Features / peptides</comment-title>\n        <p>Peptides which only occur in one protein are considered as unique for this specific protein. To avoid ambigious protein mapping later we filter the <strong>MaxQuant</strong> search results for unique peptides only. CAUTION: This increase in specificity (each peptide originates from only one protein) will reduce the size of the spectral library and might lead to decreased sensitivity  during the DIA analysis.</p>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <ol>\n    <li>How many unique features per lines remain after the filtering in the evidence and the msms output?</li>\n  </ol>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <ol>\n      <li>~100,000 lines in the evidence and ~98,000 lines in the msms.</li>\n    </ol>\n\n  </blockquote>\n\n</blockquote>\n\n<h1 id=\"diapysef-library-generation\"><strong>diapysef library generation</strong></h1>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Generation of a spectral library using the unique <b>MaxQuant</b> search results and indexed retention time <i>iRT</i> peptides</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/galaxyp/diapysef/diapysef/0.3.5.0\" title=\"diapysef library generation tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>diapysef library generation</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.3.5.0)</span> with the following parameters:\n      <ul>\n        <li>In <em>“MaxQuant output file msms.txt</em>:\n          <ul>\n            <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Infile”</em>: <code class=\"language-plaintext highlighter-rouge\">Filter on MaxQuant_MSMS</code></li>\n          </ul>\n        </li>\n        <li>In <em>“MaxQuant output file evidence.txt</em>:\n          <ul>\n            <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Infile”</em>: <code class=\"language-plaintext highlighter-rouge\">Filter on MaxQuant_Evidence</code></li>\n          </ul>\n        </li>\n        <li>In <em>“Retention time alignment method”</em>:\n          <ul>\n            <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Infile”</em>: <code class=\"language-plaintext highlighter-rouge\">iRTassays.tsv</code></li>\n          </ul>\n        </li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title>Indexed retention time <i>iRT</i> peptides</comment-title>\n        <p>To allow for improved alignement of the different measurements, synthetic (non-endogenous) peptides which were spiked-in to all samples prior to the MS measurement. First the measured retention times (RTs) of those spiked-in peptides are extracted in the <strong>MaxQuant</strong> search results. Using the measured RTs as well as arbitrary assigned values (ranging from -26 to 99) a linear regression through the 11 synthetic peptides is applied.  Based on this linear regression fit <em>indexed</em> retention times (iRTs) are assigned to all other peptides.</p>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <ol>\n    <li>How many of the 11 synthetic peptides were found in the first DDA (Sample1) file?</li>\n    <li>How many were found in the second DDA (Sample2) file?</li>\n  </ol>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <ol>\n      <li>8 iRT peptides were found in the first DDA file</li>\n      <li>9 iRT peptides were found in the second DDA file</li>\n    </ol>\n\n  </blockquote>\n\n</blockquote>\n\n<h1 id=\"spectral-library-refinement-with-openswathassaygenerator\">Spectral library refinement with <strong>OpenSwathAssayGenerator</strong></h1>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Spectral library optimization and refinement using <b>OpenSwathAssayGenerator</b></hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/galaxyp/openms_openswathassaygenerator/OpenSwathAssayGenerator/2.6+galaxy0\" title=\"OpenSwathAssayGenerator tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>OpenSwathAssayGenerator</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 2.6+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><em>“Output file type – default: determined from file extension or content”</em>: <code class=\"language-plaintext highlighter-rouge\">tabular (tsv)</code></li>\n        <li><em>“MZ threshold in Thomson for precursor ion selection”</em>: <code class=\"language-plaintext highlighter-rouge\">0.015</code></li>\n        <li><em>“upper MZ limit for precursor ions”</em>: <code class=\"language-plaintext highlighter-rouge\">1000.0</code></li>\n        <li><em>“MZ threshold in Thomson for fragment ion annotation”</em>: <code class=\"language-plaintext highlighter-rouge\">0.015</code></li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title>Adjustment of the Spectral library</comment-title>\n        <p>The spectral library coming from <strong>diapysef library generation</strong> contains all observed fragment ions from the DDA runs resulting in a relativly large spectral library. Large libraries can lead to inceased processing times as well as fewer identifications after adjusting based on the False Discovery Rate (FDR). Thus, it is recommened to optimize and refine the spectral library by e.g. filtering for peptides with at least 6 transitions (increased confidence) and limiting the maximum also to 6 transitions (avoiding inflated libraries). Furthermore, the scan range can be adjusted (here between 400 - 1000 m/z) covering the same m/z range as in the DIA measurements.</p>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <ol>\n    <li>How many transitions does the refined spectral library contain and how many were removed?</li>\n  </ol>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <ol>\n      <li>The refined library contains ~170,000 lines, and almost 700,000 lines were removed.</li>\n    </ol>\n\n  </blockquote>\n\n</blockquote>\n\n<h1 id=\"adding-decoy-sequences-with-openswathdecoygenerator\">Adding decoy sequences with <strong>OpenSwathDecoyGenerator</strong></h1>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Adding <i>decoy</i> transitions to the spectral library</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/galaxyp/openms_openswathdecoygenerator/OpenSwathDecoyGenerator/2.6+galaxy0\" title=\"OpenSwathDecoyGenerator tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>OpenSwathDecoyGenerator</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 2.6+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><em>“Output file type – default: determined from file extension or content”</em>: <code class=\"language-plaintext highlighter-rouge\">tabular (tsv)</code></li>\n        <li><em>“Advanced Options”</em>: <code class=\"language-plaintext highlighter-rouge\">Show Advanced Options</code>\n          <ul>\n            <li><em>“MZ threshold in Thomson for fragment ion annotation”</em>: <code class=\"language-plaintext highlighter-rouge\">0.015</code></li>\n          </ul>\n        </li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title><i>Decoy</i> transitions</comment-title>\n        <p>To enable correct false discovery rate (FDR) computation later on, we add computanionally generated decoy sequences to the spectral library. Those “non-observed” sequences can be generated based on the observed sequences with slight modifications. The most commonly used methods are either <strong>shuffle</strong> (randomly altering the amino acid sequence of each observed transition) or <strong>reverse</strong> (by reversing the actually obeserved transitions). Those artificially generated transitions were labelled as <strong>decoy</strong> and are later on considered as known false positives.\nExample: By applying an FDR of 1 % we only allow for e.g only 1 such decoy transition out of 100 identifications. Thus one could estimate that the remaining 99 non-labeled identifications contain also 1 % false positive hits.</p>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <ol>\n    <li>How many lines do you expect after running the <strong>OpenSwathDecoyGenerator</strong> on your spectral library containing only observed transitions?</li>\n  </ol>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <ol>\n      <li>We expect double the amount of lines (~340,000), since we generate one <em>decoy</em> (non-observed) per <em>target</em> (observed) sequence.</li>\n    </ol>\n\n  </blockquote>\n\n</blockquote>\n\n<h1 id=\"converting-the-spectral-library-with-targetedfileconverter\">Converting the spectral library with <strong>TargetedFileConverter</strong></h1>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Converting the final spectral library from <i>.tsv</i> to the sqlite <i>.pqp</i> format</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/galaxyp/openms_targetedfileconverter/TargetedFileConverter/2.6+galaxy0\" title=\"TargetedFileConverter tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>TargetedFileConverter</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 2.6+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><em>“Output file type – default: determined from file extension or content”</em>: <code class=\"language-plaintext highlighter-rouge\">pqp</code></li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title>Finding the right format for the spectral library.</comment-title>\n        <p>Generally there is a broad variety of data formats for spectral libraries including <em>.tsv</em>, <em>.dlib</em>, <em>.pqp</em> and more. Depending on the DIA analysis software one or multiple formats are supported and can be used. In <strong>OpenSwathWorkflow</strong> one needs to have the spectral library in <em>.pqp</em> format to being able to combine multiple runs after the DIA analysis and before applying the FDR scoring. This is particularily interesting when the multiple runs should be compared later on.</p>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <ol>\n    <li>How many peptides and proteins does the final library contain?</li>\n    <li>How many <em>target</em> peptides and proteins are in the library?</li>\n  </ol>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <ol>\n      <li>The final spectral library contains over 56,000 peptides covering over 10,200 proteins.</li>\n      <li>Since we added equal numbers of <em>decoy</em> sequences we expect to have only half of the peptides and proteins (~28,000 and ~5,100) which are real targets.</li>\n    </ol>\n\n  </blockquote>\n\n</blockquote>\n\n<h1 id=\"conclusion\">Conclusion</h1>\n\n<figure id=\"figure-2\" style=\"max-width: 90%;\"><img src=\"../../images/DIA_lib_gen_sum.png\" alt=\"DDA_lib_gen_pipe. \" width=\"1654\" height=\"332\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/DIA_lib_gen_sum.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 2</strong>:</span> All-in one workflow for DIA analysis in Galaxy. The generation of a spectral library is highlighted in red.</figcaption></figure>\n\n<p>Using data dependent acquisiton (DDA) mass spectrometry data we generated a spectral library which can be used for the analysis of data independent acquisition (DIA) data. The quality and content of the spectral library is crucial for the following DIA data analysis. Thus, in some analysis it might be beneficial or even necessary to use slightly adjusted spectral libraries, containing e.g. semi-tryptic peptides (see enzyme in <strong>MaxQuant</strong>), non-unique peptides (skip filtering) or longer peptides (higher missed cleavages).</p>\n\n<figure id=\"figure-3\" style=\"max-width: 90%;\"><img src=\"../../images/DIA_lib_gen_workflow.png\" alt=\"DDA_lib_gen_galaxy. \" width=\"1903\" height=\"609\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/DIA_lib_gen_workflow.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 3</strong>:</span> Galaxy worfklow containing all necessary steps for the genration of a spectral library.</figcaption></figure>\n\n"],"ref_slides":[],"video_library":{"tutorial":null,"slides":null,"demo":null,"both":null,"session":null},"hands_on":true,"slides":false,"mod_date":"2023-11-03 14:30:27 +0000","pub_date":"2020-12-02 18:41:23 +0000","version":15,"workflows":[{"workflow":"Galaxy-Workflow-DIA_lib_Training_HEK_Ecoli_3_EG_data.ga","tests":false,"url":"https://training.galaxyproject.org/training-material/topics/proteomics/tutorials/DIA_lib_OSW/workflows/Galaxy-Workflow-DIA_lib_Training_HEK_Ecoli_3_EG_data.ga","path":"topics/proteomics/tutorials/DIA_lib_OSW/workflows/Galaxy-Workflow-DIA_lib_Training_HEK_Ecoli_3_EG_data.ga","wfid":"proteomics-DIA_lib_OSW","wfname":"galaxy-workflow-dia_lib_training_hek_ecoli_3_eg_data","trs_endpoint":"https://training.galaxyproject.org/training-material/api/ga4gh/trs/v2/tools/proteomics-DIA_lib_OSW/versions/galaxy-workflow-dia_lib_training_hek_ecoli_3_eg_data","license":null,"creators":[],"name":"DIA_lib_OSW","title":"DIA_lib_OSW","test_results":null,"modified":"2024-06-14 00:15:05 +0000","mermaid":"flowchart TD\n  0[\"ℹ️ Input Dataset\\nHEK_Ecoli_exp_design.txt\"];\n  style 0 stroke:#2c3143,stroke-width:4px;\n  1[\"ℹ️ Input Dataset\\niRTassays.tsv\"];\n  style 1 stroke:#2c3143,stroke-width:4px;\n  2[\"ℹ️ Input Collection\\nFASTA collection\"];\n  style 2 stroke:#2c3143,stroke-width:4px;\n  3[\"ℹ️ Input Collection\\nDDA_data collection\"];\n  style 3 stroke:#2c3143,stroke-width:4px;\n  4[\"MaxQuant\"];\n  2 -->|output| 4;\n  3 -->|output| 4;\n  0 -->|output| 4;\n  5[\"Filter\"];\n  4 -->|evidence| 5;\n  6[\"Filter\"];\n  4 -->|msms| 6;\n  7[\"diapysef library generation\"];\n  5 -->|out_file1| 7;\n  1 -->|output| 7;\n  6 -->|out_file1| 7;\n  8[\"OpenSwathAssayGenerator\"];\n  7 -->|output_tabular| 8;\n  9[\"OpenSwathDecoyGenerator\"];\n  8 -->|out| 9;\n  10[\"TargetedFileConverter\"];\n  9 -->|out| 10;"}],"api":"https://training.galaxyproject.org/training-material/api/topics/proteomics/tutorials/DIA_lib_OSW/tutorial.json","tools":["Filter1","toolshed.g2.bx.psu.edu/repos/galaxyp/diapysef/diapysef/0.3.5.0","toolshed.g2.bx.psu.edu/repos/galaxyp/maxquant/maxquant/1.6.10.43+galaxy3","toolshed.g2.bx.psu.edu/repos/galaxyp/openms_openswathassaygenerator/OpenSwathAssayGenerator/2.5+galaxy0","toolshed.g2.bx.psu.edu/repos/galaxyp/openms_openswathassaygenerator/OpenSwathAssayGenerator/2.6+galaxy0","toolshed.g2.bx.psu.edu/repos/galaxyp/openms_openswathdecoygenerator/OpenSwathDecoyGenerator/2.5+galaxy0","toolshed.g2.bx.psu.edu/repos/galaxyp/openms_openswathdecoygenerator/OpenSwathDecoyGenerator/2.6+galaxy0","toolshed.g2.bx.psu.edu/repos/galaxyp/openms_targetedfileconverter/TargetedFileConverter/2.5+galaxy0","toolshed.g2.bx.psu.edu/repos/galaxyp/openms_targetedfileconverter/TargetedFileConverter/2.6+galaxy0"],"supported_servers":{"exact":[{"url":"https://usegalaxy.eu","name":"UseGalaxy.eu","usegalaxy":true}],"inexact":[{"url":"https://usegalaxy.cz/","name":"UseGalaxy.cz","usegalaxy":false},{"url":"https://usegalaxy.no/","name":"UseGalaxy.no","usegalaxy":false},{"url":"https://usegalaxy.org.au","name":"UseGalaxy.org.au","usegalaxy":true}]},"topic_name_human":"Proteomics","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[{"name":"diapysef","owner":"galaxyp","revisions":"8eed818f5d48","tool_panel_section_label":"Proteomics","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"maxquant","owner":"galaxyp","revisions":"37d669de2828","tool_panel_section_label":"Proteomics","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"openms_openswathassaygenerator","owner":"galaxyp","revisions":"df72ca515420","tool_panel_section_label":"Proteomics","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"openms_openswathassaygenerator","owner":"galaxyp","revisions":"2a9ff56cb279","tool_panel_section_label":"Proteomics","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"openms_openswathdecoygenerator","owner":"galaxyp","revisions":"965413f29bf5","tool_panel_section_label":"Proteomics","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"openms_openswathdecoygenerator","owner":"galaxyp","revisions":"f861ec9fbe59","tool_panel_section_label":"Proteomics","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"openms_targetedfileconverter","owner":"galaxyp","revisions":"aa62f8f48dd4","tool_panel_section_label":"Proteomics","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"openms_targetedfileconverter","owner":"galaxyp","revisions":"dd71e020e2aa","tool_panel_section_label":"Proteomics","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"}]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools:\n- name: diapysef\n  owner: galaxyp\n  revisions: 8eed818f5d48\n  tool_panel_section_label: Proteomics\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: maxquant\n  owner: galaxyp\n  revisions: 37d669de2828\n  tool_panel_section_label: Proteomics\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: openms_openswathassaygenerator\n  owner: galaxyp\n  revisions: df72ca515420\n  tool_panel_section_label: Proteomics\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: openms_openswathassaygenerator\n  owner: galaxyp\n  revisions: 2a9ff56cb279\n  tool_panel_section_label: Proteomics\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: openms_openswathdecoygenerator\n  owner: galaxyp\n  revisions: 965413f29bf5\n  tool_panel_section_label: Proteomics\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: openms_openswathdecoygenerator\n  owner: galaxyp\n  revisions: f861ec9fbe59\n  tool_panel_section_label: Proteomics\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: openms_targetedfileconverter\n  owner: galaxyp\n  revisions: aa62f8f48dd4\n  tool_panel_section_label: Proteomics\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: openms_targetedfileconverter\n  owner: galaxyp\n  revisions: dd71e020e2aa\n  tool_panel_section_label: Proteomics\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n","tours":false,"video":false,"translations":{"tutorial":[],"slides":[],"video":false},"license":"CC-BY-4.0","type":"tutorial"}