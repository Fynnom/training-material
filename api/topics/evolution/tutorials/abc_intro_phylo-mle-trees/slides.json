{"layout":"tutorial_slides","logo":"shared/images/biocommons-utas.png","title":"Phylogenetics - Back to Basics - Estimating trees from alignments","zenodo_link":"","subtopic":"phylogenetics","priority":5,"contributors":["mcharleston"],"js_requirements":{"mathjax":4916,"mermaid":false},"short_id":"S00117","url":"/topics/evolution/tutorials/abc_intro_phylo-mle-trees/slides.html","topic_name":"evolution","tutorial_name":"abc_intro_phylo-mle-trees","dir":"topics/evolution/tutorials/abc_intro_phylo-mle-trees","symlink":null,"id":"evolution/abc_intro_phylo-mle-trees","ref_tutorials":[],"ref_slides":["# Likelihood\n\n*A way to select models, given data*\n\n---\n# Why Likelihood?\n<br>\n<br>\n* _Statistical rigour!_  Likelihood requires a statistical model and gains scientific rigour to defend hypotheses made.\n* _Comparing hypotheses!_ We can compare models of evolution and determine which is better supported by the data.\n* _Accuracy!_ Likelihood is generally the most accurate method to estimate phylogenies.\n\n\n\n---\n# Likelihood Definition\n<br>\n<br>\nThe *likelihood* of a model is a quantity that is *proportional* to the probability that the model gave you the data.\n<br>\n<br>\nIt is easy(ish) to calculate the probability that a given model yields a particular outcome -- the data set.\n<br>\n<br>\nMaximum Likelihood (ML) seeks to find the model for which this probability is the *highest*.\n\n\n---\n# Dice example\n<br>\n<br>\n\nImagine I have a set of very strange 10-sided dice, where the sides of my .blue[blue] die are labelled (1,1,2,3,4,5,5,6,6,6), and the sides of the .red[red] die are labelled (1,1,2,2,3,3,4,4,5,6).\n<br>\n<br>\nBoth dice have the same range of possible outcomes, 1 through 6, but the relative probabilities are different.\n\n| score | P.red[red] | P.blue[blue]|\n|:--:|:--:|:--:|\n|\t1 | 0.2 | 0.2 |\n|\t\t2 | 0.1 | 0.2 |\n|\t\t3 | 0.1 | 0.2 |\n|\t\t4 | 0.1 | 0.2 |\n|\t\t5 | 0.2 | 0.1 |\n|\t\t6 | 0.3 | 0.1 |\n|\tTotal\t| 1.0 | 1.0 |\n\n\n---\n# Dice example\n<br>\n<br>\n\nSuppose I choose a die and roll it three times, getting values 3, 6, and 2.\n<br>\n<br>\nWhich die is most likely to have been used?\n<br>\n<br>\nIf it were the .blue[blue] die then the probability of this outcome is \\\\(0.1\\times 0.3 \\times 0.1 = 0.003\\\\).\n<br>\n<br>\nIf it were the .red[red] die then this probability is \\\\(0.2\\times 0.1 \\times 0.2 = 0.004\\\\).\n<br>\n<br>\nNeither of these probabilities is high!  But the larger of the two is for the .red[red] die: thus, given the data, we would say the maximum likelihood estimate of the \"model\" (here, which die was used) is the .red[red] die.\n\n\n---\n# Slightly formal, with Bayes\n<br>\nWe could write this example more formally as\n\n* Data \\\\(D\\\\) is the outcome \\\\((3,6,2)\\\\);\n\n* \\\\(P(\\color{blue}{B})\\\\) and \\\\(P(\\color{red}{R})\\\\) are the probabilities of choosing the blue and red dice (say 0.5 each);\n\n* \\\\(P(D|\\color{blue}{B})\\\\) and \\\\(P(D|\\color{red}{R})\\\\) are the probabilities of the data given the model \"blue die\" and \"red die\";\n\n* \\\\(P(\\color{blue}{B}|D)\\\\) is the probability of the *model* given the *data*, and it can be written\n\n\\\\(\n\tP(\\color{blue}{B}|D) = \\frac{P(D|\\color{blue}{B})P(\\color{blue}{B})}{P(D)} = \\frac{P(D|\\color{blue}{B})P(\\color{blue}{B})}{P(D|\\color{blue}{B})P(\\color{blue}{B})+P(D|\\color{red}{R})P(\\color{red}{R})}\n\\\\)\n<br>\n<br>\n-- this is *Bayes' formula*.\n<br>\n<br>\n* Similarly we can write \\\\(P(\\color{red}{R}|D)\\\\) as\n\n\\\\(\n\tP(\\color{red}{R}|D) = \\frac{P(D|\\color{red}{R})P(\\color{red}{R})}{P(D)} = \\frac{P(D|\\color{red}{R})P(\\color{red}{R})}{P(D|\\color{blue}{B})P(\\color{blue}{B})+P(D|\\color{red}{R})P(\\color{red}{R})}\n\\\\)\n<br>\n<br>\n* These conditional probabilities can be thought of as the relative likelihoods of the model, given the data.\n\n\n---\n# Important Concepts learned\n<br>\n<br>\nThe dice example was very simple but it showed us important concepts:\n\n1. We could turn around the probability of the data given a model to the probability of a model, given the data;\n<br>\n2. Of the models considered, it was possible to choose one that was more likely;\n<br>\n3. These likelihoods can be really small, and don't have to sum to 1 (so they're not probabilities really).\n\n\n---\n# Likelihood values in practice\n<br>\n<br>\nIn phylogenetics the probability of an alignment given a tree and its probabilities become really tiny so in order to avoid underflow numerical errors we use the natural log of the probabilities, and call it the *log-likelihood*.\n\n\n\n---\n# Probability of a substitution\n<br>\n<br>\nNow suppose we have a probability matrix whose entries are the probabilities of nucleotide substitution in some fixed time, say 1 million years:\n<br>\n<br>\n.image-50[ ![Formula where the probability of nucleotide substitutions P is expressed in a matrix with the nucleotides AGCT on both the x and y axis. The probability of changing from any nucleotide to another is 0.01. Probability of not changing is 0.97. Long description provided in the video recording at 11:20.](images/05-mle-02-probmatrix-1.png) ]\n<br>\n<br>\nWe could then calculate the probability of going from one nucleotide to another, say *A* to *G*, in 1M years by reading it from the graph:\n\n\\\\(\n\tPr(A\\to G) = P_{A,G} = 0.01.\n\\\\)\n\n\n---\n\n# Probability of sequences changing\n<br>\n<br>\nTo calculate the probability of multiple nucleotides changing we multiply the individual probabilities together -- which is making direct use of the assumption that each nucleotide site evolves independently of the others.\n<br>\n<br>\nWe would then calculate the probability of going from sequence **AAGT** to **AAGA** as\n\n<br>\n\n$$\n\\begin{align}\nprob & = P(A\\to A)\\times P(A\\to G) \\times P(G\\to G) \\times P(T\\to A) \\\\\\\\\n     & = 0.97 \\times 0.01 \\times 0.97 \\times 0.01 \\\\\\\\\n     & \\approx 9.4\\times 10^{-6}\n\\end{align}\n$$\n\n---\n# Changing the time\n<br>\n<br>\nTo calculate the probability of sequences changing in our toy example for say *two* million years, we would *square* the probability matrix \\\\(P\\\\):\n<br>\n<br>\n.image-50[ ![Formula where the probability of sequences changing over two million years P2 is expressed in a matrix with the nucleotides AGCT on both the x and y axis. The probability of changing from any nucleotide to another is 0.0196. Probability of not changing is 0.9412.\nLong description provided in the video recording at 13:12.](images/05-mle-03-probmatrixsquared-1.png)]\n<br>\n<br>\nNotice that the probability of going from A to G is not quite twice what it was before, since now there is a small chance that A will change to G and then back again.\n<br>\n<br>\nSo if we have a probability matrix for a fixed time period we can convert it to a probability matrix for multiples of that time.\n\n---\n# Probabilities to Rates\n<br>\n<br>\nThis doesn't generalise to arbitrary time periods, so instead we use a *rate* matrix, like this:\n<br>\n<br>\n.image-50[ ![Formula where the rate of nucleic acid subtitutions Q is expressed as a matrix with the nucleotides AGCT on both the x and y axis. The rate of change from any nucleotide to another is 0.01. The rate of not changing is -0.03. Long description provided in the video recording at 15:56](images/05-mle-04-ratematrix-1.png) ]\n<br>\n<br>\nConverting a rate matrix to a probability requires a matrix *exponentiation*, giving formulae like this:\n\n\\\\(\n\tP(t) = e^{Qt}.\n\\\\)\n\nWe won't worry here about technical details, but note that some classes of rate matrix are easier to work with than others, the easiest being the JC69 (one parameter) matrix.\n\n\n---\n# Likelihood uses rate matrices\n<br>\n<br>\n* Many models of sequence evolution available, including different base (nucleotide) frequencies, and different sites being allowed different rates.\n\n* Likelihoods will be expressed as a (negative) log-likelihood, and these are used to compare models.\n\n* Typically these will be quite large (e.g., -37000, -80000), but it is the *relative likelihoods* that matter, so the *difference* between log likelihoods.\n\n\n.blue[A model is selected to give the best chance of getting the phylogeny right.]\n\n---\n# A huge range of models\n<br>\n<br>\n* More parameter-rich models fit better; we need to avoid over-fitting.\n\n* The (log)-likelihood value can be adjusted to penalise the model, based on the number of parameters.\n\n* Common penalties are the Akaike Information Criterion (AIC).\n\n* There is also a \"corrected\" AIC (AICc), and a \"Bayesian Information Criterion\" penalty (BIC).\n\n---\n# Penalised likelihood\n<br>\n<br>\nFor a model with \\\\(k\\\\) free parameters and a log likelihood \\\\(L\\\\), here are the penalty functions:\n<br>\n<br>\nAIC is the original information-theoretic correction:\n\\\\( AIC = 2k-2\\ln(L)\\\\)\n<br>\n<br>\nAICc is a correction for small sample sizes and is equal to\n\\\\( AICc = AIC + \\frac{2k^{2}+2k}{n-k-1} \\\\)\n<br>\n<br>\nBIC is defined by\n\\\\( BIC = k\\ln(n) - 2\\ln(L)\\\\)\n(where \\\\(n\\\\) is a measure of sample size).\n<br>\n<br>\nAll of these are in common use but the commonest is AIC, and that is the method we use in the tutorial.\n\n---\n# Phylogenetic likelihood is mostly directionless\n<br>\n<br>\nThe likelihood calculations in this tutorial are based on *reversible* models: that means that there is no difference between the likelihood of going from sequence A to sequence B of from B to A.\n<br>\n<br>\nThis means that the output trees are *unrooted*.\n<br>\n<br>\n(There are some asymmetric models included in IQTree but they are well beyond the scope of this tutorial and are not in common use.)\n\n---\n# Likelihood of a tree and model\n<br>\n<br>\nNow we have the huge task:\n\n```{code}\nML Search:\n\tfor every tree $T$ in tree space {\n\t\tfor each parameter in the substitution rate matrix {\n\t\t\tfor each branch length {\n\t\t\t\tCalculate the (log-)likelihood of the alignment\n\t\t\t}\n\t\t}\n\t}\n```\n\n... and find the best combination!\n<br>\n<br>\nAll this means that *Maximum Likelihood is slow*.\n\n---\n# Likelihood under JC69\n<br>\n<br>\n.image-50[ ![Formula where rate of nucleic acid substitutions  according to Jukes-Cantor 69 model QJC69  are expressed as a matrix with the nucleotides AGCT on both the x and y axis. The rate of change from any nucleotide to another is represented by the character alpha. The rate of not changing is represented by an asterisk. Long description provided in the video recording at 26:47](images/05-mle-05-JC69-1.png) ]\n\n.reduce-75[ where the asterisk is a short-hand to make the row-sums equal 0. ]\n<br>\n<br>\n* This model has only one parameter.\n* Note: we cannot separate this from the overall rate (just as you can't tell people how \"far\" somewhere is by assuming how fast they'll travel).\n* Thus tree search is \"only\" over all trees and all branch lengths.\n\n\n---\n# Likelihood under HKY85\n<br>\n<br>\n.image-50[ ![Formula where rate of nucleic acid substitutions  according to the HKY85 model QHKY85  is expressed as a matrix with the nucleotides AGCT on both the x and y axis. The rate of change from any nucleotide to another is a factor of variation in nucleotide frequencies πA; πG; πC; πT and transition/transversion rates kappa. The rate of not changing is represented by an asterisk. Long description provided in the video recording at 28:06](images/05-mle-06-HKY85-1.png) ]\n<br>\n<br>\n* The HKY85 model has *four* parameters: \\\\(\\pi\\_{A}\\\\), \\\\(\\pi\\_{G}\\\\), \\\\(\\pi\\_{C}\\\\) (and this fixes \\\\(\\pi\\_{T}\\\\)), and a transition/ transversion rate ratio \\\\(\\kappa\\\\).\n\n* Can fix \\\\(\\pi\\\\) or estimate it from the observed frequencies, or even estimate it by searching for the best values (which means it takes longer of course).\n\n\n---\n# GTR\n<br>\n<br>\nThe General Time Reversible model has *nine* parameters: three from the base frequencies and six more from the parameters in the substitution rate matrix:\n<br>\n<br>\n.image-50[ ![Formula where rate of nucleic acid substitutions  according to the GTR model QGTR  is expressed as a matrix with the nucleotides AGCT on both the x and y axis. The rate of change from any nucleotide to another incorporates nine parameters represented by Greek letters. The rate of not changing is represented by an asterisk. Long description provided in the video recording at 30:00](images/05-mle-07-GTR-1.png) ]\n<br>\n<br>\n(The Greek letters are not standardised: they just show the structure.)\n\n---\n# Rates across sites\n<br>\n<br>\n* Some sites are non-coding: they evolve *faster* than others.\n\n* Third codon position sites are largely redundant: for most amino acids, the third nucleotide is *free to vary*.\n\n* Some are under *strong selection* and evolve slowly.\n\n* Some are so important that they must stay in the same state else a protein will not fold properly: these are *fixed*.\n<br>\n<br>\nThis means that even if the same rate matrix might be applicable at different sites, the overall substitution rate might be hundreds of times faster at one site than another.\n<br>\n<br>\nModels that accommodate this are called \"Rates Across Sites\" or RAS models.\n<br>\n<br>\n.blue[By default, IQTree includes RAS models.]\n\n\n---\n# Rates across sites\n<br>\n<br>\n![Schematic representing differences in the rate of substitutions at different sites. A line with two dots on it represents two positions within a gene. Blue arrows connect each dot to separate rate matrices. The matrices are identical but the matrix on the right is annotated 5x indicating that there are 5 times more substitutions at this site. Described at 33:00](images/05-mle-08-RAS-1.png)\n\nWhile the proportions of substitution types might be the same, the overall *rate* at these two sites can differ.\n\n---\n\n# IQTree\n<br>\n<br>\n.image-25[\n  ![IQTree logo](images/05-mle-09-IQTreeLogo-1.png)\n]\n\nIQTree is at the forefront of maximum likelihood phylogenetic tools.  It is by far the most advanced such tool and is under active development, adding new models and features.\n\nIt is available from [IQtree.org](http://www.iqtree.org/).\n\n_To cite IQTree2, please use_\n\n*B.Q. Minh, H.A. Schmidt, O. Chernomor, D. Schrempf, M.D. Woodhams, A. von Haeseler, R. Lanfear* (2020) IQ-TREE 2: New models and efficient methods for phylogenetic inference in the genomic era. _Mol. Biol. Evol._, 37:1530-1534. [https://doi.org/10.1093/molbev/msaa015](https://doi.org/10.1093/molbev/msaa015)\n\n\n---\n# Tree Space\n<br>\n<br>\n_A way to navigate among trees_\n---\n# What is \"tree space\"?\n<br>\n<br>\n.left[ A *network*: ]\n  * whose nodes are *trees*, and\n  * whose edges are *adjacencies between trees*, where\n  * each node has some *score* or weight: here, it will be *likelihood*.\n<br>\n<br>\n.left[ As we cannot check every tree we must wander through the set of trees in the hope of finding \"good\" ones, under the assumption that the best (most likely) trees will have a lot in common with each other.]\n<br>\n<br>\n.left[ Fortunately this turns out to be the case!  The best trees tend to clump together in tree space.]\n\n---\n# Tree perturbations 1: NNI\n\n*N*earest *N*eighbour *I*nterchange is a way to transform one tree into another -- so we can search for the best tree.\n\nAn NNI move consists of effectively collapsing an internal branch of the tree and re-expanding it out in either of two possible ways.\n\nFor example, given the original tree\n\n.image-25[ ![Schematic of an unrooted phylogenetic tree. There are three connected internal nodes x,y,z and five tips A, B, C, D, E. A and B are connected to x; C is connected to Y; E and D are connected to z.](images/05-mle-10-initialtree-1.png) ]\n<br>\n<br>\nthere are two internal edges: \\\\(x-y\\\\) and \\\\(y-z\\\\). We can do an NNI move on each of them.\n\n\n---\n# Tree perturbations 1: NNI\n<br>\n<br>\n![Schematic of an unrooted phylogenetic tree. There are three connected internal nodes x,y,z and five tips A, B, C, D, E. A and B are connected to x; C is connected to Y; E and D are connected to z. The edge connecting x and y is coloured red.](images/05-mle-11-select-1.png)\n\nSelect edge \\\\(xy\\\\) to collapse.\n\n---\n# Tree perturbations 1: NNI\n<br>\n<br>\n![Schematic of a non-binary phylogenetic tree. There are two connected internal nodes xy and z and five tips A, B, C, D, E. A, B and C are connected to xy; D and E are connected to z. The internal node xy coloured red.](images/05-mle-12-collapse-1.png)\n\n\\\\(xy\\\\) is collapsed.\n\n---\n# Tree perturbations 1: NNI\n<br>\n<br>\n![Schematic of two phylogenetic trees. The tree on the left has three connected internal nodes x,y,z and five tips A, B, C, D, E. A and C are connected to x; B is connected to Y; E and D are connected to z. The edge connecting x and y is red. The tree on the right has three connected internal nodes x,y,z and five tips A, B, C, D, E. B and C are connected to x; A is connected to Y; E and D are connected to z. The edge connecting x and y is red.\n](images/05-mle-13-expand-1.png)\n\nExpand \\\\(xy\\\\) in either of two ways.\n<br>\n<br>\nFor an unrooted binary tree with \\\\(n\\\\) leaves, there are \\\\(2(n-3)\\\\) neighbouring trees under this move.\n\n---\n# Simple example: five taxa\n<br>\n<br>\n![Fifteen different unrooted binary phylogenetic trees containing five taxa are arranged in a star shaped configuration. Blue lines connect the trees and represent NNI moves. Long description provided at 40:00 in the video recording.](images/05-mle-14-treespace-1.png)\n\n\n---\n# Tree perturbations 2: SPR\n<br>\n<br>\n*S*ubtree *P*runing and *R*egrafting works by choosing an edge, cutting the tree at that edge, and then reconnecting the smaller part anywhere else in the larger part.\n\n![Schematic of an unrooted phylogenetic tree. The tree has four connected internal nodes w,x,y,z and six tips A, B, C, D, E, F. A and B are connected to w; C is connected to x;  D is connected to y; E and F are connected to z. The edge connecting w and z is red.](images/05-mle-15-SPR-select-1.png)\n---\n# Tree perturbations 2: SPR\n<br>\n<br>\n![Schematic of an unrooted phylogenetic tree. The tree has four connected internal nodes w,x,y,z and six tips A, B, C, D, E, F. A and B are connected to w; C is connected to x;  D is connected to y; E and F are connected to z. There is a black dot on the edge connecting w and z.](images/05-mle-16-SPR-trim-1.png)\n\nTrim the root of the subtree...\n---\n# Tree perturbations 2: SPR\n<br>\n<br>\n![Schematic of an unrooted phylogenetic tree. The tree has four connected internal nodes w,x,y,z and six tips A, B, C, D, E, F. A and B are connected to w; C is connected to x;  D is connected to y; E and F are connected to z. There is a black dot on the edge connecting w and z. A red arrow points from this dot to the edge connecting y and D.](images/05-mle-17-SPR-graft-yD-1.png)\n\nRegraft to \\\\(y-D\\\\),\n---\n# Tree perturbations 2: SPR\n<br>\n<br>\n![Schematic of an unrooted phylogenetic tree. The tree has four connected internal nodes w,x,y,z and six tips A, B, C, D, E, F. A and B are connected to w; C is connected to x;  D is connected to y; E and F are connected to z. There is a black dot on the edge connecting w and z. Red arrows point from this dot to the edge connecting y and D and the edge connecting y and z.](images/05-mle-18-SPR-graft-yz-1.png)\n\n... or \\\\(y-z\\\\),\n---\n# Tree perturbations 2: SPR\n<br>\n<br>\n![Schematic of an unrooted phylogenetic tree. The tree has four connected internal nodes w,x,y,z and six tips A, B, C, D, E, F. A and B are connected to w; C is connected to x;  D is connected to y; E and F are connected to z. There is a black dot on the edge connecting w and z. Red arrows point from this dot to the edges connecting y and D; y and z; and z and E.](images/05-mle-19-SPR-graft-zE-1.png)\n\n... or \\\\(z-E\\\\),\n---\n# Tree perturbations 2: SPR\n<br>\n<br>\n![Schematic of an unrooted phylogenetic tree. The tree has four connected internal nodes w,x,y,z and six tips A, B, C, D, E, F. A and B are connected to w; C is connected to x;  D is connected to y; E and F are connected to z. There is a black dot on the edge connecting w and z. Red arrows point from this dot to the edges connecting y and D; y and z;  z and E; and z and F.](images/05-mle-20-SPR-graft-zF-1.png)\n\n... or \\\\(z-F\\\\).\n\nUnder this move there are more neighbours: \\\\(4(n-3)(n-2)\\\\) possible moves.\n\n---\n# Tree perturbations 3: TBR\n<br>\n<br>\n*T*ree *B*isection and *R*econnection works by cutting the tree at any internal edge, then re-rooting each of the parts just formed, and reconnecting the roots:\n\n![Schematic of an unrooted phylogenetic tree. The tree has four connected internal nodes w,x,y,z and six tips A, B, C, D, E, F. A and B are connected to w; C is connected to x;  D is connected to y; E and F are connected to z. The edge connecting x and y is red.](images/05-mle-21-TBR-select-1.png)\n---\n# Tree perturbations 3: TBR\n<br>\n<br>\n![Schematic of two phylogenetic trees. In the tree on the left node w is connected to nodes A, B and C. In the tree on the right node z is connected to nodes D, E and F.  ](images/05-mle-22-TBR-trim-1.png)\n---\n# Tree perturbations 3: TBR\n<br>\n<br>\n<br>\n![Schematic of two phylogenetic trees. In the tree on the left node w is connected to nodes A, B and C. In the tree on the right node z is connected to nodes D, E and F. Black dots are shown on the edges connecting A-w and D-z.](images/05-mle-23-TBR-selectroots-1.png)\n\nSelecting edges as roots of the new subtrees\n---\n# Tree perturbations 3: TBR\n<br>\n<br>\n<br>\n![Schematic of two phylogenetic trees. In the tree on the left node w is connected to nodes A, B and C. In the tree on the right node z is connected to nodes D, E and F. Black dots are shown on the edges connecting A-w and D-z. A dashed line connects the trees through these dots.](images/05-mle-24-TBR-regraft-1.png)\n\nAnd reconnect!\n<br>\n<br>\n*Note*: There is no neat form for the number of neighbours of a given tree under the SPR moves, but it's more than TBR.\n\n---\n<br>\n<br>\n\n![Photograph of desert landscape with multiple hills. From https://en.wikipedia.org/wiki/File:Painted_Hills_2009.08.13.11.08.52.jpg](images/Painted_Hills_2009.08.13.11.08.52.jpg)\n\nPainted Hills near Mitchell, Oregon.\n\nThis file is licensed under the Creative Commons Attribution-Share Alike 3.0 Unported license.\n\n\n---\n# Hill Climbing\n<br>\n<br>\nTree Search algorithms work essentially by\n<br>\n<br>\n1. Starting with a reasonably good estimate, e.g., using Neighbour-Joining;\n\n2. Checking all the neighbouring trees under whichever perturbation is being used for an acceptable new tree;\n\n3. If an acceptable new tree is available, move to it!  If not, then stop.\n\t- Most simply, \"acceptable\" means \"better than this one\".\n<br>\n<br>\nThis kind of heuristic search is called *hill climbing*, from the obvious analogy.\n\n---\n<br>\n<br>\n\n![Two networks containing 15 phylogenetic trees are shown. Lines connect the trees in the networks forming a star shaped pattern. The network on the right is additionally annotated with lines that trace over selected connections between trees multiple times. Long description in video recording at 47:17 Image from: https://doi.org/10.1101/746362](images/CaoEtAl2019Fig3cropped.jpg)\n\nThis figure from Cao _et al._ (2019) illustrates moving around in tree space.\n\nSource: [https://doi.org/10.1101/746362](https://doi.org/10.1101/746362)\n\n---\n\n# _Anolis_ phylogeny example\n<br>\n<br>\n.pull-left[\n![Photograph of a green lizard](images/Anole.jpg)\n]\n.pull-right[ \n_Anolis_ is a highly speciose genus of lizards -- more than 425 species (unless as some would have it, many should be moved to another genus) -- native to the Americas.\n<br>\n<br>\n.reduce50[ Graphic: \"Picture of a lizard (Anolis carolinensis) I (DanielCD) took in Atascocita, Texas (USA) on 4/22/05. Atascocita is in southeast Texas just north of Houston.\"\n\nThis file is licensed under the Creative Commons Attribution-Share Alike 3.0 Unported license. ]\n]\n---\n\nlayout: true\n\n# `iqtree` output\n\n---\n\n.reduce70[\n```\nmac@mac-pc-443 ~/N/p/t/2/AusBioCommons-Phylogenetics> iqtree2 -s anolis-aligned.fasta\nIQ-TREE multicore version 2.1.3 COVID-edition for Linux 64-bit built Apr 21 2021\nDeveloped by Bui Quang Minh, James Barbetti, Nguyen Lam Tung,\nOlga Chernomor, Heiko Schmidt, Dominik Schrempf, Michael Woodhams.\n\nHost:    mac-pc-443 (AVX2, FMA3, 31 GB RAM)\nCommand: iqtree2 -s anolis-trimmed-aligned-clustal.fasta -redo\nSeed:    225340 (Using SPRNG - Scalable Parallel Random Number Generator)\nTime:    Thu Dec 21 13:26:51 2023\nKernel:  AVX+FMA - 1 threads (8 CPU cores detected)\n\nHINT: Use -nt option to specify number of threads because your CPU has 8 cores!\nHINT: -nt AUTO will automatically determine the best number of threads to use.\n\nReading alignment file anolis-trimmed-aligned-clustal.fasta ... Fasta format detected\nAlignment most likely contains DNA/RNA sequences\nAlignment has 55 sequences with 1462 columns, 1138 distinct patterns\n913 parsimony-informative, 172 singleton sites, 377 constant sites\n                            Gap/Ambiguity  Composition  p-value\n   1  Anolis.acutus                 3.56%    passed     50.37%\n   2  A.aeneus                      5.54%    failed      2.25%\n   3  A.agassizi                    3.01%    failed      1.82%\n   4  A.ahli                        3.15%    passed     81.11%\n   5  A.aliniger                    2.74%    passed     43.47%\n   6  A.alutaceous                  2.94%    passed      9.34%\n   7  A.angusticeps                 2.80%    passed     57.88%\n   8  A.bahorucoensis               2.53%    passed     21.76%\n   9  A.barahonae                   3.90%    failed      1.72%\n  10  A.bartschi                    3.76%    passed     30.22%\n  11  A.bimaculatus                 4.65%    passed     32.77%\n```\n]\n---\n\n\n.reduce70[\n```\nCreate initial parsimony tree by phylogenetic likelihood library (PLL)... 0.010 seconds\nPerform fast likelihood tree search using GTR+I+G model...\nEstimate model parameters (epsilon = 5.000)\nPerform nearest neighbor interchange...\nEstimate model parameters (epsilon = 1.000)\n1. Initial log-likelihood: -37100.382\n2. Current log-likelihood: -37098.639\nOptimal log-likelihood: -37097.515\nRate parameters:  A-C: 1.41395  A-G: 4.11730  A-T: 1.55773  C-G: 0.69506  C-T: 7.28507  G-T: 1.00000\nBase frequencies:  A: 0.339  C: 0.261  G: 0.118  T: 0.282\nProportion of invariable sites: 0.186\nGamma shape alpha: 0.832\nParameters optimization took 2 rounds (0.144 sec)\nTime for fast ML tree search: 0.993 seconds\n```\n]\n---\n\n\n.reduce70[\n```\nModelFinder will test up to 286 DNA models (sample size: 1462) ...\n No. Model         -LnL         df  AIC          AICc         BIC\n  1  GTR+F         41407.688    115 83045.375    83065.197    83653.445\n  2  GTR+F+I       39252.694    116 78737.387    78757.569    79350.744\n  3  GTR+F+G4      37164.452    116 74560.904    74581.085    75174.261\n  4  GTR+F+I+G4    37096.959    117 74427.917    74448.462    75046.562\n  5  GTR+F+R2      37597.901    117 75429.802    75450.347    76048.447\n  6  GTR+F+R3      37179.249    119 74596.499    74617.780    75225.718\n  7  GTR+F+R4      37074.898    121 74391.795    74413.828    75031.590\n  8  GTR+F+R5      37037.210    123 74320.421    74343.219    74970.791\n  9  GTR+F+R6      37031.233    125 74312.465    74336.043    74973.410\n 21  SYM+R5        37262.481    120 74764.963    74786.618    75399.470\n 22  SYM+R6        37261.627    122 74767.254    74789.668    75412.336\n 34  TVM+F+R5      37097.645    122 74439.290    74461.704    75084.373\n 35  TVM+F+R6      37095.642    124 74439.285    74462.471    75094.942\n 47  TVMe+R5       37745.606    119 75729.213    75750.494    76358.432\n 48  TVMe+R6       37742.081    121 75726.162    75748.195    76365.957\n 60  TIM3+F+R5     37076.842    121 74395.685    74417.718    75035.480\n 61  TIM3+F+R6     37070.459    123 74386.918    74409.717    75037.288\n 73  TIM3e+R5      37747.554    118 75731.107    75752.019    76355.039\n 74  TIM3e+R6      37740.393    120 75720.786    75742.442    76355.293\n 86  TIM2+F+R5     37042.461    121 74326.921    74348.954    74966.716\n 87  TIM2+F+R6     37036.463    123 74318.927    74341.725    74969.297\n 99  TIM2e+R5      37274.306    118 74784.612    74805.524    75408.544\n100  TIM2e+R6      37273.302    120 74786.604    74808.259    75421.111\n112  TIM+F+R5      37081.068    121 74404.136    74426.169    75043.931\n113  TIM+F+R6      37074.732    123 74395.464    74418.262    75045.834\n125  TIMe+R5       37757.456    118 75750.913    75771.824    76374.845\n126  TIMe+R6       37750.820    120 75741.641    75763.296    76376.148\n138  TPM3u+F+R5    37129.051    120 74498.103    74519.758    75132.610\n```\n]\n---\n\n.reduce70[\n```\nEstimate model parameters (epsilon = 0.100)\n1. Initial log-likelihood: -37042.461\nOptimal log-likelihood: -37042.422\nRate parameters:  A-C: 1.77793  A-G: 5.08796  A-T: 1.77793  C-G: 1.00000  C-T: 8.61510  G-T: 1.00000\nBase frequencies:  A: 0.339  C: 0.261  G: 0.118  T: 0.282\nSite proportion and rates:  (0.321,0.030) (0.225,0.316) (0.232,1.114) (0.196,2.482) (0.026,6.784)\nParameters optimization took 1 rounds (0.163 sec)\nComputing ML distances based on estimated model parameters...\nComputing ML distances took 0.054833 sec (of wall-clock time) 0.054830 sec(of CPU time)\nComputing RapidNJ tree took 0.000283 sec (of wall-clock time) 0.000282 sec (of CPU time)\nLog-likelihood of RapidNJ tree: -37150.315\n```\n]\n---\n\n.reduce70[\n```\n-------------------------------------------------------------------\n|             INITIALIZING CANDIDATE TREE SET                      |\n--------------------------------------------------------------------\nGenerating 98 parsimony trees... 0.879 second\nComputing log-likelihood of 98 initial trees ... 1.283 seconds\nCurrent best score: -37042.422\n\nDo NNI search on 20 best initial trees\nEstimate model parameters (epsilon = 0.100)\nBETTER TREE FOUND at iteration 1: -37042.003\nEstimate model parameters (epsilon = 0.100)\nBETTER TREE FOUND at iteration 2: -37036.294\nIteration 10 / LogL: -37042.212 / Time: 0h:0m:5s\nIteration 20 / LogL: -37058.987 / Time: 0h:0m:6s\nFinish initializing candidate tree set (10)\nCurrent best tree score: -37036.294 / CPU time: 6.458\nNumber of iterations: 20\n```\n]\n\n---\n\n.reduce70[\n```\n--------------------------------------------------------------------\n|               OPTIMIZING CANDIDATE TREE SET                      |\n--------------------------------------------------------------------\nEstimate model parameters (epsilon = 0.100)\nBETTER TREE FOUND at iteration 27: -37036.066\nIteration 30 / LogL: -37044.404 / Time: 0h:0m:9s (0h:0m:31s left)\nIteration 40 / LogL: -37036.365 / Time: 0h:0m:11s (0h:0m:26s left)\nIteration 50 / LogL: -37036.142 / Time: 0h:0m:14s (0h:0m:22s left)\nIteration 60 / LogL: -37038.691 / Time: 0h:0m:16s (0h:0m:19s left)\nIteration 70 / LogL: -37039.589 / Time: 0h:0m:19s (0h:0m:15s left)\nIteration 80 / LogL: -37049.077 / Time: 0h:0m:21s (0h:0m:12s left)\nIteration 90 / LogL: -37036.399 / Time: 0h:0m:23s (0h:0m:9s left)\nIteration 100 / LogL: -37036.108 / Time: 0h:0m:26s (0h:0m:7s left)\nIteration 110 / LogL: -37036.508 / Time: 0h:0m:28s (0h:0m:4s left)\nIteration 120 / LogL: -37036.242 / Time: 0h:0m:31s (0h:0m:1s left)\nTREE SEARCH COMPLETED AFTER 128 ITERATIONS / Time: 0h:0m:33s\n```\n]\n\n---\n\n.reduce70[\n```\n--------------------------------------------------------------------\n|                    FINALIZING TREE SEARCH                        |\n--------------------------------------------------------------------\nPerforms final model parameters optimization\nEstimate model parameters (epsilon = 0.010)\n1. Initial log-likelihood: -37036.066\nOptimal log-likelihood: -37036.065\nRate parameters:  A-C: 1.78140  A-G: 5.12638  A-T: 1.78140  C-G: 1.00000  C-T: 8.65177  G-T: 1.00000\nBase frequencies:  A: 0.339  C: 0.261  G: 0.118  T: 0.282\nSite proportion and rates:  (0.320,0.029) (0.222,0.311) (0.230,1.085) (0.200,2.454) (0.027,6.674)\nParameters optimization took 1 rounds (0.074 sec)\nBEST SCORE FOUND : -37036.065\nTotal tree length: 10.598\n\nTotal number of iterations: 128\nCPU time used for tree search: 32.804 sec (0h:0m:32s)\nWall-clock time used for tree search: 33.018 sec (0h:0m:33s)\nTotal CPU time used: 33.400 sec (0h:0m:33s)\nTotal wall-clock time used: 33.500 sec (0h:0m:33s)\n\nAnalysis results written to:\n  IQ-TREE report:                anolis-aligned.fasta.iqtree\n  Maximum-likelihood tree:       anolis-aligned.fasta.treefile\n  Likelihood distances:          anolis-aligned.fasta.mldist\n  Screen log file:               anolis-aligned.fasta.log\n\nDate and Time: Thu Dec 21 13:28:52 2023\n```\n]\n\n---\n\n.image-100[\n\n![Screenshot of a phylogenetic tree of Anolis species. The root of the tree is at the left of the image and is connected to Anolis species on the right by multiple branches.](images/AnolisIQTree.png)\n\n]\n\n\n---\nlayout: false\n\n# Beyond Maximum Likelihood Trees\n<br>\n<br>\n* Bayesian analyses with BEAST and MrBayes\n* Networks -- next video!\n\n---\nlayout: false\n\n# Thank you!\n\n.center[_Next - phylogenetic networks!_]\n\n"],"hands_on":false,"slides":true,"mod_date":"2024-04-17 06:30:20 +0000","pub_date":"2024-05-10 11:23:12 +0000","version":9,"api":"https://training.galaxyproject.org/training-material/api/topics/evolution/tutorials/abc_intro_phylo-mle-trees/tutorial.json","tools":[],"supported_servers":{"exact":[],"inexact":[{"name":"UseGalaxy.eu","url":"https://usegalaxy.eu","id":"eu","human":"Galaxy Europe","usegalaxy":true},{"name":"UseGalaxy.org","url":"https://usegalaxy.org","id":"us","human":"Galaxy Main","usegalaxy":true},{"name":"UseGalaxy.org.au","url":"https://usegalaxy.org.au","id":"au","human":"Galaxy Australia","usegalaxy":true},{"name":"UseGalaxy.fr","url":"https://usegalaxy.fr","id":"fr","human":"Galaxy France","usegalaxy":true}]},"topic_name_human":"Evolution","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools: []\n","tours":false,"video":false,"slides_recordings":false,"translations":{"tutorial":[],"slides":[],"video":false},"license":"CC-BY-4.0","type":"tutorial","redirect_from":["/short/evolution/abc_intro_phylo-mle-trees/slides","/short/S00117"]}