{"layout":"tutorial_hands_on","redirect_from":["/topics/galaxy-data-manipulation/tutorials/collections/tutorial","/short/galaxy-interface/collections","/short/T00146"],"title":"Using dataset collections","zenodo_link":"https://doi.org/10.5281/zenodo.5119008","tags":["collections"],"level":"Intermediate","questions":["How to manipulate large numbers of datasets at once?"],"objectives":["Understand and master dataset collections"],"time_estimation":"30m","key_points":["Multiple datasets can be combined in a collection.","This significantly simplifies the analysis.","This tutorial showed how to (1) create collection, (2) run tools on a collection, (3) combine collection elements into a final analysis results.","There is a variety of **Collection operation** tools allowing to perform a variety of transformations."],"contributors":[{"name":"Anton Nekrutenko","email":"anton@nekrut.org","joined":"2017-09","id":"nekrut","url":"https://training.galaxyproject.org/training-material/api/contributors/nekrut.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/nekrut/"}],"subtopic":"manage","js_requirements":{"mathjax":null,"mermaid":false},"short_id":"T00146","url":"/topics/galaxy-interface/tutorials/collections/tutorial.html","topic_name":"galaxy-interface","tutorial_name":"collections","dir":"topics/galaxy-interface/tutorials/collections","symlink":null,"id":"galaxy-interface/collections","ref_tutorials":["<!--SNIPPET-->\n<blockquote class=\"warning\">   <div class=\"box-title warning-title\" id=\"warning-compatible-versions-of-galaxy\"><i class=\"fas fa-exclamation-triangle\" aria-hidden=\"true\"></i> Warning: Compatible Versions of Galaxy</div>   <p>This tutorial has been tested to work with 22.01</p>   <ul>   <li>Galaxy’s Interface <strong>may</strong> be different to the Galaxy where you are following this tutorial.</li>   <li>✅ All tutorial steps will still be able to be followed (potentially with minor differences for moved buttons or changed icons.)</li>   <li>✅ Tools will all still work</li> </ul> </blockquote>\n<p><!--END_SNIPPET--></p>\n\n<p>Here we will show Galaxy features designed to help with the analysis of large numbers of samples. When you have just a few samples - clicking through them is easy. But once you’ve got hundreds - it becomes very annoying. In Galaxy we have introduced <strong>Dataset collections</strong> that allow you to combine numerous datasets in a single entity that can be easily manipulated.</p>\n\n<h1 id=\"getting-data\">Getting data</h1>\n\n<p>First, we need to upload datasets. Cut and paste the following URLs to Galaxy upload tool (see a <i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tip</span> <strong>Tip</strong> on how to do this <a href=\"#tip-upload-fastqsanger-datasets-via-links\">below</a>).</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>https://zenodo.org/record/5119008/files/M117-bl_1.fq.gz\nhttps://zenodo.org/record/5119008/files/M117-bl_2.fq.gz\nhttps://zenodo.org/record/5119008/files/M117-ch_1.fq.gz\nhttps://zenodo.org/record/5119008/files/M117-ch_2.fq.gz\nhttps://zenodo.org/record/5119008/files/M117C1-bl_1.fq.gz\nhttps://zenodo.org/record/5119008/files/M117C1-bl_2.fq.gz\nhttps://zenodo.org/record/5119008/files/M117C1-ch_1.fq.gz\nhttps://zenodo.org/record/5119008/files/M117C1-ch_2.fq.gz\n</code></pre></div></div>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Set format to `fastqsanger.gz`</hands-on-title>\n  <p>The above datasets are in <code class=\"language-plaintext highlighter-rouge\">fastqsanger.gz</code> format. It is necessary to explicitly set format in Galaxy. The <i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tip</span> <strong>Tip</strong> section below explains how to upload these data and set the correct format. There is a variety of <a href=\"https://en.wikipedia.org/wiki/FASTQ_format\">fastq format flavors</a> and it is difficult to guess them automatically.</p>\n\n  <!--SNIPPET-->\n  <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-importing-via-links\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-importing-via-links\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Importing via links</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Copy the link location</li>   <li>     <p>Click <i class=\"fas fa-upload\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-upload</span> <strong>Upload Data</strong> at the top of the tool panel</p>   </li>   <li>Select <i class=\"fa fa-edit\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-wf-edit</span> <strong>Paste/Fetch Data</strong></li>   <li>     <p>Paste the link(s) into the text field</p>   </li>   <li>     <p>Change <strong>Type (set all):</strong> from “Auto-detect” to <code class=\"language-plaintext highlighter-rouge\">fastqsanger.gz</code></p>   </li>   <li>     <p>Press <strong>Start</strong></p>   </li>   <li><strong>Close</strong> the window</li> </ul> </blockquote>\n  <p><!--END_SNIPPET--></p>\n\n  <!--SNIPPET-->\n  <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-upload-fastqsanger-datasets-via-links\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-upload-fastqsanger-datasets-via-links\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Upload fastqsanger datasets via links</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p>Uploading <code class=\"language-plaintext highlighter-rouge\">fastqsanger</code> or <code class=\"language-plaintext highlighter-rouge\">fastqsanger.gz</code> datasets via URL.</p>   <ol>   <li>     <p>Click on <strong>Upload Data</strong> on the top of the left panel:</p>     <p><img src=\"/training-material/faqs/galaxy/images/upload_data_button.png\" alt=\"UploadDataButton\" /></p>   </li>   <li>     <p>Click on <strong>Paste/Fetch</strong>:</p>     <p><img src=\"/training-material/faqs/galaxy/images/paste_fetch_data_button.png\" alt=\"PasteFetchButton\" /></p>   </li>   <li>     <p>Paste URL into text box that would appear:</p>     <p><img src=\"/training-material/faqs/galaxy/images/paste_fetch_data_modal.png\" alt=\"PasteFetchModal\" /></p>   </li>   <li>     <p>Set <strong>Type (set all)</strong> to <code class=\"language-plaintext highlighter-rouge\">fastqsanger</code> or, if your data is compressed as in URLs above (they have <code class=\"language-plaintext highlighter-rouge\">.gz</code> extensions), to <code class=\"language-plaintext highlighter-rouge\">fastqsanger.gz</code></p>     <p><img src=\"/training-material/faqs/galaxy/images/paste_fetch_set_data_type.png\" alt=\"ChangeTypeDropDown\" />:</p>   </li> </ol>   <blockquote class=\"warning\">   <warning-title>Danger: Make sure you choose corect format!</warning-title>   <p>When selecting datatype in “<strong>Type (set all)</strong>” dropdown, make sure you select <code class=\"language-plaintext highlighter-rouge\">fastaqsanger</code> or <code class=\"language-plaintext highlighter-rouge\">fastqsanger.gz</code> BUT NOT <code class=\"language-plaintext highlighter-rouge\">fastqcssanger</code> or anything else!</p> </blockquote>   <p><img src=\"/training-material/faqs/galaxy/images/upload_fastqsanger_via_url.png\" alt=\"UploadAnimatedPng\" /></p> </blockquote>\n  <p><!--END_SNIPPET--></p>\n\n</blockquote>\n\n<h2 id=\"about-these-datasets\">About these datasets</h2>\n\n<p>These datasets represent genomic DNA (enriched for mitochondria via a long range PCR) isolated from blood (<code class=\"language-plaintext highlighter-rouge\">bl</code>) and cheek (buccal swab, <code class=\"language-plaintext highlighter-rouge\">ch</code>) of mother (<code class=\"language-plaintext highlighter-rouge\">M117</code>) and her child (<code class=\"language-plaintext highlighter-rouge\">M117C1</code>) that was sequenced on an Illumina miSeq machine as paired-read library (250-bp reads; see our <a href=\"http://www.pnas.org/content/111/43/15474.abstract\">2014</a> manuscript for <strong>Methods</strong>):</p>\n\n<ul>\n  <li><code class=\"language-plaintext highlighter-rouge\">M117-bl_1</code> - family 117, mother, <em>forward</em> (<strong>F</strong>) reads from <strong>blood</strong></li>\n  <li><code class=\"language-plaintext highlighter-rouge\">M117-bl_2</code> - family 117, mother, <em>reverse</em> (<strong>R</strong>) reads from <strong>blood</strong></li>\n  <li><code class=\"language-plaintext highlighter-rouge\">M117-ch_1</code> - family 117, mother, <em>forward</em> (<strong>F</strong>) reads from <strong>cheek</strong></li>\n  <li><code class=\"language-plaintext highlighter-rouge\">M117-ch_2</code> - family 117, mother, <em>reverse</em> (<strong>R</strong>) reads from <strong>cheek</strong></li>\n  <li><code class=\"language-plaintext highlighter-rouge\">M117C1-bl_1</code>- family 117, child, <em>forward</em> (<strong>F</strong>) reads from <strong>blood</strong></li>\n  <li><code class=\"language-plaintext highlighter-rouge\">M117C1-bl_2</code>- family 117, child, <em>reverse</em> (<strong>R</strong>) reads from <strong>blood</strong></li>\n  <li><code class=\"language-plaintext highlighter-rouge\">M117C1-ch_1</code>- family 117, child, <em>forward</em> (<strong>F</strong>) reads from <strong>cheek</strong></li>\n  <li><code class=\"language-plaintext highlighter-rouge\">M117C1-ch_2</code>- family 117, child, <em>reverse</em> (<strong>R</strong>) reads from <strong>cheek</strong></li>\n</ul>\n\n<h1 id=\"creating-a-paired-dataset-collection\">Creating a paired dataset collection</h1>\n\n<p>You can see that there are eight datasets forming four pairs. Obviously, we can manipulate them one-by-one (e.g., start four mapping jobs, call variants four times and so on), but this will unnecessarily tedious. Moreover, imagine if you have 100s or 1,000s of pairs: it will be impossible to process them individually.</p>\n\n<p>This is exactly why we developed collections. Dataset collections allow combining multiple datasets into a single entity. Thus instead of dealing with four, a hundred, or a thousand of individual datasets you have only one item in Galaxy history to deal with.</p>\n\n<p>Because our data is <em>paired</em> we need to create a hierarchical collection called <strong>Paired Dataset Collection</strong> or <strong>Paired Collection</strong>. In such collection there are two layers. The first layer corresponds to individual samples (e.g., <code class=\"language-plaintext highlighter-rouge\">M117-bl</code>). The second layer represent <code class=\"language-plaintext highlighter-rouge\">forward</code> and <code class=\"language-plaintext highlighter-rouge\">reverse</code> reads corresponding to each sample:</p>\n\n<figure id=\"figure-1\" style=\"max-width: 90%;\"><div style=\"overflow-x: auto\"><object data=\"../../images/collections/paired_collection.svg\" type=\"image/svg+xml\" alt=\"paired collection. \">paired collection.</object></div><a target=\"_blank\" href=\"../../images/collections/paired_collection.svg\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 1</strong>:</span> The logic of Paired Collection. Here <em>N</em> datasets are bundled into a paired collection with two layers. The first layer corresponds to samples and the second to forward and reverse reads within each sample.</figcaption></figure>\n\n<p>To begin creating a collection we need to select datasets we would like to bundle. This is done using checkbox button of Galaxy’s history menu. Fig. 2 below shows this process.</p>\n\n<figure id=\"figure-2\" style=\"max-width: 90%;\"><img src=\"../../images/collections/select_multiple_datasets.gif\" alt=\"selecting multiple datasets. \" width=\"2560\" height=\"1328\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/collections/select_multiple_datasets.gif\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 2</strong>:</span> Selecting multiple datasets and creating a paired collection.</figcaption></figure>\n\n<p>The above process ended with appearance of Galaxy collection wizard. In this case Galaxy automatically assigned pairs using the <code class=\"language-plaintext highlighter-rouge\">_1</code> and <code class=\"language-plaintext highlighter-rouge\">_2</code> endings of dataset names. Let’s however pretend that this did not happen. Click on <strong>Unpair all</strong> (highlighted in red in the figure above) link and then on <strong>Filters</strong> link (see animation in Fig. 3). The interface will change into its unpaired state.</p>\n\n<p>Here datasets containing the first (forward) and the second (reverse) read are differentiated by having <code class=\"language-plaintext highlighter-rouge\">_1</code> and <code class=\"language-plaintext highlighter-rouge\">_2</code> in the filename. We can use this feature in dataset collection wizard to pair our datasets.  Type <code class=\"language-plaintext highlighter-rouge\">_1</code> in the left <strong>Filter text</strong> text box and <code class=\"language-plaintext highlighter-rouge\">_2</code> in the right. You will see that the dataset collection wizard will automatically filter lists on each side of the interface. Now you can either click <strong>Auto pair</strong> if pairs look good to you (proper combinations of datasets are listed in each line) or pair each forward/reverse group individually by pressing <strong>Pair these datasets</strong> button separating each pair.</p>\n\n<p>Now it is time to name the collection: type <code class=\"language-plaintext highlighter-rouge\">M117-collection</code> in <strong>Name</strong> text box and create the collection by clicking <strong>Create collection</strong>. A new item will appear in the history.</p>\n\n<figure id=\"figure-3\" style=\"max-width: 90%;\"><img src=\"../../images/collections/using_collection_wizard.gif\" alt=\"using collection wizard. \" width=\"1440\" height=\"900\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/collections/using_collection_wizard.gif\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 3</strong>:</span> Working with collection wizard. Text above this figure explains each step.</figcaption></figure>\n\n<p>Clicking on collection will expand it to show four pairs it contains (panel <strong>B</strong>). Clicking individual pairs will expand them further to reveal <strong>forward</strong> and <strong>reverse</strong> datasets (panel <strong>C</strong>). Expanding these further will enable one to see individual datasets (panel <strong>D</strong>).</p>\n\n<figure id=\"figure-4\" style=\"max-width: 90%;\"><img src=\"../../images/collections/expanding_collection.gif\" alt=\"expanding collection. \" width=\"1440\" height=\"900\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/collections/expanding_collection.gif\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 4</strong>:</span> To look what is inside a collection, just click on it.</figcaption></figure>\n\n<h1 id=\"processing-data-organized-as-a-collection\">Processing data organized as a collection</h1>\n\n<p>By now we see that a collection can be used to bundle a large number of items into a single history item. Galaxy tools take collection as input. Let’s map reads contained in collection <code class=\"language-plaintext highlighter-rouge\">M117-collection</code> against human mitochondrial genome. Before we can do this we need to upload mitochondrial genome using the following URL (see a <i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tip</span> <strong>Tip</strong> on how to do this <a href=\"#tip-importing-via-links\">below</a>):</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>https://zenodo.org/record/5119008/files/chrM.fa.gz\n</code></pre></div></div>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Set format to `fasta.gz`</hands-on-title>\n  <p>The above dataset is in <code class=\"language-plaintext highlighter-rouge\">fasta.gz</code> format. The <i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tip</span> <strong>Tip</strong> section below explains how to upload these data and set the correct format.</p>\n\n  <!--SNIPPET-->\n  <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-importing-via-links-1\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-importing-via-links-1\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Importing via links</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Copy the link location</li>   <li>     <p>Click <i class=\"fas fa-upload\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-upload</span> <strong>Upload Data</strong> at the top of the tool panel</p>   </li>   <li>     <p>Click <strong>Reset</strong> button at the bottom of the form. If the button is greyed out -&gt; skip to the next step.</p>   </li>   <li>Select <i class=\"fa fa-edit\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-wf-edit</span> <strong>Paste/Fetch Data</strong></li>   <li>     <p>Paste the link(s) into the text field</p>     <p><code class=\"language-plaintext highlighter-rouge\">https://zenodo.org/record/5119008/files/chrM.fa.gz</code></p>   </li>   <li>     <p>Change <strong>Type (set all):</strong> from “Auto-detect” to <code class=\"language-plaintext highlighter-rouge\">fasta.gz</code></p>   </li>   <li>     <p>Press <strong>Start</strong></p>   </li>   <li><strong>Close</strong> the window</li> </ul> </blockquote>\n  <p><!--END_SNIPPET--></p>\n</blockquote>\n\n<h2 id=\"mapping-reads\">Mapping reads</h2>\n\n<p><strong>BWA-MEM</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> is a widely used sequence aligner for short-read sequencing datasets such as those we are analysing in this tutorial. (You can find the tool by typing <code class=\"language-plaintext highlighter-rouge\">BWA MEM</code> in the search box at the top left corner of Galaxy interface).</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Map sequencing reads to reference genome</hands-on-title>\n\n  <p>Run <span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/devteam/bwa/bwa_mem/0.7.17.1\" title=\"Map with BWA-MEM tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Map with BWA-MEM</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.7.17.1)</span> with the following parameters:</p>\n  <ul>\n    <li><em>“Will you select a reference genome from your history or use a built-in index?”</em>: <code class=\"language-plaintext highlighter-rouge\">Use a genome from history and build index</code>\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Use the following dataset as the reference sequence”</em>: <code class=\"language-plaintext highlighter-rouge\">chrM.fa.gz</code> (The mitochondrial genome we just uploaded)</li>\n      </ul>\n    </li>\n    <li><em>“Single or Paired-end reads”</em>: <code class=\"language-plaintext highlighter-rouge\">Paired Collection</code>\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select a paired collection”</em>: <code class=\"language-plaintext highlighter-rouge\">M117-collection</code> (the collection we built at the beginning of this tutorial.)</li>\n      </ul>\n    </li>\n    <li><em>“Set read groups information?”</em>: <code class=\"language-plaintext highlighter-rouge\">Do not set</code></li>\n    <li><em>“Select analysis mode”</em>: <code class=\"language-plaintext highlighter-rouge\">1.Simple Illumina mode</code></li>\n  </ul>\n\n  <p>The interface should look like this:</p>\n\n  <figure id=\"figure-5\" style=\"max-width: 90%;\"><img src=\"../../images/collections/bwa_mem_interface_coll_tut.png\" alt=\"bwa_mem_interface. \" width=\"832\" height=\"940\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/collections/bwa_mem_interface_coll_tut.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 5</strong>:</span> Tool interface</figcaption></figure>\n\n  <ul>\n    <li>Click <strong>Run Tool</strong> button</li>\n  </ul>\n\n</blockquote>\n\n<p>You will see jobs being submitted and new datasets appearing in the history. Because our collection contains four paired datasets Galaxy will actually generate four separate <code class=\"language-plaintext highlighter-rouge\">BWA-MEM</code> jobs. In the end this <code class=\"language-plaintext highlighter-rouge\">BWA-MEM</code> run will produce a new collection containing four (4) BAM datasets. Let’s look at this collection by clicking on it (panel <strong>A</strong> in the figure below). You can see that now this collection is no longer paired (compared to the collection we created in the beginning of this tutorial). This is because <code class=\"language-plaintext highlighter-rouge\">BWA-MEM</code> takes forward and reverse data as input, but produces only a single BAM dataset as the output. So what we have in the result is a <em>list</em> of four dataset (BAM files; panel <strong>B</strong>). If you click on any of the datasets you will see that it is indeed a BAM dataset (panel <strong>C</strong>).</p>\n\n<p><a href=\"../../images/collections/collection_expansion.svg\" rel=\"noopener noreferrer\"><img src=\"../../images/collections/collection_expansion.svg\" alt=\"bwa_memCollection_ABC. \" width=\"900\" height=\"390\" loading=\"lazy\" /></a></p>\n\n<h2 id=\"calling-variants\">Calling variants</h2>\n\n<p>After we mapped reads against the mitochondrial genome, we can now call variants. In this step a variant calling tool <code class=\"language-plaintext highlighter-rouge\">lofreq</code> will take a collection of BAM datasets (the one produced by <code class=\"language-plaintext highlighter-rouge\">BWA-MEM</code>), identify differences between reads and the reference, and output these differences as a collection of <a href=\"https://en.wikipedia.org/wiki/Variant_Call_Format\">VCF</a> datasets.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Call variants  </hands-on-title>\n\n  <p>Run <span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/lofreq_call/lofreq_call/2.1.5+galaxy1\" title=\"Call variants tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Call variants</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 2.1.5+galaxy1)</span> with the following parameters:</p>\n  <ul>\n    <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Input reads in BAM format”</em>: <code class=\"language-plaintext highlighter-rouge\">Map with BWA-MEM...</code> (output of <strong>BWA-MEM</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n    <li><em>“Choose the source for the reference genome”</em>: <code class=\"language-plaintext highlighter-rouge\">History</code>\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Reference”</em>: <code class=\"language-plaintext highlighter-rouge\">chrM.fa.gz (as fasta)</code> (Input dataset)</li>\n      </ul>\n    </li>\n    <li><em>“Call variants across”</em>: <code class=\"language-plaintext highlighter-rouge\">Whole reference</code></li>\n    <li><em>“Types of variants to call”</em>: <code class=\"language-plaintext highlighter-rouge\">SNVs and indels</code></li>\n  </ul>\n\n  <p>The interface should look like this:</p>\n\n  <hr />\n\n  <p><a href=\"../../images/collections/lofreq_interface.png\" rel=\"noopener noreferrer\"><img src=\"../../images/collections/lofreq_interface.png\" alt=\"lofreq_interface. \" width=\"848\" height=\"1002\" loading=\"lazy\" /></a></p>\n\n  <hr />\n\n  <ul>\n    <li>Click <strong>Run Tool</strong> button</li>\n  </ul>\n\n</blockquote>\n\n<h2 id=\"create-table-of-variants-using-snpsift-extract-fields\">Create table of variants using <strong>SnpSift Extract Fields</strong></h2>\n\n<p>We will now convert VCF datasets into tab delimited format as it will be easier to work with. This will be done with <code class=\"language-plaintext highlighter-rouge\">SNPSift</code>: a tool specifically designed for manipulation of tab-delimited data.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Create table of variants</hands-on-title>\n\n  <p>Run <span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/snpsift/snpSift_extractFields/4.3+t.galaxy0\" title=\"SnpSift Extract Fields tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>SnpSift Extract Fields</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 4.3+t.galaxy0)</span> with the following parameters:</p>\n  <ul>\n    <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Variant input file in VCF format”</em>: <code class=\"language-plaintext highlighter-rouge\">Call variants on collection...</code> (output of <strong>Call variants with lofreq</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n    <li><em>“Fields to extract”</em>: <code class=\"language-plaintext highlighter-rouge\">CHROM POS REF ALT QUAL DP AF SB DP4</code></li>\n    <li><em>“One effect per line”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n  </ul>\n\n  <p>The interface should look like this:</p>\n\n  <hr />\n\n  <p><a href=\"../../images/collections/snpsift_interface.png\" rel=\"noopener noreferrer\"><img src=\"../../images/collections/snpsift_interface.png\" alt=\"snpsift_interface. \" width=\"1354\" height=\"846\" loading=\"lazy\" /></a></p>\n\n  <hr />\n\n  <ul>\n    <li>Click <strong>Run Tool</strong> button</li>\n  </ul>\n\n</blockquote>\n\n<p>As a result of this operation we now have a collection of four tab delimited files. Yet, ultimately we want to summaize these data as one final table. The next step does just that.</p>\n\n<h2 id=\"collapse-data-into-a-single-dataset\">Collapse data into a single dataset</h2>\n\n<p>We now extracted meaningful fields from VCF datasets. But they still exist as a collection. To move towards secondary analysis we need to <strong>collapse</strong> this collection into a single dataset. For more information about collapsing collections see this video:</p>\n\n<figure>\n<iframe credentialless=\"\" allowfullscreen=\"\" referrerpolicy=\"no-referrer\" sandbox=\"allow-scripts allow-same-origin\" allow=\"accelerometer 'none'; ambient-light-sensor 'none'; autoplay 'none'; battery 'none'; bluetooth 'none'; browsing-topics 'none'; camera 'none'; ch-ua 'none'; display-capture 'none'; domain-agent 'none'; document-domain 'none'; encrypted-media 'none'; execution-while-not-rendered 'none'; execution-while-out-of-viewport 'none'; gamepad 'none'; geolocation 'none'; gyroscope 'none'; hid 'none'; identity-credentials-get 'none'; idle-detection 'none'; keyboard-map 'none'; local-fonts 'none'; magnetometer 'none'; microphone 'none'; midi 'none'; navigation-override 'none'; otp-credentials 'none'; payment 'none'; picture-in-picture 'none'; publickey-credentials-create 'none'; publickey-credentials-get 'none'; screen-wake-lock 'none'; serial 'none'; speaker-selection 'none'; sync-xhr 'none'; usb 'none'; web-share 'none'; window-management 'none'; xr-spatial-tracking 'none'\" csp=\"sandbox allow-scripts allow-same-origin;\" width=\"560\" height=\"315\" src=\"https://www.youtube-nocookie.com/embed/ypuFZ1RKMIY\" title=\"Collapsing collections\" frameborder=\"0\" loading=\"lazy\"></iframe>\n<figcaption>\n  <span class=\"figcaption-prefix\"><strong>Video</strong>:</span> Collapsing collections</figcaption>\n</figure>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Collapse a collection</hands-on-title>\n\n  <p>Run <span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/nml/collapse_collections/collapse_dataset/4.0\" title=\"Collapse Collection tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Collapse Collection</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 4.0)</span> with the following parameters:</p>\n  <ul>\n    <li><i class=\"far fa-folder\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-collection</span> <em>“Collection of files to collapse into single dataset”</em>: <code class=\"language-plaintext highlighter-rouge\">SnpSift Extract Fields ...</code> (output of <strong>SnpSift Extract Fields</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n    <li>“<em>Keep one header line</em>”: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n    <li>“<em>Prepend File name</em>”: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n    <li>“<em>Where to add dataset name</em>”: <code class=\"language-plaintext highlighter-rouge\">Same line and each line in dataset</code></li>\n  </ul>\n\n  <p>The interface should look like this:</p>\n\n  <hr />\n\n  <p><a href=\"../../images/collections/collapse_collection.png\" rel=\"noopener noreferrer\"><img src=\"../../images/collections/collapse_collection.png\" alt=\"snpsift_interface. \" width=\"854\" height=\"527\" loading=\"lazy\" /></a></p>\n\n  <hr />\n\n  <ul>\n    <li>Click <strong>Run Tool</strong> button</li>\n  </ul>\n\n</blockquote>\n\n<p>You can see that this tool takes lines from all collection elements (in our case we have two), add element name as the first column, and pastes everything together. So if we have a collection as an input:</p>\n\n<blockquote class=\"code-in\">\n  <code-in-title>A collection with two items</code-in-title>\n  <p>A collection element named <code class=\"language-plaintext highlighter-rouge\">M117-bl.fq</code></p>\n\n  <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>chrM   152 T C  3707.0 1242 0.99 0 2,2,540,697\nchrM 16519 T C 35149.0 1033 0.99 0 1,1,611,420\n</code></pre></div>  </div>\n\n  <p>A collection element named <code class=\"language-plaintext highlighter-rouge\">M117-ch.fq</code>:</p>\n\n  <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>chrM   152 T C  4098.0 1440 0.99 0 0,1,575,863\nchrM 16519 T C 36574.0 1039 0.99 2 3,0,713,321\n</code></pre></div>  </div>\n\n  <p>A collection element named <code class=\"language-plaintext highlighter-rouge\">M117C1-bl.fq</code>:</p>\n\n  <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>chrM   152 T C  4888.0 1235 1.00 0 0,0,548,687\nchrM 16519 T C 35220.0 1042 0.99 0 0,0,598,443\n</code></pre></div>  </div>\n\n  <p>A collection element named <code class=\"language-plaintext highlighter-rouge\">M117C1-ch.fq</code>:</p>\n\n  <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>chrM   152 T C  2757.0 1413 0.99 0 2,2,576,833\nchrM 16455 G A    54.0  100 0.04 0 89,7,4,0\nchrM 16519 T C 36363.0 1061 0.99 6 3,4,691,362\n</code></pre></div>  </div>\n\n</blockquote>\n\n<p>We will have a single dataset as the output:</p>\n\n<blockquote class=\"code-out\">\n  <code-out-title>A single dataset</code-out-title>\n\n  <p>then the <strong>Collapse Collection</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> will produce this:</p>\n\n  <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>M117-bl.fq   chrM   152 T C  3707.0 1242 0.99 0 2,2,540,697\nM117-bl.fq   chrM 16519 T C 35149.0 1033 0.99 0 1,1,611,420\nM117-ch.fq   chrM   152 T C  4098.0 1440 0.99 0 0,1,575,863\nM117-ch.fq   chrM 16519 T C 36574.0 1039 0.99 2 3,0,713,321\nM117C1-bl.fq chrM   152 T C  4888.0 1235 1.00 0 0,0,548,687\nM117C1-bl.fq chrM 16519 T C 35220.0 1042 0.99 0 0,0,598,443\nM117C1-ch.fq chrM   152 T C  2757.0 1413 0.99 0 2,2,576,833\nM117C1-ch.fq chrM 16455 G A    54.0  100 0.04 0 89,7,4,0\nM117C1-ch.fq chrM 16519 T C 36363.0 1061 0.99 6 3,4,691,362\n</code></pre></div>  </div>\n</blockquote>\n\n<p>you can see that added a column with dataset ID taken from collection element name.</p>\n\n<h2 id=\"we-did-not-fake-this\">We did not fake this:</h2>\n<p>The history described in this page is accessible directly from here:</p>\n\n<ul>\n  <li>History <a href=\"https://usegalaxy.org/u/cartman/h/collection-tutorial\"><strong>Collections (full analysis)</strong></a></li>\n</ul>\n\n<p>From there you can import histories to make them your own.</p>\n\n<h1 id=\"collection-operations\">Collection operations</h1>\n\n<p>In this brief analysis we took four paired datasets, created a collection, analyzed this collection and finally created a single report. Such “lifecycle” is shown in the figure below. Here we started with eight fastq datasets representing four paired end samples. A paired collection was reduced to a list of BAM datasets by <code class=\"language-plaintext highlighter-rouge\">BWA-MEM</code>. Varinat calling by <code class=\"language-plaintext highlighter-rouge\">lofreq</code> and field extraction with <code class=\"language-plaintext highlighter-rouge\">SnpEff</code> maintained collection structure: these tools processed four individual datasets changing their formats from BAM to VCF, and from VCF to Tab-delimited. Finally, we collapsed collection by merging its content into a single dataset.</p>\n\n<figure id=\"figure-6\" style=\"max-width: 90%;\"><div style=\"overflow-x: auto\"><object data=\"../../images/collections/collection_lifecycle.svg\" type=\"image/svg+xml\" alt=\"Collection lifecycle. \">Collection lifecycle.</object></div><a target=\"_blank\" href=\"../../images/collections/collection_lifecycle.svg\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 6</strong>:</span> Collection lifecycle. Arrows = individual fastq datasets; Four shades of yellow = four samples analyzed in this example.</figcaption></figure>\n\n<p>The last step of our analysis, collapsing a collection, is an example of a <em>collection operation</em>. Galaxy contains an entire section of tools designed for handling of collection data. These can be classified as:</p>\n\n<ul>\n  <li>Tools that manipulate elements within a collection</li>\n  <li>Tools that change collection structure</li>\n  <li>Tools that combine elements of a collection</li>\n</ul>\n\n<p>Let’s look at these categories in more detail:</p>\n\n<h2 id=\"tools-that-manipulate-elements-within-a-collection\">Tools that manipulate elements within a collection</h2>\n\n<h3 id=\"extract-dataset\">Extract dataset</h3>\n\n<p><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> <strong>Extract dataset</strong> extracts datasets from a collection based on either position or identifier.</p>\n\n<p>The tool allow extracting datasets based on position (<strong>The first dataset</strong> and <strong>Select by index</strong> options) or name (<strong>Select belement identifier</strong> option). This tool effectively collapses the inner-most collection into a dataset. For nested collections (e.g a list of lists of lists: outer:middle:inner, extracting the inner dataset element) a new list is created where the selected element takes the position of the inner-most collection (so outer:middle, where middle is not a collection but the inner dataset element).</p>\n\n<h3 id=\"filter-empty\">Filter empty</h3>\n\n<p><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> <strong>Filter empty</strong> removes empty elements from a collection.</p>\n\n<p>This tool takes a dataset collection and filters out (removes) empty datasets. This is useful for continuing a multi-sample analysis when downstream tools require datasets to have content.</p>\n\n<p><a href=\"../../images/collections/filter_empty.svg\" rel=\"noopener noreferrer\"><img src=\"../../images/collections/filter_empty.svg\" alt=\"Filtering empty datasets. \" width=\"530\" height=\"210\" loading=\"lazy\" /></a></p>\n\n<h3 id=\"filter-failed-datasets\">Filter failed datasets</h3>\n\n<p><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> <strong>Filter failed datasets</strong> removes datasets in error (red) from a collection.</p>\n\n<p>This tool takes a dataset collection and filters out (removes) datasets in the failed (red) state. This is useful for continuing a multi-sample analysis when one or more of the samples fails at some point.</p>\n\n<p><a href=\"../../images/collections/filter_error.svg\" rel=\"noopener noreferrer\"><img src=\"../../images/collections/filter_error.svg\" alt=\"filter_failed. \" width=\"530\" height=\"210\" loading=\"lazy\" /></a></p>\n\n<h3 id=\"build-list\">Build list</h3>\n\n<p><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> <strong>Build list</strong> creates a new list collection from individual datasets or collections.</p>\n\n<p>This tool combines individual datasets or collections into a new collection. The simplest scenario is building a new colection from individual datasets (case <strong>A</strong> in the image below). You can merge a collection with individual dataset(s). In this case (see <strong>B</strong> in the image below) the individual dataset(s) will be merged with each element of the input collection to create a nested collection. Finally, two or more collection can be merged together creating a nested collection (case <strong>C</strong> in the image below).</p>\n\n<p><a href=\"../../images/collections/build_list.svg\" rel=\"noopener noreferrer\"><img src=\"../../images/collections/build_list.svg\" alt=\"Build list. \" width=\"820\" height=\"530\" loading=\"lazy\" /></a></p>\n\n<h3 id=\"filter-collection\">Filter collection</h3>\n\n<p><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> <strong>Filter collection</strong> removes elements from a collection using a list supplied in a file.</p>\n\n<p>This tools allow filtering elements from a data collection.  It takes an input collection and a text file with names (i.e. identifiers). The tool behaviour is controlled by <strong>How should the elements to remove be determined?</strong> drop-down. It has the following options:</p>\n\n<h4 id=\"remove-if-identifiers-are-absent-from-file\">Remove if identifiers are ABSENT from file</h4>\n\n<p>Given a collection:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> Collection: [Dataset A]\n             [Dataset B]\n             [Dataset X]\n</code></pre></div></div>\n\n<p>and a text file:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>             A\n             B\n             Z\n</code></pre></div></div>\n\n<p>the tool will return two collections:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>\n (filtered):  [Dataset A]\n              [Dataset B]\n\n (discarded): [Dataset X]\n</code></pre></div></div>\n\n<h4 id=\"remove-if-identifiers-are-present-in-file\">Remove if identifiers are PRESENT in file</h4>\n\n<p>Given a collection:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> Collection: [Dataset A]\n             [Dataset B]\n             [Dataset X]\n</code></pre></div></div>\n<p>and a text file:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>             A\n             B\n             Z\n</code></pre></div></div>\n\n<p>the tool will return two collections:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> (filtered):  [Dataset X]\n\n (discarded): [Dataset A]\n              [Dataset B]\n\n</code></pre></div></div>\n\n<h3 id=\"relabel-identifiers\">Relabel identifiers</h3>\n\n<p><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>  <strong>Relabel identifiers</strong> changes identifiers of datasets within a collection using identifiers from a supplied file.</p>\n\n<p>New identifiers can be supplied as either a simple list or a tab-delimited file mapping old identifier to the new ones. This is controlled using <strong>How should the new identifiers be specified?</strong> drop-down:</p>\n\n<h4 id=\"using-lines-in-a-simple-text-file\">Using lines in a simple text file</h4>\n\n<p>Given a collection:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> Collection: [Dataset A]\n             [Dataset B]\n             [Dataset X]\n</code></pre></div></div>\n\n<p>and a simple text file:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>             Alpha\n             Beta\n             Gamma\n</code></pre></div></div>\n\n<p>the tool will return:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> Collection: [Dataset Alpha]\n             [Dataset Beta]\n             [Dataset Gamma]\n</code></pre></div></div>\n\n<h4 id=\"map-original-identifiers-to-new-ones-using-a-two-column-table\">Map original identifiers to new ones using a two column table</h4>\n\n<p>Given a collection:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> Collection: [Dataset A]\n             [Dataset B]\n             [Dataset X]\n</code></pre></div></div>\n\n<p>and a simple text file (you can see that entries do not have to be in order here):</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>             B Beta\n             X Gamma\n             A Alpha\n</code></pre></div></div>\n\n<p>the tool will return:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> Collection: [Dataset Alpha]\n             [Dataset Beta]\n             [Dataset Gamma]\n</code></pre></div></div>\n\n<h3 id=\"sort-collection\">Sort collection</h3>\n\n<p><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> <strong>Sort collection</strong> sorts dataset collection alphabetically, numerically, or using predetermined order from a supplied file.</p>\n\n<h4 id=\"numeric-sort\">Numeric sort</h4>\n\n<p>The tool sort in ascending order. When <em>numeric</em> sort is chosen, the tool ignores non-numeric characters. For example, if a collection contains the following elements:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> Collection: [Horse123]\n             [Donkey543]\n             [Mule176]\n</code></pre></div></div>\n\n<p>The tool will output:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> Collection: [Horse123]\n             [Mule176]\n             [Donkey543]\n</code></pre></div></div>\n\n<h4 id=\"sorting-from-file\">Sorting from file</h4>\n\n<p>Alternative, one can supply a single column text file containing elements identifiers in the desired sort order. For example, suppose there a collection:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> Collection: [Horse123]\n             [Donkey543]\n             [Mule176]\n</code></pre></div></div>\n\n<p>and a file specifying sort order:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> Donkey543\n Horse123\n Mule176\n</code></pre></div></div>\n\n<p>the output will predictably look like this:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> Collection: [Donkey543]\n             [Horse123]\n             [Mule176]\n</code></pre></div></div>\n\n<h3 id=\"tag-collection\">Tag collection</h3>\n\n<p><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>  <strong>Tag collection</strong> adds tags (including name: and group: tags) to collection elements.</p>\n\n<p>The relationship between element names and tags is specified in a two column tab-delimited file. This file may contain less entries than elements in the collection. In that case only matching list identifiers will be tagged.</p>\n\n<p>To create name: or group: tags prepend them with <code class=\"language-plaintext highlighter-rouge\">#</code> (you can also use <code class=\"language-plaintext highlighter-rouge\">name:</code>) or <code class=\"language-plaintext highlighter-rouge\">group:</code>, respectively.</p>\n\n<p>More about tags</p>\n\n<blockquote class=\"tip\">\n  <tip-title>More about tags</tip-title>\n  <p>Galaxy allows tagging datasets to facilitate analyses. There are several types of tags including simple tags, name tags, and group tags. <strong>Simple</strong> tags allow you to attach an alternative label to a dataset, which will make it easier to find it later. <strong>Name</strong> tags allow you to track propagation of a dataset through the analyses: all datasets derived from the initial dataset labeled with a name tag will inherit it. Finally, <strong>group</strong> tags allow you to label group of datasets. This is useful. for example, for differential expression analysis where you can have two groups of datasets labeled as “treatment” and “control”.</p>\n\n  <p>To learn mote about tags go to <a href=\"/training-material/search.html?query=tags\">training site</a>.</p>\n</blockquote>\n\n<h2 id=\"tools-that-change-collection-structure\">Tools that change collection structure</h2>\n\n<h3 id=\"flatten-collection\">Flatten collection</h3>\n\n<p><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> <strong>Flatten collection</strong> collapses nested collection into a simple list.</p>\n\n<p>This tool takes nested collections such as a list of lists or a list of dataset pairs and produces a flat list from the inputs. It effectively “flattens” the hierarchy. The collection identifiers are merged together (using <code class=\"language-plaintext highlighter-rouge\">_</code> as default) to create new collection identifiers in the flattened result:</p>\n\n<p><a href=\"../../images/collections/flatten.svg\" rel=\"noopener noreferrer\"><img src=\"../../images/collections/flatten.svg\" alt=\"Flatten collection. \" width=\"530\" height=\"330\" loading=\"lazy\" /></a></p>\n\n<h3 id=\"merge-collections\">Merge collections</h3>\n\n<p><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>  <strong>Merge collections</strong> takes two or more collections and creates a single collection from them.</p>\n\n<p>By default the tool assumes that collections that are being merged have unique dataset names. If it not the case only one (the first) of the datasets with a repeated name will be included in the merged collection. For example, suppose you have two collections. Each has two datasets named “A” and “B”:</p>\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> Collection 1: [Dataset A]\n               [Dataset B]\n               [Dataset X]\n Collection 2: [Dataset A]\n               [Dataset B]\n               [Dataset Y]\n</code></pre></div></div>\n\n<p>Merging them will produce a single collection with only two datasets:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> Merged Collection: [Dataset A]\n                    [Dataset B]\n                    [Dataset X]\n                    [Dataset Y]\n</code></pre></div></div>\n\n<p>This behavior can be changed by clicking on “<em>Advanced Options</em>” link. The following options are available:</p>\n\n<h4 id=\"keep-first-instance-default-behavior\">Keep first instance (Default behavior)</h4>\n\n<p>Input:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> Collection 1: [Dataset A]\n               [Dataset B]\n               [Dataset X]\n Collection 2: [Dataset A]\n               [Dataset B]\n               [Dataset Y]\n</code></pre></div></div>\n\n<p>Output:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> Merged Collection: [Dataset A]\n                    [Dataset B]\n                    [Dataset X]\n                    [Dataset Y]\n</code></pre></div></div>\n\n<p>Here if two collection have identical dataset names, a dataset is chosen from the <em>first</em> collection.</p>\n\n<h4 id=\"keep-last-instance\">Keep last instance</h4>\n\n<p>Input:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> Collection 1: [Dataset A]\n               [Dataset B]\n               [Dataset X]\n Collection 2: [Dataset A]\n               [Dataset B]\n               [Dataset Y]\n</code></pre></div></div>\n\n<p>Output:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> Merged Collection: [Dataset A]\n                    [Dataset B]\n                    [Dataset X]\n                    [Dataset Y]\n</code></pre></div></div>\n\n<p>Here if two collection have identical dataset names, a dataset is chosen from the <em>last</em> collection.</p>\n\n<h4 id=\"append-suffix-to-conflicted-element-identifiers\">Append suffix to conflicted element identifiers</h4>\n\n<p>Input:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> Collection 1: [Dataset A]\n               [Dataset B]\n               [Dataset X]\n Collection 2: [Dataset A]\n               [Dataset B]\n               [Dataset Y]\n</code></pre></div></div>\n\n<p>Output:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> Merged Collection: [Dataset A_1]\n                    [Dataset B_1]\n                    [Dataset A_2]\n                    [Dataset B_2]\n                    [Dataset X]\n                    [Dataset Y]\n</code></pre></div></div>\n\n<h4 id=\"append-suffix-to-conflicted-element-identifiers-after-first-on-encountered\">Append suffix to conflicted element identifiers after first on encountered</h4>\n\n<p>Input:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>\n Collection 1: [Dataset A]\n               [Dataset B]\n               [Dataset X]\n Collection 2: [Dataset A]\n               [Dataset B]\n               [Dataset Y]\n</code></pre></div></div>\n\n<p>Output:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> Merged Collection: [Dataset A]\n                    [Dataset B]\n                    [Dataset A_2]\n                    [Dataset B_2]\n                    [Dataset X]\n                    [Dataset Y]\n</code></pre></div></div>\n\n<h4 id=\"append-suffix-to-every-element-identifier\">Append suffix to every element identifier</h4>\n\n<p>Input:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> Collection 1: [Dataset A]\n               [Dataset B]\n               [Dataset X]\n Collection 2: [Dataset A]\n               [Dataset B]\n               [Dataset Y]\n</code></pre></div></div>\n\n<p>Output:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> Merged Collection: [Dataset A_1]\n                    [Dataset B_2]\n                    [Dataset A_2]\n                    [Dataset B_2]\n                    [Dataset X_1]\n                    [Dataset Y_2]\n</code></pre></div></div>\n\n<h4 id=\"fail-collection-creation\">Fail collection creation</h4>\n\n<p>This option will simply trigger an error.</p>\n\n<h3 id=\"zip-collection\">Zip collection</h3>\n\n<p><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> <strong>Zip collection</strong> takes two collections and creates a paired collection from them.</p>\n\n<p>If you have one collection containing only forward reads and one containing only reverse, this tools will “zip” them together into a simple paired collection. For example, given two collections with <code class=\"language-plaintext highlighter-rouge\">forward</code> and <code class=\"language-plaintext highlighter-rouge\">reverse</code> reads they can be “zipped” into a single paired collection:</p>\n\n<p><a href=\"../../images/collections/zip.svg\" rel=\"noopener noreferrer\"><img src=\"../../images/collections/zip.svg\" alt=\"Zip collection. \" width=\"620\" height=\"586\" loading=\"lazy\" /></a></p>\n\n<h3 id=\"unzip-collection\">Unzip collection</h3>\n\n<p><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> <strong>Unzip collection</strong> takes a paired collection and “unzips” it into two simple dataset collections (lists of datasets).</p>\n\n<p>Given a paired collection of forward and reverse reads this tool will “unzip” it into two collections containing forward and reverse reads, respectively:</p>\n\n<p><a href=\"../../images/collections/unzip.svg\" rel=\"noopener noreferrer\"><img src=\"../../images/collections/unzip.svg\" alt=\"Unzip collection. \" width=\"620\" height=\"575\" loading=\"lazy\" /></a></p>\n\n<h2 id=\"tools-that-combine-elements-of-a-collection\">Tools that combine elements of a collection</h2>\n\n<h3 id=\"column-join\">Column join</h3>\n\n<p><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> <strong>Column join</strong> merges elements of a collection on a given column.</p>\n\n<p>If you have a collection with three elements (image below), merging it on the first column will first produce a union on values found in the first column of each elements and then paste elements having the same value side-by-side:</p>\n\n<p><a href=\"../../images/collections/join_on_column.svg\" rel=\"noopener noreferrer\"><img src=\"../../images/collections/join_on_column.svg\" alt=\"Column join. \" width=\"360\" height=\"470\" loading=\"lazy\" /></a></p>\n\n<h3 id=\"collapse-collection\">Collapse collection</h3>\n\n<p><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> <strong>Collapse collection</strong> merges elements together (head-to-tail) in the order of the collection. Its power comes from the ability to add identifiers when it performs the merge. Identifiers can be added in variety of ways specified by the <strong>Prepend File name</strong> option as shown in the figure below (we used option <strong>A</strong> in the last step of this tutorial). <strong>A</strong> = <code class=\"language-plaintext highlighter-rouge\">Same line and each line in dataset</code>; <strong>B</strong> = <code class=\"language-plaintext highlighter-rouge\">Same line and only once per dataset</code>; <strong>C</strong> =  <code class=\"language-plaintext highlighter-rouge\">Line above</code></p>\n\n<p><a href=\"../../images/collections/collapse_collection.svg\" rel=\"noopener noreferrer\"><img src=\"../../images/collections/collapse_collection.svg\" alt=\"Collapse collection. \" width=\"880\" height=\"720\" loading=\"lazy\" /></a></p>\n\n<!-- GTN:IGNORE:002 -->\n"],"ref_slides":[],"video_library":{"tutorial":{"description":null,"materials":[{"link":"topics/galaxy-interface/tutorials/collections/tutorial.html","title":"Using dataset collections","type":"Tutorial"}],"tags":["galaxy-interface"],"type":"Tutorial","versions":[{"link":"uN6nP3I7QLE","captions":["delphine-l"],"date":"2023-05-09","length":"13M","speakers":["delphine-l"]},{"captions":["annefou","mariipia10"],"date":"2021-08-09","length":"11M","link":"uZUt9XIHUQo","speakers":["nekrut"]}],"gtn_id":"galaxy-interface/collections","title":"Using dataset collections","captioned":true},"slides":null,"demo":null,"both":null,"session":null},"hands_on":true,"slides":false,"mod_date":"2024-06-11 09:37:34 +0000","pub_date":"2016-09-30 12:51:14 +0000","version":30,"api":"https://training.galaxyproject.org/training-material/api/topics/galaxy-interface/tutorials/collections/tutorial.json","tools":["toolshed.g2.bx.psu.edu/repos/devteam/bwa/bwa_mem/0.7.17.1","toolshed.g2.bx.psu.edu/repos/iuc/lofreq_call/lofreq_call/2.1.5+galaxy1","toolshed.g2.bx.psu.edu/repos/iuc/snpsift/snpSift_extractFields/4.3+t.galaxy0","toolshed.g2.bx.psu.edu/repos/nml/collapse_collections/collapse_dataset/4.0"],"supported_servers":{"exact":[{"url":"https://usegalaxy.eu","name":"UseGalaxy.eu","usegalaxy":true},{"url":"https://usegalaxy.org","name":"UseGalaxy.org (Main)","usegalaxy":true},{"url":"https://usegalaxy.org.au","name":"UseGalaxy.org.au","usegalaxy":true}],"inexact":[{"url":"https://galaxytrakr.org/","name":"GalaxyTrakr","usegalaxy":false},{"url":"https://galaxy.hyphy.org/","name":"HyPhy HIV NGS Tools","usegalaxy":false},{"url":"https://mississippi.sorbonne-universite.fr","name":"MISSISSIPPI","usegalaxy":false},{"url":"https://usegalaxy.be/","name":"UseGalaxy.be","usegalaxy":false},{"url":"https://usegalaxy.cz/","name":"UseGalaxy.cz","usegalaxy":false},{"url":"https://usegalaxy.fr/","name":"UseGalaxy.fr","usegalaxy":false},{"url":"https://usegalaxy.no/","name":"UseGalaxy.no","usegalaxy":false}]},"topic_name_human":"Using Galaxy and Managing your Data","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[{"name":"bwa","owner":"devteam","revisions":"3fe632431b68","tool_panel_section_label":"Mapping","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"lofreq_call","owner":"iuc","revisions":"e1461b5c52a0","tool_panel_section_label":"Variant Calling","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"snpsift","owner":"iuc","revisions":"5fab4f81391d","tool_panel_section_label":"Variant Calling","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"collapse_collections","owner":"nml","revisions":"25136a2b0cfe","tool_panel_section_label":"Collection Operations","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"}]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools:\n- name: bwa\n  owner: devteam\n  revisions: 3fe632431b68\n  tool_panel_section_label: Mapping\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: lofreq_call\n  owner: iuc\n  revisions: e1461b5c52a0\n  tool_panel_section_label: Variant Calling\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: snpsift\n  owner: iuc\n  revisions: 5fab4f81391d\n  tool_panel_section_label: Variant Calling\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: collapse_collections\n  owner: nml\n  revisions: 25136a2b0cfe\n  tool_panel_section_label: Collection Operations\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n","tours":false,"video":false,"translations":{"tutorial":[],"slides":[],"video":false},"license":"CC-BY-4.0","type":"tutorial"}