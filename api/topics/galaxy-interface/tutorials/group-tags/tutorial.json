{"layout":"tutorial_hands_on","redirect_from":["/topics/galaxy-data-manipulation/tutorials/group-tags/tutorial","/short/galaxy-interface/group-tags","/short/T00149"],"title":"Group tags for complex experimental designs","zenodo_link":"","questions":["What are group tags?","How can I use group tags to perform multi-factor analyses with collections"],"objectives":["Learn how to set group tags","Learn how to select group tags in tools"],"time_estimation":"10m","key_points":["Group tags allow complex analyses without reshaping or unhiding datasets in a collection"],"contributors":[{"name":"Marius van den Beek","joined":"2018-06","id":"mvdbeek","url":"https://training.galaxyproject.org/training-material/api/contributors/mvdbeek.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/mvdbeek/"}],"subtopic":"manage","js_requirements":{"mathjax":null,"mermaid":false},"short_id":"T00149","url":"/topics/galaxy-interface/tutorials/group-tags/tutorial.html","topic_name":"galaxy-interface","tutorial_name":"group-tags","dir":"topics/galaxy-interface/tutorials/group-tags","symlink":null,"id":"galaxy-interface/group-tags","ref_tutorials":["<p>Advanced uses of Galaxy often require the use of dataset collections,\nwhich can contain between one and tens of thousands of datasets.\nGrouping datasets in this way has numerous advantages:</p>\n<ul>\n  <li>It is easy to represent a single collection in the History</li>\n  <li>Dataset names (“Element Identifiers”) are immutable and preserved</li>\n  <li>Collections can be split and nested in arbitrary ways</li>\n</ul>\n\n<p>While collections can be split in any way, doing so for multi-factor analysis\nquickly becomes cumbersome and messy. An alternative is to label collection\nelements with special group tags, i.e. tags prefixed by the string <code class=\"language-plaintext highlighter-rouge\">group:</code>.\nNote that group tags currently do not propagate, i.e. they are not inherited\nto datasets resulting from analyses. These tags can be displayed in the Tool\nform, allowing users to select subsets\nof collections.</p>\n\n<p>This tutorial outlines how to set and use group tags with the DESeq2 tool.\nFor a more detailed description and background for differential expression\ntesting see the <a href=\"/training-material/topics/transcriptomics/tutorials/ref-based/tutorial.html\">Reference-based RNA-Seq data analysis</a>.</p>\n\n<blockquote class=\"agenda\">\n  <agenda-title></agenda-title>\n\n  <p>In this tutorial, we will cover:</p>\n\n<ol id=\"markdown-toc\">\n  <li><a href=\"#setting-group-tags-using-the-apply-rules-tool\" id=\"markdown-toc-setting-group-tags-using-the-apply-rules-tool\">Setting group tags using the apply rules tool</a>    <ol>\n      <li><a href=\"#set-group-tags-during-upload\" id=\"markdown-toc-set-group-tags-during-upload\">Set group tags during upload</a></li>\n      <li><a href=\"#set-group-tags-using-the-tag-elements-from-file-tool\" id=\"markdown-toc-set-group-tags-using-the-tag-elements-from-file-tool\">Set group tags using the “Tag elements from file” tool</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#using-group-tags-in-tool-eg-deseq2\" id=\"markdown-toc-using-group-tags-in-tool-eg-deseq2\">Using group tags in tool, e.g. DESeq2</a></li>\n  <li><a href=\"#conclusion\" id=\"markdown-toc-conclusion\">Conclusion</a></li>\n</ol>\n\n</blockquote>\n\n<h1 id=\"setting-group-tags-using-the-apply-rules-tool\">Setting group tags using the apply rules tool</h1>\n\n<p>There are several ways to set group tags:</p>\n<ul>\n  <li>Using the Rule Based Uploader</li>\n  <li>Using the “Tag elements from file” tool</li>\n  <li>Using the “Apply Rules” tool</li>\n  <li>Manually adding dataset tags with the prefix <code class=\"language-plaintext highlighter-rouge\">group:</code></li>\n</ul>\n\n<p>We will use the first two methods in this tutorial.\nThe second and third methods work at any step during the analysis.\nNote that the function of the “Apply Rules” tool is (nearly) identical\nto the Rule Based Uploader.</p>\n\n<h2 id=\"set-group-tags-during-upload\">Set group tags during upload</h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Set group tags during upload</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Create a new history for this tutorial</p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-creating-a-new-history\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-creating-a-new-history\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Creating a new history</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p>Click the <i class=\"fas fa-plus\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">new-history</span> icon at the top of the history panel:</p>   <p><img src=\"/training-material/shared/images/history_create_new.svg\" alt=\"UI for creating new history\" /></p>   <!-- the original drawing can be found here https://docs.google.com/drawings/d/1cCBrLAo4kDGic5QyB70rRiWJAKTenTU8STsKDaLcVU8/edit?usp=sharing --> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>Open the Galaxy Upload Manager (<i class=\"fas fa-upload\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-upload</span> on the top-right of the tool panel)</li>\n    <li>\n      <p>Click on <strong>Rule-based</strong> on the top</p>\n\n      <p><a href=\"../../images/group-tags/rule_upload.png\" rel=\"noopener noreferrer\"><img src=\"../../images/group-tags/rule_upload.png\" alt=\"Rule-based upload. \" width=\"891\" height=\"538\" loading=\"lazy\" /></a></p>\n\n      <p>As you can see in this dialog, data can be selected from a history dataset or pasted in directly</p>\n    </li>\n    <li>Set <strong>Upload data as:</strong> to <code class=\"language-plaintext highlighter-rouge\">Collection(s)</code></li>\n    <li>\n      <p>Paste the following links into the text box</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>https://zenodo.org/record/1185122/files/GSM461176_untreat_single.counts\nhttps://zenodo.org/record/1185122/files/GSM461177_untreat_paired.counts\nhttps://zenodo.org/record/1185122/files/GSM461178_untreat_paired.counts\nhttps://zenodo.org/record/1185122/files/GSM461179_treat_single.counts\nhttps://zenodo.org/record/1185122/files/GSM461180_treat_paired.counts\nhttps://zenodo.org/record/1185122/files/GSM461181_treat_paired.counts\nhttps://zenodo.org/record/1185122/files/GSM461182_untreat_single.counts\n</code></pre></div>      </div>\n    </li>\n    <li>Click <strong>Build</strong></li>\n    <li>We will add a regex that creates 3 new columns with accession, treatment and library type:\n      <ul>\n        <li>Click on the <strong>Column</strong> button and then <strong>Using a Regular Expression</strong></li>\n        <li>Select <strong>Create columns matching expression groups</strong></li>\n        <li>Paste <code class=\"language-plaintext highlighter-rouge\">.*(GSM.*)_(.*)_(.*).counts</code> in <em>“Regular Expression”</em></li>\n        <li>Set <em>“Number of Groups”</em> to 3</li>\n        <li>\n          <p>Click on <strong>Apply</strong></p>\n\n          <p>We should have now a table with 4 columns: link, sample name, treatment, sequencing type</p>\n        </li>\n        <li>Click on <strong>Rules</strong> and then <strong>Add / Modify Column Definitions</strong></li>\n        <li>Click on <strong>Add Definition</strong> and select:\n          <ul>\n            <li><em>“URL”</em>: Column A (Note that this option is absent when using the “Apply rules tool”)</li>\n            <li><em>“List Identifiers”</em>: Column B</li>\n            <li><em>“Group Tags”</em>: Columns C and D (Select Column C first and then add D by clicking on <em>“… Add another column”</em>)</li>\n          </ul>\n        </li>\n        <li>Click <strong>Apply</strong></li>\n        <li>Enter a name for the new collection</li>\n        <li>Click <strong>Upload</strong></li>\n      </ul>\n    </li>\n    <li>\n      <p>Expand the generated collection and the files in it and check their names and tags</p>\n\n      <p><a href=\"../../images/group-tags/group-tags.png\" rel=\"noopener noreferrer\"><img src=\"../../images/group-tags/group-tags.png\" alt=\"Group tags in Galaxy UI are prefixed with group:. \" width=\"279\" height=\"176\" loading=\"lazy\" /></a></p>\n    </li>\n  </ol>\n</blockquote>\n\n<h2 id=\"set-group-tags-using-the-tag-elements-from-file-tool\">Set group tags using the “Tag elements from file” tool</h2>\n\n<p>We now want to add group tags using the “Tag elements from file” tool.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Upload and create a collection</hands-on-title>\n\n  <ol>\n    <li>Create a new history for this tutorial</li>\n    <li>\n      <p>Import the following files</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>https://zenodo.org/record/1185122/files/GSM461176_untreat_single.counts\nhttps://zenodo.org/record/1185122/files/GSM461177_untreat_paired.counts\nhttps://zenodo.org/record/1185122/files/GSM461178_untreat_paired.counts\nhttps://zenodo.org/record/1185122/files/GSM461179_treat_single.counts\nhttps://zenodo.org/record/1185122/files/GSM461180_treat_paired.counts\nhttps://zenodo.org/record/1185122/files/GSM461181_treat_paired.counts\nhttps://zenodo.org/record/1185122/files/GSM461182_untreat_single.counts\n</code></pre></div>      </div>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-importing-via-links\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-importing-via-links\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Importing via links</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Copy the link location</li>   <li>     <p>Click <i class=\"fas fa-upload\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-upload</span> <strong>Upload Data</strong> at the top of the tool panel</p>   </li>   <li>Select <i class=\"fa fa-edit\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-wf-edit</span> <strong>Paste/Fetch Data</strong></li>   <li>     <p>Paste the link(s) into the text field</p>   </li>   <li>     <p>Press <strong>Start</strong></p>   </li>   <li><strong>Close</strong> the window</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>\n      <p>Create a <strong>Dataset List (Collection)</strong> with these 7 files</p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-creating-a-dataset-collection\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-creating-a-dataset-collection\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Creating a dataset collection</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Click on <i class=\"far fa-check-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-selector</span> <strong>Select Items</strong> at the top of the history panel <img src=\"/training-material/topics/galaxy-interface/images/historyItemControls.png\" alt=\"Select Items button\" /></li>   <li>Check The 7 datasets you’ve just imported</li>   <li>     <p>Click <strong>7 of N selected</strong> and choose <strong>Build Dataset List</strong></p>     <p><img src=\"/training-material/topics/galaxy-interface/images/buildList.png\" alt=\"build list collection menu item\" width=\"15%\" /></p>   </li>   <li>Enter a name for your collection</li>   <li>Click <strong>Create collection</strong> to build your collection</li>   <li>Click on the checkmark icon at the top of your history again</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>We have now a collection with our files. We can now either upload a tabular file containing the element identifiers\nand the tags we want to apply, or we can extract the element identifiers and extract the tags using a Regular Expression.\nWe will do the latter.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Set group tags using the \"Tag elements from file\" tool</hands-on-title>\n  <ol>\n    <li><strong>Extract element identifiers</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>\n      <ul>\n        <li><i class=\"far fa-folder\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-collection</span> <em>“Dataset collection”</em>: created collection</li>\n      </ul>\n    </li>\n    <li><strong>Replace Text in entire line</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“File to process”</em>: output of <strong>Extract element identifiers</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span></li>\n        <li>In <em>“Replacement”</em>:\n          <ul>\n            <li>In <em>“1: Replacement”</em>\n              <ul>\n                <li><em>“Find pattern”</em>: <code class=\"language-plaintext highlighter-rouge\">(.*)_(.*)_(.*).counts</code></li>\n                <li><em>“Replace with”</em>: <code class=\"language-plaintext highlighter-rouge\">\\1_\\2_\\3.counts\\tgroup:\\2\\tgroup:\\3</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n\n      <p>This step adds an additional columns that can be used with the <code class=\"language-plaintext highlighter-rouge\">Tag elements from file</code> tool</p>\n    </li>\n    <li>\n      <p>Change the datatype to <code class=\"language-plaintext highlighter-rouge\">tabular</code></p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-changing-the-datatype\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-changing-the-datatype\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Changing the datatype</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Click on the <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>   <li>In the central panel, click <i class=\"fas fa-database\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-chart-select-data</span> <strong>Datatypes</strong> tab on the top</li>   <li>In the <i class=\"fas fa-database\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-chart-select-data</span> <strong>Assign Datatype</strong>, select <code class=\"language-plaintext highlighter-rouge\">tabular</code> from “<em>New type</em>” dropdown     <ul>       <li>Tip: you can start typing the datatype into the field to filter the dropdown menu</li>     </ul>   </li>   <li>Click the <strong>Save</strong> button</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li><strong>Tag elements from file</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>\n      <ul>\n        <li><i class=\"far fa-folder\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-collection</span> <em>“Input Collection”</em>: created collection</li>\n        <li><i class=\"far fa-folder\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-collection</span> <em>“Tag collection elements according to this file”</em>: output of <strong>Replace Text</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span></li>\n      </ul>\n    </li>\n  </ol>\n</blockquote>\n\n<p>You should now have a properly tagged collection of tabular files that can be used in DESeq2.</p>\n\n<h1 id=\"using-group-tags-in-tool-eg-deseq2\">Using group tags in tool, e.g. DESeq2</h1>\n\n<p>DESeq2 has two modes for specifying factors. One can either\nselect datasets corresponding to factors, or use group tags\nto specify factors. We will use the group tags present in\nour collection to specify factors.</p>\n\n<p>The tool interface will prompt you with the group tags that are available for your inputs:</p>\n\n<p><a href=\"../../images/group-tags/tool-ui.png\" rel=\"noopener noreferrer\"><img src=\"../../images/group-tags/tool-ui.png\" alt=\"Group tags in the tool UI. \" width=\"488\" height=\"339\" loading=\"lazy\" /></a></p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Running <b>DESeq2</b> with group tags</hands-on-title>\n\n  <ol>\n    <li><strong>DESeq2</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:\n      <ul>\n        <li><em>“how”</em>: <code class=\"language-plaintext highlighter-rouge\">Select group tags corresponding to levels</code>\n          <ul>\n            <li><i class=\"far fa-folder\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-collection</span> <em>“Count file(s) collection”</em>: Generated collection</li>\n            <li>In <em>“Factor”</em>:\n              <ul>\n                <li>In “1: Factor”\n                  <ul>\n                    <li><em>“Specify a factor name”</em>: <code class=\"language-plaintext highlighter-rouge\">Treatment</code></li>\n                    <li>In <em>“Factor level”</em>:\n                      <ul>\n                        <li>In <em>“1: Factor level”</em>:\n                          <ul>\n                            <li><em>“Specify a factor level”</em>: <code class=\"language-plaintext highlighter-rouge\">treat</code></li>\n                            <li><em>“Select groups that correspond to this factor level”</em>: <code class=\"language-plaintext highlighter-rouge\">Tags: treat</code></li>\n                          </ul>\n                        </li>\n                        <li>In <em>“2: Factor level”</em>:\n                          <ul>\n                            <li><em>“Specify a factor level”</em>: <code class=\"language-plaintext highlighter-rouge\">untreat</code></li>\n                            <li><em>“Select groups that correspond to this factor level”</em>: <code class=\"language-plaintext highlighter-rouge\">Tags: untreat</code></li>\n                          </ul>\n                        </li>\n                      </ul>\n                    </li>\n                  </ul>\n                </li>\n                <li>Click on <i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert Factor”</em> (not on “Insert Factor level”)</li>\n                <li>In “2: Factor”\n                  <ul>\n                    <li>“Specify a factor name” to <code class=\"language-plaintext highlighter-rouge\">Sequencing</code></li>\n                    <li>In <em>“Factor level”</em>:\n                      <ul>\n                        <li>In <em>“1: Factor level”</em>:\n                          <ul>\n                            <li><em>“Specify a factor level”</em>: <code class=\"language-plaintext highlighter-rouge\">paired</code></li>\n                            <li><em>“Select groups that correspond to this factor level”</em>: <code class=\"language-plaintext highlighter-rouge\">Tags: paired</code></li>\n                          </ul>\n                        </li>\n                        <li>In <em>“2: Factor level”</em>:\n                          <ul>\n                            <li><em>“Specify a factor level”</em>: <code class=\"language-plaintext highlighter-rouge\">single</code></li>\n                            <li><em>“Select groups that correspond to this factor level”</em>: <code class=\"language-plaintext highlighter-rouge\">Tags: single</code></li>\n                          </ul>\n                        </li>\n                      </ul>\n                    </li>\n                  </ul>\n                </li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n        <li><em>“Files have header?”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n        <li><em>“Output normalized counts table”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n      </ul>\n    </li>\n  </ol>\n</blockquote>\n\n<h1 id=\"conclusion\">Conclusion</h1>\n\n<p>We can select a subset of Collections using the special group tag.</p>\n"],"ref_slides":[],"hands_on":true,"slides":false,"mod_date":"2023-11-03 14:30:27 +0000","pub_date":"2019-03-06 13:41:44 +0000","version":17,"api":"https://training.galaxyproject.org/training-material/api/topics/galaxy-interface/tutorials/group-tags/tutorial.json","tools":[],"supported_servers":{"exact":[],"inexact":[{"name":"UseGalaxy.eu","url":"https://usegalaxy.eu","id":"eu","human":"Galaxy Europe","usegalaxy":true},{"name":"UseGalaxy.org","url":"https://usegalaxy.org","id":"us","human":"Galaxy Main","usegalaxy":true},{"name":"UseGalaxy.org.au","url":"https://usegalaxy.org.au","id":"au","human":"Galaxy Australia","usegalaxy":true},{"name":"UseGalaxy.fr","url":"https://usegalaxy.fr","id":"fr","human":"Galaxy France","usegalaxy":true}]},"topic_name_human":"Using Galaxy and Managing your Data","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools: []\n","tours":false,"video":false,"slides_recordings":false,"translations":{"tutorial":[],"slides":[],"video":false},"license":"CC-BY-4.0","type":"tutorial"}