{"layout":"tutorial_hands_on","title":"Introduction to sequencing with Python (part four)","questions":["How to manipulate files in Python","How to read and write FASTA","How to read and write FASTQ","How to read and write SAM"],"objectives":["Understand manipulation of files in Python"],"time_estimation":"1h","key_points":["Python can be used to read and write files"],"contributions":{"authorship":["nekrut"]},"priority":5,"subtopic":"gnmx","draft":true,"notebook":{"language":"python","pyolite":true},"js_requirements":{"mathjax":null,"mermaid":false},"short_id":"T00411","url":"/topics/data-science/tutorials/gnmx-lecture5/tutorial.html","topic_name":"data-science","tutorial_name":"gnmx-lecture5","dir":"topics/data-science/tutorials/gnmx-lecture5","symlink":null,"id":"data-science/gnmx-lecture5","ref_tutorials":["<h1 id=\"reading-and-writing-files-in-python\">Reading and writing files in Python</h1>\n\n<p>First let’s download a file we will be using to your notebooks:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>!wget https://raw.githubusercontent.com/nekrut/BMMB554/master/2023/data/l9/mt_cds.fa\n</code></pre></div></div>\n\n<p>In Python, you can handle files using the built-in <code class=\"language-plaintext highlighter-rouge\">open</code> function. The <code class=\"language-plaintext highlighter-rouge\">open</code> function creates a file object, which you can use to read, write, or modify the file.</p>\n\n<p>Here’s an example of how to open a file for reading:</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">f</span> <span class=\"o\">=</span> <span class=\"nf\">open</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">mt_cds.fa</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">r</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n</code></pre></div></div>\n\n<p>In this example, the open function takes two arguments: the name of the file, and the mode in which you want to open the file. The <code class=\"language-plaintext highlighter-rouge\">r</code> mode indicates that you want to open the file for reading.</p>\n\n<p>After you’ve opened the file, you can read its contents using the read method:</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">contents</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"p\">.</span><span class=\"nf\">read</span><span class=\"p\">()</span>\n<span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">contents</span><span class=\"p\">)</span>\n</code></pre></div></div>\n\n<p>You can also read the file line by line using the readline method:</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">line</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"p\">.</span><span class=\"nf\">readline</span><span class=\"p\">()</span>\n<span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">line</span><span class=\"p\">)</span>\n</code></pre></div></div>\n\n<p>When you’re done reading the file, you should close it using the close method:</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">f</span><span class=\"p\">.</span><span class=\"nf\">close</span><span class=\"p\">()</span>\n</code></pre></div></div>\n\n<p>You can also use the <code class=\"language-plaintext highlighter-rouge\">with</code> statement to automatically close the file when you’re done:</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">with</span> <span class=\"nf\">open</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">mt_cds.fa</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">r</span><span class=\"sh\">\"</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n    <span class=\"n\">contents</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"p\">.</span><span class=\"nf\">read</span><span class=\"p\">()</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">contents</span><span class=\"p\">)</span>\n</code></pre></div></div>\n\n<p>You can also write to files using <code class=\"language-plaintext highlighter-rouge\">write</code> method (note the <code class=\"language-plaintext highlighter-rouge\">\"w\"</code> mode):</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">f</span> <span class=\"o\">=</span> <span class=\"nf\">open</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">sample.txt</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">w</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n<span class=\"n\">f</span><span class=\"p\">.</span><span class=\"nf\">write</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">This is a new line.</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n<span class=\"n\">f</span><span class=\"p\">.</span><span class=\"nf\">close</span><span class=\"p\">()</span>\n</code></pre></div></div>\n\n<p>If you open an existing file in write mode, its contents will be overwritten. If you want to append to an existing file instead, you can use the <code class=\"language-plaintext highlighter-rouge\">\"a\"</code> mode:</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">f</span> <span class=\"o\">=</span> <span class=\"nf\">open</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">sample.txt</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">a</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n<span class=\"n\">f</span><span class=\"p\">.</span><span class=\"nf\">write</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">This is another line.</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n<span class=\"n\">f</span><span class=\"p\">.</span><span class=\"nf\">close</span><span class=\"p\">()</span>\n</code></pre></div></div>\n\n<p>When you’re writing to a file, it’s important to make sure you close the file when you’re done. If you don’t close the file, any changes you make may not be saved.</p>\n\n<p>In addition to reading and writing text files, you can also use Python to handle binary files, such as images or audio files.</p>\n\n<p>Let’s download an image:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>!wget https://imgs.xkcd.com/comics/file_extensions.png\n</code></pre></div></div>\n\n<p>Here’s an example of how to read an image file:</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">with</span> <span class=\"nf\">open</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">file_extensions.png</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">rb</span><span class=\"sh\">\"</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n    <span class=\"n\">contents</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"p\">.</span><span class=\"nf\">read</span><span class=\"p\">()</span>\n</code></pre></div></div>\n\n<p>Note that when working with binary files, you must use the <code class=\"language-plaintext highlighter-rouge\">\"rb\"</code> mode for reading and the <code class=\"language-plaintext highlighter-rouge\">\"wb\"</code> mode for writing.</p>\n\n<p>There are many more features and methods related to file handling in Python, but the basics covered here should be enough to get you started.</p>\n\n<h2 id=\"fasta\"><a href=\"https://en.wikipedia.org/wiki/FASTA_format\">Fasta</a></h2>\n\n<p>Fasta is a file format that is commonly used to store biological sequences, such as DNA or protein sequences. In Python, you can read a Fasta file by opening the file, reading the lines one by one, and processing the data as needed.</p>\n\n<p>Here’s an example of how you might read a Fasta file in Python:</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">sequences</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n<span class=\"k\">with</span> <span class=\"nf\">open</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">mt_cds.fa</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">r</span><span class=\"sh\">\"</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"nb\">file</span><span class=\"p\">:</span>\n  <span class=\"n\">header</span> <span class=\"o\">=</span> <span class=\"sh\">\"\"</span>\n  <span class=\"n\">sequence</span> <span class=\"o\">=</span> <span class=\"sh\">\"\"</span>\n  <span class=\"k\">for</span> <span class=\"n\">line</span> <span class=\"ow\">in</span> <span class=\"nb\">file</span><span class=\"p\">:</span>\n    <span class=\"n\">line</span><span class=\"o\">=</span><span class=\"n\">line</span><span class=\"p\">.</span><span class=\"nf\">rstrip</span><span class=\"p\">()</span>\n    <span class=\"k\">if</span> <span class=\"n\">line</span><span class=\"p\">.</span><span class=\"nf\">startswith</span><span class=\"p\">(</span><span class=\"sh\">'</span><span class=\"s\">&gt;</span><span class=\"sh\">'</span><span class=\"p\">):</span>\n      <span class=\"k\">if</span> <span class=\"n\">header</span> <span class=\"o\">!=</span> <span class=\"sh\">\"\"</span><span class=\"p\">:</span>\n        <span class=\"n\">sequences</span><span class=\"p\">[</span><span class=\"n\">header</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">sequence</span>\n        <span class=\"n\">sequence</span> <span class=\"o\">=</span> <span class=\"sh\">\"\"</span>\n      <span class=\"n\">header</span> <span class=\"o\">=</span> <span class=\"n\">line</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">:]</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n      <span class=\"n\">sequence</span> <span class=\"o\">+=</span> <span class=\"n\">line</span>\n  <span class=\"k\">if</span> <span class=\"n\">header</span> <span class=\"o\">!=</span> <span class=\"sh\">\"\"</span><span class=\"p\">:</span>\n    <span class=\"n\">sequences</span><span class=\"p\">[</span><span class=\"n\">header</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">sequence</span>\n</code></pre></div></div>\n<p>The code above uses a <code class=\"language-plaintext highlighter-rouge\">with</code> statement to open the file and read the lines one by one. If a line starts with a <code class=\"language-plaintext highlighter-rouge\">\"&gt;\"</code>, it is assumed to be a header, and the current sequence is stored in the dictionary using the current header as the key. If the line does not start with a <code class=\"language-plaintext highlighter-rouge\">\"&gt;\"</code>, it is assumed to be part of the current sequence.</p>\n\n<h2 id=\"fastq\"><a href=\"https://en.wikipedia.org/wiki/FASTQ_format\">FASTQ</a></h2>\n\n<p>Let’s download a sample fastq file:</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"err\">!</span><span class=\"n\">wget</span> <span class=\"n\">https</span><span class=\"p\">:</span><span class=\"o\">//</span><span class=\"n\">raw</span><span class=\"p\">.</span><span class=\"n\">githubusercontent</span><span class=\"p\">.</span><span class=\"n\">com</span><span class=\"o\">/</span><span class=\"n\">nekrut</span><span class=\"o\">/</span><span class=\"n\">BMMB554</span><span class=\"o\">/</span><span class=\"n\">master</span><span class=\"o\">/</span><span class=\"mi\">2023</span><span class=\"o\">/</span><span class=\"n\">data</span><span class=\"o\">/</span><span class=\"n\">l9</span><span class=\"o\">/</span><span class=\"n\">reads</span><span class=\"p\">.</span><span class=\"n\">fq</span>\n</code></pre></div></div>\n\n<p>Fastq is a file format that is commonly used to store high-throughput sequencing data. It consists of a series of records, each of which includes a header, a sequence, a quality score header, and a quality score string. In Python, you can read a Fastq file by opening the file, reading the lines four at a time, and processing the data as needed.</p>\n\n<p>Here’s an example of how you might read a Fastq file in Python:</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">def</span> <span class=\"nf\">read_fastq</span><span class=\"p\">(</span><span class=\"n\">file_path</span><span class=\"p\">):</span>\n    <span class=\"n\">records</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n    <span class=\"k\">with</span> <span class=\"nf\">open</span><span class=\"p\">(</span><span class=\"n\">file_path</span><span class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">r</span><span class=\"sh\">\"</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n        <span class=\"k\">while</span> <span class=\"bp\">True</span><span class=\"p\">:</span>\n            <span class=\"n\">header</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"p\">.</span><span class=\"nf\">readline</span><span class=\"p\">().</span><span class=\"nf\">strip</span><span class=\"p\">()</span>\n            <span class=\"k\">if</span> <span class=\"n\">header</span> <span class=\"o\">==</span> <span class=\"sh\">\"\"</span><span class=\"p\">:</span>\n                <span class=\"k\">break</span>\n            <span class=\"n\">sequence</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"p\">.</span><span class=\"nf\">readline</span><span class=\"p\">().</span><span class=\"nf\">strip</span><span class=\"p\">()</span>\n            <span class=\"n\">quality_header</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"p\">.</span><span class=\"nf\">readline</span><span class=\"p\">().</span><span class=\"nf\">strip</span><span class=\"p\">()</span>\n            <span class=\"n\">quality</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"p\">.</span><span class=\"nf\">readline</span><span class=\"p\">().</span><span class=\"nf\">strip</span><span class=\"p\">()</span>\n            <span class=\"n\">records</span><span class=\"p\">.</span><span class=\"nf\">append</span><span class=\"p\">((</span><span class=\"n\">header</span><span class=\"p\">,</span> <span class=\"n\">sequence</span><span class=\"p\">,</span> <span class=\"n\">quality</span><span class=\"p\">))</span>\n    <span class=\"k\">return</span> <span class=\"n\">records</span>\n</code></pre></div></div>\n<p>In this example, the <code class=\"language-plaintext highlighter-rouge\">read_fastq</code> function takes a file path as an argument, and returns a list of records, where each record is a tuple of four strings: the header, the sequence, the quality score header, and the quality score string. The function uses a <code class=\"language-plaintext highlighter-rouge\">while</code> loop to read the lines four at a time until the end of the file is reached.</p>\n\n<p>You can use this function to read a Fastq file like this:</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">records</span> <span class=\"o\">=</span> <span class=\"nf\">read_fastq</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">reads.fq</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n<span class=\"k\">for</span> <span class=\"n\">header</span><span class=\"p\">,</span> <span class=\"n\">sequence</span><span class=\"p\">,</span> <span class=\"n\">quality_header</span><span class=\"p\">,</span> <span class=\"n\">quality</span> <span class=\"ow\">in</span> <span class=\"n\">records</span><span class=\"p\">:</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">header</span><span class=\"p\">)</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">sequence</span><span class=\"p\">)</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">quality_header</span><span class=\"p\">)</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">quality</span><span class=\"p\">)</span>\n</code></pre></div></div>\n<p>This will print the headers, sequences, quality score headers, and quality scores in the Fastq file. You can modify the read_fastq function to process the data in any way you need.</p>\n\n<h2 id=\"sam\"><a href=\"https://en.wikipedia.org/wiki/SAM_(file_format)\">SAM</a></h2>\n\n<p>Let’s download an example SAM file:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>!wget https://raw.githubusercontent.com/nekrut/BMMB554/master/2023/data/l9/sam_example.sam\n</code></pre></div></div>\n\n<p>SAM (Sequence Alignment/Map) is a file format that is used to store the results of DNA sequencing alignments. In Python, you can read a SAM file by opening the file, reading the lines one by one, and processing the data as needed.</p>\n\n<p>Here’s an example of how you might read a SAM file in Python:</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">def</span> <span class=\"nf\">read_sam</span><span class=\"p\">(</span><span class=\"n\">file_path</span><span class=\"p\">):</span>\n    <span class=\"n\">records</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n    <span class=\"k\">with</span> <span class=\"nf\">open</span><span class=\"p\">(</span><span class=\"n\">file_path</span><span class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">r</span><span class=\"sh\">\"</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n        <span class=\"k\">for</span> <span class=\"n\">line</span> <span class=\"ow\">in</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"n\">line</span><span class=\"p\">.</span><span class=\"nf\">startswith</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">@</span><span class=\"sh\">\"</span><span class=\"p\">):</span>\n                <span class=\"k\">continue</span>\n            <span class=\"n\">fields</span> <span class=\"o\">=</span> <span class=\"n\">line</span><span class=\"p\">.</span><span class=\"nf\">strip</span><span class=\"p\">().</span><span class=\"nf\">split</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"se\">\\t</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n            <span class=\"n\">records</span><span class=\"p\">.</span><span class=\"nf\">append</span><span class=\"p\">(</span><span class=\"n\">fields</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">records</span>\n</code></pre></div></div>\n<p>In this example, the <code class=\"language-plaintext highlighter-rouge\">read_sam</code> function takes a file path as an argument, and returns a list of records, where each record is a list of fields. The function uses a <code class=\"language-plaintext highlighter-rouge\">with</code> statement to open the file and read the lines one by one. If a line starts with an <code class=\"language-plaintext highlighter-rouge\">\"@\"</code>, it is assumed to be a header and is ignored. If the line does not start with an <code class=\"language-plaintext highlighter-rouge\">\"@\"</code>, it is assumed to be a record, and the fields are extracted by splitting the line on tabs.</p>\n\n<p>You can use this function to read a SAM file like this:</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">records</span> <span class=\"o\">=</span> <span class=\"nf\">read_sam</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">sam_example.sam</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n<span class=\"k\">for</span> <span class=\"n\">fields</span> <span class=\"ow\">in</span> <span class=\"n\">records</span><span class=\"p\">:</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">fields</span><span class=\"p\">)</span>\n</code></pre></div></div>\n\n<p>This will print the fields in the SAM file. You can modify the read_sam function to process the data in any way you need. For example, you might want to extract specific fields, such as the reference name, the start position, and the cigar string.</p>\n"],"ref_slides":[],"hands_on":true,"slides":false,"mod_date":"2024-02-19 19:03:29 +0000","pub_date":"2024-02-13 14:53:48 +0000","version":2,"api":"https://training.galaxyproject.org/training-material/api/topics/data-science/tutorials/gnmx-lecture5/tutorial.json","tools":[],"supported_servers":{"exact":[],"inexact":[{"name":"UseGalaxy.eu","url":"https://usegalaxy.eu","id":"eu","human":"Galaxy Europe","usegalaxy":true},{"name":"UseGalaxy.org","url":"https://usegalaxy.org","id":"us","human":"Galaxy Main","usegalaxy":true},{"name":"UseGalaxy.org.au","url":"https://usegalaxy.org.au","id":"au","human":"Galaxy Australia","usegalaxy":true},{"name":"UseGalaxy.fr","url":"https://usegalaxy.fr","id":"fr","human":"Galaxy France","usegalaxy":true}]},"topic_name_human":"Foundations of Data Science","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools: []\n","tours":false,"video":false,"slides_recordings":false,"translations":{"tutorial":[],"slides":[],"video":false},"license":"CC-BY-4.0","type":"tutorial","tags":["work-in-progress"],"contributors":[{"name":"Anton Nekrutenko","email":"anton@nekrut.org","joined":"2017-09","id":"nekrut","url":"https://training.galaxyproject.org/training-material/api/contributors/nekrut.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/nekrut/"}]}