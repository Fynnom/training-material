{"layout":"tutorial_hands_on","title":"SQL Educational Game - Murder Mystery","level":"Intermediate","zenodo_link":"","requirements":[{"type":"internal","topic_name":"data-science","tutorials":["sql-basic","sql-advanced"]}],"follow_up_training":[],"questions":["Who did the crime?"],"objectives":["Explore SQL City and discover who committed the murder","Reinforce your experiences with SQL such as querying, filtering, and joining data."],"time_estimation":"2H","key_points":["Learning SQL can be fun!"],"notebook":{"language":"python"},"subtopic":"sql","contributions":{"authorship":["NUKnightLab","hexylena"],"funding":["gallantries","avans-atgm"]},"tags":["game","SQL","jupyter-notebook"],"license":"MIT","copyright":"Copyright (c) 2018 NUKnightLab","js_requirements":{"mathjax":null,"mermaid":false},"short_id":"T00108","url":"/topics/data-science/tutorials/sql-game/tutorial.html","topic_name":"data-science","tutorial_name":"sql-game","dir":"topics/data-science/tutorials/sql-game","symlink":null,"id":"data-science/sql-game","ref_tutorials":["<p>This is not a tutorial like most GTN content but a fun exercise for you to play around and learn a bit about SQL in a more ‘practical’, and hopefully re-inforce the skills you covered in Basic and Advanced SQL skills. It makes use of the <a href=\"https://github.com/NUKnightLab/sql-mysteries\">NUKnightLab/sql-mysteries</a> SQL murder mystery project and released under open licenses:</p>\n\n<blockquote class=\"comment\">\n  <comment-title>Source</comment-title>\n  <p>Original code for NUKnightLab/sql-mysteries is released under the MIT License.\nOriginal text and other content is released under Creative Commons CC BY-SA 4.0.</p>\n</blockquote>\n\n<p>Download the database and connector:</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\"># This preamble sets up the sql \"magic\" for jupyter. Use %%sql in your cells to write sql!\n</span><span class=\"err\">!</span><span class=\"n\">python3</span> <span class=\"o\">-</span><span class=\"n\">m</span> <span class=\"n\">pip</span> <span class=\"n\">install</span> <span class=\"n\">ipython</span><span class=\"o\">-</span><span class=\"n\">sql</span> <span class=\"n\">sqlalchemy</span>\n<span class=\"err\">!</span><span class=\"n\">wget</span> <span class=\"o\">-</span><span class=\"n\">c</span> <span class=\"n\">https</span><span class=\"p\">:</span><span class=\"o\">//</span><span class=\"n\">github</span><span class=\"p\">.</span><span class=\"n\">com</span><span class=\"o\">/</span><span class=\"n\">NUKnightLab</span><span class=\"o\">/</span><span class=\"n\">sql</span><span class=\"o\">-</span><span class=\"n\">mysteries</span><span class=\"o\">/</span><span class=\"n\">raw</span><span class=\"o\">/</span><span class=\"n\">master</span><span class=\"o\">/</span><span class=\"n\">sql</span><span class=\"o\">-</span><span class=\"n\">murder</span><span class=\"o\">-</span><span class=\"n\">mystery</span><span class=\"p\">.</span><span class=\"n\">db</span>\n</code></pre></div></div>\n\n<p>Setup the database connection:</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">import</span> <span class=\"n\">sqlalchemy</span>\n<span class=\"n\">engine</span> <span class=\"o\">=</span> <span class=\"n\">sqlalchemy</span><span class=\"p\">.</span><span class=\"nf\">create_engine</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">sqlite:///sql-murder-mystery.db</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n<span class=\"o\">%</span><span class=\"n\">load_ext</span> <span class=\"n\">sql</span>\n<span class=\"o\">%</span><span class=\"n\">sql</span> <span class=\"n\">sqlite</span><span class=\"p\">:</span><span class=\"o\">///</span><span class=\"n\">sql</span><span class=\"o\">-</span><span class=\"n\">murder</span><span class=\"o\">-</span><span class=\"n\">mystery</span><span class=\"p\">.</span><span class=\"n\">db</span>\n<span class=\"o\">%</span><span class=\"n\">config</span> <span class=\"n\">SqlMagic</span><span class=\"p\">.</span><span class=\"n\">displaycon</span><span class=\"o\">=</span><span class=\"bp\">False</span>\n</code></pre></div></div>\n\n<h2 id=\"tables\">Tables</h2>\n\n<p>Which tables are available to you? What columns do they contain? Here’s a handy reference for you:</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">import</span> <span class=\"n\">pandas</span> <span class=\"k\">as</span> <span class=\"n\">pd</span>\n<span class=\"kn\">from</span> <span class=\"n\">sqlalchemy</span> <span class=\"kn\">import</span> <span class=\"n\">MetaData</span>\n<span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"nc\">MetaData</span><span class=\"p\">()</span>\n<span class=\"n\">m</span><span class=\"p\">.</span><span class=\"nf\">reflect</span><span class=\"p\">(</span><span class=\"n\">engine</span><span class=\"p\">)</span>\n<span class=\"n\">results</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n<span class=\"k\">for</span> <span class=\"n\">table</span> <span class=\"ow\">in</span> <span class=\"n\">m</span><span class=\"p\">.</span><span class=\"n\">tables</span><span class=\"p\">.</span><span class=\"nf\">values</span><span class=\"p\">():</span>\n    <span class=\"n\">results</span><span class=\"p\">.</span><span class=\"nf\">append</span><span class=\"p\">([</span><span class=\"n\">table</span><span class=\"p\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"sh\">'</span><span class=\"s\">, </span><span class=\"sh\">'</span><span class=\"p\">.</span><span class=\"nf\">join</span><span class=\"p\">([</span><span class=\"n\">c</span><span class=\"p\">.</span><span class=\"n\">name</span> <span class=\"k\">for</span> <span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">table</span><span class=\"p\">.</span><span class=\"n\">c</span><span class=\"p\">])])</span>\n<span class=\"n\">pd</span><span class=\"p\">.</span><span class=\"nf\">set_option</span><span class=\"p\">(</span><span class=\"sh\">'</span><span class=\"s\">display.max_colwidth</span><span class=\"sh\">'</span><span class=\"p\">,</span> <span class=\"bp\">None</span><span class=\"p\">)</span>\n<span class=\"n\">pd</span><span class=\"p\">.</span><span class=\"nc\">DataFrame</span><span class=\"p\">(</span><span class=\"n\">results</span><span class=\"p\">,</span> <span class=\"n\">columns</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"sh\">\"</span><span class=\"s\">Table</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">Columns</span><span class=\"sh\">\"</span><span class=\"p\">])</span>\n</code></pre></div></div>\n\n<h2 id=\"the-search\">The search!</h2>\n\n<p>Begin your search for the truth</p>\n\n<blockquote class=\"quote\">\n  <p>A crime has taken place and the police are both useless <em>and</em> corrupt and it\nis up to you and your community to solve the mystery. They failed to secure\ntheir database, and now their crime scene reports are public, it is time to\nfigure out who the murderer was.</p>\n\n  <p>You know that the crime was a <strong>murder</strong> that occurred sometime on <strong>Jan.15,\n2018</strong> and that it took place in <strong>SQL City</strong>.</p>\n\n  <p>All the clues to this mystery are buried in a huge database, and you need to\nuse SQL to navigate through this vast network of information. Your first step\nto solving the mystery is to retrieve the corresponding crime scene report\nfrom the police department’s database. From there, you can use your SQL\nskills to find the murderer.</p>\n</blockquote>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"o\">%%</span><span class=\"n\">sql</span>\n<span class=\"n\">select</span> <span class=\"o\">*</span> <span class=\"k\">from</span> <span class=\"n\">crime_scene_report</span> <span class=\"n\">limit</span> <span class=\"mi\">8</span><span class=\"p\">;</span>\n</code></pre></div></div>\n\n<p>Try using the ‘Insert → Cell Below’ functionality to keep track of important query results as you go!</p>\n\n<h2 id=\"solution\">Solution</h2>\n\n<p>Write the following queries in your SQL environment to check whether you’ve found the right murderer:</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"o\">%%</span><span class=\"n\">sql</span>\n<span class=\"n\">INSERT</span> <span class=\"n\">INTO</span> <span class=\"n\">solution</span> <span class=\"nc\">VALUES </span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">Insert the name of the person you found here</span><span class=\"sh\">\"</span><span class=\"p\">);</span>\n<span class=\"n\">SELECT</span> <span class=\"n\">value</span> <span class=\"n\">FROM</span> <span class=\"n\">solution</span><span class=\"p\">;</span>\n</code></pre></div></div>\n"],"ref_slides":[],"hands_on":true,"slides":false,"mod_date":"2023-11-21 13:51:43 +0000","pub_date":"2021-10-11 14:22:29 +0000","version":8,"api":"https://training.galaxyproject.org/training-material/api/topics/data-science/tutorials/sql-game/tutorial.json","tools":[],"supported_servers":{"exact":[],"inexact":[{"name":"UseGalaxy.eu","url":"https://usegalaxy.eu","id":"eu","human":"Galaxy Europe","usegalaxy":true},{"name":"UseGalaxy.org","url":"https://usegalaxy.org","id":"us","human":"Galaxy Main","usegalaxy":true},{"name":"UseGalaxy.org.au","url":"https://usegalaxy.org.au","id":"au","human":"Galaxy Australia","usegalaxy":true},{"name":"UseGalaxy.fr","url":"https://usegalaxy.fr","id":"fr","human":"Galaxy France","usegalaxy":true}]},"topic_name_human":"Foundations of Data Science","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools: []\n","tours":false,"video":false,"slides_recordings":false,"translations":{"tutorial":[],"slides":[],"video":false},"type":"tutorial","contributors":[{"name":"NU Knight Lab","joined":"2021-10","id":"NUKnightLab","url":"https://training.galaxyproject.org/training-material/api/contributors/NUKnightLab.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/NUKnightLab/"},{"name":"Helena Rasche","orcid":"0000-0001-9760-8992","maintainer_contact":"gitter","matrix":"hexylena:matrix.org","joined":"2017-09","elixir_node":"nl","affiliations":["gallantries","by-covid","erasmusmc","elixir-europe","elixir-converge"],"former_affiliations":["deNBI","avans-atgm","uni-freiburg"],"contact_for_training":false,"location":{"country":"NL","lat":51.91,"lon":4.46},"id":"hexylena","url":"https://training.galaxyproject.org/training-material/api/contributors/hexylena.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/hexylena/"},{"name":"Gallantries: Bridging Training Communities in Life Science, Environment and Health","short_name":"Gallantries","start_date":"2020-09-01","end_date":"2023-09-30","joined":"2020-09","avatar":"https://gallantries.github.io/assets/images/gallantries-logo.png","github":false,"funder":true,"url":"https://training.galaxyproject.org/training-material/api/funders/gallantries.json","funder_name":"Erasmus+ Programme","funding_id":"2020-1-NL01-KA203-064717","funding_system":"erasmusplus","funding_statement":"This project (<a href=\"https://erasmus-plus.ec.europa.eu/projects/search/details/2020-1-NL01-KA203-064717\"><code class=\"language-plaintext highlighter-rouge\">2020-1-NL01-KA203-064717</code></a>) is funded with the support of the Erasmus+ programme of the European Union. Their funding has supported a large number of tutorials within the GTN across a wide array of topics.\n<img src=\"https://gallantries.github.io/assets/images/logosbeneficaireserasmusright_en.jpg\" alt=\"eu flag with the text: with the support of the erasmus programme of the european union\" />\n<img src=\"https://www.erasmusplus.nl/assets/images/logo.png\" alt=\"erasmus plus logo\" />","members":["abretaud","bebatut","colineroyaux","fpsom","hexylena","shiltemann","yvanlebras"],"id":"gallantries","page":"https://training.galaxyproject.org/training-material/hall-of-fame/gallantries/"},{"name":"Avans Hogeschool","joined":"2020-11","url":"https://training.galaxyproject.org/training-material/api/organisations/avans-atgm.json","avatar":"/training-material/shared/images/logo-avans.png","members":["bazante1"],"former_members":["dirowa","hexylena"],"id":"avans-atgm","page":"https://training.galaxyproject.org/training-material/hall-of-fame/avans-atgm/"}]}