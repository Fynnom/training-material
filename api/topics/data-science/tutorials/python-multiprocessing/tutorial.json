{"layout":"tutorial_hands_on","title":"Python - Multiprocessing","level":"Advanced","requirements":[],"follow_up_training":[],"questions":["How can I parallelize code to make it run faster","What code is, or is not, a prime target for parallelisation"],"objectives":["Understanding how to paralellise code to make it run faster.","Identifying how to decompose code into a parallel unit."],"time_estimation":"30M","key_points":["Code go brrrt."],"subtopic":"python-modular","contributions":{"authorship":["hexylena"],"editing":["dirowa","bazante1"],"funding":["avans-atgm"]},"priority":20,"notebook":{"language":"python","pyolite":true},"abbreviations":{"GIL":"Global Interpreter Lock"},"js_requirements":{"mathjax":null,"mermaid":false},"short_id":"T00095","url":"/topics/data-science/tutorials/python-multiprocessing/tutorial.html","topic_name":"data-science","tutorial_name":"python-multiprocessing","dir":"topics/data-science/tutorials/python-multiprocessing","symlink":null,"id":"data-science/python-multiprocessing","ref_tutorials":["<p>This tutorial will introduce you to the basics of Threads and Processes in\nPython and how you can use them to parallelise your code.</p>\n\n<blockquote class=\"agenda\">\n  <agenda-title></agenda-title>\n\n  <p>In this tutorial, we will cover:</p>\n\n<ol id=\"markdown-toc\">\n  <li><a href=\"#threads-vs-processes\" id=\"markdown-toc-threads-vs-processes\">Threads vs Processes</a></li>\n  <li><a href=\"#pools--paralellism\" id=\"markdown-toc-pools--paralellism\">Pools &amp; Paralellism</a></li>\n  <li><a href=\"#when-to-parallelise\" id=\"markdown-toc-when-to-parallelise\">When to parallelise</a></li>\n  <li><a href=\"#sizing-your-pool\" id=\"markdown-toc-sizing-your-pool\">Sizing your Pool</a></li>\n  <li><a href=\"#threads\" id=\"markdown-toc-threads\">Threads</a></li>\n</ol>\n\n</blockquote>\n\n<h2 id=\"threads-vs-processes\">Threads vs Processes</h2>\n\n<p>For many languages, threads can be extremely efficient, as they are rather light weight and don’t require many resources to create new threads. “Threads are cheap”. However Python has a major limitation with the Global Interpreter Lock (GIL). Only one thread can be executing at once, whether it’s the main thread, or one of the others you’ve spawned. So we look to alternative concurrency mechanisms like processes for sharing the load across multiple CPU cores.</p>\n\n<p>For <strong>threads</strong>, if you are doing “lightweight” work like fetching data from the web where a lot of time is spent waiting for the server to respond, but very little computational work within Python is required, then threads are a great fit!</p>\n\n<p>However if you are doing computationally intensive work (imagine calculating prime numbers or similar complex tasks) then each thread will be contending for CPU time. Python is a single processes and can only have one thread running at a time due to the <abbr title=\"Global Interpreter Lock\">GIL</abbr>. So it will switch between multiple threads and try and make progress on each, but it cannot execute them truly simultaneously. Here we need to switch to processes.</p>\n\n<p><strong>Processes</strong> are relatively heavier weight as they essentially start a new python process, before executing the individual function. This is part of the reason for a “Pool”, to amortise the expensive cost of setting up processes, before allowing them to do a lot of work quickly. Here each process can be using it’s own CPU core fully, and thus make more sense for computationally expensive tasks.</p>\n\n<p>Let’s dive straight into an example: here we’re using the <code class=\"language-plaintext highlighter-rouge\">multiprocessing</code> library which uses processes and is relatively simple to understand:</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">from</span> <span class=\"n\">multiprocessing</span> <span class=\"kn\">import</span> <span class=\"n\">Pool</span>\n</code></pre></div></div>\n\n<p>Importantly we should define a <em>pure</em> function, i.e. a function that only works on the inputs available to it, and doesn’t use or affect global state (i.e.  without side effects). (printing is ok.)</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">def</span> <span class=\"nf\">f</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">x</span> <span class=\"o\">*</span> <span class=\"n\">x</span>\n</code></pre></div></div>\n\n<p>We spawn a process Pool, with 5 processes And then use the convenient map\nfunction to send inputs multiply to the specified function <code class=\"language-plaintext highlighter-rouge\">f</code></p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">with</span> <span class=\"nc\">Pool</span><span class=\"p\">(</span><span class=\"mi\">5</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">p</span><span class=\"p\">:</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">p</span><span class=\"p\">.</span><span class=\"nf\">map</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"p\">,</span> <span class=\"nf\">range</span><span class=\"p\">(</span><span class=\"mi\">10</span><span class=\"p\">)))</span>\n</code></pre></div></div>\n\n<p>This will create 5 new python processes, and they will begin to consume tasks from the queue as quickly as they can. As soon as a process has finished handling one task, it will begin work on the next task.</p>\n\n<h2 id=\"pools--paralellism\">Pools &amp; Paralellism</h2>\n\n<p>Let’s do another example, the classic “print time”, to see how the threads are actually executing across 4 processes.</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">import</span> <span class=\"n\">time</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">g</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">):</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">time</span><span class=\"p\">.</span><span class=\"nf\">time</span><span class=\"p\">())</span>\n    <span class=\"n\">time</span><span class=\"p\">.</span><span class=\"nf\">sleep</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n\n<span class=\"k\">with</span> <span class=\"nc\">Pool</span><span class=\"p\">(</span><span class=\"mi\">4</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">p</span><span class=\"p\">:</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">p</span><span class=\"p\">.</span><span class=\"nf\">map</span><span class=\"p\">(</span><span class=\"n\">g</span><span class=\"p\">,</span> <span class=\"nf\">range</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">)))</span>\n</code></pre></div></div>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n  <p>What did you see here?</p>\n\n  <p>Was it clear and easy to read?</p>\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n    <p>It prints four timestamps immediately, all around the same time. Then one second later it prints 4 more, and one second later, a final four.\nOur Pool of 4 processes processes the function the maximal amount of times possible concurrently. Once each of those functions returns, then it can move on to processing the next tasks.\nThis is precisely the situation of e.g. 4 queues at the grocery; as soon as one customer is processed, they immediately begin on the next, until no more remain.</p>\n\n    <p>You might also see a situation where the numbers are interleaved in a completely unreadable way. Here they write immediately, but there is no synchronisation or limiting on who can write at one time, and the result is a mess of interleaved print statements.</p>\n  </blockquote>\n</blockquote>\n\n<h2 id=\"when-to-parallelise\">When to parallelise</h2>\n\n<p>Some guidelines:</p>\n\n<ul>\n  <li>When you can isolate a pure function</li>\n  <li>That do not require shared state, nor ordering</li>\n  <li>That do not modify global state (pure!)</li>\n  <li>That take a significant amount of time, relative to the time it takes to rewrite your code to support parallelising.</li>\n</ul>\n\n<p>Some common examples of this are slow tasks like requesting data from multiple websites, e.g. using the <code class=\"language-plaintext highlighter-rouge\">requests</code> library. Or doing some computationally expensive calculation. The last point however is especially important, as it is not always trivial to rearchitect your code to handle being spread across multiple threads or processes.</p>\n\n<p>Let’s parallelize this program which fetches some metadata from multiple Galaxy servers:</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">import</span> <span class=\"n\">requests</span>\n<span class=\"kn\">import</span> <span class=\"n\">time</span>\n\n<span class=\"n\">servers</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n    <span class=\"sh\">\"</span><span class=\"s\">https://usegalaxy.org</span><span class=\"sh\">\"</span><span class=\"p\">,</span>\n    <span class=\"sh\">\"</span><span class=\"s\">https://usegalaxy.org.au</span><span class=\"sh\">\"</span><span class=\"p\">,</span>\n    <span class=\"sh\">\"</span><span class=\"s\">https://usegalaxy.eu</span><span class=\"sh\">\"</span><span class=\"p\">,</span>\n    <span class=\"sh\">\"</span><span class=\"s\">https://usegalaxy.fr</span><span class=\"sh\">\"</span><span class=\"p\">,</span>\n    <span class=\"sh\">\"</span><span class=\"s\">https://usegalaxy.be</span><span class=\"sh\">\"</span><span class=\"p\">,</span>\n<span class=\"p\">]</span>\n\n<span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n<span class=\"n\">start</span> <span class=\"o\">=</span> <span class=\"n\">time</span><span class=\"p\">.</span><span class=\"nf\">time</span><span class=\"p\">()</span>\n<span class=\"k\">for</span> <span class=\"n\">url</span> <span class=\"ow\">in</span> <span class=\"n\">servers</span><span class=\"p\">:</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">url</span><span class=\"p\">)</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"n\">requests</span><span class=\"p\">.</span><span class=\"nf\">get</span><span class=\"p\">(</span><span class=\"n\">url</span> <span class=\"o\">+</span> <span class=\"sh\">\"</span><span class=\"s\">/api/version</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"n\">timeout</span><span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">).</span><span class=\"nf\">json</span><span class=\"p\">()</span>\n        <span class=\"n\">data</span><span class=\"p\">[</span><span class=\"n\">url</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">response</span><span class=\"p\">[</span><span class=\"sh\">'</span><span class=\"s\">version_major</span><span class=\"sh\">'</span><span class=\"p\">]</span>\n    <span class=\"k\">except</span> <span class=\"n\">requests</span><span class=\"p\">.</span><span class=\"n\">exceptions</span><span class=\"p\">.</span><span class=\"n\">ConnectTimeout</span><span class=\"p\">:</span>\n        <span class=\"n\">data</span><span class=\"p\">[</span><span class=\"n\">url</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"bp\">None</span>\n    <span class=\"k\">except</span> <span class=\"n\">requests</span><span class=\"p\">.</span><span class=\"n\">exceptions</span><span class=\"p\">.</span><span class=\"n\">ReadTimeout</span><span class=\"p\">:</span>\n        <span class=\"n\">data</span><span class=\"p\">[</span><span class=\"n\">url</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"bp\">None</span>\n\n\n<span class=\"c1\"># How long did it take to execute\n</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">time</span><span class=\"p\">.</span><span class=\"nf\">time</span><span class=\"p\">()</span> <span class=\"o\">-</span> <span class=\"n\">start</span><span class=\"p\">)</span>\n\n<span class=\"k\">for</span> <span class=\"n\">k</span><span class=\"p\">,</span> <span class=\"n\">v</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"p\">.</span><span class=\"nf\">items</span><span class=\"p\">():</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">k</span><span class=\"p\">,</span> <span class=\"n\">v</span><span class=\"p\">)</span>\n</code></pre></div></div>\n\n<p>If we look at this, we can see one hot spot in the code, where it’s quite slow, requesting data from a remote server. If we want to speed this up we’ll need to isolate it into a pure function. Here we can see a possibility for a function that requests the data, with the input of the server url, and output of the version.</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">def</span> <span class=\"nf\">fetch_version</span><span class=\"p\">(</span><span class=\"n\">server_url</span><span class=\"p\">):</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"n\">requests</span><span class=\"p\">.</span><span class=\"nf\">get</span><span class=\"p\">(</span><span class=\"n\">server_url</span> <span class=\"o\">+</span> <span class=\"sh\">\"</span><span class=\"s\">/api/version</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"n\">timeout</span><span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">).</span><span class=\"nf\">json</span><span class=\"p\">()</span>\n        <span class=\"k\">return</span> <span class=\"n\">response</span><span class=\"p\">[</span><span class=\"sh\">'</span><span class=\"s\">version_major</span><span class=\"sh\">'</span><span class=\"p\">]</span>\n    <span class=\"k\">except</span> <span class=\"n\">requests</span><span class=\"p\">.</span><span class=\"n\">exceptions</span><span class=\"p\">.</span><span class=\"n\">ConnectTimeout</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"bp\">None</span>\n    <span class=\"k\">except</span> <span class=\"n\">requests</span><span class=\"p\">.</span><span class=\"n\">exceptions</span><span class=\"p\">.</span><span class=\"n\">ReadTimeout</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"bp\">None</span>\n</code></pre></div></div>\n\n<p>This now lacks side effects (like modifying the <code class=\"language-plaintext highlighter-rouge\">data</code> object), and can be used in a map statement.</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">start</span> <span class=\"o\">=</span> <span class=\"n\">time</span><span class=\"p\">.</span><span class=\"nf\">time</span><span class=\"p\">()</span>\n<span class=\"k\">with</span> <span class=\"nc\">Pool</span><span class=\"p\">(</span><span class=\"mi\">4</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">p</span><span class=\"p\">:</span>\n    <span class=\"n\">versions</span> <span class=\"o\">=</span> <span class=\"n\">p</span><span class=\"p\">.</span><span class=\"nf\">map</span><span class=\"p\">(</span><span class=\"n\">fetch_version</span><span class=\"p\">,</span> <span class=\"n\">servers</span><span class=\"p\">)</span>\n    <span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"nf\">dict</span><span class=\"p\">(</span><span class=\"nf\">zip</span><span class=\"p\">(</span><span class=\"n\">servers</span><span class=\"p\">,</span> <span class=\"n\">versions</span><span class=\"p\">))</span>\n<span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">time</span><span class=\"p\">.</span><span class=\"nf\">time</span><span class=\"p\">()</span> <span class=\"o\">-</span> <span class=\"n\">start</span><span class=\"p\">)</span>\n\n<span class=\"k\">for</span> <span class=\"n\">k</span><span class=\"p\">,</span> <span class=\"n\">v</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"p\">.</span><span class=\"nf\">items</span><span class=\"p\">():</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">k</span><span class=\"p\">,</span> <span class=\"n\">v</span><span class=\"p\">)</span>\n</code></pre></div></div>\n\n<p>Same result, and now this is a lot more efficient!</p>\n\n<h2 id=\"sizing-your-pool\">Sizing your Pool</h2>\n\n<p>This depends largely on profilling your code or knowing the performance characteristics of it. In the above example, there is very little computation work executed as part of this function, it’s essentially all network I/O, no CPU or memory usage.</p>\n\n<p>As such, we can probably set our pool size to be very large, a multiple of our systems’ processor count. It will spawn many processes that do very little.</p>\n\n<p>If however this were a more complicated task (e.g. calculating a large number, machine learning, etc.), then we might wish to set our pool size to the number of CPUs - 1, as each process will potentially consume it’s CPU allocation completely, and we wish to have some left over for the managing program and any other work going on, on the system.</p>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n  <p>Try changing the pool size and see what effect it has on runtime. Start from a value of 1, and go up to 5, the number of servers in our list.</p>\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n    <p>Given the small sample size (5 servers), and the variability of response times (in local testing between 3-8 seconds for the single-pool version), you can see varying results but <em>generally</em> it should decrease as the pool size increases. However, sometimes you will see the Pool=5 version take the same or longer than Pool=4.</p>\n\n    <p>Especially in the case that 1 server (or 1 request one time) dominates the request time, this can “hide” the improvements as the others complete quickly on the remaining N-1 processes.</p>\n  </blockquote>\n</blockquote>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">results</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n<span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"nf\">range</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">6</span><span class=\"p\">):</span>\n    <span class=\"n\">start</span> <span class=\"o\">=</span> <span class=\"n\">time</span><span class=\"p\">.</span><span class=\"nf\">time</span><span class=\"p\">()</span>\n    <span class=\"k\">with</span> <span class=\"nc\">Pool</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">p</span><span class=\"p\">:</span>\n        <span class=\"n\">versions</span> <span class=\"o\">=</span> <span class=\"n\">p</span><span class=\"p\">.</span><span class=\"nf\">map</span><span class=\"p\">(</span><span class=\"n\">fetch_version</span><span class=\"p\">,</span> <span class=\"n\">servers</span><span class=\"p\">)</span>\n        <span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"nf\">dict</span><span class=\"p\">(</span><span class=\"nf\">zip</span><span class=\"p\">(</span><span class=\"n\">servers</span><span class=\"p\">,</span> <span class=\"n\">versions</span><span class=\"p\">))</span>\n    <span class=\"n\">duration</span> <span class=\"o\">=</span> <span class=\"n\">time</span><span class=\"p\">.</span><span class=\"nf\">time</span><span class=\"p\">()</span> <span class=\"o\">-</span> <span class=\"n\">start</span>\n    <span class=\"n\">results</span><span class=\"p\">.</span><span class=\"nf\">append</span><span class=\"p\">(</span><span class=\"n\">duration</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Plot it\n</span><span class=\"kn\">import</span> <span class=\"n\">matplotlib.pyplot</span> <span class=\"k\">as</span> <span class=\"n\">plt</span>\n<span class=\"n\">fig</span><span class=\"p\">,</span> <span class=\"n\">ax</span> <span class=\"o\">=</span> <span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"nf\">subplots</span><span class=\"p\">()</span>\n<span class=\"n\">ax</span><span class=\"p\">.</span><span class=\"nf\">plot</span><span class=\"p\">(</span><span class=\"nf\">range</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">6</span><span class=\"p\">),</span> <span class=\"n\">results</span><span class=\"p\">)</span>\n<span class=\"n\">ax</span><span class=\"p\">.</span><span class=\"nf\">set</span><span class=\"p\">(</span><span class=\"n\">ylabel</span><span class=\"o\">=</span><span class=\"sh\">'</span><span class=\"s\">time (s)</span><span class=\"sh\">'</span><span class=\"p\">,</span> <span class=\"n\">xlabel</span><span class=\"o\">=</span><span class=\"sh\">'</span><span class=\"s\">Pool Size</span><span class=\"sh\">'</span><span class=\"p\">,</span> <span class=\"n\">title</span><span class=\"o\">=</span><span class=\"sh\">'</span><span class=\"s\">Pool size vs runtime</span><span class=\"sh\">'</span><span class=\"p\">)</span>\n<span class=\"n\">ax</span><span class=\"p\">.</span><span class=\"nf\">grid</span><span class=\"p\">()</span>\n<span class=\"c1\"># Uncomment if your notebook cannot display images inline.\n# fig.savefig(\"pool-vs-runtime.png\")\n</span><span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"nf\">show</span><span class=\"p\">()</span>\n</code></pre></div></div>\n\n<p>You might see a result similar to the following:</p>\n\n<p><a href=\"../../images/pool-vs-runtime.png\" rel=\"noopener noreferrer\"><img src=\"../../images/pool-vs-runtime.png\" alt=\"graph of the above, showing a decrease in runtime from 2.6 seconds to approximately 1.1 seconds as the pool size increases from 1 to 5. As the pool size increases from 1-2 there is a large improvement, but as it increases from 4-5 the improvement is very small, on the order of milliseconds.\" width=\"640\" height=\"480\" loading=\"lazy\" /></a></p>\n\n<h2 id=\"threads\">Threads</h2>\n\n<p>Let’s convert our previous example from processes to threads, as processes aren’t strictly necessary for such a light weight use case as fetching data from the internet where you’re blocking on network rather than CPU resources.</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">import</span> <span class=\"n\">multiprocessing.pool</span>\n<span class=\"kn\">import</span> <span class=\"n\">requests</span>\n<span class=\"kn\">import</span> <span class=\"n\">time</span>\n\n<span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n<span class=\"n\">start</span> <span class=\"o\">=</span> <span class=\"n\">time</span><span class=\"p\">.</span><span class=\"nf\">time</span><span class=\"p\">()</span>\n\n<span class=\"n\">pool</span> <span class=\"o\">=</span> <span class=\"n\">multiprocessing</span><span class=\"p\">.</span><span class=\"n\">pool</span><span class=\"p\">.</span><span class=\"nc\">ThreadPool</span><span class=\"p\">(</span><span class=\"n\">processes</span><span class=\"o\">=</span><span class=\"mi\">4</span><span class=\"p\">)</span>\n<span class=\"n\">results</span> <span class=\"o\">=</span> <span class=\"n\">pool</span><span class=\"p\">.</span><span class=\"nf\">map</span><span class=\"p\">(</span><span class=\"n\">fetch_version</span><span class=\"p\">,</span> <span class=\"n\">servers</span><span class=\"p\">,</span> <span class=\"n\">chunksize</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"n\">k</span><span class=\"p\">:</span> <span class=\"n\">v</span> <span class=\"nf\">for </span><span class=\"p\">(</span><span class=\"n\">k</span><span class=\"p\">,</span> <span class=\"n\">v</span><span class=\"p\">)</span> <span class=\"ow\">in</span> <span class=\"nf\">zip</span><span class=\"p\">(</span><span class=\"n\">servers</span><span class=\"p\">,</span> <span class=\"n\">results</span><span class=\"p\">)}</span>\n<span class=\"n\">pool</span><span class=\"p\">.</span><span class=\"nf\">close</span><span class=\"p\">()</span>\n\n<span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">time</span><span class=\"p\">.</span><span class=\"nf\">time</span><span class=\"p\">()</span> <span class=\"o\">-</span> <span class=\"n\">start</span><span class=\"p\">)</span>\n\n<span class=\"k\">for</span> <span class=\"n\">k</span><span class=\"p\">,</span> <span class=\"n\">v</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"p\">.</span><span class=\"nf\">items</span><span class=\"p\">():</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">k</span><span class=\"p\">,</span> <span class=\"n\">v</span><span class=\"p\">)</span>\n</code></pre></div></div>\n\n<p>This is a bit more complicated to write, but again, if you’re not blocking on CPU resources, then this is potentially approximately as effecient as thread pools.</p>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n  <p>What result did you get? Was it slower, faster, or about the same as processes?</p>\n</blockquote>\n"],"ref_slides":[],"video_library":{"tutorial":null,"slides":null,"demo":null,"both":null,"session":null},"hands_on":true,"slides":false,"mod_date":"2023-11-15 11:27:38 +0000","pub_date":"2022-10-19 13:04:07 +0000","version":8,"api":"https://training.galaxyproject.org/training-material/api/topics/data-science/tutorials/python-multiprocessing/tutorial.json","tools":[],"supported_servers":{"exact":[],"inexact":[{"name":"UseGalaxy.eu","url":"https://usegalaxy.eu","id":"eu","human":"Galaxy Europe","usegalaxy":true},{"name":"UseGalaxy.org","url":"https://usegalaxy.org","id":"us","human":"Galaxy Main","usegalaxy":true},{"name":"UseGalaxy.org.au","url":"https://usegalaxy.org.au","id":"au","human":"Galaxy Australia","usegalaxy":true},{"name":"UseGalaxy.fr","url":"https://usegalaxy.fr","id":"fr","human":"Galaxy France","usegalaxy":true}]},"topic_name_human":"Foundations of Data Science","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools: []\n","tours":false,"video":false,"translations":{"tutorial":[],"slides":[],"video":false},"license":"CC-BY-4.0","type":"tutorial","contributors":[{"name":"Helena Rasche","orcid":"0000-0001-9760-8992","maintainer_contact":"gitter","matrix":"hexylena:matrix.org","joined":"2017-09","elixir_node":"nl","affiliations":["gallantries","by-covid","erasmusmc","elixir-europe","elixir-converge"],"former_affiliations":["deNBI","avans-atgm","uni-freiburg"],"contact_for_training":false,"location":{"country":"NL","lat":51.91,"lon":4.46},"id":"hexylena","url":"https://training.galaxyproject.org/training-material/api/contributors/hexylena.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/hexylena/"},{"name":"Donny Vrins","joined":"2021-10","linkedin":"Donny Vrins","email":"D.vrins@live.nl","former_affiliations":["avans-atgm"],"id":"dirowa","url":"https://training.galaxyproject.org/training-material/api/contributors/dirowa.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/dirowa/"},{"name":"Bazante Sanders","joined":"2020-12","affiliations":["avans-atgm"],"id":"bazante1","url":"https://training.galaxyproject.org/training-material/api/contributors/bazante1.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/bazante1/"},{"name":"Avans Hogeschool","joined":"2020-11","url":"https://training.galaxyproject.org/training-material/api/organisations/avans-atgm.json","avatar":"/training-material/shared/images/logo-avans.png","members":["bazante1"],"former_members":["dirowa","hexylena"],"id":"avans-atgm","page":"https://training.galaxyproject.org/training-material/hall-of-fame/avans-atgm/"}]}