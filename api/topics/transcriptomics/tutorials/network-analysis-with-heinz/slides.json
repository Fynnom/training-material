{"layout":"tutorial_slides","title":"Network Analysis with Heinz","zenodo_link":"https://doi.org/10.5281/zenodo.1344105","tags":["metatranscriptomics","network analysis"],"questions":["What is metatranscriptomics","Which pathways are potentially contributing to dental caries?"],"objectives":["Learn some background knowledge about microbiome","Understand metatranscriptomics","Familiarize yourself with KEGG terminology","Understand how network(pathway) analysis works"],"time_estimation":"1h30m","key_points":["Analyzing differential expression for (meta)transcriptomics data","Validating the p-value distribution of the differential expression analysis","Finding the most differentially expressed subnetwork in a gene functional network using Heinz","Interpreting the pinpointed subnetwork"],"contributors":["sanneabeln","ChaoZhang123"],"js_requirements":{"mathjax":13295,"mermaid":false},"short_id":"S00096","url":"/topics/transcriptomics/tutorials/network-analysis-with-heinz/slides.html","topic_name":"transcriptomics","tutorial_name":"network-analysis-with-heinz","dir":"topics/transcriptomics/tutorials/network-analysis-with-heinz","symlink":null,"id":"transcriptomics/network-analysis-with-heinz","ref_tutorials":["<h1 id=\"overview\">Overview</h1>\n\n<p>The human microbiome plays a key role in health and disease. Thanks to comparative metatranscriptomics,\nthe cellular functions that are deregulated by the microbiome in disease can now be computationally\nexplored. Unlike gene-centric approaches, pathway-based methods provide a systemic view of such\nfunctions; however, they typically consider each pathway in isolation and in its entirety.\nThey can therefore overlook the key differences that (i) span multiple pathways, (ii) contain\nbidirectionally deregulated components, (iii) are confined to a pathway region. To capture these\nproperties, computational methods that reach beyond the scope of predefined pathways are needed.</p>\n\n<p>In this tutorial, we will perform a network analysis using Heinz (<a href=\"https://github.com/ls-cwi/heinz\">GitHub</a>,\n<a href=\"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2718639/\">publication</a>) in Galaxy. The data comes from\nthe study <a href=\"https://academic.oup.com/bioinformatics/article/32/11/1678/2240171\">May et al.</a>,\nand we will reproduce some of the computational steps from this study with simplified data and\nparameters to speed up the analysis for the purposes of this tutorial.</p>\n\n<blockquote class=\"agenda\">\n  <agenda-title></agenda-title>\n\n  <p>In this tutorial, we will cover:</p>\n\n<ol id=\"markdown-toc\">\n  <li><a href=\"#overview\" id=\"markdown-toc-overview\">Overview</a></li>\n  <li><a href=\"#obtaining-and-preparing-data--\" id=\"markdown-toc-obtaining-and-preparing-data--\">Obtaining and preparing data  <a href=\"https://zenodo.org/badge/DOI/10.5281/zenodo.1344105.svg\" rel=\"noopener noreferrer\"><img src=\"https://zenodo.org/badge/DOI/10.5281/zenodo.1344105.svg\" alt=\"DOI. \" loading=\"lazy\" /></a></a>    <ol>\n      <li><a href=\"#understanding-our-input-data\" id=\"markdown-toc-understanding-our-input-data\">Understanding our input data</a></li>\n      <li><a href=\"#importing-the-data-into-galaxy\" id=\"markdown-toc-importing-the-data-into-galaxy\">Importing the data into Galaxy</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#differential-expression-analysis-dea-by-deseq2\" id=\"markdown-toc-differential-expression-analysis-dea-by-deseq2\">Differential Expression Analysis (DEA) by DESeq2</a>    <ol>\n      <li><a href=\"#what-is-differential-expression-analysis\" id=\"markdown-toc-what-is-differential-expression-analysis\">What is differential expression analysis?</a></li>\n      <li><a href=\"#which-tools-are-available-for-dea\" id=\"markdown-toc-which-tools-are-available-for-dea\">Which tools are available for DEA?</a></li>\n      <li><a href=\"#perform-differential-expression-analysis-dea\" id=\"markdown-toc-perform-differential-expression-analysis-dea\">Perform Differential Expression Analysis (DEA)</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#fit-a-bum-model-a-mixture-model\" id=\"markdown-toc-fit-a-bum-model-a-mixture-model\">Fit a BUM model (a mixture model)</a></li>\n  <li><a href=\"#pinpoint-the-key-pathways-with-heinz\" id=\"markdown-toc-pinpoint-the-key-pathways-with-heinz\">Pinpoint the key pathways with Heinz</a>    <ol>\n      <li><a href=\"#calculate-heinz-scores\" id=\"markdown-toc-calculate-heinz-scores\">Calculate Heinz scores</a></li>\n      <li><a href=\"#run-heinz-pinpoint-the-optimal-subnetwork\" id=\"markdown-toc-run-heinz-pinpoint-the-optimal-subnetwork\">Run Heinz: pinpoint the optimal subnetwork</a></li>\n      <li><a href=\"#visualize-the-output-visualize-the-optimal-subnetwork\" id=\"markdown-toc-visualize-the-output-visualize-the-optimal-subnetwork\">Visualize the output: visualize the optimal subnetwork</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#save-the-history-into-a-workflow\" id=\"markdown-toc-save-the-history-into-a-workflow\">Save the history into a workflow</a></li>\n</ol>\n\n</blockquote>\n\n<!--SNIPPET-->\n<blockquote class=\"comment\">   <div class=\"box-title comment-title\" id=\"comment-results-may-vary\"><i class=\"far fa-comment-dots\" aria-hidden=\"true\"></i> Comment: Results may vary</div>   <p>Your results may be slightly different from the ones presented in this tutorial due to differing versions of tools, reference data, external databases, or because of stochastic processes in the algorithms.</p> </blockquote>\n<p><!--END_SNIPPET--></p>\n\n<p>In this tutorial, we will run the Heinz workflow step by step to understand how each step works. To get an overview of what this workflow does\nand what kind of calculation is involved, view the flowchart below.</p>\n\n<p><a href=\"../../images/transcriptomics_images/flowchart-heinz.png\" rel=\"noopener noreferrer\"><img src=\"../../images/transcriptomics_images/flowchart-heinz.png\" alt=\"Heinz flowchart. \" width=\"3112\" height=\"558\" loading=\"lazy\" /></a></p>\n\n<h1 id=\"obtaining-and-preparing-data--\">Obtaining and preparing data  <a href=\"https://doi.org/10.5281/zenodo.1344105\"><a href=\"https://zenodo.org/badge/DOI/10.5281/zenodo.1344105.svg\" rel=\"noopener noreferrer\"><img src=\"https://zenodo.org/badge/DOI/10.5281/zenodo.1344105.svg\" alt=\"DOI. \" loading=\"lazy\" /></a></a></h1>\n\n<p>The study <a href=\"https://academic.oup.com/bioinformatics/article/32/11/1678/2240171\">May et al.</a> includes the computation\nsteps starting from the raw RNAseq datasets. The operations that processed raw data into the interpreted data are\nbeyond the scope of this tutorial. To learn that, please refer to the relevant topics in the Galaxy training\nmaterial. In this tutorial, we start with the interpreted data, which are KO\n(<a href=\"https://www.genome.jp/kegg/ko.html\">KEGG Orthology</a>) count data. All the data needed for this tutorial are\navailable from Zenodo.</p>\n\n<blockquote class=\"details\">\n  <details-title>Background: What is KO count?</details-title>\n\n  <p>KOs are organism-independent identifiers that group together proteins of similar biochemical functions.\nIt is a term specific to <a href=\"https://www.genome.jp/kegg/\">KEGG</a> database. It is a group concept, similar to the concept “pathway”, which\nincludes a bunch of molecules and their interactions. Take a random line in our dataset, “K01369 7” as an example, the first column represents the KO ID,\nand the second column — the numeric value is the KO counts. If we understand it by the face value, it is 7 protein molecules that are counted from our dataset as this KO “K01369”; but we usually mingle proteins with genes because we often assume that each protein corresponds to a gene, so it can be understood as 7 genes. Now we are working on the microbial RNAseq data, and the assumption is also used subconsciously.</p>\n\n</blockquote>\n\n<h2 id=\"understanding-our-input-data\">Understanding our input data</h2>\n\n<p>According to the study <a href=\"https://academic.oup.com/bioinformatics/article/32/11/1678/2240171\">May et al.</a>,\ndental caries (DC) dataset in this tutorial came from an experiment that comprised of supragingival plaque\nsamples collected from all dental surfaces of 36 individuals who had either a caries-positive (disease) or\na caries-negative (health) oral profile. Each of the 36 samples was sequenced, pre-processed and transformed\ninto KO counts. We will use these count data as the starting point to perform the network analysis.</p>\n\n<blockquote class=\"comment\">\n  <comment-title>Dataset details</comment-title>\n  <p>The count data of the 36 samples are separated into 36 files, organized into two groups:\n‘CP’ (caries-positive) and ‘CN’ (caries-negative).</p>\n</blockquote>\n\n<h2 id=\"importing-the-data-into-galaxy\">Importing the data into Galaxy</h2>\n\n<p>After knowing what our input data are like, let’s get them into Galaxy history:</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Obtaining our data</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Make sure we have an empty Galaxy history. Give it a sensible name.</p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-creating-a-new-history\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-creating-a-new-history\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Creating a new history</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p>Click the <i class=\"fas fa-plus\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">new-history</span> icon at the top of the history panel:</p>   <p><img src=\"/training-material/shared/images/history_create_new.svg\" alt=\"UI for creating new history\" /></p>   <!-- the original drawing can be found here https://docs.google.com/drawings/d/1cCBrLAo4kDGic5QyB70rRiWJAKTenTU8STsKDaLcVU8/edit?usp=sharing --> </blockquote>\n      <p><!--END_SNIPPET--></p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-renaming-a-history\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-renaming-a-history\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Renaming a history</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ol>   <li>Click on <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> (<strong>Edit</strong>) next to the history name (which by default is “Unnamed history”)</li>   <li>Type the new name</li>   <li>Click on <strong>Save</strong></li> </ol>   <p>If you do not have the <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> (<strong>Edit</strong>) next to the history name:</p>   <ol>   <li>Click on <strong>Unnamed history</strong> (or the current name of the history) (<strong>Click to rename history</strong>) at the top of your history panel</li>   <li>Type the new name</li>   <li>Press <kbd>Enter</kbd></li> </ol> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li><strong>Upload Disease Dataset</strong>\n      <ul>\n        <li>Open the file upload menu</li>\n        <li>Click on  <strong>Collection</strong> tab</li>\n        <li>Click on the <strong>Paste/Fetch data</strong> button</li>\n        <li>Copy the Zenodo links for the Disease Datasets\n          <blockquote class=\"details\">\n            <details-title>View list of Zenodo URLs for Dental Caries Dataset (Disease, CP)</details-title>\n            <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>https://zenodo.org/record/1344105/files/2241_CP_DZ_PairTo_2242.txt\nhttps://zenodo.org/record/1344105/files/2126_CP_MZ_PairTo_2125.txt\nhttps://zenodo.org/record/1344105/files/2991_CP_DZ_PairTo_2992.txt\nhttps://zenodo.org/record/1344105/files/2931_CP_DZ_PairTo_2930.txt\nhttps://zenodo.org/record/1344105/files/2284_CP_DZ_PairTo_2283.txt\nhttps://zenodo.org/record/1344105/files/2125_CP_MZ_PairTo_2126.txt\nhttps://zenodo.org/record/1344105/files/4131_CP_DZ_PairTo_4132.txt\nhttps://zenodo.org/record/1344105/files/2954_CP_DZ_PairTo_2955.txt\nhttps://zenodo.org/record/1344105/files/2170_CP_MZ_PairTo_2169.txt\nhttps://zenodo.org/record/1344105/files/2955_CP_DZ_PairTo_2954.txt\nhttps://zenodo.org/record/1344105/files/2011_CP_DZ_PairTo_2012.txt\nhttps://zenodo.org/record/1344105/files/2012_CP_DZ_PairTo_2011.txt\nhttps://zenodo.org/record/1344105/files/2269_CP_DZ_PairTo_2270.txt\nhttps://zenodo.org/record/1344105/files/3215_CP_MZ_PairTo_3214.txt\nhttps://zenodo.org/record/1344105/files/2354_CP_DZ_PairTo_2355.txt\nhttps://zenodo.org/record/1344105/files/3306_CP_DZ_PairTo_3307.txt\nhttps://zenodo.org/record/1344105/files/2061_CP_DZ_PairTo_2062.txt\nhttps://zenodo.org/record/1344105/files/2355_CP_DZ_PairTo_2354.txt\nhttps://zenodo.org/record/1344105/files/2242_CP_DZ_PairTo_2241.txt\n</code></pre></div>            </div>\n          </blockquote>\n        </li>\n        <li>Click on <strong>Start</strong> to Upload the files</li>\n        <li>Click <strong>Build</strong> once upload has completed</li>\n        <li>Enter <strong>Name</strong>: <code class=\"language-plaintext highlighter-rouge\">CP</code></li>\n        <li>Click <strong>Create list</strong> to make the collection</li>\n      </ul>\n    </li>\n    <li><strong>Upload control (healthy) datasets</strong>\n      <ul>\n        <li>Repeat the previous steps with the samples from healthy individuals:\n          <blockquote class=\"details\">\n            <details-title>View list of Zenodo URLs for Dental Caries Dataset (Healthy, CN)</details-title>\n            <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>https://zenodo.org/record/1344105/files/2310_CN_DZ_PairTo_2309.txt\nhttps://zenodo.org/record/1344105/files/2062_CN_DZ_PairTo_2061.txt\nhttps://zenodo.org/record/1344105/files/2191_CN_MZ_PairTo_2192.txt\nhttps://zenodo.org/record/1344105/files/2052_CN_MZ_PairTo_2051.txt\nhttps://zenodo.org/record/1344105/files/2051_CN_MZ_PairTo_2052.txt\nhttps://zenodo.org/record/1344105/files/2192_CN_MZ_PairTo_2191.txt\nhttps://zenodo.org/record/1344105/files/2234_CN_DZ_PairTo_2233.txt\nhttps://zenodo.org/record/1344105/files/2233_CN_DZ_PairTo_2234.txt\nhttps://zenodo.org/record/1344105/files/2270_CN_DZ_PairTo_2269.txt\nhttps://zenodo.org/record/1344105/files/2225_CN_MZ_PairTo_2226.txt\nhttps://zenodo.org/record/1344105/files/4132_CN_DZ_PairTo_4131.txt\nhttps://zenodo.org/record/1344105/files/2309_CN_DZ_PairTo_2310.txt\nhttps://zenodo.org/record/1344105/files/2992_CN_DZ_PairTo_2991.txt\nhttps://zenodo.org/record/1344105/files/3214_CN_MZ_PairTo_3215.txt\nhttps://zenodo.org/record/1344105/files/2169_CN_MZ_PairTo_2170.txt\nhttps://zenodo.org/record/1344105/files/2930_CN_DZ_PairTo_2931.txt\nhttps://zenodo.org/record/1344105/files/3307_CN_DZ_PairTo_3306.txt\n</code></pre></div>            </div>\n          </blockquote>\n        </li>\n        <li>Name this collection: <code class=\"language-plaintext highlighter-rouge\">CN</code></li>\n      </ul>\n\n      <blockquote class=\"question\">\n        <question-title></question-title>\n\n        <ol>\n          <li>How many samples do you have in our disease collection (CP)? How many healthy samples (CN)?</li>\n          <li>How many columns in each file? What are these columns?</li>\n        </ol>\n\n        <blockquote class=\"solution\">\n          <solution-title></solution-title>\n\n          <ol>\n            <li>You should have 19 samples in the disease collection (CP), and 17 in the negative collection (CN).</li>\n            <li>There are two columns, one is the KO IDs, the other is the count.</li>\n          </ol>\n\n        </blockquote>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"tip\">\n  <tip-title>Creating a collection from files already in your history</tip-title>\n\n  <p><em>Dataset collections</em> enables us to easily run tools on multiple datasets at once, you probably\nhave done that in the file upload menu using the <code class=\"language-plaintext highlighter-rouge\">Collection</code> tab. If not, you can still create\n<em>dataset collections</em> manually.</p>\n\n  <blockquote class=\"hands_on\">\n    <hands-on-title>Manually organizing our data into a collection</hands-on-title>\n\n    <p>If you have all the datasets in the history, but they are not organized into a collection yet,\nyou can follow these steps to create a collection:</p>\n\n    <ol>\n      <li>\n        <p>Click on the <strong>checkmark icon</strong> at top of your history.\n  <a href=\"../../../../shared/images/history_menu_buttons2.png\" rel=\"noopener noreferrer\"><img src=\"../../../../shared/images/history_menu_buttons2.png\" alt=\"Checkmark icon in history menu. \" width=\"75\" height=\"33\" loading=\"lazy\" /></a></p>\n      </li>\n      <li>\n        <p>Select all the files whose name contains <code class=\"language-plaintext highlighter-rouge\">CP</code>, then click on <strong>n of N selected</strong> and select\n  <strong>Build Dataset List</strong> from the dropdown menu.</p>\n      </li>\n      <li>\n        <p>In the next dialog window, you need to give a name, here we just set it to <code class=\"language-plaintext highlighter-rouge\">CP</code>, then click <strong>Create list</strong>.</p>\n      </li>\n      <li>\n        <p>Redo the Step 2, 3 for CN, set the name of the data list as ‘CN’.</p>\n      </li>\n    </ol>\n  </blockquote>\n</blockquote>\n\n<h1 id=\"differential-expression-analysis-dea-by-deseq2\">Differential Expression Analysis (DEA) by DESeq2</h1>\n\n<h2 id=\"what-is-differential-expression-analysis\">What is differential expression analysis?</h2>\n\n<blockquote class=\"comment\">\n  <comment-title>A definition</comment-title>\n\n  <p>The definition of differential expression analysis given by\n<a href=\"https://www.ebi.ac.uk/training/online/course/functional-genomics-ii-common-technologies-and-data-analysis-methods/differential-gene\">EBI</a>\nmeans taking the normalised read count data and performing statistical analysis to discover quantitative\nchanges in expression levels between experimental groups. For example, we use statistical testing to decide\nwhether, for a given gene, an observed difference in read counts is significant, that is, whether it is greater\nthan what would be expected just due to natural random variation.</p>\n\n</blockquote>\n\n<p>In principle, DEA is a causal analysis; but in reality, it is hampered by the complexity of the experimental\nsituation and measurement. Back to our datasets, CP and CN, they are from two experimental groups. By DEA,\nwe hope to pinpoint the candidate genes relevant to dental caries first, then we will use Heinz to infer the\nrelated pathways.</p>\n\n<h2 id=\"which-tools-are-available-for-dea\">Which tools are available for DEA?</h2>\n\n<p>There are a few canned tools commonly used for DEA, like <a href=\"https://bioconductor.org/packages/release/bioc/html/limma.html\">Limma</a>\nand <a href=\"https://bioconductor.org/packages/release/bioc/html/DESeq2.html\">DESeq2</a>. If you are interested, you\nmay look up the pros and cons of each tool. Here we use DESeq2.</p>\n\n<h2 id=\"perform-differential-expression-analysis-dea\">Perform Differential Expression Analysis (DEA)</h2>\n\n<p>After learning about differential expression analysis, let’s get some hands-on experience.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>DEA via DESeq2</hands-on-title>\n\n  <ul>\n    <li><strong>DESeq2</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters\n      <ul>\n        <li><em>“Specify a factor name”</em>: <code class=\"language-plaintext highlighter-rouge\">dental_caries</code> (under <code class=\"language-plaintext highlighter-rouge\">1: Factor</code>)</li>\n        <li><em>“Specify a factor level”</em>: to <code class=\"language-plaintext highlighter-rouge\">CP</code> (under <code class=\"language-plaintext highlighter-rouge\">1: Factor level</code>)\n          <ul>\n            <li><i class=\"far fa-copy\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-files</span> <em>“Counts file(s)”</em>: <code class=\"language-plaintext highlighter-rouge\">CP</code> (collection)</li>\n          </ul>\n        </li>\n        <li><em>“Specify a factor level”</em>: <code class=\"language-plaintext highlighter-rouge\">CN</code> (under <code class=\"language-plaintext highlighter-rouge\">2: Factor level</code>)\n          <ul>\n            <li><i class=\"far fa-copy\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-files</span> <em>“Counts file(s)”</em>: <code class=\"language-plaintext highlighter-rouge\">CN</code> (collection)</li>\n          </ul>\n        </li>\n        <li><em>“Files have header”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n        <li><em>“Visualising the analysis results”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n        <li>Leave all other parameters to the default settings <br /><br /></li>\n      </ul>\n    </li>\n  </ul>\n\n</blockquote>\n\n<p>It takes a few minutes to finish DESseq2. After the analysis is finished, have a look at the file, it should look like something this:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>GeneID  Base mean   log2(FC)\t        StdErr\t            Wald-Stats\t        P-value\t                P-adj\nK15661  55.0733128361562    2.49892393773464\t0.508475451930939\t4.91454194739384\t8.89902710599613e-07\t0.00491938218419466\nK15666  48.4532561772761    2.22805029428311\t0.493391718412049\t4.51578372951607\t6.30830206230236e-06\t0.00820667379798327\nK10213  25.1966742274619    -2.45624670858868\t0.550895251183889\t-4.45864563782342\t8.24791475064012e-06\t0.00820667379798327\nK03732  563.63634258472 -1.41961721984814\t0.316992240900184\t-4.47839737596338\t7.52055094378821e-06\t0.00820667379798327\nK01792  112.923146882195    -1.26925892659617\t0.285732234964578\t-4.44212717810268\t8.90738834802815e-06\t0.00820667379798327\n</code></pre></div></div>\n\n<h1 id=\"fit-a-bum-model-a-mixture-model\">Fit a BUM model (a mixture model)</h1>\n\n<p>From a statistical point of view, p-values are uniformly distributed under null hypothesis; in other words,\nunder alternative hypothesis, the noise component (which holds under null hypothesis) will be adequately\nmodeled by a uniform distribution. With this knowledge, we can fit these p-values to a mixture model\n(BUM model), as the figure below shows.</p>\n\n<p><a href=\"../../images/transcriptomics_images/bum.jpeg\" rel=\"noopener noreferrer\"><img src=\"../../images/transcriptomics_images/bum.jpeg\" alt=\"p-values are fitted to a mixture model. \" width=\"1280\" height=\"1138\" loading=\"lazy\" /></a></p>\n\n<blockquote class=\"comment\">\n  <comment-title>Why do we need a mixture model?</comment-title>\n\n  <p>To avoid making this tutorial sound like a math class, let’s focus on the philosophy of using a statistical model.\nIn the graph above, we have visualized the p-values; those bins have some shapes; by viewing the figure, it\nis possible for us to cherrypick the data points (KO) with mesh eyes, but it must be tedious and boring, nobody wants to\nspend a few days on doing this. In this situation, computers come into play; however, unlike humans, computers cannot understand the graph but\nmathematical formulas, that’s why we need to fix the data into a statistical model (denoted by the red curve and blue line in the graph),\nwhich computers can understand easily.</p>\n\n</blockquote>\n\n<p>Before fitting to BUM model in Galaxy, we need to prepare the input data for the tool\n<strong>Fit a BUM model</strong>, that’s a file that only contains p-values.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>extract p-values from DESeq2 output</hands-on-title>\n\n  <ul>\n    <li><strong>cut</strong> columns from a table <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:\n      <ul>\n        <li><em>“Cut columns”</em>: <code class=\"language-plaintext highlighter-rouge\">c6</code></li>\n        <li><em>“Delimited by”</em>: to <code class=\"language-plaintext highlighter-rouge\">TAB</code></li>\n        <li><em>“From”</em>: to the output of <strong>DESeq2</strong></li>\n      </ul>\n    </li>\n  </ul>\n\n</blockquote>\n\n<p>Now we can <strong>Fit a BUM model</strong>:</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>fit the BUM model</hands-on-title>\n\n  <ul>\n    <li><strong>Fit a BUM model</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters\n      <ul>\n        <li><em>“Input file”</em>: the output of <strong>cut</strong></li>\n      </ul>\n    </li>\n  </ul>\n\n</blockquote>\n\n<h1 id=\"pinpoint-the-key-pathways-with-heinz\">Pinpoint the key pathways with Heinz</h1>\n\n<p>After getting the parameters of the BUM model from the last step, we will use Heinz to pinpoint\nthe optimal subnetwork. Then we could look for the key pathways relevant to the subnetwork.\nBefore we continue, let’s figure out what Heinz is actually doing.</p>\n\n<p>Heinz is an algorithm for searching an optimal subnetwork from a bigger network. You may wonder what\nthe network is here. Through the previous steps, we have got a list of identities, that is a list\nof gene IDs with p-values, which form the nodes  of ‘the bigger network’, the relations between the\nnodes, that is the edges, needs to be obtained from a background network, which represents a pathway\nrelation databases, such as <a href=\"https://reactome.org/\">Reactome</a> and <a href=\"https://string-db.org/\">STRING</a>.\nIn this tutorial, we only use a small sample background network for demonstration purposes. The\nbackground network is represented as edges in a TXT file where each line denotes an edge as follows:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>ACTR1B\tACVR2B\nZSWIM9\tFOXP3\nLGALS4\tPRKX\nNPTX1\tCIAO1\n</code></pre></div></div>\n\n<p>Upload this edge file (hereafter we call it edge file) into the Galaxy instance.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Upload edge file</hands-on-title>\n\n  <ol>\n    <li><strong>Upload the edge file from Zenodo</strong>\n      <ul>\n        <li>Open the upload menu</li>\n        <li>Choose <strong>Paste/Fetch data</strong> option</li>\n        <li>Paste the URL into the box:\n          <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>https://zenodo.org/record/1344105/files/edge.txt\n</code></pre></div>          </div>\n        </li>\n        <li>Click <strong>Start</strong></li>\n      </ul>\n    </li>\n  </ol>\n</blockquote>\n\n<h2 id=\"calculate-heinz-scores\">Calculate Heinz scores</h2>\n\n<p>As the first step, we need to calculate a Heinz score for each node, using the BUM model parameters\nwe obtained; meanwhile, we also need to specify an FDR value as input.</p>\n\n<blockquote class=\"comment\">\n  <comment-title>What is an FDR value?</comment-title>\n\n  <p>FDR is short for false discovery rate, which is a method of conceptualizing the rate of type I errors\nin null hypothesis testing when conducting multiple comparisons, if you are interested, view the detail\nin <a href=\"https://en.wikipedia.org/wiki/False_discovery_rate\">Wikipedia</a>.</p>\n\n</blockquote>\n\n<p>For different datasets and problems, we probably need to pick up an FDR value separately. Here we set FDR to 0.11.</p>\n\n<p>Similar to <strong>Fit a BUM model</strong>, we also need to prepare the input data for the tool\n<strong>Calculate a Heinz score</strong>.</p>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <p>What is the requirement of the input data format for <strong>Calculate a Heinz score</strong>?</p>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <p>In the user interface of the tool “Calculate a Heinz score”, we see that “A node file with p-values” is needed.\nIt should contain two columns delimited by tab, one is KO ID; the other, p-value.</p>\n\n  </blockquote>\n</blockquote>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>extract geneID and p-values from DESeq2 output</hands-on-title>\n\n  <ul>\n    <li><strong>cut</strong> columns from a table <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters\n      <ul>\n        <li><em>“Cut columns”</em>: <code class=\"language-plaintext highlighter-rouge\">c1,c6</code></li>\n        <li><em>“Delimited by”</em>: <code class=\"language-plaintext highlighter-rouge\">TAB</code></li>\n        <li><em>“From”</em>: the output of <strong>DESeq2</strong></li>\n      </ul>\n    </li>\n  </ul>\n\n</blockquote>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>calculate Heinz scores</hands-on-title>\n\n  <ul>\n    <li><strong>Calculate a Heinz score</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters\n      <ul>\n        <li><em>“A node file with p-values”</em>: the output of the previous <strong>cut</strong> step</li>\n        <li><em>“FDR value”</em>: to 0.11</li>\n        <li><em>“Choose your input type for BUM parameters”</em>: <code class=\"language-plaintext highlighter-rouge\">The output file of BUM model</code></li>\n        <li><em>“Output file of BUM model as input: lambda on the first line and alpha, the second”</em>: the output of <strong>Fit a BUM model</strong></li>\n      </ul>\n    </li>\n  </ul>\n</blockquote>\n\n<blockquote class=\"comment\">\n  <comment-title>What is the Heinz score?</comment-title>\n\n  <p>To figure out this score without reading the formula, we can understand Heinz score in this way. FDR is involved in calculating a p-value threshold\nand any KO whose p-value is below this threshold is regarded as significant, which means the Heinz score is positive (another calculation in the formula). If we pick a higher FDR value, then we will have a higher p-value threshold, and more KOs are probably regarded as significant. In this situation, we probably have many false positive (those regarded as significant are actually not) on the one hand; on the other hand, Heinz will deliver a bigger subnetwork, which might be exhausting to analyze. Therefore, we need to pick up an FDR value properly.</p>\n\n</blockquote>\n\n<h2 id=\"run-heinz-pinpoint-the-optimal-subnetwork\">Run Heinz: pinpoint the optimal subnetwork</h2>\n\n<p>After getting Heinz scores, let’s run Heinz program to find the optimal subnetwork from the background network which we mentioned earlier.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>pinpoint the optimal subnetwork</hands-on-title>\n\n  <ul>\n    <li><strong>Identify optimal scoring subnetwork</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters\n      <ul>\n        <li><em>“File containing Heinz scores”</em>: the output of <strong>Calculate a Heinz score</strong></li>\n        <li><em>“Edge file”</em>: the edge file uploaded</li>\n      </ul>\n    </li>\n  </ul>\n\n</blockquote>\n\n<p>It usually takes a few minutes to get the result, but mind you, for some tasks, it might take a few hours to get a result in practice.</p>\n\n<blockquote class=\"comment\">\n  <comment-title>The running time of the program</comment-title>\n\n  <ul>\n    <li>Graph problem is way more complicated than we thought.</li>\n    <li>It might take a much longer time for some complicated datasets.</li>\n    <li>We can use multiple CPUs to accelerate the computation (for now, this function is not available in Galaxy yet),\nbut, to use that, you can install Heinz directly via <a href=\"https://anaconda.org/bioconda/heinz\">Bioconda</a> in a Linux environment.</li>\n  </ul>\n</blockquote>\n\n<h2 id=\"visualize-the-output-visualize-the-optimal-subnetwork\">Visualize the output: visualize the optimal subnetwork</h2>\n\n<p>The result we got from the last step is not very human-readable, is it? It is a little painful to understand the Heinz result directly. Therefore we need to visualize the output by making it into graphs.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>visualize the optimal subnetwork</hands-on-title>\n\n  <ul>\n    <li><strong>Visualize</strong> the optimal scoring subnetwork <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters\n      <ul>\n        <li><em>“Heinz output file”</em>: the output of <strong>Identify optimal scoring subnetwork</strong></li>\n      </ul>\n    </li>\n  </ul>\n\n</blockquote>\n\n<p>In this tutorial, you probably get a similar graph to the following:</p>\n\n<p><a href=\"../../images/transcriptomics_images/Heinz_visualisation.png\" rel=\"noopener noreferrer\"><img src=\"../../images/transcriptomics_images/Heinz_visualisation.png\" alt=\"p-values are fitted to a mixture model. \" width=\"860\" height=\"1414\" loading=\"lazy\" /></a></p>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <p>According to the figure above, Why are some shapes are round, others square?</p>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <p>Round shape corresponds to positive Heinz score; square shape corresponds to negative Heinz score.</p>\n\n  </blockquote>\n</blockquote>\n\n<p>In addition to the tool we will use in Galaxy, you may consider using eXamine plugin in Cytoscape for a richer visualization, if we use the original data from the study <a href=\"https://academic.oup.com/bioinformatics/article/32/11/1678/2240171\">May et al.</a>, perform all of these steps and visualize the result by eXamine, we can get a visualization as follows:</p>\n\n<p><a href=\"../../images/transcriptomics_images/metaModules.png\" rel=\"noopener noreferrer\"><img src=\"../../images/transcriptomics_images/metaModules.png\" alt=\"metaModules Result. \" width=\"2250\" height=\"1742\" loading=\"lazy\" /></a></p>\n\n<p>If you are interested, you may try to make sense of the result yourself. To answer the question “which pathways are potentially contributing to dental caries?”, we need to find the key pathways relevant to the subnetwork. To achieve that, we probably need to combine information from other bioinformatics services and literature.</p>\n\n<h1 id=\"save-the-history-into-a-workflow\">Save the history into a workflow</h1>\n\n<p>Let’s assume that these are the operations we always need for different datasets, to make life easier, we can save all of these operations into a workflow in Galaxy, which you can reuse for different datasets next time.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Extract the Heinz workflow</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Extract the workflow from your history</p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-extracting-a-workflow-from-your-history\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-extracting-a-workflow-from-your-history\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Extracting a workflow from your history</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ol>   <li>     <p><strong>Clean up</strong> your history: remove any failed (red) jobs from your history by clicking on the <i class=\"fas fa-trash\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-delete</span> button.</p>     <p>This will make the creation of the workflow easier.</p>   </li>   <li>     <p>Click on <i class=\"fas fa-cog\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-gear</span> (<strong>History options</strong>) at the top of your history panel and select <strong>Extract workflow</strong>.</p>     <p><img src=\"/training-material/topics/introduction/images/history_menu_extract_workflow.png\" alt=\"`Extract Workflow` entry in the history options menu\" /></p>     <p>The central panel will show the content of the history in reverse order (oldest on top), and you will be able to choose which steps to include in the workflow.</p>   </li>   <li>     <p>Replace the <strong>Workflow name</strong> to something more descriptive.</p>   </li>   <li>     <p><strong>Rename</strong> each workflow input in the boxes at the top of the second column.</p>   </li>   <li>     <p>If there are any steps that shouldn’t be included in the workflow, you can <strong>uncheck</strong> them in the first column of boxes.</p>   </li>   <li>     <p>Click on the <strong>Create Workflow</strong> button near the top.</p>     <p>You will get a message that the workflow was created.</p>   </li> </ol> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>\n      <p>Run the workflow on the dataset in this tutorial</p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p><a href=\"../../images/transcriptomics_images/heinz-workflow.png\" rel=\"noopener noreferrer\"><img src=\"../../images/transcriptomics_images/heinz-workflow.png\" alt=\"Heinz workflow. \" width=\"2630\" height=\"866\" loading=\"lazy\" /></a></p>\n\n<p>As a self practice, you ran the newly created workflow with the dataset in this tutorial. Do you feel the convenience of running a workflow directly?</p>\n\n<p>Congrats! You have finished all the tools in Heinz workflow! You have successfully run each tool and understood how it works. In real research, running these tools are only part of the effort, we still need to invest a huge amount of intelligence in making sense of the results and converting them to knowledge, which is fraught with uncertainties and confounders, where perhaps luck will come into play. So good luck!</p>\n"],"ref_slides":["# Metagenomics / metatranscriptomics\n\n- Sequence all DNA/RNA in a sample from a specific microbial environment\n- Get an overview of the entire microbial community\n\n![sample collection from environment to sequence data. DNA is isolated, manipulated, ligated together with a BAC vector, before a library is constructued and the expression of different proteins analysed in a live sample.](../../images/heinz/sampleextraction.png)\n\n???\nThere are several advantages in sequencing all DNA (metagenomics) or RNA (metatranscriptomics) in a sample to consider the microbial content.\n\nMany bacterial species are not easily grown on a petri-dish, and may therefore not be observed with classic  analysis techniques.\n\nMetatranscriptomics can also reveal the functional state of the microbiome, suggesting which functional pathways are switched on.\n\n---\n\n# The human microbiome\n\n- Over 100 trillion microbes\n- Outnumber our human cells 1.3 to 1.\n- Include bacteria, fungi, protozoa, viruses, in and outside our body.\n- The number of genes in all the microbes in one person's microbiome is ~10-200 times the number of genes in the human genome.\n- The microbiome may weigh as much as 200 grams\n\n\n.image-50[ ![image of a human with lines leading from various points on the body to pie charts of bacteria distribution](../../../microbiome/images/human_microbiome.png)]\n\n.footnote[[Sender et al 2016, PLoS ONE](https://doi.org/10.1371/journal.pbio.1002533)]\n\n???\n\n[*] this figure is difficult to estimate, as we need to consider when two orthologous genes can be considered different. A rough estimate would be 500~10000 species of bacteria with a median of 2000 genes.\n\n---\n\n# Environments related to health\n\n.pull-left[\n- Gut / bowel / intestine\n- Oral Cavity\n- Nasal Cavity\n- Skin\n\n![Picture of someone's mouth, showing their teeth and into their oral cavity and throat.](../../images/heinz/oralcavity.jpg)\n]\n\n.pull-right[\n![Nature cover \"our other genome\"](../../images/heinz/othergenome.png)\n]\n---\n\n# What would we find?\n\n.pull-left[\n- Oral Cavity\n- DNA from:\n  - bacteria\n  - viruses\n  - human\n  - archaea\n  - spider (?!)\n]\n\n.pull-right[\n![Picture of someone's mouth, showing their teeth and into their oral cavity and throat.](../../images/heinz/oralcavity.jpg)\n]\n\n---\n\n## Some bacterial species are difficult to culture\n\n![petri dish with bacterial cultures](../../images/heinz/petridish.png)\n\n- Such bacteria may not be found in current reference databases\n- The only way to obtain each species may be through direct sequencing of environmental samples\n- Purpose: find novel species, genomes, and genes\n\n\n---\n\n# Metagenomics vs 16S\n\n.pull-left[\n**Full shotgun sequencing of sample:**\n - sequence all available DNA/ RNA\n - may need to sequence very deep\n - functional composition\n\n**Sequence ribosomal regions (16S)**\n - need amplicons\n - requires less sequencing\n - taxonomic composition\n\n]\n\n.pull-right[\n\n.image-75[ ![shotgun sequencing illustrated with jigsaw puzzles, severla individual puzzles are mixed together.](../../../microbiome/images/puzzles-shotgun.png) ]\n\n.image-75[ ![amplicon sequencing illustrated with jigsaw puzzles, all of the corner pieces of each puzzle are circled.](../../../microbiome/images/puzzles-amplicon.png)]\n\n]\n???\nFor the workflow considered here we assume RNAseq of the microbiome.\n\nPuzzle analogy: think of each organism as a jigsaw puzzle\n\n- shotgun: we considers all pieces (DNA) from all puzzles (organisms); we throw the pieces in a big pile, and need to reconstruct each individual puzzle from this. It is more complex, but you get full details (functional information) about the picture on each puzzle.\n\n- amplicon: we only look at the corner pieces, these are easy to spot, and all puzzles have them. It will not tell us all the details (e.g. functional information) of the picture on the puzzle, but might be enough to tell us whether it is a landscape or a portrait or abstract art for instance (taxonomy).\n\n\n---\n\n# 16S ribosomal DNA\n\n![overview of the bacterial genome](../../images/heinz/16Sgene.png)\n\n- Multiple copies of **16S, 23S** and **5S**\n- 16S: 9 hypervariable & 9 highly conserved regions\n\n???\n16S sequencing is still very popular to estimate the diversity of a microbiome. In this work we are also interested in the functional content.\n\n---\n\n# Gum disease (priodontitis)\n\n![journal article \"Metatranscriptomics of the human oral microbiome during health and disease\"](../../images/heinz/abstract.png)\n\n???\nFor reference only\n\n---\n\n# Microbiome\n\n![oral microbiome](../../images/heinz/oralmicrobiome.png)\n\n???\n\nWhen we work with metagenomics data there are two main aims\n1) profiling of the species content of the microbiome\n2) a functional analysis of the microbiome.\n\n---\n\n# MetaModules\n\n![metamodules publication](../../images/heinz/metamodules.png)\n\n???\nHere we consider the “metaModules” workflow designed by Ali May et a.\n\n\n---\n\n# Exploring the networks of microbial function that are involved in disease\n\n![A gigantic blob of nodes and lines](../../images/heinz/network.png)\n\n???\nThe key idea is to explore functional  networks of the microbiome that are involved in disease\n\n---\n\n# Oral disease\n\n.pull-left[\n- **Dental caries**\n  The most common chronic disease of children (25%), and adolescents (59%). Bacteria feed on food debris. Bacteria produce acids leading to demineralization and destruction of the teeth.\n\n- **Periodontal disease**\n  Bacteria living in tissues surrounding and supporting the teeth; An over-aggressive immune response can subsequently lead to loosening and finally loss of teeth.\n\n\n]\n\n.pull-right[\n\n.image-75[ ![dental caries](../../images/heinz/caries.jpg)]\n\n.image-75[ ![periodontal disease](../../images/heinz/periodontaldisease.jpg)]\n\n]\n\n---\n\n# Healthy vs Disease\n\n![comparing microbiomes from healthy and disease samples. Both are sequenced, and then pie charts showing different microbiomes.](../../images/heinz/healthyvsdisease.png)\n\n???\nThe first part of the workflow entail RNA sequencing of oral microbiome samples.\n\nFrom this we get the total RNA present, from all species, including ribosomal RNA.\n\nThis can be used to estimate both a taxonomic profile, and a functional profile.\n\nWith the workflow presented here, we go one step further, and consider which subnetworks in the metabolic pathways are most deregulated in the microbiome samples showing disease (caries).\n\n---\n\n## Using knowledge to pinpoint the key players\n\n![The healthy and diseased mouths are sequenced, mapped to produce gene counts, these are binned for KO counts, and differential expression analysis produces the p-values of KO Fold changes. The p-values are converted to KO weights, and these are mapped to KO pathways to produce a network with weighted KOs, and maximum scoring subnetworks are extracted.](../../images/heinz/workflow.png)\n\n???\n\nSo, now to the experimental design and analysis steps. We used a previously published metatranscriptomic dataset of microbial RNA reads from healthy and caries disease samples.\n\nWe did some preprocessing to filter out non-coding RNA etc, and mapped the remaining reads to a KEGG database of 3 million genes.\n\nWe calculated the gene counts in healthy and diseased samples and aggregated these gene counts in KOs.\n\nThis was followed b differential expression analysis at the KO level, from which we derived fold changes and P-values for KOs.\n\nWe use the P-values to obtain scores for each KO, use the scores to annotate the network and finally run an algorithm in the network to identify the maximum-scoring regions.\n\n---\n\n# Some (KEGG database) terminology\n\n![KEGG species view](../../images/heinz/kegg1.png)\n\n???\nBut let’s talk briefly about how we define these molecular functions first and get familiar with the terminology. In the database we use, KEGG, we have species and corresponding molecular pathways, like in this case S. Mutans and glycolysis.\n\n---\n\n# Some (KEGG database) terminology\n\n![KEGG species view](../../images/heinz/kegg1-2.png)\n\n\n???\nOf course, each species has its own specific metabolic network - even though we may not have the information on all specific species in a sample.\n\n---\n\n# Some (KEGG database) terminology\n\n![KEGG KO groups showing pathways from Species 1 and species 2. Different portions of the pathway are highlighted](../../images/heinz/kegg2.png)\n\n???\nNow, as orthologous genes in the different species perform the same function, we can collapse the metabolic network of all known bacterial species in to a single network. Here is node represents a KO: a KEGG Orthologous Group, containing orthologous genes performing the same metabolic function in the metabolic network. We use this network of KOs to analyse the microbial sample.\n\n---\n\n# Functional signatures of microbiome-related disease\n\nThe most common objective is to identify differentially expressed pathways by performing comparative metagenomic/metatranscriptomic analyses.\n\n![funtional signatures of healthy and disease samples](../../images/heinz/functionalsignatures.png)\n\n???\nTo understand the functional differences between two conditions, for instance in microbiome-related disease and health, what is commonly done is to look at differentially expressed pathways between the two conditions.\n\nThe figure on left shows the pathways that are significantly over- or under-abundant in diseased and healthy patients.\n\nOn the right is a figure from another study where researchers listed some important pathways and the KOs in these pathways that are up- (blue) or downregulated (red) in disease.\n\n---\n\n![pathway analysis of a network image](../../images/heinz/globalapproach.png)\n\n???\nWe can now visualise the RNAseq data on our collapsed microbial metabolic network of KOs. The red nodes represent KOs that are overexpressed in disease, and the blue node those that are underexpressed in disease as compared to healthy samples.\n\nIt is immediately clear that the data contains many overexpressed genes, and it is difficult to immediately pinpoint the most deregulated part of the network. For this purpose, we use the Heinz methods to extract de most deregulated subnetwork.\n\n---\n\n# Identifying signatures of disease\n\n- Where are the most important regions in this large network?\n- How can we find such regions?\n\n![the large messy graph from before is shown in the dark, with a torch shining a light on a subset of that graph.](../../images/heinz/identification.png)\n\n---\n\n# Step 1: Construct a global network\n\n![369 pathway maps are reduced into 6642 KOs and 35405 interactions in a giant messy graph.](../../images/heinz/globalnetwork.png)\n\n???\n\nThe first step is to construct the global KO network, in the pratical this global network is already provided. As are the processed RNAseq values per KO.\n\n---\n\n# Step 2: Annotate the network with weights\n\n![A network of KOs are shown with weights on each node.](../../images/heinz/network_heinz.png)\n\n???\n\nNext we need to convert the p-values provided by deseq for under and over- expression into weights. Where a positive weight means the KO is significantly deregulated.\n\n---\n\n# Step 3: Calculate the maximum-scoring connected subnetwork\n\n.pull-left[\n\n- Problem: given network with weights find the maximum-scoring subnetwork\n\n- NP-hard problem.\n\n- Solutions are feasible in biological networks.\n\n- An exact solver exists: Heinz [Dittrich et al., 2008].\n\n\n]\n\n.pull-right[\n\n![maximum scoring subnetwork](../../images/heinz/network_heinz2.png)\n]\n\n???\n\nSubsequently, the Heinz algorithm can find the subnetwork that is most deregulated.\n\n---\n\n# Differential Expression Analysis\n\n![differential expression analysis plot](../../images/heinz/dea.png)\n\nEach dot's (function's) change in expression corresponds to a P-value\n\n---\n\n# P-value distribution when the null hypothesis is true\n\n![distribution of p-values](../../images/heinz/histogram.png)\n\n???\nFirst, we need to convert the p-values to weight. Here we think about a p-value distribution on a set that has no signal. In this case we expect a uniform distribution of p-values between 0 and 1. Note that if you generate many p-values for a data set, it is always helpful to check the distribution to see if there is any signal in the data.\n\n\n---\n\n# P-value distribution: signal vs noise\n\n![Beta uniform mixture (BUM) model](../../images/heinz/bum.png \"P-value histogram of 7105 KO fold changes\")\n\n<span style=\"color:blue\">Noise (blue)</span> and <span style=\"color:red\">signal (red)</span> in an expected P-value distribution\nBeta-uniform mixture model (mixing a beta and a uniform distribution )\n\n\n???\nIf there is a significant part of the data deregulated, we expect a peak on the left hand side of the distribution, i.e. an abundance of very low p-value as compared to the uniform distribution. This figure is very helpful, as we can estimate the number of true positives in the data: the part of the peak that rises above the uniform distribution.\n\n---\n\n# P-value to weight transformation\n\n![A graph comparing p-value to density with four regions labelled, A, B, C, and D. A is the region with p less than 0.1 and density greater than 0.5. C is the region directly below, with low p-value but low density. D is the region of higher p-value (0.1-1.0) but low density, and B is the final region of higher p-value and higher density. ](../../images/heinz/pvalue-to-weight.png)\n\n$$ FDR = \\frac{C}{A+C}$$\n\n- **A:** True positives, **C:** False positives\n- False discovery rate (**FDR**) -> a threshold P-value\n\n???\nFP = false positives, TP = true positives\n\nFrom the true positives, false positives and false negatives we can calculate the FDR (false discovery rate). Note that this is generally true for p-value distribution, and not specific for expression data.\n\n---\n\n# False discovery rate (FDR) sets the  threshold P-value\n\n![the same graph as before, caption repeats. A graph comparing p-value to density with four regions labelled, A, B, C, and D. A is the region with p less than 0.1 and density greater than 0.5. C is the region directly below, with low p-value but low density. D is the region of higher p-value (0.1-1.0) but low density, and B is the final region of higher p-value and higher density.](../../images/heinz/pvalue-to-weight.png \"p-value histogram of 7105 KO fold\")\n\n- The threshold P-value (τ) -> KOs with + and - weights\n- FDR determines the number of positive-scoring nodes and therefore the size of the final subnetwork.\n- In this dataset, an **FDR=0.0007 corresponded to τ = 10^5**\n\n???\nFrom this we can calculate the FDR, and we can use an FDR threshold to determine which p-value should correspond the a zero weight.\n\n---\n\n# Result: Weight-annotated network\n\n![weight-annotated network image](../../images/heinz/network_weight_annotated.png)\n\n<span style=\"color:red\">red:</span> weight &gt; 0, <span style=\"color:grey\">grey:</span> weight &lt; 0\n\n???\nNow we display the transformed weight onto the global KO network. Note that it is still difficult to spot the most deregulated subnetwork by eye.\n\n---\n\n# Finding the subnetwork\n\n![using Heinz to find subnetworks](../../images/heinz/find_subnetwork.png)\n\n.footnote[Dittrich,M.T. et al. (2008) Identifying functional modules in protein–protein interaction networks: an integrated exact approach. Bioinformatics, 24, I223–I231]\n\n???\nLastly, we use Heinz to find this deregulated subnetwork.\n\n---\n\n# Result: gum disease subnetwork\n\n7 pathways, 39 KOs (32 up- and 7 downregulated in disease)\n\n![results subnetworks](../../images/heinz/results.png)\n\n.footnote[ Dinkla,K. et al. (2014) eXamine: exploring annotated modules in networks. BMCBioinformatics, 15, 201.]\n\n\n???\n\nHere we display the results not for a caries dataset, but a gum-disease data set. We will look at the caries data set in the practical.\n\n\n---\n\n# Butanoate metabolism in gum disease\n\n\n.pull-left[\n\n.image-50[![results subnetworks](../../images/heinz/results.png)]\n\n<span style=\"color:green\">Green:</span> Butanoate metabolism\n\n.image-75[ ![butanoate metabolic pathway](../../images/heinz/butanoate.png)]\n\n]\n\n.pull-right[\n<span style=\"font-size: small\">\n*Niederman et al., 1997:*\n...**butyric acid concentrations** associated significantly with **disease severity**. Taken together, these data suggest that **butyric acid plays a mediating role in periodontal disease pathogenesis.**\n</span>\n\n<span style=\"font-size: small\">\n*Chang et al., 2013:*\n…**butyrate** generated by periodontal pathogens may be involved in the pathogenesis of **periodontal diseases** via the induction of ROS production and the impairment of cell growth, cell cycle progression and expression of cell cycle-related genes in GFs.\n</span>\n]\n\n???\nSome of the pathways found in the deregulated subnetwork have previously been associated with gum-disease, but are here found by simply analysing high-throughput data.\n\n---\n\n# Sulfur metabolism in gum disease\n\n\n.pull-left[\n\n.image-50[ ![results subnetworks](../../images/heinz/results.png)]\n\n<span style=\"color:coral\">Coral:</span> Sulfur metabolism\n\n.image-50[ ![sulfur metabolic pathway](../../images/heinz/sulfur.png)]\n\n]\n\n.pull-right[\n\n<span style=\"font-size: small\">\n*Langendijk et al 2001*: **Sulfate-reducing bacteria** (SRB) may be etiologically involved in destructive **periodontal diseases**. These strictly anaerobic bacteria utilize fermentation products for energy conservation by reduction of sulfate to sulfide. This toxic product can accumulate in periodontal pockets in concentrations causing cellular destruction. SRB depend on an actively degrading microbiota to produce a reduced environment, fermentation products and sulfate. The detection frequency of these bacteria is **strongly increased in periodontitis** compared with healthy sites in the oral cavity.\n</span>\n\n![publication on role of sulfure in periodontitis](../../images/heinz/sulfur_publication.png)\n\n]\n\n\n---\n\n# Potentially interesting pathways\n\nAlso some potentially interesting novel pathways have been found.\n\n![A large graph shown mostly in dark grey, several sub-graphs are highlighted in colour.](../../images/heinz/novelpathways.png)\n\n\n---\n\n# Real biology vs. 500 random networks\n\n![500 networks with shuffled weights were produced, a graph shows the subnetworks from networks with shuffled weights having low cumulative subnetwork scores, while the original subnetwork has a high score.](../../images/heinz/random-vs-real.png)\n\n???\nLastly, it is possible to check how significant the deregulated subnetwork itself is. This goes beyond the scope of the practical work.\n\n---\n\n# Practical\n\n- Work on caries data set for a network analysis\n- Get a feel of running each tool, mentally map the parameters/options back to the method mentioned in this presentation.\n- Save all the steps into a workflow and rerun it.\n"],"hands_on":true,"slides":true,"mod_date":"2024-01-11 10:48:02 +0000","pub_date":"2018-10-11 09:07:16 +0000","version":23,"workflows":[{"workflow":"Galaxy-Workflow-Heinz.ga","tests":false,"url":"https://training.galaxyproject.org/training-material/topics/transcriptomics/tutorials/network-analysis-with-heinz/workflows/Galaxy-Workflow-Heinz.ga","path":"topics/transcriptomics/tutorials/network-analysis-with-heinz/workflows/Galaxy-Workflow-Heinz.ga","wfid":"transcriptomics-network-analysis-with-heinz","wfname":"galaxy-workflow-heinz","trs_endpoint":"https://training.galaxyproject.org/training-material/api/ga4gh/trs/v2/tools/transcriptomics-network-analysis-with-heinz/versions/galaxy-workflow-heinz","license":null,"creators":[],"name":"Workflow Constructed From History 'Heinz Workflow Trial Sep 11'","title":"Workflow Constructed From History 'Heinz Workflow Trial Sep 11'","test_results":null,"modified":"2024-06-18 12:44:29 +0000","mermaid":"flowchart TD\n  0[\"ℹ️ Input Dataset\\nEdge File\"];\n  style 0 stroke:#2c3143,stroke-width:4px;\n  1[\"ℹ️ Input Collection\\nInput dataset collection\"];\n  style 1 stroke:#2c3143,stroke-width:4px;\n  2[\"ℹ️ Input Collection\\nInput dataset collection\"];\n  style 2 stroke:#2c3143,stroke-width:4px;\n  3[\"DESeq2\"];\n  1 -->|output| 3;\n  2 -->|output| 3;\n  4[\"Cut\"];\n  3 -->|deseq_out| 4;\n  5[\"Cut\"];\n  3 -->|deseq_out| 5;\n  6[\"Fit a BUM model\"];\n  4 -->|out_file1| 6;\n  7[\"Calculate a Heinz score\"];\n  5 -->|out_file1| 7;\n  6 -->|dist_params| 7;\n  8[\"Identify optimal scoring subnetwork\"];\n  7 -->|score| 8;\n  0 -->|output| 8;\n  9[\"Visualize\"];\n  8 -->|subnetwork| 9;"}],"api":"https://training.galaxyproject.org/training-material/api/topics/transcriptomics/tutorials/network-analysis-with-heinz/tutorial.json","tools":["Cut1","toolshed.g2.bx.psu.edu/repos/iuc/deseq2/deseq2/2.11.40.2","toolshed.g2.bx.psu.edu/repos/iuc/heinz/heinz/1.0","toolshed.g2.bx.psu.edu/repos/iuc/heinz/heinz_bum/1.0","toolshed.g2.bx.psu.edu/repos/iuc/heinz/heinz_scoring/1.0","toolshed.g2.bx.psu.edu/repos/iuc/heinz/heinz_visualization/0.1.0"],"supported_servers":{"exact":[{"url":"https://usegalaxy.be/","name":"UseGalaxy.be","usegalaxy":false},{"url":"https://usegalaxy.eu","name":"UseGalaxy.eu","usegalaxy":true}],"inexact":[{"url":"https://usegalaxy.cz/","name":"UseGalaxy.cz","usegalaxy":false},{"url":"https://usegalaxy.no/","name":"UseGalaxy.no","usegalaxy":false},{"url":"https://usegalaxy.org","name":"UseGalaxy.org (Main)","usegalaxy":true},{"url":"https://usegalaxy.org.au","name":"UseGalaxy.org.au","usegalaxy":true}]},"topic_name_human":"Transcriptomics","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[{"name":"deseq2","owner":"iuc","revisions":"d9e5cadc7f0b","tool_panel_section_label":"RNA Analysis","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"heinz","owner":"iuc","revisions":"2b80a2596064","tool_panel_section_label":"RNA Analysis","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"heinz","owner":"iuc","revisions":"2b80a2596064","tool_panel_section_label":"RNA Analysis","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"heinz","owner":"iuc","revisions":"2b80a2596064","tool_panel_section_label":"RNA Analysis","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"heinz","owner":"iuc","revisions":"5f589c91566e","tool_panel_section_label":"RNA Analysis","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"}]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools:\n- name: deseq2\n  owner: iuc\n  revisions: d9e5cadc7f0b\n  tool_panel_section_label: RNA Analysis\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: heinz\n  owner: iuc\n  revisions: 2b80a2596064\n  tool_panel_section_label: RNA Analysis\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: heinz\n  owner: iuc\n  revisions: 2b80a2596064\n  tool_panel_section_label: RNA Analysis\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: heinz\n  owner: iuc\n  revisions: 2b80a2596064\n  tool_panel_section_label: RNA Analysis\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: heinz\n  owner: iuc\n  revisions: 5f589c91566e\n  tool_panel_section_label: RNA Analysis\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n","tours":false,"video":false,"slides_recordings":false,"translations":{"tutorial":[],"slides":[],"video":false},"license":"CC-BY-4.0","type":"tutorial","logo":"GTN","redirect_from":["/short/transcriptomics/network-analysis-with-heinz/slides","/short/S00096"]}