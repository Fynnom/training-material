{"layout":"tutorial_hands_on","title":"Galaxy Monitoring with gxadmin","zenodo_link":"","questions":["What is gxadmin","What can it do?","How to write a query?"],"objectives":["Learn gxadmin basics","See some queries and learn how they help debug production issues"],"time_estimation":"30m","key_points":["gxadmin is a tool to run common database queries useful for Galaxy admins","new queries are welcome and easy to contribute"],"contributors":[{"name":"Helena Rasche","orcid":"0000-0001-9760-8992","maintainer_contact":"gitter","matrix":"hexylena:matrix.org","joined":"2017-09","elixir_node":"nl","affiliations":["gallantries","by-covid","erasmusmc","elixir-europe","elixir-converge"],"former_affiliations":["deNBI","avans-atgm","uni-freiburg"],"contact_for_training":false,"location":{"country":"NL","lat":51.91,"lon":4.46},"id":"hexylena","url":"https://training.galaxyproject.org/training-material/api/contributors/hexylena.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/hexylena/"}],"subtopic":"monitoring","tags":["monitoring","ansible","git-gat"],"js_requirements":{"mathjax":null,"mermaid":false},"short_id":"T00009","url":"/topics/admin/tutorials/gxadmin/tutorial.html","topic_name":"admin","tutorial_name":"gxadmin","dir":"topics/admin/tutorials/gxadmin","symlink":null,"id":"admin/gxadmin","ref_tutorials":["<p>We will just briefly cover the features available in <code class=\"language-plaintext highlighter-rouge\">gxadmin</code>, there are lots of queries that may or may not be useful for your Galaxy instance and you will have to read the documentation before using them.</p>\n\n<p>It started life as a small shell script that Helena wrote because she couldn’t remember what <a href=\"https://github.com/galaxyproject/gravity\">Gravity</a> was called or where it could be found. Some of the functions needed for things like swapping zerglings are still included in gxadmin but are highly specific to UseGalaxy.eu and not generally useful.</p>\n\n<p>Since then it became the home for “all of the SQL queries we [galaxy admins] run regularly.” <a href=\"/training-material/hall-of-fame/hexylena/\" class=\"contributor-badge-inline contributor-hexylena\">\n  <img src=\"https://avatars.githubusercontent.com/hexylena?s=36\" alt=\"Helena Rasche avatar\" width=\"36\" class=\"avatar\" />\n  Helena Rasche</a>\n and <a href=\"/training-material/hall-of-fame/natefoo/\" class=\"contributor-badge-inline contributor-natefoo\">\n  <img src=\"https://avatars.githubusercontent.com/natefoo?s=36\" alt=\"Nate Coraor avatar\" width=\"36\" class=\"avatar\" />\n  Nate Coraor</a>\n often shared SQL queries with each other in private chats, but this wasn’t helpful to the admin community at large, so they decided to put them all in <code class=\"language-plaintext highlighter-rouge\">gxadmin</code> and make it as easy to install as possible. We are continually trying to make this tool more generic and generally useful, if you notice something that’s missing or broken, or have a new query you want to run, just <a href=\"https://github.com/usegalaxy-eu/gxadmin/issues/new\">let us know</a>.</p>\n\n<blockquote class=\"agenda\">\n  <agenda-title></agenda-title>\n\n<ol id=\"markdown-toc\">\n  <li><a href=\"#installing-gxadmin\" id=\"markdown-toc-installing-gxadmin\">Installing gxadmin</a></li>\n  <li><a href=\"#configuration\" id=\"markdown-toc-configuration\">Configuration</a></li>\n  <li><a href=\"#overview\" id=\"markdown-toc-overview\">Overview</a></li>\n  <li><a href=\"#admin-favourite-queries\" id=\"markdown-toc-admin-favourite-queries\">Admin Favourite Queries</a></li>\n  <li><a href=\"#gxadmin-for-monitoring\" id=\"markdown-toc-gxadmin-for-monitoring\"><code class=\"language-plaintext highlighter-rouge\">gxadmin</code> for Monitoring</a></li>\n  <li><a href=\"#summary\" id=\"markdown-toc-summary\">Summary</a></li>\n</ol>\n\n</blockquote>\n\n<!--SNIPPET-->\n<blockquote class=\"comment\">   <div class=\"box-title comment-title\" id=\"comment-galaxy-admin-training-path\"><i class=\"far fa-comment-dots\" aria-hidden=\"true\"></i> Comment: Galaxy Admin Training Path</div>   <p>The yearly Galaxy Admin Training follows a specific ordering of tutorials. Use this timeline to help keep track of where you are in Galaxy Admin Training.</p>   <ol id=\"git-gat-timeline\">                    <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html\">             <div>Step 1</div>             <div>ansible-galaxy</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/backup-cleanup/tutorial.html\">             <div>Step 2</div>             <div>backup-cleanup</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/customization/tutorial.html\">             <div>Step 3</div>             <div>customization</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/tus/tutorial.html\">             <div>Step 4</div>             <div>tus</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/cvmfs/tutorial.html\">             <div>Step 5</div>             <div>cvmfs</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/apptainer/tutorial.html\">             <div>Step 6</div>             <div>apptainer</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/tool-management/tutorial.html\">             <div>Step 7</div>             <div>tool-management</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/reference-genomes/tutorial.html\">             <div>Step 8</div>             <div>reference-genomes</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/data-library/tutorial.html\">             <div>Step 9</div>             <div>data-library</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/dev/tutorials/bioblend-api/tutorial.html\">             <div>Step 10</div>             <div>dev/bioblend-api</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/connect-to-compute-cluster/tutorial.html\">             <div>Step 11</div>             <div>connect-to-compute-cluster</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/job-destinations/tutorial.html\">             <div>Step 12</div>             <div>job-destinations</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/pulsar/tutorial.html\">             <div>Step 13</div>             <div>pulsar</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/celery/tutorial.html\">             <div>Step 14</div>             <div>celery</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"active\">         <a href=\"/training-material/topics/admin/tutorials/gxadmin/tutorial.html\">             <div>Step 15</div>             <div>gxadmin</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/reports/tutorial.html\">             <div>Step 16</div>             <div>reports</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/monitoring/tutorial.html\">             <div>Step 17</div>             <div>monitoring</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/tiaas/tutorial.html\">             <div>Step 18</div>             <div>tiaas</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/sentry/tutorial.html\">             <div>Step 19</div>             <div>sentry</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/ftp/tutorial.html\">             <div>Step 20</div>             <div>ftp</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/beacon/tutorial.html\">             <div>Step 21</div>             <div>beacon</div>         </a>     </li>           </ol> </blockquote>\n<p><!--END_SNIPPET--></p>\n\n<h2 id=\"installing-gxadmin\">Installing gxadmin</h2>\n\n<p>It’s simple to install gxadmin. Here’s how you do it, if you haven’t done it already.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Installing gxadmin with Ansible</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Edit your <code class=\"language-plaintext highlighter-rouge\">requirements.yml</code> and add the following:</p>\n\n      <div class=\"language-diff highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"gd\">--- a/requirements.yml\n</span><span class=\"gi\">+++ b/requirements.yml\n</span><span class=\"p\">@@ -28,3 +28,5 @@</span>\n   version: 6.1.0\n - name: usegalaxy_eu.rabbitmqserver\n   version: 1.4.1\n<span class=\"gi\">+- src: galaxyproject.gxadmin\n+  version: 0.0.12\n</span>   \n</code></pre></div>      </div>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-how-to-read-a-diff\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-how-to-read-a-diff\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: How to read a Diff</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p>If you haven’t worked with diffs before, this can be something quite new or different.</p>   <p>If we have two files, let’s say a grocery list, in two files. We’ll call them ‘a’ and ‘b’.</p>   <blockquote class=\"code-2col\">   <blockquote class=\"code-in\">     <code-in-title>Old</code-in-title>     <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>$ cat old<br />🍎<br />🍐<br />🍊<br />🍋<br />🍒<br />🥑<br /></code></pre></div>    </div>   </blockquote>   <blockquote class=\"code-out\">     <code-out-title>New</code-out-title>     <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>$ cat new<br />🍎<br />🍐<br />🍊<br />🍋<br />🍍<br />🥑<br /></code></pre></div>    </div>   </blockquote> </blockquote>   <p>We can see that they have some different entries. We’ve removed 🍒 because they’re awful, and replaced them with an 🍍</p>   <p>Diff lets us compare these files</p>   <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>diff old new<br />5c5<br />&lt; 🍒<br /><span class=\"nt\">---</span><br /><span class=\"o\">&gt;</span> 🍍<br /></code></pre></div></div>   <p>Here we see that 🍒 is only in a, and 🍍 is only in b. But otherwise the files are identical.</p>   <p>There are a couple different formats to diffs, one is the ‘unified diff’</p>   <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>diff <span class=\"nt\">-U2</span> old new<br /><span class=\"nt\">---</span> old\t2022-02-16 14:06:19.697132568 +0100<br />+++ new\t2022-02-16 14:06:36.340962616 +0100<br />@@ <span class=\"nt\">-3</span>,4 +3,4 @@<br /> 🍊<br /> 🍋<br />-🍒<br />+🍍<br /> 🥑<br /></code></pre></div></div>   <p>This is basically what you see in the training materials which gives you a lot of context about the changes:</p>   <ul>   <li><code class=\"language-plaintext highlighter-rouge\">--- old</code> is the ‘old’ file in our view</li>   <li><code class=\"language-plaintext highlighter-rouge\">+++ new</code> is the ‘new’ file</li>   <li>@@ these lines tell us where the change occurs and how many lines are added or removed.</li>   <li>Lines starting with a - are removed from our ‘new’ file</li>   <li>Lines with a + have been added.</li> </ul>   <p>So when you go to apply these diffs to your files in the training:</p>   <ol>   <li>Ignore the header</li>   <li>Remove lines starting with - from your file</li>   <li>Add lines starting with + to your file</li> </ol>   <p>The other lines (🍊/🍋 and 🥑) above just provide “context”, they help you know where a change belongs in a file, but <strong>should not be edited</strong> when you’re making the above change. Given the above diff, you would find a line with a 🍒, and replace it with a 🍍</p>   <h4 id=\"added--removed-lines\">Added &amp; Removed Lines</h4>   <p>Removals are very easy to spot, we just have removed lines</p>   <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nt\">---</span> old\t2022-02-16 14:06:19.697132568 +0100<br />+++ new\t2022-02-16 14:10:14.370722802 +0100<br />@@ <span class=\"nt\">-4</span>,3 +4,2 @@<br /> 🍋<br /> 🍒<br />-🥑<br /></code></pre></div></div>   <p>And additions likewise are very easy, just add a new line, between the other lines in your file.</p>   <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nt\">---</span> old\t2022-02-16 14:06:19.697132568 +0100<br />+++ new\t2022-02-16 14:11:11.422135393 +0100<br />@@ <span class=\"nt\">-1</span>,3 +1,4 @@<br /> 🍎<br />+🍍<br /> 🍐<br /> 🍊<br /></code></pre></div></div>   <h4 id=\"completely-new-files\">Completely new files</h4>   <p>Completely new files look a bit different, there the “old” file is <code class=\"language-plaintext highlighter-rouge\">/dev/null</code>, the empty file in a Linux machine.</p>   <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>diff <span class=\"nt\">-U2</span> /dev/null old<br /><span class=\"nt\">---</span> /dev/null\t2022-02-15 11:47:16.100000270 +0100<br />+++ old\t2022-02-16 14:06:19.697132568 +0100<br />@@ <span class=\"nt\">-0</span>,0 +1,6 @@<br />+🍎<br />+🍐<br />+🍊<br />+🍋<br />+🍒<br />+🥑<br /></code></pre></div></div>   <p>And removed files are similar, except with the new file being /dev/null</p>   <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nt\">---</span> old\t2022-02-16 14:06:19.697132568 +0100<br />+++ /dev/null\t2022-02-15 11:47:16.100000270 +0100<br />@@ <span class=\"nt\">-1</span>,6 +0,0 @@<br />-🍎<br />-🍐<br />-🍊<br />-🍋<br />-🍒<br />-🥑<br /></code></pre></div></div> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>\n      <p>Install the role with:</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div data-cmd=\"true\" class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>ansible-galaxy <span class=\"nb\">install</span> <span class=\"nt\">-p</span> roles <span class=\"nt\">-r</span> requirements.yml\n</code></pre></div>        </div>\n      </blockquote>\n    </li>\n    <li>\n      <p>Add the role to your playbook:</p>\n\n      <div class=\"language-diff highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"gd\">--- a/galaxy.yml\n</span><span class=\"gi\">+++ b/galaxy.yml\n</span><span class=\"p\">@@ -34,3 +34,4 @@</span>\n     - galaxyproject.nginx\n     - galaxyproject.tusd\n     - galaxyproject.cvmfs\n<span class=\"gi\">+    - galaxyproject.gxadmin\n</span>   \n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p>Run the playbook</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div data-cmd=\"true\" class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>ansible-playbook galaxy.yml\n</code></pre></div>        </div>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>With that, <code class=\"language-plaintext highlighter-rouge\">gxadmin</code> should be installed! Now, test it out:</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Test out gxadmin</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Run <code class=\"language-plaintext highlighter-rouge\">gxadmin</code> as the galaxy user and list recently registered users:</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div data-cmd=\"true\" class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">sudo</span> <span class=\"nt\">-u</span> galaxy gxadmin query latest-users\n</code></pre></div>        </div>\n      </blockquote>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Output</code-in-title>\n        <div data-cmd=\"true\" class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> <span class=\"nb\">id</span> |          create_time          | disk_usage | username |       email        | <span class=\"nb\">groups</span> | active\n<span class=\"nt\">----</span>+-------------------------------+------------+----------+--------------------+--------+--------\n  1 | 2021-06-09 12:25:59.299651+00 | 218 kB     | admin    | admin@example.org  |        | f\n<span class=\"o\">(</span>1 rows<span class=\"o\">)</span>\n</code></pre></div>        </div>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"hidden\">\n  <div data-test=\"true\" class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>1.sh\n</code></pre></div>  </div>\n</blockquote>\n\n<h2 id=\"configuration\">Configuration</h2>\n\n<p>If <code class=\"language-plaintext highlighter-rouge\">psql</code> runs without any additional arguments, and permits you to access your galaxy database then you do not need to do any more configuration for gxadmin.\nOtherwise, you may need to set some of the <a href=\"https://github.com/usegalaxy-eu/gxadmin#postgres\">PostgreSQL environment variables</a></p>\n\n<h2 id=\"overview\">Overview</h2>\n\n<p><code class=\"language-plaintext highlighter-rouge\">gxadmin</code> has several categories of commands, each with different focuses. This is not a technically meaningful separation, it is just done to make the interface easier for end users.</p>\n\n<table>\n  <thead>\n    <tr>\n      <th>Category</th>\n      <th>Keyword</th>\n      <th>Purpose</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>Configuration</td>\n      <td><code class=\"language-plaintext highlighter-rouge\">config</code></td>\n      <td>Commands relating to galaxy’s configuration files like XML validation.</td>\n    </tr>\n    <tr>\n      <td>Filters</td>\n      <td><code class=\"language-plaintext highlighter-rouge\">filter</code></td>\n      <td>Transforming streams of text.</td>\n    </tr>\n    <tr>\n      <td>Galaxy Admin</td>\n      <td><code class=\"language-plaintext highlighter-rouge\">galaxy</code></td>\n      <td>Miscellaneous galaxy related commands like a cleanup wrapper.</td>\n    </tr>\n    <tr>\n      <td>uWSGI</td>\n      <td><code class=\"language-plaintext highlighter-rouge\">uwsgi</code></td>\n      <td>If you’re using <a href=\"https://github.com/usegalaxy-eu/ansible-galaxy-systemd/\">systemd for Galaxy</a> and a handler/zergling setup, then this lets you manage your handlers and zerglings.</td>\n    </tr>\n    <tr>\n      <td>DB Queries</td>\n      <td><code class=\"language-plaintext highlighter-rouge\">{csv,tsv,i,}query</code></td>\n      <td>Queries against the database which return tabular output.</td>\n    </tr>\n    <tr>\n      <td>Report</td>\n      <td><code class=\"language-plaintext highlighter-rouge\">report</code></td>\n      <td>Queries which return more complex and structured markdown reports.</td>\n    </tr>\n    <tr>\n      <td>Mutations</td>\n      <td><code class=\"language-plaintext highlighter-rouge\">mutate</code></td>\n      <td>These are like queries, except they mutate the database. All other queries are read-only.</td>\n    </tr>\n    <tr>\n      <td>Meta</td>\n      <td><code class=\"language-plaintext highlighter-rouge\">meta</code></td>\n      <td>More miscellaneous commands, and a built-in updating function.</td>\n    </tr>\n  </tbody>\n</table>\n\n<h2 id=\"admin-favourite-queries\">Admin Favourite Queries</h2>\n\n<p><strong><a href=\"/training-material/hall-of-fame/slugger70/\" class=\"contributor-badge-inline contributor-slugger70\">\n  <img src=\"https://avatars.githubusercontent.com/slugger70?s=36\" alt=\"Simon Gladman avatar\" width=\"36\" class=\"avatar\" />\n  Simon Gladman</a>\n‘s favourite</strong>: <code class=\"language-plaintext highlighter-rouge\">gxadmin query old-histories</code>. He contributed this function to find old histories, as their instance has a 90 day limit on histories, anything older than that might be automatically removed. This helps their group identify any histories that can be purged in order to save space. Running this on UseGalaxy.eu, we have some truly ancient histories, and maybe could benefit from a similar policy.</p>\n\n<blockquote class=\"code-in\">\n  <code-in-title></code-in-title>\n  <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>gxadmin query old-histories\n</code></pre></div>  </div>\n</blockquote>\n\n<blockquote class=\"code-out\">\n  <code-out-title></code-out-title>\n\n  <table>\n    <thead>\n      <tr>\n        <th>id</th>\n        <th>update-time</th>\n        <th>user-id</th>\n        <th>email</th>\n        <th>name</th>\n        <th>published</th>\n        <th>deleted</th>\n        <th>purged</th>\n        <th>hid-counter</th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr>\n        <td>361</td>\n        <td>2013-02-24 16:27:29.197572</td>\n        <td>xxx</td>\n        <td>xxxx</td>\n        <td>Unnamed history</td>\n        <td>f</td>\n        <td>f</td>\n        <td>f</td>\n        <td>6</td>\n      </tr>\n      <tr>\n        <td>362</td>\n        <td>2013-02-24 15:31:05.804747</td>\n        <td>xxx</td>\n        <td>xxxx</td>\n        <td>Unnamed history</td>\n        <td>f</td>\n        <td>f</td>\n        <td>f</td>\n        <td>1</td>\n      </tr>\n      <tr>\n        <td>347</td>\n        <td>2013-02-22 15:59:12.044169</td>\n        <td>xxx</td>\n        <td>xxxx</td>\n        <td>Unnamed history</td>\n        <td>f</td>\n        <td>f</td>\n        <td>f</td>\n        <td>19</td>\n      </tr>\n      <tr>\n        <td>324</td>\n        <td>2013-02-22 15:57:54.500637</td>\n        <td>xxx</td>\n        <td>xxxx</td>\n        <td>Exercise 5</td>\n        <td>f</td>\n        <td>f</td>\n        <td>f</td>\n        <td>64</td>\n      </tr>\n      <tr>\n        <td>315</td>\n        <td>2013-02-22 15:50:51.398894</td>\n        <td>xxx</td>\n        <td>xxxx</td>\n        <td>day5 practical</td>\n        <td>f</td>\n        <td>f</td>\n        <td>f</td>\n        <td>90</td>\n      </tr>\n      <tr>\n        <td>314</td>\n        <td>2013-02-22 15:45:47.75967</td>\n        <td>xxx</td>\n        <td>xxxx</td>\n        <td>5. Tag Galaxy-Kurs</td>\n        <td>f</td>\n        <td>f</td>\n        <td>f</td>\n        <td>78</td>\n      </tr>\n    </tbody>\n  </table>\n\n</blockquote>\n\n<p><strong><a href=\"/training-material/hall-of-fame/natefoo/\" class=\"contributor-badge-inline contributor-natefoo\">\n  <img src=\"https://avatars.githubusercontent.com/natefoo?s=36\" alt=\"Nate Coraor avatar\" width=\"36\" class=\"avatar\" />\n  Nate Coraor</a>\n‘s favourite</strong>: <code class=\"language-plaintext highlighter-rouge\">gxadmin query job-inputs</code>. He contributed this function which helps him debug jobs which are not running and should be.</p>\n\n<blockquote class=\"code-in\">\n  <code-in-title></code-in-title>\n  <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>gxadmin query job-inputs 5 # Or another job ID\n</code></pre></div>  </div>\n</blockquote>\n\n<table>\n  <thead>\n    <tr>\n      <th>hda-id</th>\n      <th>hda-state</th>\n      <th>hda-deleted</th>\n      <th>hda-purged</th>\n      <th>d-id</th>\n      <th>d-state</th>\n      <th>d-deleted</th>\n      <th>d-purged</th>\n      <th>object-store-id</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>8638197</td>\n      <td> </td>\n      <td>f</td>\n      <td>f</td>\n      <td>8246854</td>\n      <td>running</td>\n      <td>f</td>\n      <td>f</td>\n      <td>files9</td>\n    </tr>\n    <tr>\n      <td>8638195</td>\n      <td> </td>\n      <td>f</td>\n      <td>f</td>\n      <td>8246852</td>\n      <td>running</td>\n      <td>f</td>\n      <td>f</td>\n      <td>files9</td>\n    </tr>\n    <tr>\n      <td>8638195</td>\n      <td> </td>\n      <td>f</td>\n      <td>f</td>\n      <td>8246852</td>\n      <td>running</td>\n      <td>f</td>\n      <td>f</td>\n      <td>files9</td>\n    </tr>\n  </tbody>\n</table>\n\n<p><strong><a href=\"/training-material/hall-of-fame/bgruening/\" class=\"contributor-badge-inline contributor-bgruening\">\n  <img src=\"https://avatars.githubusercontent.com/bgruening?s=36\" alt=\"Björn Grüning avatar\" width=\"36\" class=\"avatar\" />\n  Björn Grüning</a>\n‘s favourite</strong>: <code class=\"language-plaintext highlighter-rouge\">gxadmin query latest-users</code> let’s us see who has recently joined our server. We sometimes notice that people are running a training on our infrastructure and they haven’t registered for <a href=\"https://galaxyproject.eu/tiaas\">training infrastructure as a service</a> which helps us coordinate infrastructure for them so they don’t have bad experiences.</p>\n\n<blockquote class=\"code-in\">\n  <code-in-title></code-in-title>\n  <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>gxadmin query latest-users\n</code></pre></div>  </div>\n</blockquote>\n\n<table>\n  <thead>\n    <tr>\n      <th>id</th>\n      <th>create_time</th>\n      <th>disk_usage</th>\n      <th>username</th>\n      <th>email</th>\n      <th>groups</th>\n      <th>active</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>3937</td>\n      <td>2019-01-27 14:11:12.636399</td>\n      <td>291 MB</td>\n      <td>xxxx</td>\n      <td>xxxx</td>\n      <td> </td>\n      <td>t</td>\n    </tr>\n    <tr>\n      <td>3936</td>\n      <td>2019-01-27 10:41:07.76126</td>\n      <td>1416 MB</td>\n      <td>xxxx</td>\n      <td>xxxx</td>\n      <td> </td>\n      <td>t</td>\n    </tr>\n    <tr>\n      <td>3935</td>\n      <td>2019-01-27 10:13:01.499094</td>\n      <td>2072 kB</td>\n      <td>xxxx</td>\n      <td>xxxx</td>\n      <td> </td>\n      <td>t</td>\n    </tr>\n    <tr>\n      <td>3934</td>\n      <td>2019-01-27 10:06:40.973938</td>\n      <td>0 bytes</td>\n      <td>xxxx</td>\n      <td>xxxx</td>\n      <td> </td>\n      <td>f</td>\n    </tr>\n    <tr>\n      <td>3933</td>\n      <td>2019-01-27 10:01:22.562782</td>\n      <td> </td>\n      <td>xxxx</td>\n      <td>xxxx</td>\n      <td> </td>\n      <td>f</td>\n    </tr>\n  </tbody>\n</table>\n\n<p><strong><a href=\"/training-material/hall-of-fame/hexylena/\" class=\"contributor-badge-inline contributor-hexylena\">\n  <img src=\"https://avatars.githubusercontent.com/hexylena?s=36\" alt=\"Helena Rasche avatar\" width=\"36\" class=\"avatar\" />\n  Helena Rasche</a>\n‘s favourite</strong> <code class=\"language-plaintext highlighter-rouge\">gxadmin report job-info</code>. This command gives more information than you probably need on the execution of a specific job, formatted as markdown for easy sharing with fellow administrators.</p>\n\n<blockquote class=\"code-in\">\n  <code-in-title></code-in-title>\n  <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>gxadmin report job-info 1\n</code></pre></div>  </div>\n</blockquote>\n\n<blockquote class=\"code-out\">\n  <code-out-title></code-out-title>\n  <div class=\"language-text highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code># Galaxy Job 5132146\n\nProperty      | Value\n------------- | -----\n         Tool | toolshed.g2.bx.psu.edu/repos/bgruening/canu/canu/1.7\n        State | running\n      Handler | handler_main_2\n      Created | 2019-04-20 11:04:40.854975+02 (3 days 05:49:30.451719 ago)\nJob Runner/ID | condor / 568537\n        Owner | e08d6c893f5\n\n## Destination Parameters\n\nKey                     |   Value\n---                     |   ---\ndescription             |   `canu`\npriority                |   `-128`\nrequest_cpus            |   `20`\nrequest_memory          |   `64G`\nrequirements            |   `GalaxyGroup == \"compute\"`\ntmp_dir                 |   `True`\n\n## Dependencies\n\nName   |   Version   |   Dependency Type   |   Cacheable   |   Exact   |   Environment Path                          |   Model Class\n---    |   ---       |   ---               |   ---         |   ---     |   ---                                       |   ---\ncanu   |   1.7       |   conda             |   false       |   true    |   /usr/local/tools/_conda/envs/__canu@1.7   |   MergedCondaDependency\n\n## Tool Parameters\n\nName                 |   Settings\n---------            |   ------------------------------------\nminOverlapLength     |   500\nchromInfo            |   /opt/galaxy/tool-data/shared/ucsc/chrom/?.len\nstage                |   all\ncontigFilter         |   {lowCovDepth: 5, lowCovSpan: 0.5, minLength: 0, minReads: 2, singleReadSpan: 1.0}\ns                    |   null\nmode                 |   -nanopore-raw\ndbkey                |   ?\ngenomeSize           |   300000\ncorOutCoverage       |   40\nrawErrorRate         |\nminReadLength        |   1000\ncorrectedErrorRate   |\n\n## Inputs\n\nJob ID    |   Name                |   Extension     |   hda-id    |   hda-state   |   hda-deleted   |   hda-purged   |   ds-id     |   ds-state   |   ds-deleted   |   ds-purged   |   Size\n----      |   ----                |   ----          |   ----      |   ----        |   ----          |   ----         |   ----      |   ----       |   ----         |   ----        |   ----\n4975404   |   Osur_record.fastq   |   fastqsanger   |   9517188   |               |   t             |   f            |   9015329   |   ok         |   f            |   f           |   3272 MB\n4975404   |   Osur_record.fastq   |   fastqsanger   |   9517188   |               |   t             |   f            |   9015329   |   ok         |   f            |   f           |   3272 MB\n\n## Outputs\n\nName                                          |   Extension   |   hda-id    |   hda-state   |   hda-deleted   |   hda-purged   |   ds-id     |   ds-state   |   ds-deleted   |   ds-purged   |   Size\n----                                          |   ----        |   ----      |   ----        |   ----          |   ----         |   ----      |   ----       |   ----         |   ----        |   ----\nCanu assembler on data 41 (trimmed reads)     |   fasta.gz    |   9520369   |               |   f             |   f            |   9018510   |   running    |   f            |   f           |\nCanu assembler on data 41 (corrected reads)   |   fasta.gz    |   9520368   |               |   f             |   f            |   9018509   |   running    |   f            |   f           |\nCanu assembler on data 41 (unitigs)           |   fasta       |   9520367   |               |   f             |   f            |   9018508   |   running    |   f            |   f           |\nCanu assembler on data 41 (unassembled)       |   fasta       |   9520366   |               |   f             |   f            |   9018507   |   running    |   f            |   f           |\nCanu assembler on data 41 (contigs)           |   fasta       |   9520365   |               |   f             |   f            |   9018506   |   running    |   f            |   f           |\n</code></pre></div>  </div>\n</blockquote>\n\n<p><strong><a href=\"/training-material/hall-of-fame/cat-bro/\" class=\"contributor-badge-inline contributor-cat-bro\">\n  <img src=\"https://avatars.githubusercontent.com/cat-bro?s=36\" alt=\"Catherine Bromhead avatar\" width=\"36\" class=\"avatar\" />\n  Catherine Bromhead</a>\n contributed</strong> the ‘jobs’ query: <code class=\"language-plaintext highlighter-rouge\">gxadmin query jobs</code> lets you list jobs that have been run on your Galaxy. It’s a <em>lot</em> more flexible than <code class=\"language-plaintext highlighter-rouge\">queue-overview</code> and we suggest using it instead, in most places. E.g. to find <code class=\"language-plaintext highlighter-rouge\">circos</code> jobs that were recently run:</p>\n\n<blockquote class=\"code-in\">\n  <code-in-title></code-in-title>\n  <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>gxadmin query jobs --limit 2  --tool circos\n</code></pre></div>  </div>\n</blockquote>\n\n<table>\n  <thead>\n    <tr>\n      <th>job_id</th>\n      <th>create_time</th>\n      <th>update_time</th>\n      <th>user_id</th>\n      <th>state</th>\n      <th>tool_id</th>\n      <th>handler</th>\n      <th>destination</th>\n      <th>external_id</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>58483488</td>\n      <td>2023-04-04 18:42:40</td>\n      <td>2023-04-04 18:43:30</td>\n      <td> </td>\n      <td>error</td>\n      <td>toolshed.g2.bx.psu.edu/repos/iuc/circos/circos/0.69.8+galaxy8</td>\n      <td>handler_sn06_5</td>\n      <td>1cores_10.0G</td>\n      <td>42071736</td>\n    </tr>\n    <tr>\n      <td>58483208</td>\n      <td>2023-04-04 18:36:24</td>\n      <td>2023-04-04 18:40:43</td>\n      <td> </td>\n      <td>error</td>\n      <td>toolshed.g2.bx.psu.edu/repos/iuc/circos/circos/0.69.8+galaxy9</td>\n      <td>handler_sn06_3</td>\n      <td>1cores_10.0G</td>\n      <td>42071486</td>\n    </tr>\n  </tbody>\n</table>\n\n<p>or to see recent jobs from a specific user (e.g. to help answer their email queries when they just send you a screenshot rather than a proper bug report)</p>\n\n<blockquote class=\"code-in\">\n  <code-in-title></code-in-title>\n  <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>gxadmin query jobs --limit 2 --user helena-rasche --terminal\n</code></pre></div>  </div>\n</blockquote>\n\n<table>\n  <thead>\n    <tr>\n      <th>job_id</th>\n      <th>create_time</th>\n      <th>update_time</th>\n      <th>user_id</th>\n      <th>state</th>\n      <th>tool_id</th>\n      <th>handler</th>\n      <th>destination</th>\n      <th>external_id</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>58277473</td>\n      <td>2023-03-31 09:53:36</td>\n      <td>2023-03-31 09:53:36</td>\n      <td>580</td>\n      <td>ok</td>\n      <td><strong>TAG_FROM_FILE</strong></td>\n      <td><em>default</em></td>\n      <td> </td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td>58277410</td>\n      <td>2023-03-31 09:47:16</td>\n      <td>2023-03-31 09:51:26</td>\n      <td>580</td>\n      <td>ok</td>\n      <td>toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_find_and_replace/1.1.4</td>\n      <td>handler_sn06_0</td>\n      <td>1cores_4.0G</td>\n      <td>41859564</td>\n    </tr>\n  </tbody>\n</table>\n\n<h2 id=\"gxadmin-for-monitoring\"><code class=\"language-plaintext highlighter-rouge\">gxadmin</code> for Monitoring</h2>\n\n<p><code class=\"language-plaintext highlighter-rouge\">gxadmin</code> already supported <code class=\"language-plaintext highlighter-rouge\">query</code>, <code class=\"language-plaintext highlighter-rouge\">csvquery</code>, and <code class=\"language-plaintext highlighter-rouge\">tsvquery</code> for requesting data from the Galaxy database in tables, CSV, or TSV formats, but we recently implemented <code class=\"language-plaintext highlighter-rouge\">influx</code> queries which output data in a format that <a href=\"https://github.com/influxdata/telegraf\">Telegraf</a> can consume.</p>\n\n<p>So running <code class=\"language-plaintext highlighter-rouge\">gxadmin query queue-overview</code> normally shows something like:</p>\n\n<blockquote class=\"code-in\">\n  <code-in-title></code-in-title>\n  <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>gxadmin query queue-overview\n</code></pre></div>  </div>\n</blockquote>\n\n<table>\n  <thead>\n    <tr>\n      <th>tool_id</th>\n      <th>tool_version</th>\n      <th>destination_id</th>\n      <th>handler</th>\n      <th>state</th>\n      <th>job_runner_name</th>\n      <th>count</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>toolshed.g2.bx.psu.edu/repos/iuc/unicycler/unicycler/0.4.6.0</td>\n      <td>0.4.6.0</td>\n      <td>12cores_180G_special</td>\n      <td>handler_main_4</td>\n      <td>running</td>\n      <td>condor</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <td>toolshed.g2.bx.psu.edu/repos/iuc/unicycler/unicycler/0.4.6.0</td>\n      <td>0.4.6.0</td>\n      <td>12cores_180G_special</td>\n      <td>handler_main_5</td>\n      <td>running</td>\n      <td>condor</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <td>toolshed.g2.bx.psu.edu/repos/devteam/freebayes/freebayes/1.1.0.46-0</td>\n      <td>1.1.0.46-0</td>\n      <td>12cores_12G</td>\n      <td>handler_main_3</td>\n      <td>running</td>\n      <td>condor</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <td>toolshed.g2.bx.psu.edu/repos/iuc/qiime_extract_barcodes/qiime_extract_barcodes/1.9.1.0</td>\n      <td>1.9.1.0</td>\n      <td>4G_memory</td>\n      <td>handler_main_1</td>\n      <td>running</td>\n      <td>condor</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <td>toolshed.g2.bx.psu.edu/repos/iuc/hisat2/hisat2/2.1.0+galaxy3</td>\n      <td>2.1.0+galaxy3</td>\n      <td>8cores_20G</td>\n      <td>handler_main_11</td>\n      <td>running</td>\n      <td>condor</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <td>toolshed.g2.bx.psu.edu/repos/devteam/fastqc/fastqc/0.72</td>\n      <td>0.72</td>\n      <td>20G_memory</td>\n      <td>handler_main_11</td>\n      <td>running</td>\n      <td>condor</td>\n      <td>4</td>\n    </tr>\n    <tr>\n      <td>ebi_sra_main</td>\n      <td>1.0.1</td>\n      <td>4G_memory</td>\n      <td>handler_main_3</td>\n      <td>running</td>\n      <td>condor</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <td>ebi_sra_main</td>\n      <td>1.0.1</td>\n      <td>4G_memory</td>\n      <td>handler_main_4</td>\n      <td>running</td>\n      <td>condor</td>\n      <td>3</td>\n    </tr>\n  </tbody>\n</table>\n\n<p>The <code class=\"language-plaintext highlighter-rouge\">gxadmin iquery queue-overview</code> is run by our Telegraf monitor on a regular basis, allowing us to consume the data:</p>\n\n<blockquote class=\"code-in\">\n  <code-in-title></code-in-title>\n  <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>gxadmin iquery queue-overview\n</code></pre></div>  </div>\n</blockquote>\n\n<blockquote class=\"code-out\">\n  <code-out-title></code-out-title>\n  <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>queue-overview,tool_id=toolshed.g2.bx.psu.edu/repos/iuc/unicycler/unicycler/0.4.6.0,tool_version=0.4.6.0,state=running,handler=handler_main_4,destination_id=12cores_180G_special,job_runner_name=condor count=1\nqueue-overview,tool_id=toolshed.g2.bx.psu.edu/repos/iuc/unicycler/unicycler/0.4.6.0,tool_version=0.4.6.0,state=running,handler=handler_main_5,destination_id=12cores_180G_special,job_runner_name=condor count=1\nqueue-overview,tool_id=toolshed.g2.bx.psu.edu/repos/devteam/freebayes/freebayes/1.1.0.46-0,tool_version=1.1.0.46-0,state=running,handler=handler_main_3,destination_id=12cores_12G,job_runner_name=condor count=1\nqueue-overview,tool_id=toolshed.g2.bx.psu.edu/repos/devteam/vcffilter/vcffilter2/1.0.0_rc1+galaxy1,tool_version=1.0.0_rc1+galaxy1,state=queued,handler=handler_main_11,destination_id=4G_memory,job_runner_name=condor count=1\nqueue-overview,tool_id=toolshed.g2.bx.psu.edu/repos/iuc/hisat2/hisat2/2.1.0+galaxy3,tool_version=2.1.0+galaxy3,state=running,handler=handler_main_11,destination_id=8cores_20G,job_runner_name=condor count=1\nqueue-overview,tool_id=toolshed.g2.bx.psu.edu/repos/devteam/fastqc/fastqc/0.72,tool_version=0.72,state=running,handler=handler_main_11,destination_id=20G_memory,job_runner_name=condor count=4\nqueue-overview,tool_id=ebi_sra_main,tool_version=1.0.1,state=running,handler=handler_main_3,destination_id=4G_memory,job_runner_name=condor count=2\nqueue-overview,tool_id=ebi_sra_main,tool_version=1.0.1,state=running,handler=handler_main_4,destination_id=4G_memory,job_runner_name=condor count=3\n</code></pre></div>  </div>\n</blockquote>\n\n<p>And produce <a href=\"https://stats.galaxyproject.eu/\">some nice graphs</a> from it.</p>\n\n<p>You can use an influx configuration like:</p>\n\n<div class=\"language-toml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nn\">[[inputs.exec]]</span>\n    <span class=\"py\">commands</span> <span class=\"p\">=</span> <span class=\"p\">[</span><span class=\"s\">\"/usr/bin/galaxy-queue-size\"</span><span class=\"p\">]</span>\n    <span class=\"py\">timeout</span> <span class=\"p\">=</span> <span class=\"s\">\"10s\"</span>\n    <span class=\"py\">data_format</span> <span class=\"p\">=</span> <span class=\"s\">\"influx\"</span>\n    <span class=\"py\">interval</span> <span class=\"p\">=</span> <span class=\"s\">\"1m\"</span>\n</code></pre></div></div>\n\n<p>This often requires a wrapper script, because you’ll need to pass environment variables to the <code class=\"language-plaintext highlighter-rouge\">gxadmin</code> invocation, e.g.:</p>\n\n<div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\">#!/bin/bash</span>\n<span class=\"nb\">export </span><span class=\"nv\">PGUSER</span><span class=\"o\">=</span>galaxy\n<span class=\"nb\">export </span><span class=\"nv\">PGHOST</span><span class=\"o\">=</span>dbhost\ngxadmin iquery queue-overview <span class=\"nt\">--short-tool-id</span>\ngxadmin iquery workflow-invocation-status\n</code></pre></div></div>\n\n<blockquote class=\"tip\">\n  <tip-title>Which queries support iquery?</tip-title>\n  <p>This data is not currently exposed, so, just try the queries. But it’s easy to add influx support when missing! <a href=\"https://github.com/usegalaxy-eu/gxadmin/blob/e0ec0174ebbdce1acd8c40c7431308934981aa0c/parts/22-query.sh#L54\">Here is an example</a>, we set the variables in a function:</p>\n\n  <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>fields=\"count=1\"\ntags=\"tool_id=0\"\n</code></pre></div>  </div>\n\n  <p>This means: column 0 is a tag named tool_id, and column 1 is a field (real value) named count.\n<a href=\"https://github.com/usegalaxy-eu/gxadmin/blob/e0ec0174ebbdce1acd8c40c7431308934981aa0c/parts/22-query.sh#L1987\">Here is an example</a> that has multiple fields that are stored.</p>\n\n</blockquote>\n\n<h1 id=\"summary\">Summary</h1>\n\n<p>There are a lot of queries, all tailored to specific use cases, some of these may be interesting for you, some may not. These are <a href=\"https://github.com/usegalaxy-eu/gxadmin#commands\">all documented</a> with example inputs and outputs in the gxadmin readme, and help is likewise available from the command line.</p>\n\n<!--SNIPPET-->\n<blockquote class=\"hands_on\">   <div class=\"box-title hands_on-title\" id=\"hands-on-time-to-git-commit\"><i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i> Hands-on: Time to git commit</div>   <p>It’s time to commit your work! Check the status with</p>   <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>git status<br /></code></pre></div></div>   <p>Add your changed files with</p>   <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>git add ... # any files you see that are changed<br /></code></pre></div></div>   <p>And then commit it!</p>   <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>git commit -m 'Finished Galaxy Monitoring with gxadmin'<br /></code></pre></div></div> </blockquote>\n<p><!--END_SNIPPET--></p>\n\n<!--SNIPPET-->\n<blockquote class=\"comment\">   <div class=\"box-title comment-title\" id=\"comment-got-lost-along-the-way\"><i class=\"far fa-comment-dots\" aria-hidden=\"true\"></i> Comment: Got lost along the way?</div>   <p>If you missed any steps, you can compare against the <a href=\"https://github.com/hexylena/git-gat/tree/step-10\">reference files</a>, or see what changed since <a href=\"https://github.com/hexylena/git-gat/compare/step-9...step-10#files_bucket\">the previous tutorial</a>.</p>   <p>If you’re using <code class=\"language-plaintext highlighter-rouge\">git</code> to track your progress, remember to add your changes and commit with a good commit message!</p> </blockquote>\n<p><!--END_SNIPPET--></p>\n\n<!--SNIPPET-->\n<blockquote class=\"comment\">   <div class=\"box-title comment-title\" id=\"comment-galaxy-admin-training-path-1\"><i class=\"far fa-comment-dots\" aria-hidden=\"true\"></i> Comment: Galaxy Admin Training Path</div>   <p>The yearly Galaxy Admin Training follows a specific ordering of tutorials. Use this timeline to help keep track of where you are in Galaxy Admin Training.</p>   <ol id=\"git-gat-timeline\">                    <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html\">             <div>Step 1</div>             <div>ansible-galaxy</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/backup-cleanup/tutorial.html\">             <div>Step 2</div>             <div>backup-cleanup</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/customization/tutorial.html\">             <div>Step 3</div>             <div>customization</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/tus/tutorial.html\">             <div>Step 4</div>             <div>tus</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/cvmfs/tutorial.html\">             <div>Step 5</div>             <div>cvmfs</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/apptainer/tutorial.html\">             <div>Step 6</div>             <div>apptainer</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/tool-management/tutorial.html\">             <div>Step 7</div>             <div>tool-management</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/reference-genomes/tutorial.html\">             <div>Step 8</div>             <div>reference-genomes</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/data-library/tutorial.html\">             <div>Step 9</div>             <div>data-library</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/dev/tutorials/bioblend-api/tutorial.html\">             <div>Step 10</div>             <div>dev/bioblend-api</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/connect-to-compute-cluster/tutorial.html\">             <div>Step 11</div>             <div>connect-to-compute-cluster</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/job-destinations/tutorial.html\">             <div>Step 12</div>             <div>job-destinations</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/pulsar/tutorial.html\">             <div>Step 13</div>             <div>pulsar</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/celery/tutorial.html\">             <div>Step 14</div>             <div>celery</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"active\">         <a href=\"/training-material/topics/admin/tutorials/gxadmin/tutorial.html\">             <div>Step 15</div>             <div>gxadmin</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/reports/tutorial.html\">             <div>Step 16</div>             <div>reports</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/monitoring/tutorial.html\">             <div>Step 17</div>             <div>monitoring</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/tiaas/tutorial.html\">             <div>Step 18</div>             <div>tiaas</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/sentry/tutorial.html\">             <div>Step 19</div>             <div>sentry</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/ftp/tutorial.html\">             <div>Step 20</div>             <div>ftp</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/beacon/tutorial.html\">             <div>Step 21</div>             <div>beacon</div>         </a>     </li>           </ol> </blockquote>\n<p><!--END_SNIPPET--></p>\n"],"ref_slides":["# Database Queries\n\nSometimes it's the best way to get the exact data you need\n\nCan be very useful for:\n- Debugging\n- Reporting\n- Analytics\n\nBut consider: [`gxadmin`](https://github.com/usegalaxy-eu/gxadmin) and sharing your SQL\n\n???\n\n- Admins often need to run database queries.\n- Debugging the live application in production is difficult, but running queries is easy.\n- Additionally running SQL queries is commonly used for debuggin and reporting and analytics.\n- The community collects queries we commonly use in a program called gxadmin.\n\n---\n# Database Queries\n\n\"Can you send me the number of jobs per day/state from Main in September and October?\"\n\n```sql\nSELECT\n  date_trunc('month', j.create_time) AS month,\n  j.state,\n  COUNT(j.state) AS job_count\nFROM job j\nLEFT OUTER JOIN galaxy_user u\n  ON j.user_id = u.id\nWHERE u.email != 'monitor@bx.psu.edu'\nGROUP BY month,\n         j.state\nHAVING date_trunc('month', j.create_time) >= '2016-09-01'\nAND date_trunc('month', j.create_time) < '2016-11-01'\nORDER BY month, j.state;\n```\n\n???\n\n- We often get requests like how many jobs were run in a time period, and did they finish successfully.\n- So we write some SQL like this.\n- As an admin, you'll want to understand SQL.\n\n---\n# Database Queries\n\n```console\n        month        |  state  | job_count\n---------------------+---------+-----------\n 2016-09-01 00:00:00 | deleted |     11369\n 2016-09-01 00:00:00 | error   |     15375\n 2016-09-01 00:00:00 | new     |      1179\n 2016-09-01 00:00:00 | ok      |    165963\n 2016-09-01 00:00:00 | paused  |       933\n 2016-09-01 00:00:00 | waiting |         9\n 2016-10-01 00:00:00 | deleted |     13190\n 2016-10-01 00:00:00 | error   |     12539\n 2016-10-01 00:00:00 | new     |      1183\n 2016-10-01 00:00:00 | ok      |    167547\n 2016-10-01 00:00:00 | paused  |       645\n 2016-10-01 00:00:00 | queued  |        75\n 2016-10-01 00:00:00 | running |        36\n 2016-10-01 00:00:00 | waiting |        17\n(14 rows)\n```\n\n???\n\n- Here is the output of such a query.\n- SQL is very powerful for extracting data and graphs for reporting.\n\n---\n# gxadmin\n\n- It's unpleasant to write queries every time you need them.\n- So the community collects SQL in `gxadmin`.\n- It's a giant bash script full of SQL and some magic ✨\n- [github.com/usegalaxy-eu/gxadmin](https://github.com/usegalaxy-eu/gxadmin)\n\n???\n\n- We often re-run the same queries.\n- gxadmin makes it easier by storing the useful queries.\n- everyone is welcome to contribute to it.\n\n---\n# Database Queries\n\n\"I need a list of current main toolshed users and a number of their repos\"\n\n```console\n$ gxadmin query ts-repos\n```\n\n**OR**\n\n```sql\nSELECT\n  u.username,\n  COUNT(r.id) AS r_count\nFROM galaxy_user u\nJOIN repository r\n  ON u.id = r.user_id\nWHERE NOT r.deleted\nGROUP BY u.id\nORDER BY r_count DESC\nLIMIT 12;\n```\n\n???\n\n- However, some of these queries we run over and over.\n- And those we include in gxadmin.\n- This way every admin has access to all of the interesting queries we run.\n- And we don't get repetitive strain injury typing SQL.\n\n---\n# Database Queries\n\n```console\n                 username                 | r_count\n------------------------------------------+---------\n iuc                                      |     571\n devteam                                  |     366\n bgruening                                |      95\n galaxyp                                  |      87\n jjohnson                                 |      46\n xuebing                                  |      40\n peterjc                                  |      39\n rnateam                                  |      33\n anton                                    |      32\n nml                                      |      32\n yhoogstrate                              |      31\n iracooke                                 |      30\n(12 rows)\n```\n\n???\n\n- Example output from the previous query.\n\n---\n\n# Database Queries\n\n\"What is the status of this job\"\n\n*Lots* of SQL or: `gxadmin report job-info <job-id>`\n\n```console\n# Galaxy Job 5132146\n\nProperty      | Value\n------------- | -----\n         Tool | toolshed.g2.bx.psu.edu/repos/bgruening/canu/canu/1.7\n        State | running\n      Handler | handler_main_2\n      Created | 2019-04-20 11:04:40.854975+02 (3 days 03:35:04.881599 ago)\nJob Runner/ID | condor / 568537\n        Owner | e08d6c893f5\n\n## Destination Parameters\n\nKey                     |   Value\n---                     |   ---\ndescription             |   `canu`\npriority                |   `-128`\nrequest_cpus            |   `20`\nrequest_memory          |   `64G`\n```\n\n???\n\n- Another extremely common query is: what is the status of this job?\n- There is a gxadmin command which aggregates information about jobs.\n- This can help you debug job failure to run issues.\n\n---\n\n# Database Queries\n\n\"Get me a list of recently registered users\"\n\n```console\n$ gxadmin query latest-users\n```\n\n**OR**\n\n```sql\nSELECT\n\tid,\n\tcreate_time AT TIME ZONE 'UTC' as create_time,\n\tpg_size_pretty(disk_usage) as disk_usage,\n\tusername,\n\temail,\n\tactive\nFROM galaxy_user\nORDER BY create_time desc\nLIMIT 40\n```\n\n???\n\n- Another common query, who has recently joined our server?\n- This is an easy command to write, but it is also included in gxadmin.\n\n---\n\n# Database Queries\n\n```console\n\n  id  |          create_time   | disk_usage |  username   |    email    |    groups    | active\n------+------------------------+------------+-------------+-------------+--------------+--------\n 5581 | 2019-04-23 14:53:58+02 |            | xxx         | xxx         |              | t\n 5580 | 2019-04-23 11:25:03+02 | 1222 MB    | xxx         | xxx         |              | t\n 5579 | 2019-04-23 10:40:30+02 | 841 MB     | xxx         | xxx         |              | t\n 5578 | 2019-04-23 10:31:50+02 |            | xxx         | xxx         |              | t\n 5577 | 2019-04-23 10:27:21+02 | 0 bytes    | xxx         | xxx         |              | t\n 5576 | 2019-04-23 10:07:53+02 |            | xxx         | xxx         |              | t\n 5575 | 2019-04-23 09:04:40+02 | 2011 MB    | xxx         | xxx         | training-gqa | t\n 5574 | 2019-04-23 09:01:58+02 | 296 MB     | xxx         | xxx         |              | t\n 5573 | 2019-04-23 08:58:42+02 | 605 MB     | xxx         | xxx         |              | t\n 5572 | 2019-04-23 08:58:17+02 | 1762 MB    | xxx         | xxx         | training-gqa | t\n 5571 | 2019-04-23 08:56:11+02 | 0 bytes    | xxx         | xxx         |              | f\n 5570 | 2019-04-23 08:55:57+02 | 1759 MB    | xxx         | xxx         | training-gqa | t\n 5569 | 2019-04-23 08:43:21+02 | 1621 MB    | xxx         | xxx         |              | t\n 5568 | 2019-04-23 07:48:38+02 |            | xxx         | xxx         |              | t\n 5567 | 2019-04-23 05:12:43+02 |            | xxx         | xxx         |              | t\n```\n\n???\n\n- Example output of the previous query.\n- With SQL you can choose just the columns or data that is relevant to you.\n- This may not be so easily available in the interface.\n\n---\n\n# Tabular Output\n\nConverting SQL query output to tabular and other formats\n\n```SQL\nCOPY (...) to STDOUT with CSV DELIMITER E'\\t'\n```\n\n**or**\n\n```console\n$ gxadmin query ...\n$ gxadmin tsvquery ...\n$ gxadmin csvquery ...\n```\n\n???\n\n- However to reuse this data in other applications, the postgres format is not convenient.\n- There is special syntax you can use to output CSV.\n- gxadmin includes query variants to do this as well.\n\n---\n\n# Monitoring\n\nTelegraf can consume Influx formatted output, which `gxadmin` can produce:\n\n```console\n$ gxadmin iquery queue\nqueue,tool_id=ncbi_blastx_wrapper/0.3.1,state=running count=76\nqueue,tool_id=rna_star/2.6.0b-2,state=queued count=36\nqueue,tool_id=rna_star/2.6.0b-2,state=running count=15\nqueue,tool_id=unicycler/0.4.7.0,state=running count=10\nqueue,tool_id=hisat2/2.1.0+galaxy4,state=running count=9\n```\n\n???\n\n- For monitoring, many galaxy sites use Influx DB.\n- gxadmin supports exporting influx compatible format.\n- This makes it easy to add new data and graphs to your monitoring.\n"],"hands_on":true,"slides":true,"mod_date":"2024-05-31 14:27:26 +0000","pub_date":"2019-01-28 04:20:16 +0000","version":43,"api":"https://training.galaxyproject.org/training-material/api/topics/admin/tutorials/gxadmin/tutorial.json","tools":[],"supported_servers":[],"topic_name_human":"Galaxy Server administration","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools: []\n","tours":false,"video":true,"slides_recordings":[{"captioners":["hexylena"],"date":"2021-02-15","galaxy_version":"21.01","length":"2M","youtube_id":"QFwOgDyFSSA","speakers":["awspolly"]}],"translations":{"tutorial":[],"slides":[],"video":true},"license":"CC-BY-4.0","type":"tutorial"}