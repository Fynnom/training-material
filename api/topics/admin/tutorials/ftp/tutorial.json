{"layout":"tutorial_hands_on","title":"Enable upload via FTP","zenodo_link":"","questions":["How can I setup FTP to be easy for my users?","Can I authenticate ftp users with Galaxy credentials?"],"objectives":["Configure galaxy and install a FTP server.","Use an Ansible playbook for this."],"time_estimation":"1h","key_points":["FTP is easy to deploy thanks to the role","Users can be authenticated with their Galaxy credentials simplifying the user management process significantly"],"contributors":[{"name":"Lucille Delisle","email":"lucille.delisle@epfl.ch","orcid":"0000-0002-1964-4960","joined":"2019-08","elixir_node":"ch","contact_for_training":true,"location":{"country":"CH","lat":46.52,"lon":6.56},"affiliations":["elixir-europe"],"id":"lldelisle","url":"https://training.galaxyproject.org/training-material/api/contributors/lldelisle.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/lldelisle/"}],"subtopic":"features","requirements":[{"type":"internal","topic_name":"admin","tutorials":["ansible","ansible-galaxy"]}],"abbreviations":{"FTP":"File Transfer Protocol","NAT":"Network Address Translation"},"tags":["data","git-gat"],"js_requirements":{"mathjax":null,"mermaid":false},"short_id":"T00008","url":"/topics/admin/tutorials/ftp/tutorial.html","topic_name":"admin","tutorial_name":"ftp","dir":"topics/admin/tutorials/ftp","symlink":null,"id":"admin/ftp","ref_tutorials":["<p>This tutorial will guide you to setup an File Transfer Protocol (FTP) server so galaxy users can use it to upload large files. Indeed, as written on the <a href=\"https://galaxyproject.org/ftp-upload/\">galaxy community hub</a>, uploading data directly from the browser can be unreliable and cumbersome. FTP will allow users to monitor the upload status as well as resume interrupted transfers.</p>\n\n<blockquote class=\"agenda\">\n  <agenda-title></agenda-title>\n\n<ol id=\"markdown-toc\">\n  <li><a href=\"#ftp\" id=\"markdown-toc-ftp\">FTP</a></li>\n  <li><a href=\"#ftp-and-galaxy\" id=\"markdown-toc-ftp-and-galaxy\">FTP and Galaxy</a>    <ol>\n      <li><a href=\"#installing-and-configuring\" id=\"markdown-toc-installing-and-configuring\">Installing and Configuring</a></li>\n      <li><a href=\"#check-it-works\" id=\"markdown-toc-check-it-works\">Check it works</a></li>\n    </ol>\n  </li>\n</ol>\n\n</blockquote>\n\n<!--SNIPPET-->\n<blockquote class=\"comment\">   <div class=\"box-title comment-title\" id=\"comment-galaxy-admin-training-path\"><i class=\"far fa-comment-dots\" aria-hidden=\"true\"></i> Comment: Galaxy Admin Training Path</div>   <p>The yearly Galaxy Admin Training follows a specific ordering of tutorials. Use this timeline to help keep track of where you are in Galaxy Admin Training.</p>   <ol id=\"git-gat-timeline\">                    <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html\">             <div>Step 1</div>             <div>ansible-galaxy</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/backup-cleanup/tutorial.html\">             <div>Step 2</div>             <div>backup-cleanup</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/customization/tutorial.html\">             <div>Step 3</div>             <div>customization</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/tus/tutorial.html\">             <div>Step 4</div>             <div>tus</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/cvmfs/tutorial.html\">             <div>Step 5</div>             <div>cvmfs</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/apptainer/tutorial.html\">             <div>Step 6</div>             <div>apptainer</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/tool-management/tutorial.html\">             <div>Step 7</div>             <div>tool-management</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/reference-genomes/tutorial.html\">             <div>Step 8</div>             <div>reference-genomes</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/data-library/tutorial.html\">             <div>Step 9</div>             <div>data-library</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/dev/tutorials/bioblend-api/tutorial.html\">             <div>Step 10</div>             <div>dev/bioblend-api</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/connect-to-compute-cluster/tutorial.html\">             <div>Step 11</div>             <div>connect-to-compute-cluster</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/job-destinations/tutorial.html\">             <div>Step 12</div>             <div>job-destinations</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/pulsar/tutorial.html\">             <div>Step 13</div>             <div>pulsar</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/celery/tutorial.html\">             <div>Step 14</div>             <div>celery</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/gxadmin/tutorial.html\">             <div>Step 15</div>             <div>gxadmin</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/reports/tutorial.html\">             <div>Step 16</div>             <div>reports</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/monitoring/tutorial.html\">             <div>Step 17</div>             <div>monitoring</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/tiaas/tutorial.html\">             <div>Step 18</div>             <div>tiaas</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/sentry/tutorial.html\">             <div>Step 19</div>             <div>sentry</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"active\">         <a href=\"/training-material/topics/admin/tutorials/ftp/tutorial.html\">             <div>Step 20</div>             <div>ftp</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/beacon/tutorial.html\">             <div>Step 21</div>             <div>beacon</div>         </a>     </li>           </ol> </blockquote>\n<p><!--END_SNIPPET--></p>\n\n<h1 id=\"ftp\">FTP</h1>\n\n<p><abbr title=\"File Transfer Protocol\">FTP</abbr> is a very old and reliable communication protocol that has been around since 1971 <span class=\"citation\"><a href=\"#rfc114\">Bhushan 1971</a></span>. It requires a server (here our galaxy server) and a client (user’s computer). The FTP server requires to have at least 2 ports accessible from outside (one for the commands and one for the transfer). Usually the port for the command is 21.</p>\n\n<p>FTP supports two different modes: active, and passive. Active mode requires that the user’s computer be reachable from the internet, which in the age of Network Address Translation (NAT) and firewalls is usually unusable. So passive mode is the most commonly used. In passive mode, a client connects to the FTP server, and requests a channel for sending files. The server responds with an IP and port, from its range of “Passive Ports”.</p>\n\n<blockquote class=\"comment\">\n  <comment-title>Requirements for Running This Tutorial</comment-title>\n\n  <p>Your VM or wherever you are installing Galaxy needs to have the following ports available:</p>\n\n  <ul>\n    <li>21</li>\n    <li>Some high range of ports not used by another service, e.g. 56k-60k</li>\n  </ul>\n\n  <p>You need to know which ports are open so you can use them for the transfer (PassivePorts). In this training we assume that 56k to 60k are open.</p>\n\n  <p>Which ports precisely is not important, and these numbers can differ between sites.</p>\n</blockquote>\n\n<h1 id=\"ftp-and-galaxy\">FTP and Galaxy</h1>\n\n<p>To allow your user to upload via FTP, you will need to:</p>\n\n<ul>\n  <li>configure Galaxy to know where the files are uploaded.</li>\n  <li>install a FTP server</li>\n  <li>allow your FTP server to read Galaxy’s database so users can use their credential and upload in the good directory.</li>\n</ul>\n\n<p>For secure transmission we will use SSL/TLS (FTPS), not the SSH File Transfer Protocol (SFTP) as the Galaxy users don’t correspond to users on the machine.</p>\n\n<h2 id=\"installing-and-configuring\">Installing and Configuring</h2>\n\n<p>Luckily for us, there is an ansible role written by the Galaxy Project for this purpose. It will install proftpd. Firstly, we need to install the role and then update our playbook for using it.</p>\n\n<p>If the terms “Ansible”, “role” and “playbook” mean nothing to you, please checkout <a href=\"/training-material/topics/admin/tutorials/ansible/slides.html\">the Ansible introduction slides</a> and <a href=\"/training-material/topics/admin/tutorials/ansible/tutorial.html\">the Ansible introduction tutorial</a></p>\n\n<!--SNIPPET-->\n<blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-running-ansible-on-your-remote-machine\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-running-ansible-on-your-remote-machine\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Running Ansible on your remote machine</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p>It is possible to have ansible installed on the remote machine and run it there, not just from your local machine connecting to the remote machine.</p>   <p>Your hosts file will need to use <code class=\"language-plaintext highlighter-rouge\">localhost</code>,  and whenever you run playbooks with <code class=\"language-plaintext highlighter-rouge\">ansible-playbook -i hosts playbook.yml</code>, you will need to add <code class=\"language-plaintext highlighter-rouge\">-c local</code> to your command.</p>   <p>Be <strong>certain</strong> that the playbook that you’re writing on the remote machine is stored somewhere safe, like your user home directory, or backed up on your local machine. The cloud can be unreliable and things can disappear at any time.</p> </blockquote>\n<p><!--END_SNIPPET--></p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Setting up ftp upload with Ansible</hands-on-title>\n\n  <ol>\n    <li>\n      <p>In your playbook directory, add the <code class=\"language-plaintext highlighter-rouge\">galaxyproject.proftpd</code> role to your <code class=\"language-plaintext highlighter-rouge\">requirements.yml</code></p>\n\n      <div data-commit=\"Add requirement\" class=\"language-diff highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"gd\">--- a/requirements.yml\n</span><span class=\"gi\">+++ b/requirements.yml\n</span><span class=\"p\">@@ -57,3 +57,6 @@</span>\n # Sentry\n - name: mvdbeek.sentry_selfhosted\n   src: https://github.com/mvdbeek/ansible-role-sentry/archive/main.tar.gz\n<span class=\"gi\">+# Our FTP Server\n+- src: galaxyproject.proftpd\n+  version: 0.3.1\n</span>   \n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p>Install the role with:</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div data-cmd=\"true\" class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>ansible-galaxy <span class=\"nb\">install</span> <span class=\"nt\">-p</span> roles <span class=\"nt\">-r</span> requirements.yml\n</code></pre></div>        </div>\n      </blockquote>\n    </li>\n    <li>\n      <p>As in this training we are using certbot, we will ask for a private key for proftpd. Add the following line to your <code class=\"language-plaintext highlighter-rouge\">group_vars/galaxyserver.yml</code> file:</p>\n\n      <div data-commit=\"Add proftpd in certbot\" class=\"language-diff highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"gd\">--- a/group_vars/galaxyservers.yml\n</span><span class=\"gi\">+++ b/group_vars/galaxyservers.yml\n</span><span class=\"p\">@@ -210,11 +210,13 @@</span> certbot_environment: staging\n certbot_well_known_root: /srv/nginx/_well-known_root\n certbot_share_key_users:\n   - www-data\n<span class=\"gi\">+  - proftpd\n</span> certbot_share_key_ids:\n   - \"999:999\"\n certbot_post_renewal: |\n     systemctl restart nginx || true\n     docker restart rabbit_hole || true\n<span class=\"gi\">+    systemctl restart proftpd || true\n</span> certbot_domains:\n  - \"{{ inventory_hostname }}\"\n certbot_agree_tos: --agree-tos\n   \n</code></pre></div>      </div>\n\n      <p>This will make a copy of the current letsencrypt key available as <code class=\"language-plaintext highlighter-rouge\">/etc/ssl/user/privkey-proftpd.pem</code>, and automatically restart proftpd every time the key is updated.</p>\n    </li>\n    <li>\n      <p>We will configure Galaxy to enable ftp file upload. Add the following line to your <code class=\"language-plaintext highlighter-rouge\">group_vars/galaxyserver.yml</code> file in the galaxy_config/galaxy section:</p>\n\n      <div data-commit=\"Add ftp vars in galaxy\" class=\"language-diff highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"gd\">--- a/group_vars/galaxyservers.yml\n</span><span class=\"gi\">+++ b/group_vars/galaxyservers.yml\n</span><span class=\"p\">@@ -122,6 +122,9 @@</span> galaxy_config:\n     sentry_dsn: \"{{ vault_galaxy_sentry_dsn }}\"\n     sentry_traces_sample_rate: 0.5\n     error_report_file: \"{{ galaxy_config_dir }}/error_reports_file.yml\"\n<span class=\"gi\">+    # FTP\n+    ftp_upload_dir: /data/uploads\n+    ftp_upload_site: \"{{ inventory_hostname }}\"\n</span>   gravity:\n     process_manager: systemd\n     galaxy_root: \"{{ galaxy_root }}/server\"\n   \n</code></pre></div>      </div>\n    </li>\n  </ol>\n\n  <p>To check the other options for setting up ftp in Galaxy, please check the <a href=\"https://docs.galaxyproject.org/en/master/admin/galaxy_options.html?highlight=ftp_upload_site#ftp-upload-dir\">Galaxy configuration documentation</a>.</p>\n\n  <ol>\n    <li>\n      <p>Then we will set the different variables for proftpd. Add the following lines to your <code class=\"language-plaintext highlighter-rouge\">group_vars/galaxyserver.yml</code> file. Please replace the PassivePorts below with the range of ports that are appropriate for your machine!</p>\n\n      <div data-commit=\"Add proftpd variables\" class=\"language-diff highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"gd\">--- a/group_vars/galaxyservers.yml\n</span><span class=\"gi\">+++ b/group_vars/galaxyservers.yml\n</span><span class=\"p\">@@ -366,3 +366,24 @@</span> telegraf_plugins_extra:\n tiaas_dir: /srv/tiaas\n tiaas_admin_user: admin\n tiaas_admin_pass: changeme\n<span class=\"gi\">+\n+# Proftpd:\n+proftpd_galaxy_auth: yes\n+galaxy_ftp_upload_dir: \"{{ galaxy_config.galaxy.ftp_upload_dir }}\"\n+proftpd_display_connect: |\n+  {{ inventory_hostname }} FTP server\n+\n+  Unauthorized access is prohibited\n+proftpd_create_ftp_upload_dir: yes\n+proftpd_options:\n+  - User: galaxy\n+  - Group: galaxy\n+  - Port: 21\n+proftpd_sql_db: galaxy@/var/run/postgresql\n+proftpd_sql_user: galaxy\n+proftpd_conf_ssl_certificate: /etc/ssl/certs/cert.pem\n+proftpd_conf_ssl_certificate_key: /etc/ssl/user/privkey-proftpd.pem\n+proftpd_global_options:\n+  - PassivePorts: 56000 60000\n+proftpd_use_mod_tls_shmcache: false\n+proftpd_tls_options: NoSessionReuseRequired\n</span>   \n</code></pre></div>      </div>\n\n      <p>Here is a description of the set variables:</p>\n\n      <table>\n        <thead>\n          <tr>\n            <th>Variable</th>\n            <th>Description</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr>\n            <td><code class=\"language-plaintext highlighter-rouge\">proftpd_galaxy_auth</code></td>\n            <td>Attempt to authenticate users against a Galaxy database.</td>\n          </tr>\n          <tr>\n            <td><code class=\"language-plaintext highlighter-rouge\">galaxy_ftp_upload_dir</code></td>\n            <td>Path to the Galaxy FTP upload directory, should match <code class=\"language-plaintext highlighter-rouge\">ftp_upload_dir</code> in your Galaxy config.</td>\n          </tr>\n          <tr>\n            <td><code class=\"language-plaintext highlighter-rouge\">proftpd_display_connect</code></td>\n            <td>Message to display when users connect to the FTP server. This should be the message, not the path to a file.</td>\n          </tr>\n          <tr>\n            <td><code class=\"language-plaintext highlighter-rouge\">proftpd_create_ftp_upload_dir</code></td>\n            <td>Whether to allow the role to create this with owner <code class=\"language-plaintext highlighter-rouge\">galaxy_user</code>.</td>\n          </tr>\n          <tr>\n            <td><code class=\"language-plaintext highlighter-rouge\">proftpd_options</code></td>\n            <td>Any option for proftpd, we will just set up the user and group of the <code class=\"language-plaintext highlighter-rouge\">galaxy_user</code>.</td>\n          </tr>\n          <tr>\n            <td><code class=\"language-plaintext highlighter-rouge\">proftpd_sql_db</code></td>\n            <td>Database name to connect to for authentication info.</td>\n          </tr>\n          <tr>\n            <td><code class=\"language-plaintext highlighter-rouge\">proftpd_sql_user</code></td>\n            <td>(default: the value of galaxy_user): Value of the username parameter to SQLConnectInfo.</td>\n          </tr>\n          <tr>\n            <td><code class=\"language-plaintext highlighter-rouge\">proftpd_conf_ssl_certificate</code></td>\n            <td>Path on the remote host where the SSL certificate file is.</td>\n          </tr>\n          <tr>\n            <td><code class=\"language-plaintext highlighter-rouge\">proftpd_conf_ssl_certificate_key</code></td>\n            <td>Path on the remote host where the SSL private key file is.</td>\n          </tr>\n          <tr>\n            <td><code class=\"language-plaintext highlighter-rouge\">proftpd_global_options</code></td>\n            <td>Set arbitrary options in the <Global> context. We set here the PassivePorts range.</Global></td>\n          </tr>\n          <tr>\n            <td><code class=\"language-plaintext highlighter-rouge\">proftpd_use_mod_tls_shmcache</code></td>\n            <td>By default proftpd uses <code class=\"language-plaintext highlighter-rouge\">mod_tls_shmcache</code> which is not installed on the server so we just disable it.</td>\n          </tr>\n          <tr>\n            <td><code class=\"language-plaintext highlighter-rouge\">proftpd_tls_options</code></td>\n            <td>Additional options for tls. We will use <code class=\"language-plaintext highlighter-rouge\">NoSessionReuseRequired</code></td>\n          </tr>\n        </tbody>\n      </table>\n\n      <blockquote class=\"tip\">\n        <tip-title>Why NoSessionReuseRequired?</tip-title>\n        <p><code class=\"language-plaintext highlighter-rouge\">mod_tls</code> only accepts SSL/TLS data connections that reuse the SSL session of the control connection, as a security measure. Unfortunately, there are some clients (e.g. curl/Filezilla) which do not reuse SSL sessions.\nTo relax the requirement that the SSL session from the control connection be reused for data connections we set <code class=\"language-plaintext highlighter-rouge\">NoSessionReuseRequired</code>.</p>\n      </blockquote>\n    </li>\n    <li>\n      <p>Add the new role to the list of roles under the <code class=\"language-plaintext highlighter-rouge\">roles</code> key in your playbook, <code class=\"language-plaintext highlighter-rouge\">galaxy.yml</code>:</p>\n\n      <div data-commit=\"Add role to playbook\" class=\"language-diff highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"gd\">--- a/galaxy.yml\n</span><span class=\"gi\">+++ b/galaxy.yml\n</span><span class=\"p\">@@ -45,6 +45,7 @@</span>\n     - geerlingguy.redis\n     - usegalaxy_eu.flower\n     - galaxyproject.nginx\n<span class=\"gi\">+    - galaxyproject.proftpd\n</span>     - geerlingguy.docker\n     - usegalaxy_eu.rabbitmqserver\n     - galaxyproject.tiaas2\n   \n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p>Run the playbook</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div data-cmd=\"true\" class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>ansible-playbook galaxy.yml\n</code></pre></div>        </div>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>Congratulations, you’ve set up FTP for Galaxy.</p>\n\n<h2 id=\"check-it-works\">Check it works</h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Checking proftpd from the server</hands-on-title>\n\n  <ol>\n    <li>\n      <p>SSH into your machine</p>\n    </li>\n    <li>\n      <p>Check the active status of proftpd by <code class=\"language-plaintext highlighter-rouge\">systemctl status proftpd</code>.</p>\n    </li>\n    <li>\n      <p>Check the port has been correctly attributed by <code class=\"language-plaintext highlighter-rouge\">sudo lsof -i -P -n</code>.</p>\n\n      <blockquote class=\"question\">\n        <question-title></question-title>\n\n        <p>What do you see?</p>\n\n        <blockquote class=\"solution\">\n          <solution-title></solution-title>\n          <p>You should see all the ports used by the server. What interests us is the line with proftpd.\nYou should see TCP *:21 (LISTEN).</p>\n\n        </blockquote>\n\n      </blockquote>\n    </li>\n    <li>\n      <p>Check the directory <code class=\"language-plaintext highlighter-rouge\">/data/uploads/</code> has been created and is empty.</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>sudo tree /data/uploads/\n</code></pre></div>        </div>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"hidden\">\n  <div data-test=\"true\" class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>1.sh\n</code></pre></div>  </div>\n</blockquote>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Checking galaxy detected the ftp possibility</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Open your galaxy in a browser.</p>\n    </li>\n    <li>\n      <p>Log in with a user (FTP is only possible for authenticated sessions).</p>\n    </li>\n    <li>\n      <p>Click on the upload button. You should now see on the bottom “Choose FTP files”</p>\n    </li>\n    <li>\n      <p>Click on the Choose FTP files button. You should see a message “Your FTP directory does not contain any files.”</p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>It’s working!</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Upload your first file</hands-on-title>\n\n  <p>There are three options for uploading files, you can choose whichever is easiest for you.</p>\n\n  <ol>\n    <li>\n      <p><strong>FileZilla</strong></p>\n\n      <ol>\n        <li>Follow the <a href=\"https://galaxyproject.org/ftp-upload/\">tutorial</a> to upload a file.</li>\n        <li>You will have a message which ask you to approve the certificate, approve it.</li>\n      </ol>\n    </li>\n    <li>\n      <p><strong>lftp</strong></p>\n\n      <p>You can use locally lftp to test the ftp.</p>\n\n      <ol class=\"tip\">\n        <li>Install lftp with <code class=\"language-plaintext highlighter-rouge\">sudo apt-get install lftp</code>.</li>\n        <li>Add the public certificate to the list of known certificates (only for LetsEncrypt Staging Certificates!):\n          <blockquote class=\"code-in\">\n            <code-in-title>Bash</code-in-title>\n            <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>mkdir .lftp\necho \"set ssl:ca-file \\\"/etc/ssl/certs/cert.pem\\\"\" &gt; .lftp/rc\n</code></pre></div>            </div>\n          </blockquote>\n        </li>\n        <li>Connect to the server with for example the admin account:\n          <blockquote class=\"code-in\">\n            <code-in-title>Bash</code-in-title>\n            <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>lftp admin@example.org@$HOSTNAME\n</code></pre></div>            </div>\n          </blockquote>\n        </li>\n        <li>Enter the password of the admin@example.org galaxy user.</li>\n        <li>\n          <p>Put a random file:</p>\n\n          <p><code class=\"language-plaintext highlighter-rouge\">put /srv/galaxy/server/CITATION</code></p>\n        </li>\n        <li>Check it is there with <code class=\"language-plaintext highlighter-rouge\">ls</code>.</li>\n        <li>Leave lftp with <code class=\"language-plaintext highlighter-rouge\">quit</code>.</li>\n      </ol>\n    </li>\n    <li>\n      <p><strong>Curl</strong></p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>curl -T {\"/srv/galaxy/server/CITATION\"} ftp://localhost --user admin@example.org:password --ssl -k\n</code></pre></div>        </div>\n        <p>Here <code class=\"language-plaintext highlighter-rouge\">-T</code> says to upload a file, <code class=\"language-plaintext highlighter-rouge\">--ssl</code> ensures that the FTP connection is SSL/TLS encrypted, and <code class=\"language-plaintext highlighter-rouge\">-k</code> ignores any certificate issues as the hostname <code class=\"language-plaintext highlighter-rouge\">localhost</code> will not match the certificate we have.</p>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Check where the file has been uploaded</hands-on-title>\n\n  <ol>\n    <li>\n      <p>SSH into your machine</p>\n    </li>\n    <li>\n      <p>Check the directory <code class=\"language-plaintext highlighter-rouge\">/uploads/</code>.</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>sudo tree /uploads/\n</code></pre></div>        </div>\n      </blockquote>\n\n      <blockquote class=\"question\">\n        <question-title></question-title>\n\n        <p>What do you see?</p>\n\n        <blockquote class=\"solution\">\n          <solution-title></solution-title>\n          <p>As I uploaded a file called <code class=\"language-plaintext highlighter-rouge\">CITATION</code> with the admin@example.org user I see:</p>\n          <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>/uploads/\n└── admin@example.org\n    └── CITATION\n</code></pre></div>          </div>\n\n        </blockquote>\n\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Use it in galaxy</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Open your galaxy in a browser.</p>\n    </li>\n    <li>\n      <p>Log in with the user you used to upload the file.</p>\n    </li>\n    <li>\n      <p>Click on the upload button.</p>\n    </li>\n    <li>\n      <p>Click on the Choose FTP files button. You should see your file.</p>\n    </li>\n    <li>\n      <p>Click on it and click on Start to launch the upload. It should go to your history as a new dataset.</p>\n    </li>\n    <li>\n      <p>Click again on Choose FTP files button. Your file has disappeared. By default, the files are removed from the FTP at import.</p>\n\n      <blockquote class=\"tip\">\n        <tip-title>You want to change this behaviour?</tip-title>\n        <p>You just need to add <code class=\"language-plaintext highlighter-rouge\">ftp_upload_purge: false</code> to the galaxy_config/galaxy variables (next to <code class=\"language-plaintext highlighter-rouge\">ftp_upload_dir</code>).</p>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>Congratulations! Let your users know this is an option, many of them will prefer to start large uploads from an FTP client.</p>\n\n<!--SNIPPET-->\n<blockquote class=\"hands_on\">   <div class=\"box-title hands_on-title\" id=\"hands-on-time-to-git-commit\"><i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i> Hands-on: Time to git commit</div>   <p>It’s time to commit your work! Check the status with</p>   <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>git status<br /></code></pre></div></div>   <p>Add your changed files with</p>   <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>git add ... # any files you see that are changed<br /></code></pre></div></div>   <p>And then commit it!</p>   <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>git commit -m 'Finished Enable upload via FTP'<br /></code></pre></div></div> </blockquote>\n<p><!--END_SNIPPET--></p>\n\n<!--SNIPPET-->\n<blockquote class=\"comment\">   <div class=\"box-title comment-title\" id=\"comment-got-lost-along-the-way\"><i class=\"far fa-comment-dots\" aria-hidden=\"true\"></i> Comment: Got lost along the way?</div>   <p>If you missed any steps, you can compare against the <a href=\"https://github.com/hexylena/git-gat/tree/step-16\">reference files</a>, or see what changed since <a href=\"https://github.com/hexylena/git-gat/compare/step-15...step-16#files_bucket\">the previous tutorial</a>.</p>   <p>If you’re using <code class=\"language-plaintext highlighter-rouge\">git</code> to track your progress, remember to add your changes and commit with a good commit message!</p> </blockquote>\n<p><!--END_SNIPPET--></p>\n\n<!--SNIPPET-->\n<blockquote class=\"comment\">   <div class=\"box-title comment-title\" id=\"comment-galaxy-admin-training-path-1\"><i class=\"far fa-comment-dots\" aria-hidden=\"true\"></i> Comment: Galaxy Admin Training Path</div>   <p>The yearly Galaxy Admin Training follows a specific ordering of tutorials. Use this timeline to help keep track of where you are in Galaxy Admin Training.</p>   <ol id=\"git-gat-timeline\">                    <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html\">             <div>Step 1</div>             <div>ansible-galaxy</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/backup-cleanup/tutorial.html\">             <div>Step 2</div>             <div>backup-cleanup</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/customization/tutorial.html\">             <div>Step 3</div>             <div>customization</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/tus/tutorial.html\">             <div>Step 4</div>             <div>tus</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/cvmfs/tutorial.html\">             <div>Step 5</div>             <div>cvmfs</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/apptainer/tutorial.html\">             <div>Step 6</div>             <div>apptainer</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/tool-management/tutorial.html\">             <div>Step 7</div>             <div>tool-management</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/reference-genomes/tutorial.html\">             <div>Step 8</div>             <div>reference-genomes</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/data-library/tutorial.html\">             <div>Step 9</div>             <div>data-library</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/dev/tutorials/bioblend-api/tutorial.html\">             <div>Step 10</div>             <div>dev/bioblend-api</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/connect-to-compute-cluster/tutorial.html\">             <div>Step 11</div>             <div>connect-to-compute-cluster</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/job-destinations/tutorial.html\">             <div>Step 12</div>             <div>job-destinations</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/pulsar/tutorial.html\">             <div>Step 13</div>             <div>pulsar</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/celery/tutorial.html\">             <div>Step 14</div>             <div>celery</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/gxadmin/tutorial.html\">             <div>Step 15</div>             <div>gxadmin</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/reports/tutorial.html\">             <div>Step 16</div>             <div>reports</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/monitoring/tutorial.html\">             <div>Step 17</div>             <div>monitoring</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/tiaas/tutorial.html\">             <div>Step 18</div>             <div>tiaas</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/sentry/tutorial.html\">             <div>Step 19</div>             <div>sentry</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"active\">         <a href=\"/training-material/topics/admin/tutorials/ftp/tutorial.html\">             <div>Step 20</div>             <div>ftp</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/beacon/tutorial.html\">             <div>Step 21</div>             <div>beacon</div>         </a>     </li>           </ol> </blockquote>\n<p><!--END_SNIPPET--></p>\n"],"ref_slides":[],"hands_on":true,"slides":false,"mod_date":"2024-01-31 16:33:56 +0000","pub_date":"2021-06-18 13:52:44 +0000","version":65,"api":"https://training.galaxyproject.org/training-material/api/topics/admin/tutorials/ftp/tutorial.json","tools":[],"supported_servers":[],"topic_name_human":"Galaxy Server administration","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools: []\n","tours":false,"video":false,"slides_recordings":false,"translations":{"tutorial":[],"slides":[],"video":false},"license":"CC-BY-4.0","type":"tutorial"}