{"layout":"tutorial_hands_on","title":"Deploying a compute cluster in OpenStack via Terraform","zenodo_link":"","questions":["What is Terraform?","In which situations is it good/bad?","How to use it for managing your VM cluster"],"objectives":["Learn Terraform basics","Launch a VM with Terraform","Launch and tear down a cluster with Terraform"],"time_estimation":"60m","key_points":["Terraform lets you develop and implement infrastructure-as-code within your organisation","It can drastically simplify management of large numbers of VMs"],"contributors":[{"name":"Helena Rasche","orcid":"0000-0001-9760-8992","maintainer_contact":"gitter","matrix":"hexylena:matrix.org","joined":"2017-09","elixir_node":"nl","affiliations":["gallantries","by-covid","erasmusmc","elixir-europe","elixir-converge"],"former_affiliations":["deNBI","avans-atgm","uni-freiburg"],"contact_for_training":false,"location":{"country":"NL","lat":51.91,"lon":4.46},"id":"hexylena","url":"https://training.galaxyproject.org/training-material/api/contributors/hexylena.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/hexylena/"}],"subtopic":"cloud","tags":["terraform","deploying","cloud"],"priority":3,"js_requirements":{"mathjax":null,"mermaid":false},"short_id":"T00021","url":"/topics/admin/tutorials/terraform/tutorial.html","topic_name":"admin","tutorial_name":"terraform","dir":"topics/admin/tutorials/terraform","symlink":null,"id":"admin/terraform","ref_tutorials":["<h1 id=\"overview\">Overview</h1>\n\n<p>In this tutorial we will briefly cover what <a href=\"https://www.terraform.io\">Terraform</a> is and how you can leverage it for your needs. This will not make you an expert on Terraform but will give you the tools you need in order to maintain your cloud infrastructure as code.</p>\n\n<p>This will be a very practical training with emphasis on looking at examples from modules and becoming self sufficient. This tutorial uses the OpenStack provider for Terraform. Other Cloud providers are available, but their invocation will be different from that which is described here.</p>\n\n<blockquote class=\"agenda\">\n  <agenda-title></agenda-title>\n\n<ol id=\"markdown-toc\">\n  <li><a href=\"#overview\" id=\"markdown-toc-overview\">Overview</a></li>\n  <li><a href=\"#cattle-vs-pets\" id=\"markdown-toc-cattle-vs-pets\">Cattle vs. Pets</a></li>\n  <li><a href=\"#what-is-terraform\" id=\"markdown-toc-what-is-terraform\">What is Terraform?</a>    <ol>\n      <li><a href=\"#what-can-be-managed\" id=\"markdown-toc-what-can-be-managed\">What can be managed</a></li>\n      <li><a href=\"#what-should-be-managed\" id=\"markdown-toc-what-should-be-managed\">What should be managed</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#managing-a-single-vm\" id=\"markdown-toc-managing-a-single-vm\">Managing a Single VM</a>    <ol>\n      <li><a href=\"#keypair\" id=\"markdown-toc-keypair\">Keypair</a></li>\n      <li><a href=\"#adding-an-instance\" id=\"markdown-toc-adding-an-instance\">Adding an Instance</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#managing-a-cluster-of-vms\" id=\"markdown-toc-managing-a-cluster-of-vms\">Managing a Cluster of VMs</a>    <ol>\n      <li><a href=\"#configuration\" id=\"markdown-toc-configuration\">Configuration</a></li>\n      <li><a href=\"#cloud-init\" id=\"markdown-toc-cloud-init\"><code class=\"language-plaintext highlighter-rouge\">cloud-init</code></a></li>\n      <li><a href=\"#login--htcondor--a-test-job\" id=\"markdown-toc-login--htcondor--a-test-job\">Login / HTCondor / A Test Job</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#infrastructure-graph\" id=\"markdown-toc-infrastructure-graph\">Infrastructure Graph</a></li>\n  <li><a href=\"#tearing-everything-down\" id=\"markdown-toc-tearing-everything-down\">Tearing Everything Down</a>    <ol>\n      <li><a href=\"#destroy-time-provisioners\" id=\"markdown-toc-destroy-time-provisioners\">Destroy time provisioners</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#usegalaxyeus-terraform-usage\" id=\"markdown-toc-usegalaxyeus-terraform-usage\">UseGalaxy.eu’s Terraform Usage</a></li>\n</ol>\n\n</blockquote>\n\n<h1 id=\"cattle-vs-pets\">Cattle vs. Pets</h1>\n\n<p>For those of you with more experience as System Administrators, you may have heard the term “cattle vs. pets.”</p>\n\n<dl>\n  <dt>Pets</dt>\n  <dd>These servers are managed by hand, with admins SSHing in to make changes directly on the machine, and no log of this. If a “pet” dies, everyone is sad.</dd>\n  <dt>Cattle</dt>\n  <dd>These servers are managed in bulk, you no longer own a beloved pet but hundreds of identical ones. You stop caring if an individual server lives or dies as you have many identical ones ready to take its place, and you can easily replace them.</dd>\n</dl>\n\n<h1 id=\"what-is-terraform\">What is Terraform?</h1>\n\n<p>Terraform is a tool you can use to “sync” your infrastructure (VMs in Clouds, DNS records, etc.) with code you have written in configuration files. This is known as <strong>infrastructure as code</strong>.\nKnowing that your infrastructure is exactly what you expect it to be can simplify your operations significantly. You can have confidence that if anything changes, any images crash or are accidentally deleted, that you can immediately re-build your infrastructure.</p>\n\n<p>UseGalaxy.eu used Terraform to migrate easily between clouds, when our old cloud shut down and our new cloud was launched. We simply updated the credentials for connecting to the cloud, and ran Terraform. It recognised that none of our existing resources were there and recreated all of them. This made life incredibly easy for us, we knew that our infrastructure would be exactly correct relative to what it looked like in the previous cloud.</p>\n\n<h2 id=\"what-can-be-managed\">What can be managed</h2>\n\n<p>Terraform supports <a href=\"https://www.terraform.io/docs/providers/index.html\">many providers</a>, allowing you to easily manage resources no matter where they are located. Primarily this consists of resources like virtual machines and DNS records.</p>\n\n<p>If you have VMs you are managing, whether for individual projects or for large scale infrastructure like UseGalaxy.eu, your work or research can be simpler and more reproducible if you are doing it with automation like Terraform.</p>\n\n<h2 id=\"what-should-be-managed\">What should be managed</h2>\n\n<p>Support for certain databases and other software is available, but whether or not this is a good idea depends heavily on your workflow. UseGalaxy.eu found that managing databases and database users was not a good fit with our workflow. We launch VMs with terraform and then provision them with ansible. To then have a second step where we re-connect and provision the database with terraform was an awkward workflow, so we mostly let Ansible manage these resources.</p>\n\n<p>Some groups use Ansible or Bash scripts in order to launch VMs. This can be a better workflow for certain cases. Launching VMs that manage themselves or are automatically scaled by some external process is not a good fit. Terraform expects the resource to be there the next time, with the same ID, with the same values, and will alert you if it isn’t.</p>\n\n<h1 id=\"managing-a-single-vm\">Managing a Single VM</h1>\n\n<p>We will start small, by managing a single VM in our cloud account. Make sure you have your OpenStack credentials available.</p>\n\n<blockquote class=\"tip\">\n  <tip-title>Obtaining credentials from OpenStack dashboard</tip-title>\n\n  <p>You can download the environment file with the credentials from the OpenStack dashboard.</p>\n\n  <ul>\n    <li>Log in to the OpenStack dashboard, choose the project for which you want to download the OpenStack RC file, and click “Access &amp; Security”.</li>\n    <li>Click “Download OpenStack RC File” and save the file.</li>\n  </ul>\n</blockquote>\n\n<!-- TODO(hxr): add example DO config? -->\n\n<h2 id=\"keypair\">Keypair</h2>\n\n<p>Terraform reads all files with the extension <code class=\"language-plaintext highlighter-rouge\">.tf</code> in your current directory. Resources can be in a single file, or organised across several different files. We had the best experience by separating out logical groups of resources:</p>\n\n<ul>\n  <li>DNS entries in a single file</li>\n  <li>Security groups in separate <code class=\"language-plaintext highlighter-rouge\">.tf</code> files</li>\n  <li>Keypairs in a single file</li>\n  <li>Servers/Instances in individual files.</li>\n</ul>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Setting up Terraform</hands-on-title>\n\n  <ol>\n    <li>\n      <p><a href=\"https://www.terraform.io/downloads.html\">Install Terraform</a></p>\n    </li>\n    <li>\n      <p>Create a new directory and go into it.</p>\n    </li>\n    <li>\n      <p>Create a <code class=\"language-plaintext highlighter-rouge\">providers.tf</code> file with the following contents:</p>\n\n      <div class=\"language-ini highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"err\">provider</span> <span class=\"err\">\"openstack\"</span> <span class=\"err\">{}</span>\n</code></pre></div>      </div>\n\n      <p>This specifies the configuration for the OpenStack plugin. You can either specify the configuration in the plugin, or it will automatically load the values from the normal OpenStack environment variable names.</p>\n    </li>\n    <li>\n      <p>Run <code class=\"language-plaintext highlighter-rouge\">terraform init</code></p>\n\n      <blockquote class=\"question\">\n        <question-title></question-title>\n\n        <p>What did the output look like?</p>\n\n        <blockquote class=\"solution\">\n          <solution-title></solution-title>\n\n          <p>If this is not the first time you’ve run it, you will see Terraform download any missing providers:</p>\n\n          <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>Initializing provider plugins...\n- Checking for available provider plugins on https://releases.hashicorp.com...\n- Downloading plugin for provider \"openstack\" (1.10.0)...\n\nThe following providers do not have any version constraints in configuration,\nso the latest version was installed.\n\nTo prevent automatic upgrades to new major versions that may contain breaking\nchanges, it is recommended to add version = \"...\" constraints to the\ncorresponding provider blocks in configuration, with the constraint strings\nsuggested below.\n\n* provider.openstack: version = \"~&gt; 1.10\"\n\nTerraform has been successfully initialized!\n\nYou may now begin working with Terraform. Try running \"terraform plan\" to see\nany changes that are required for your infrastructure. All Terraform commands\nshould now work.\n\nIf you ever set or change modules or backend configuration for Terraform,\nrerun this command to reinitialize your working directory. If you forget, other\ncommands will detect it and remind you to do so if necessary.\n</code></pre></div>          </div>\n\n        </blockquote>\n      </blockquote>\n    </li>\n  </ol>\n</blockquote>\n\n<p>This is the minimum to get started with Terraform, defining which providers we will use and any parameters for them. We have two options now:</p>\n\n<ol>\n  <li>We can load the OpenStack credentials as environment variables</li>\n  <li>We can code the OpenStack credentials in the <code class=\"language-plaintext highlighter-rouge\">providers.tf</code> file</li>\n</ol>\n\n<p>We recommend the first option, as often Terraform plans are <a href=\"https://github.com/usegalaxy-eu/infrastructure\">made publicly available</a> in order to collaborate on them, and this prevents accidentally committing your credentials to the git repository where.</p>\n\n<p>We will start by managing your SSH keypair for the cloud as this is an easy thing to add.</p>\n\n<blockquote class=\"comment\">\n  <comment-title>Your Operating System</comment-title>\n\n  <p>If you are on Windows and do not know your public key, please skip to the “Adding an Instance” section, as you probably do not have the tools installed to do this, and we cannot document how to do it. Instead you can simply reference the key by name later. We will point out this location.</p>\n\n</blockquote>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Keypairs</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Find the public key you will use for connecting to the your new VM. It is usually known as <code class=\"language-plaintext highlighter-rouge\">id_rsa.pub</code></p>\n\n      <blockquote class=\"comment\">\n        <comment-title>No public key</comment-title>\n        <p>If you can find the private key file (possibly a <code class=\"language-plaintext highlighter-rouge\">cloud.pem</code> file you downloaded earlier from OpenStack), then you can find the public key by running the command:</p>\n\n        <div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>ssh-keygen <span class=\"nt\">-y</span> <span class=\"nt\">-f</span> /path/to/key.pem\n</code></pre></div>        </div>\n      </blockquote>\n    </li>\n    <li>\n      <p>Create a new file, <code class=\"language-plaintext highlighter-rouge\">main.tf</code> with the following structure. In <code class=\"language-plaintext highlighter-rouge\">public_key</code>, write the complete value of your public key that you found in the first step.</p>\n\n      <div class=\"language-ini highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"err\">resource</span> <span class=\"err\">\"openstack_compute_keypair_v2\"</span> <span class=\"err\">\"my-cloud-key\"</span> <span class=\"err\">{</span>\n  <span class=\"py\">name</span>       <span class=\"p\">=</span> <span class=\"s\">\"my-key\"</span>\n  <span class=\"py\">public_key</span> <span class=\"p\">=</span> <span class=\"s\">\"ssh-rsa AAAAB3Nz...\"</span>\n<span class=\"err\">}</span>\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p>Run <code class=\"language-plaintext highlighter-rouge\">terraform plan</code></p>\n\n      <blockquote class=\"question\">\n        <question-title></question-title>\n\n        <p>What does the output look like? Did it execute successfully?</p>\n\n        <blockquote class=\"solution\">\n          <solution-title></solution-title>\n\n          <p>If you have not sourced your OpenStack credentials file, you will see something like the following:</p>\n\n          <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>Error: Error running plan: 1 error(s) occurred:\n\n* provider.openstack: One of 'auth_url' or 'cloud' must be specified\n</code></pre></div>          </div>\n\n          <p>You should source your openstack credentials first. This is the file which has lines like:</p>\n\n          <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">export </span><span class=\"nv\">OS_AUTH_URL</span><span class=\"o\">=</span>https://...\n<span class=\"nb\">export </span><span class=\"nv\">OS_PROJECT_ID</span><span class=\"o\">=</span>...\n<span class=\"nb\">export </span><span class=\"nv\">OS_PROJECT_NAME</span><span class=\"o\">=</span><span class=\"s2\">\"...\"</span>\n<span class=\"nb\">export </span><span class=\"nv\">OS_USER_DOMAIN_NAME</span><span class=\"o\">=</span><span class=\"s2\">\"Default\"</span>\n</code></pre></div>          </div>\n\n          <p>You should run <code class=\"language-plaintext highlighter-rouge\">source /path/to/file.sh</code> in your terminal, and then re-run <code class=\"language-plaintext highlighter-rouge\">terraform plan</code>:</p>\n\n          <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>An execution plan has been generated and is shown below.\nResource actions are indicated with the following symbols:\n  + create\n\nTerraform will perform the following actions:\n\n  + openstack_compute_keypair_v2.my-cloud-key\n      id:          &lt;computed&gt;\n      fingerprint: &lt;computed&gt;\n      name:        \"my-key\"\n      private_key: &lt;computed&gt;\n      public_key:  \"ssh-rsa AAAAB....\"\n      region:      &lt;computed&gt;\n\n\nPlan: 1 to add, 0 to change, 0 to destroy.\n</code></pre></div>          </div>\n\n          <p>If you see this, then everything ran successfully</p>\n\n        </blockquote>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>Let’s look at the output in detail:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>An execution plan has been generated and is shown below.\nResource actions are indicated with the following symbols:\n  + create\n\nTerraform will perform the following actions:\n\n  + openstack_compute_keypair_v2.my-cloud-key\n      id:          &lt;computed&gt;\n      fingerprint: &lt;computed&gt;\n      name:        \"my-key\"\n      private_key: &lt;computed&gt;\n      public_key:  \"ssh-rsa AAAAB...\"\n      region:      &lt;computed&gt;\n\n\nPlan: 1 to add, 0 to change, 0 to destroy.\n\n------------------------------------------------------------------------\n\nNote: You didn't specify an \"-out\" parameter to save this plan, so Terraform\ncan't guarantee that exactly these actions will be performed if\n\"terraform apply\" is subsequently run.\n</code></pre></div></div>\n\n<p>Terraform informs us first about the different symbols used. Here it tells us that it will <code class=\"language-plaintext highlighter-rouge\">+ create</code> a resource. Sometimes it will <code class=\"language-plaintext highlighter-rouge\">- delete</code> or <code class=\"language-plaintext highlighter-rouge\">~ update in-place</code>. Next it describes in detail what will be done and why. For creating a resource it does not give us much information, we will see more types of changes later.</p>\n\n<p>Lastly it informs us that we did not save our plan. Terraform can maintain a concept of what the remote resource’s state looks like between your <code class=\"language-plaintext highlighter-rouge\">terraform plan</code> and <code class=\"language-plaintext highlighter-rouge\">terraform apply</code> steps. This is a more advanced feature and will not be covered today.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Applying our plan</hands-on-title>\n\n  <p>Now that you’ve reviewed the plan and everything looks good, we’re ready to apply our changes.</p>\n\n  <ol>\n    <li>\n      <p>Run <code class=\"language-plaintext highlighter-rouge\">terraform apply</code>. Because we did not re-use our plan from the previous step, terraform will re-run the plan step first, and request your confirmation:</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>An execution plan has been generated and is shown below.\nResource actions are indicated with the following symbols:\n  + create\n\nTerraform will perform the following actions:\n\n  + openstack_compute_keypair_v2.my-cloud-key\n      id:          &lt;computed&gt;\n      fingerprint: &lt;computed&gt;\n      name:        \"my-key\"\n      private_key: &lt;computed&gt;\n      public_key:  \"\" =&gt; \"ssh-rsa AAAAB3...\"\n      region:      &lt;computed&gt;\n\n\nPlan: 1 to add, 0 to change, 0 to destroy.\n\nDo you want to perform these actions?\n  Terraform will perform the actions described above.\n  Only 'yes' will be accepted to approve.\n\n  Enter a value:\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p>Confirm that everything looks good and enter the value ‘yes’, and hit enter.</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>openstack_compute_keypair_v2.my-cloud-key: Creating...\n  fingerprint: \"\" =&gt; \"&lt;computed&gt;\"\n  name:        \"\" =&gt; \"my-key\"\n  private_key: \"\" =&gt; \"&lt;computed&gt;\"\n  public_key:  \"\" =&gt; \"ssh-rsa AAAAB3...\"\n  region:      \"\" =&gt; \"&lt;computed&gt;\"\nopenstack_compute_keypair_v2.my-cloud-key: Creation complete after 3s (ID: my-key)\n\nApply complete! Resources: 1 added, 0 changed, 0 destroyed.\n</code></pre></div>      </div>\n\n      <blockquote class=\"comment\">\n        <comment-title>\"Key pair 'my-key' already exists\"</comment-title>\n\n        <p>If you see an error message that says:</p>\n\n        <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>{\"conflictingRequest\": {\"message\": \"Key pair 'my-key' already exists.\", \"code\": 409}}\n</code></pre></div>        </div>\n\n        <p>Then you already have a keypair with this name. You should update the <code class=\"language-plaintext highlighter-rouge\">name = \"my-key\"</code> to use a different name.</p>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>We should now have a keypair in our cloud!</p>\n\n<h2 id=\"adding-an-instance\">Adding an Instance</h2>\n\n<p>We now have:</p>\n\n<ul>\n  <li>Terraform installed</li>\n  <li>The OpenStack plugin initialized</li>\n  <li>A keypair in OpenStack</li>\n</ul>\n\n<blockquote class=\"comment\">\n  <comment-title>Doing this training outside of a training event</comment-title>\n  <p>If you are doing this training outside of an event, then you will likely need to do some additional steps specific to your Cloud:</p>\n\n  <ol>\n    <li>\n      <p>Identify a small image flavor that you can use for your testing.</p>\n    </li>\n    <li>\n      <p>Upload this <code class=\"language-plaintext highlighter-rouge\">raw</code> format image available from <a href=\"https://usegalaxy.eu/static/vgcn/denbi-centos7-j10-2e08aa4bfa33-master.raw\">UseGalaxy.eu</a> to your OpenStack</p>\n    </li>\n  </ol>\n\n  <p>You will need to do both of these things before you can proceed.</p>\n</blockquote>\n\n<p>You are now ready to launch an instance!</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Launching an Instance</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Open your <code class=\"language-plaintext highlighter-rouge\">main.tf</code> in your text editor and add the following.</p>\n\n      <blockquote class=\"warning\">\n        <warning-title>Correct image/flavor/network/security_group names</warning-title>\n        <p>The documentation below notes some specific values for the <code class=\"language-plaintext highlighter-rouge\">image_name</code>, <code class=\"language-plaintext highlighter-rouge\">flavor_name</code>, <code class=\"language-plaintext highlighter-rouge\">security_groups</code>, and <code class=\"language-plaintext highlighter-rouge\">network</code> properties. These <em>may not be correct</em> for your training, instead your instructor will provide these values to you.</p>\n      </blockquote>\n\n      <div class=\"language-ini highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"err\">resource</span> <span class=\"err\">\"openstack_compute_instance_v2\"</span> <span class=\"err\">\"test\"</span> <span class=\"err\">{</span>\n  <span class=\"py\">name</span>            <span class=\"p\">=</span> <span class=\"s\">\"test-vm\"</span>\n  <span class=\"py\">image_name</span>      <span class=\"p\">=</span> <span class=\"s\">\"denbi-centos7-j10-2e08aa4bfa33-master\"</span>\n  <span class=\"py\">flavor_name</span>     <span class=\"p\">=</span> <span class=\"s\">\"m1.tiny\"</span>\n  <span class=\"py\">key_pair</span>        <span class=\"p\">=</span> <span class=\"s\">\"${openstack_compute_keypair_v2.my-cloud-key.name}\"</span>\n  <span class=\"py\">security_groups</span> <span class=\"p\">=</span> <span class=\"s\">[\"default\"]</span>\n\n  <span class=\"err\">network</span> <span class=\"err\">{</span>\n    <span class=\"py\">name</span> <span class=\"p\">=</span> <span class=\"s\">\"public\"</span>\n  <span class=\"err\">}</span>\n<span class=\"err\">}</span>\n</code></pre></div>      </div>\n\n      <p>There are some important things to note, we reproduce the above configuration but with comments:</p>\n\n      <p>“openstack_compute_instance_v2” is the ‘type’ of a resource, ‘test’ is the name of this specific resource.</p>\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>resource \"openstack_compute_instance_v2\" \"test\" {\n</code></pre></div>      </div>\n\n      <p>This will become the server name</p>\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>  name            = \"test-vm\"\n</code></pre></div>      </div>\n\n      <p>The image which will be launched</p>\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>  image_name      = \"denbi-centos7-j10-2e08aa4bfa33-master\"\n</code></pre></div>      </div>\n\n      <p>Which flavor</p>\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>  flavor_name     = \"m1.tiny\"\n</code></pre></div>      </div>\n\n      <p>This uses Terraform’s knowledge of the\n<code class=\"language-plaintext highlighter-rouge\">openstack_compute_keypair_v2.my-cloud-key</code> resource which you\npreviously described. Then it accesses the <code class=\"language-plaintext highlighter-rouge\">.name</code> attribute.\nThis allow your to update the name at any time, and still have your\nresource definitions be correct.</p>\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>  key_pair        = \"${openstack_compute_keypair_v2.my-cloud-key.name}\"\n</code></pre></div>      </div>\n\n      <p>The security group to apply. This is a comma separated list, but\n<code class=\"language-plaintext highlighter-rouge\">default</code> should work for most OpenStack clouds.</p>\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>  security_groups = [\"default\"]\n</code></pre></div>      </div>\n\n      <p>A network that is accessible to you.</p>\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>  network {\n    name = \"public\"\n  }\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p>Run <code class=\"language-plaintext highlighter-rouge\">terraform apply</code>. Running the <code class=\"language-plaintext highlighter-rouge\">plan</code> step is not necessary, it is just useful to see what changes will be applied without starting the apply process.</p>\n\n      <p>Note that first terraform “refreshes” the state of the remote resources that it already manages, before checking what changes need to be made.</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>$ terraform apply\nopenstack_compute_keypair_v2.my-cloud-key: Refreshing state... (ID: my-key)\n\nAn execution plan has been generated and is shown below.\nResource actions are indicated with the following symbols:\n  + create\n\nTerraform will perform the following actions:\n\n  + openstack_compute_instance_v2.test\n      id:                         &lt;computed&gt;\n      access_ip_v4:               &lt;computed&gt;\n      access_ip_v6:               &lt;computed&gt;\n      all_metadata.%:             &lt;computed&gt;\n      availability_zone:          &lt;computed&gt;\n      flavor_id:                  &lt;computed&gt;\n      flavor_name:                \"m1.tiny\"\n      force_delete:               \"false\"\n      image_id:                   &lt;computed&gt;\n      image_name:                 \"denbi-centos7-j10-2e08aa4bfa33-master\"\n      key_pair:                   \"my-key\"\n      name:                       \"test-vm\"\n      network.#:                  \"1\"\n      network.0.access_network:   \"false\"\n      network.0.fixed_ip_v4:      &lt;computed&gt;\n      network.0.fixed_ip_v6:      &lt;computed&gt;\n      network.0.floating_ip:      &lt;computed&gt;\n      network.0.mac:              &lt;computed&gt;\n      network.0.name:             \"public\"\n      network.0.port:             &lt;computed&gt;\n      network.0.uuid:             &lt;computed&gt;\n      power_state:                \"active\"\n      region:                     &lt;computed&gt;\n      security_groups.#:          \"1\"\n      security_groups.3814588639: \"default\"\n      stop_before_destroy:        \"false\"\n\n\nPlan: 1 to add, 0 to change, 0 to destroy.\n\nDo you want to perform these actions?\n  Terraform will perform the actions described above.\n  Only 'yes' will be accepted to approve.\n\n  Enter a value:\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p>If everything looks good, enter ‘yes’.</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>openstack_compute_instance_v2.test: Creating...\n  access_ip_v4:               \"\" =&gt; \"&lt;computed&gt;\"\n  access_ip_v6:               \"\" =&gt; \"&lt;computed&gt;\"\n  all_metadata.%:             \"\" =&gt; \"&lt;computed&gt;\"\n  availability_zone:          \"\" =&gt; \"&lt;computed&gt;\"\n  flavor_id:                  \"\" =&gt; \"&lt;computed&gt;\"\n  flavor_name:                \"\" =&gt; \"m1.tiny\"\n  force_delete:               \"\" =&gt; \"false\"\n  image_id:                   \"\" =&gt; \"&lt;computed&gt;\"\n  image_name:                 \"\" =&gt; \"denbi-centos7-j10-2e08aa4bfa33-master\"\n  key_pair:                   \"\" =&gt; \"my-key\"\n  name:                       \"\" =&gt; \"test-vm\"\n  network.#:                  \"\" =&gt; \"1\"\n  network.0.access_network:   \"\" =&gt; \"false\"\n  network.0.fixed_ip_v4:      \"\" =&gt; \"&lt;computed&gt;\"\n  network.0.fixed_ip_v6:      \"\" =&gt; \"&lt;computed&gt;\"\n  network.0.floating_ip:      \"\" =&gt; \"&lt;computed&gt;\"\n  network.0.mac:              \"\" =&gt; \"&lt;computed&gt;\"\n  network.0.name:             \"\" =&gt; \"public\"\n  network.0.port:             \"\" =&gt; \"&lt;computed&gt;\"\n  network.0.uuid:             \"\" =&gt; \"&lt;computed&gt;\"\n  power_state:                \"\" =&gt; \"active\"\n  region:                     \"\" =&gt; \"&lt;computed&gt;\"\n  security_groups.#:          \"\" =&gt; \"1\"\n  security_groups.3814588639: \"\" =&gt; \"default\"\n  stop_before_destroy:        \"\" =&gt; \"false\"\nopenstack_compute_instance_v2.test: Still creating... (10s elapsed)\nopenstack_compute_instance_v2.test: Still creating... (20s elapsed)\nopenstack_compute_instance_v2.test: Creation complete after 30s (ID: 7a2ed5ba-0801-49b5-bf1b-9bf9cec733fa)\n\nApply complete! Resources: 1 added, 0 changed, 0 destroyed.\n</code></pre></div>      </div>\n    </li>\n  </ol>\n</blockquote>\n\n<p>You now have a running instance! We do not know the IP address so we cannot login yet. You can obtain that from the OpenStack dashboard, or via the <code class=\"language-plaintext highlighter-rouge\">terraform show</code> command</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>`terraform show` and logging in</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Run <code class=\"language-plaintext highlighter-rouge\">terraform show</code></p>\n\n      <p>The values in the following output will not match yours.</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>openstack_compute_instance_v2.test:\n  id = 7a2ed5ba-0801-49b5-bf1b-9bf9cec733fa\n  access_ip_v4 = 192.52.32.231\n  access_ip_v6 =\n  all_metadata.% = 0\n  availability_zone = nova\n  flavor_id = a9a58bcf-29a3-47f4-b4c3-e71e40127833\n  flavor_name = m1.tiny\n  force_delete = false\n  image_id = 922ae172-275b-4e6a-bb9d-c7ace52fc8d4\n  image_name = denbi-centos7-j10-2e08aa4bfa33-master\n  key_pair = my-key\n  name = test-vm\n  network.# = 1\n  network.0.access_network = false\n  network.0.fixed_ip_v4 = 192.52.32.231\n  network.0.fixed_ip_v6 =\n  network.0.floating_ip =\n  network.0.mac = fa:16:3e:e6:cd:6c\n  network.0.name = public\n  network.0.port =\n  network.0.uuid = 6a68b40c-356f-4d4c-95e9-e5c72855fb35\n  power_state = active\n  region = Freiburg\n  security_groups.# = 1\n  security_groups.3814588639 = default\n  stop_before_destroy = false\nopenstack_compute_keypair_v2.my-cloud-key:\n  id = my-key\n  fingerprint = 4a:72:2c:7e:d2:b7:f2:c4:5a:9e:bb:ca:c7:8f:d7:a3\n  name = my-key\n  private_key =\n  public_key = ssh-rsa AAAAB3...\n  region = Freiburg\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p>Here we can obtain the IP address. In the above output, it is <code class=\"language-plaintext highlighter-rouge\">192.52.32.231</code></p>\n    </li>\n    <li>\n      <p>Login with <code class=\"language-plaintext highlighter-rouge\">ssh</code>: <code class=\"language-plaintext highlighter-rouge\">ssh centos@&lt;your-ip-address&gt;</code>. You should see something like the following:</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>The authenticity of host '192.52.32.231 (192.52.32.231)' can't be established.\nECDSA key fingerprint is SHA256:oEHgotonwT3a47K0kLdsNVd/QqctBjDK7F829J0VnwQ.\nAre you sure you want to continue connecting (yes/no)? yes\nWarning: Permanently added '192.52.32.231' (ECDSA) to the list of known hosts.\n      _        _   _ ____ _____\n     | |      | \\ | |  _ \\_   _| ██      ██\n   __| | ___  |  \\| | |_) || |     ██████\n  / _' |/ _ \\ | . ' |  _ &lt; | |     ██████\n | (_| |  __/_| |\\  | |_) || |_  ██  ██  ██\n  \\__,_|\\___(_)_| \\_|____/_____| ██  ██  ██\n====================================================\nHostname..........: test-vm.novalocal\nRelease...........: CentOS Linux release 7.5.1804 (Core)\nBuild.............: de.NBI Generic denbi-centos7-j10-2e08aa4bfa33-master\nBuild Date........: 2018-10-24T14:28:38Z\nCurrent user......: centos\nLoad..............: 0.00 0.07 0.05 2/148 1644\nUptime............: up 5 minutes\n====================================================\n[centos@test-vm ~]$\n</code></pre></div>      </div>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>With this, you’re done. You’ve launched a single VM with Terraform. The image we are using comes with:</p>\n\n<ul>\n  <li>HTCondor</li>\n  <li>Docker</li>\n  <li>Singularity</li>\n  <li>Conda</li>\n  <li>CVMFS connected to Galaxyproject’s biological databases and Singularity containers</li>\n</ul>\n\n<p>This is very similar to the standard image that UseGalaxy.eu uses for all of its compute nodes.</p>\n\n<h1 id=\"managing-a-cluster-of-vms\">Managing a Cluster of VMs</h1>\n\n<p>When you are done playing around with the individual VM, we’re ready to explore launching an entire cluster.</p>\n\n<ul>\n  <li>We will launch a VM to act as our HTCondor central manager</li>\n  <li>We will launch a VM to act as an NFS server for our “cluster”</li>\n  <li>We will launch two execution nodes to process jobs</li>\n</ul>\n\n<p>We use a very similar setup for our production cloud cluster that powers UseGalaxy.eu’s compute and training infrastructure.</p>\n\n<h2 id=\"configuration\">Configuration</h2>\n\n<p>We will start by setting up the new nodes and launching them as a test:</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Adding configuration for other nodes</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Update the name of the instance you already have, <code class=\"language-plaintext highlighter-rouge\">test</code> to <code class=\"language-plaintext highlighter-rouge\">name = \"central-manager\"</code>. This will be our scheduler central manager.</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>resource \"openstack_compute_instance_v2\" \"test\" {\n  name            = \"central-manager\"\n  ...\n}\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p>Add the NFS server. It is mostly the same configuration you’ve done before, just with a different <code class=\"language-plaintext highlighter-rouge\">name</code> and resource name.</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>resource \"openstack_compute_instance_v2\" \"nfs\" {\n  name            = \"nfs-server\"\n  image_name      = \"denbi-centos7-j10-2e08aa4bfa33-master\"\n  flavor_name     = \"m1.tiny\"\n  key_pair        = \"${openstack_compute_keypair_v2.my-cloud-key.name}\"\n  security_groups = [\"default\"]\n\n  network {\n    name = \"public\"\n  }\n}\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p>Lastly, we’ll add the execution nodes. Here we will launch two servers at once by using the <code class=\"language-plaintext highlighter-rouge\">count</code> parameter. We can add <code class=\"language-plaintext highlighter-rouge\">count</code> in the main portion of a Terraform resource definition and it will create that many copies of that same resource. In the case where we wish to be able to distinguish between them, we can use <code class=\"language-plaintext highlighter-rouge\">${count.index}</code> in the name or another field to distinguish them.</p>\n\n      <div class=\"language-ini highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"err\">resource</span> <span class=\"err\">\"openstack_compute_instance_v2\"</span> <span class=\"err\">\"exec\"</span> <span class=\"err\">{</span>\n  <span class=\"py\">name</span>            <span class=\"p\">=</span> <span class=\"s\">\"exec-${count.index}\"</span>\n  <span class=\"py\">image_name</span>      <span class=\"p\">=</span> <span class=\"s\">\"denbi-centos7-j10-2e08aa4bfa33-master\"</span>\n  <span class=\"py\">flavor_name</span>     <span class=\"p\">=</span> <span class=\"s\">\"m1.tiny\"</span>\n  <span class=\"py\">key_pair</span>        <span class=\"p\">=</span> <span class=\"s\">\"${openstack_compute_keypair_v2.my-cloud-key.name}\"</span>\n  <span class=\"py\">security_groups</span> <span class=\"p\">=</span> <span class=\"s\">[\"default\"]</span>\n  <span class=\"py\">count</span>           <span class=\"p\">=</span> <span class=\"s\">2</span>\n\n  <span class=\"err\">network</span> <span class=\"err\">{</span>\n    <span class=\"py\">name</span> <span class=\"p\">=</span> <span class=\"s\">\"public\"</span>\n  <span class=\"err\">}</span>\n<span class=\"err\">}</span>\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p>Run <code class=\"language-plaintext highlighter-rouge\">terraform apply</code></p>\n\n      <p>You will see something like the following:</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>openstack_compute_keypair_v2.my-cloud-key: Refreshing state... (ID: my-key)\nopenstack_compute_instance_v2.test: Refreshing state... (ID: 7a2ed5ba-0801-49b5-bf1b-9bf9cec733fa)\n\nAn execution plan has been generated and is shown below.\nResource actions are indicated with the following symbols:\n  + create\n  ~ update in-place\n\nTerraform will perform the following actions:\n\n  + openstack_compute_instance_v2.exec[0]\n      id:                         &lt;computed&gt;\n      access_ip_v4:               &lt;computed&gt;\n      access_ip_v6:               &lt;computed&gt;\n      all_metadata.%:             &lt;computed&gt;\n      availability_zone:          &lt;computed&gt;\n      ...\n\n  ~ openstack_compute_instance_v2.test\n      name:                       \"test-vm\" =&gt; \"central-manager\"\n\n\nPlan: 3 to add, 1 to change, 0 to destroy.\n\nDo you want to perform these actions?\n  Terraform will perform the actions described above.\n  Only 'yes' will be accepted to approve.\n\n  Enter a value:\n</code></pre></div>      </div>\n\n      <p>This time, Terraform is able to modify the <code class=\"language-plaintext highlighter-rouge\">openstack_compute_instance_v2.test</code> resource in place, it can just update the name of the VM. It will also create the other three requested resources.</p>\n    </li>\n    <li>\n      <p>Enter <code class=\"language-plaintext highlighter-rouge\">yes</code> and terraform will make the requested changes</p>\n    </li>\n    <li>\n      <p>It should complete successfully</p>\n\n      <blockquote class=\"question\">\n        <question-title></question-title>\n\n        <p>What did the output look like?</p>\n\n        <blockquote class=\"solution\">\n          <solution-title></solution-title>\n\n          <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>openstack_compute_instance_v2.nfs: Creation complete after 2m55s (ID: 421f0899-f2c1-43c9-8bbe-9b0415c8f4f4)\nopenstack_compute_instance_v2.exec[0]: Creation complete after 2m57s (ID: 1ae02775-a0ff-47a5-907f-513190a8548e)\nopenstack_compute_instance_v2.exec[1]: Creation complete after 2m59s (ID: d339ebeb-4288-498c-9923-42fce32a3808)\n\nApply complete! Resources: 3 added, 0 changed, 0 destroyed.\n</code></pre></div>          </div>\n        </blockquote>\n      </blockquote>\n    </li>\n  </ol>\n</blockquote>\n\n<h2 id=\"cloud-init\"><code class=\"language-plaintext highlighter-rouge\">cloud-init</code></h2>\n\n<p>These VMs that we have launched currently are all absolutely identical, except for the host name. There is no specialisation. They all do nothing. We will fix that and make these machines have individual roles by booting them with metadata attached to each instance.</p>\n\n<p><a href=\"https://cloud-init.io/\"><code class=\"language-plaintext highlighter-rouge\">cloud-init</code></a> is used for this process, it allows for injecting files and executing commands as part of the boot process.</p>\n\n<blockquote class=\"details\">\n  <details-title>Other actions</details-title>\n  <p>cloud-init allows for many more actions to be executed as well, you can read about them in <a href=\"https://cloudinit.readthedocs.io/en/latest/\">the documentation</a>.</p>\n</blockquote>\n\n<p>The <code class=\"language-plaintext highlighter-rouge\">cloud-init</code> configuration is a YAML file. Here we can see an example of how it is used, we have a YAML array at the top level. Inside, a hash of <code class=\"language-plaintext highlighter-rouge\">content</code>, <code class=\"language-plaintext highlighter-rouge\">owner</code>, <code class=\"language-plaintext highlighter-rouge\">path</code>, and <code class=\"language-plaintext highlighter-rouge\">permissions</code>.</p>\n\n<div class=\"language-yaml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">#cloud-config</span>\n<span class=\"na\">write_files</span><span class=\"pi\">:</span>\n<span class=\"pi\">-</span> <span class=\"na\">content</span><span class=\"pi\">:</span> <span class=\"pi\">|</span>\n    <span class=\"s\">CONDOR_HOST = 127.0.0.1</span>\n    <span class=\"s\">ALLOW_WRITE = *</span>\n    <span class=\"s\">ALLOW_READ = $(ALLOW_WRITE)</span>\n    <span class=\"s\">ALLOW_NEGOTIATOR = $(ALLOW_WRITE)</span>\n    <span class=\"s\">DAEMON_LIST = COLLECTOR, MASTER, NEGOTIATOR, SCHEDD</span>\n    <span class=\"s\">FILESYSTEM_DOMAIN = denbi</span>\n    <span class=\"s\">UID_DOMAIN = denbi</span>\n    <span class=\"s\">TRUST_UID_DOMAIN = True</span>\n    <span class=\"s\">SOFT_UID_DOMAIN = True</span>\n  <span class=\"na\">owner</span><span class=\"pi\">:</span> <span class=\"s\">root:root</span>\n  <span class=\"na\">path</span><span class=\"pi\">:</span> <span class=\"s\">/etc/condor/condor_config.local</span>\n  <span class=\"na\">permissions</span><span class=\"pi\">:</span> <span class=\"s1\">'</span><span class=\"s\">0644'</span>\n</code></pre></div></div>\n\n<p>This will create a file with the value from <code class=\"language-plaintext highlighter-rouge\">content</code>, owned by root/group root, in <code class=\"language-plaintext highlighter-rouge\">/etc/condor/condor_config.local</code>. So let’s re-structure our <code class=\"language-plaintext highlighter-rouge\">main.tf</code> file to have some configuration:</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>cloud-init</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Edit your central-manager server and add a block like the following at the end.</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>user_data = &lt;&lt;-EOF\n  #cloud-config\n  write_files:\n  - content: |\n      CONDOR_HOST = localhost\n      ALLOW_WRITE = *\n      ALLOW_READ = $(ALLOW_WRITE)\n      ALLOW_NEGOTIATOR = $(ALLOW_WRITE)\n      DAEMON_LIST = COLLECTOR, MASTER, NEGOTIATOR, SCHEDD\n      FILESYSTEM_DOMAIN = terraform-training\n      UID_DOMAIN = terraform-training\n      TRUST_UID_DOMAIN = True\n      SOFT_UID_DOMAIN = True\n    owner: root:root\n    path: /etc/condor/condor_config.local\n    permissions: '0644'\n  - content: |\n      /data           /etc/auto.data          nfsvers=3\n    owner: root:root\n    path: /etc/auto.master.d/data.autofs\n    permissions: '0644'\n  - content: |\n      share  -rw,hard,intr,nosuid,quota  ${openstack_compute_instance_v2.nfs.access_ip_v4}:/data/share\n    owner: root:root\n    path: /etc/auto.data\n    permissions: '0644'\nEOF\n</code></pre></div>      </div>\n\n      <p>Near the end we see an interesting thing, <code class=\"language-plaintext highlighter-rouge\">${openstack_compute_instance_v2.nfs.access_ip_v4}</code>, this will template the <code class=\"language-plaintext highlighter-rouge\">user_data</code> that is passed to <code class=\"language-plaintext highlighter-rouge\">cloud-init</code>, with the IP address of the NFS server.</p>\n    </li>\n    <li>\n      <p>Edit your NFS server and add a user data block like:</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>user_data = &lt;&lt;-EOF\n  #cloud-config\n  write_files:\n  - content: |\n      /data/share *(rw,sync)\n    owner: root:root\n    path: /etc/exports\n    permissions: '0644'\n  runcmd:\n   - [ mkdir, -p, /data/share ]\n   - [ chown, \"centos:centos\", -R, /data/share ]\n   - [ systemctl, enable, nfs-server ]\n   - [ systemctl, start, nfs-server ]\n   - [ exportfs, -avr ]\nEOF\n</code></pre></div>      </div>\n\n      <p>This will:</p>\n\n      <ol>\n        <li>Make the <code class=\"language-plaintext highlighter-rouge\">/data/share</code> directory</li>\n        <li>Set permissions on it</li>\n        <li>Launch the NFS service</li>\n        <li>Export <code class=\"language-plaintext highlighter-rouge\">/data/share</code> to the network</li>\n      </ol>\n    </li>\n    <li>\n      <p>Edit the <code class=\"language-plaintext highlighter-rouge\">exec</code> node and add a user data block like:</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>user_data = &lt;&lt;-EOF\n  #cloud-config\n  write_files:\n  - content: |\n      CONDOR_HOST = ${openstack_compute_instance_v2.test.access_ip_v4}\n      ALLOW_WRITE = *\n      ALLOW_READ = $(ALLOW_WRITE)\n      ALLOW_ADMINISTRATOR = *\n      ALLOW_NEGOTIATOR = $(ALLOW_ADMINISTRATOR)\n      ALLOW_CONFIG = $(ALLOW_ADMINISTRATOR)\n      ALLOW_DAEMON = $(ALLOW_ADMINISTRATOR)\n      ALLOW_OWNER = $(ALLOW_ADMINISTRATOR)\n      ALLOW_CLIENT = *\n      DAEMON_LIST = MASTER, SCHEDD, STARTD\n      FILESYSTEM_DOMAIN = terraform-training\n      UID_DOMAIN = terraform-training\n      TRUST_UID_DOMAIN = True\n      SOFT_UID_DOMAIN = True\n      # run with partitionable slots\n      CLAIM_PARTITIONABLE_LEFTOVERS = True\n      NUM_SLOTS = 1\n      NUM_SLOTS_TYPE_1 = 1\n      SLOT_TYPE_1 = 100%\n      SLOT_TYPE_1_PARTITIONABLE = True\n      ALLOW_PSLOT_PREEMPTION = False\n      STARTD.PROPORTIONAL_SWAP_ASSIGNMENT = True\n    owner: root:root\n    path: /etc/condor/condor_config.local\n    permissions: '0644'\n  - content: |\n      /data           /etc/auto.data          nfsvers=3\n    owner: root:root\n    path: /etc/auto.master.d/data.autofs\n    permissions: '0644'\n  - content: |\n      share  -rw,hard,intr,nosuid,quota  ${openstack_compute_instance_v2.nfs.access_ip_v4}:/data/share\n    owner: root:root\n    path: /etc/auto.data\n    permissions: '0644'\nEOF\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p>Compare your final configuration against ours:</p>\n\n      <blockquote class=\"solution\">\n        <solution-title>Final Configuration</solution-title>\n        <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>resource \"openstack_compute_keypair_v2\" \"my-cloud-key\" {\n  name       = \"my-key\"\n  public_key = \"ssh-rsa AAAAB3...\"\n}\n\nresource \"openstack_compute_instance_v2\" \"test\" {\n  name            = \"central-manager\"\n  image_name      = \"denbi-centos7-j10-2e08aa4bfa33-master\"\n  flavor_name     = \"m1.tiny\"\n  key_pair        = \"${openstack_compute_keypair_v2.my-cloud-key.name}\"\n  security_groups = [\"default\"]\n\n  network {\n    name = \"public\"\n  }\n\n  user_data = &lt;&lt;-EOF\n    #cloud-config\n    write_files:\n    - content: |\n        CONDOR_HOST = localhost\n        ALLOW_WRITE = *\n        ALLOW_READ = $(ALLOW_WRITE)\n        ALLOW_NEGOTIATOR = $(ALLOW_WRITE)\n        DAEMON_LIST = COLLECTOR, MASTER, NEGOTIATOR, SCHEDD\n        FILESYSTEM_DOMAIN = terraform-training\n        UID_DOMAIN = terraform-training\n        TRUST_UID_DOMAIN = True\n        SOFT_UID_DOMAIN = True\n      owner: root:root\n      path: /etc/condor/condor_config.local\n      permissions: '0644'\n    - content: |\n        /data           /etc/auto.data          nfsvers=3\n      owner: root:root\n      path: /etc/auto.master.d/data.autofs\n      permissions: '0644'\n    - content: |\n        share  -rw,hard,intr,nosuid,quota  ${openstack_compute_instance_v2.nfs.access_ip_v4}:/data/share\n      owner: root:root\n      path: /etc/auto.data\n      permissions: '0644'\n  EOF\n}\n\nresource \"openstack_compute_instance_v2\" \"nfs\" {\n  name            = \"nfs-server\"\n  image_name      = \"denbi-centos7-j10-2e08aa4bfa33-master\"\n  flavor_name     = \"m1.tiny\"\n  key_pair        = \"${openstack_compute_keypair_v2.my-cloud-key.name}\"\n  security_groups = [\"default\"]\n\n  network {\n    name = \"public\"\n  }\n\n  user_data = &lt;&lt;-EOF\n    #cloud-config\n    write_files:\n    - content: |\n        /data/share *(rw,sync)\n      owner: root:root\n      path: /etc/exports\n      permissions: '0644'\n    runcmd:\n     - [ mkdir, -p, /data/share ]\n     - [ chown, \"centos:centos\", -R, /data/share ]\n     - [ systemctl, enable, nfs-server ]\n     - [ systemctl, start, nfs-server ]\n     - [ exportfs, -avr ]\n  EOF\n}\n\nresource \"openstack_compute_instance_v2\" \"exec\" {\n  name            = \"exec-${count.index}\"\n  image_name      = \"denbi-centos7-j10-2e08aa4bfa33-master\"\n  flavor_name     = \"m1.tiny\"\n  key_pair        = \"${openstack_compute_keypair_v2.my-cloud-key.name}\"\n  security_groups = [\"default\"]\n  count           = 2\n\n  network {\n    name = \"public\"\n  }\n\n  user_data = &lt;&lt;-EOF\n    #cloud-config\n    write_files:\n    - content: |\n        CONDOR_HOST = ${openstack_compute_instance_v2.test.access_ip_v4}\n        ALLOW_WRITE = *\n        ALLOW_READ = $(ALLOW_WRITE)\n        ALLOW_ADMINISTRATOR = *\n        ALLOW_NEGOTIATOR = $(ALLOW_ADMINISTRATOR)\n        ALLOW_CONFIG = $(ALLOW_ADMINISTRATOR)\n        ALLOW_DAEMON = $(ALLOW_ADMINISTRATOR)\n        ALLOW_OWNER = $(ALLOW_ADMINISTRATOR)\n        ALLOW_CLIENT = *\n        DAEMON_LIST = MASTER, SCHEDD, STARTD\n        FILESYSTEM_DOMAIN = terraform-training\n        UID_DOMAIN = terraform-training\n        TRUST_UID_DOMAIN = True\n        SOFT_UID_DOMAIN = True\n        # run with partitionable slots\n        CLAIM_PARTITIONABLE_LEFTOVERS = True\n        NUM_SLOTS = 1\n        NUM_SLOTS_TYPE_1 = 1\n        SLOT_TYPE_1 = 100%\n        SLOT_TYPE_1_PARTITIONABLE = True\n        ALLOW_PSLOT_PREEMPTION = False\n        STARTD.PROPORTIONAL_SWAP_ASSIGNMENT = True\n      owner: root:root\n      path: /etc/condor/condor_config.local\n      permissions: '0644'\n    - content: |\n        /data           /etc/auto.data          nfsvers=3\n      owner: root:root\n      path: /etc/auto.master.d/data.autofs\n      permissions: '0644'\n    - content: |\n        share  -rw,hard,intr,nosuid,quota  ${openstack_compute_instance_v2.nfs.access_ip_v4}:/data/share\n      owner: root:root\n      path: /etc/auto.data\n      permissions: '0644'\n  EOF\n}\n</code></pre></div>        </div>\n\n      </blockquote>\n    </li>\n    <li>\n      <p>Run <code class=\"language-plaintext highlighter-rouge\">terraform apply</code></p>\n\n      <p>It will look slightly different this time:</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>$ terraform apply\nopenstack_compute_keypair_v2.my-cloud-key: Refreshing state... (ID: my-key)\nopenstack_compute_instance_v2.nfs: Refreshing state... (ID: 421f0899-f2c1-43c9-8bbe-9b0415c8f4f4)\nopenstack_compute_instance_v2.test: Refreshing state... (ID: 7a2ed5ba-0801-49b5-bf1b-9bf9cec733fa)\nopenstack_compute_instance_v2.exec[0]: Refreshing state... (ID: 1ae02775-a0ff-47a5-907f-513190a8548e)\nopenstack_compute_instance_v2.exec[1]: Refreshing state... (ID: d339ebeb-4288-498c-9923-42fce32a3808)\n\nAn execution plan has been generated and is shown below.\nResource actions are indicated with the following symbols:\n-/+ destroy and then create replacement\n\nTerraform will perform the following actions:\n\n-/+ openstack_compute_instance_v2.exec[0] (new resource required)\n      id:                         \"1ae02775-a0ff-47a5-907f-513190a8548e\" =&gt; &lt;computed&gt; (forces new resource)\n      access_ip_v4:               \"192.52.32.255\" =&gt; &lt;computed&gt;\n      ...\n      user_data:                  \"\" =&gt; \"07d27d50dbdf12a5647d9fd12a3510861d32203c\" (forces new resource)\n\n...\nPlan: 4 to add, 0 to change, 4 to destroy.\n\nDo you want to perform these actions?\n  Terraform will perform the actions described above.\n  Only 'yes' will be accepted to approve.\n\n  Enter a value:\n</code></pre></div>      </div>\n\n      <p>Here Terraform has detected that the userdata has changed. It cannot change this dynamically at runtime, only at boot time. So it decides that it must destroy and then replace that resource.</p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h2 id=\"login--htcondor--a-test-job\">Login / HTCondor / A Test Job</h2>\n\n<p>We now have a running cluster! Let’s log in</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Cluster Usage</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Now that we have a cluster in the cloud, let’s login. Look through the output of <code class=\"language-plaintext highlighter-rouge\">terraform show</code> to find your <code class=\"language-plaintext highlighter-rouge\">central-manager</code> server and its IP address.</p>\n    </li>\n    <li>\n      <p><code class=\"language-plaintext highlighter-rouge\">ssh centos@&lt;your manager ip&gt;</code></p>\n    </li>\n    <li>\n      <p>Run <code class=\"language-plaintext highlighter-rouge\">condor_status</code> which will show you the status of your cluster.</p>\n\n      <p>After your central manager VM booted, the executor nodes booted as well. Then, using the IP address of the central manager, the executors contacted that machine, and advertised their availability to run jobs.</p>\n\n      <blockquote class=\"question\">\n        <question-title></question-title>\n\n        <p>What does the output look like? How many executor nodes do you see?</p>\n\n        <blockquote class=\"solution\">\n          <solution-title></solution-title>\n          <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>[centos@central-manager share]$ condor_status\nName                   OpSys      Arch   State     Activity LoadAv Mem   ActvtyTime\n\nslot1@exec-0.novalocal LINUX      X86_64 Unclaimed Idle      0.150  991  0+00:15:28\nslot1@exec-1.novalocal LINUX      X86_64 Unclaimed Idle      0.000  991  0+00:15:32\n\n                     Machines Owner Claimed Unclaimed Matched Preempting  Drain\n\n        X86_64/LINUX        2     0       0         2       0          0      0\n\n               Total        2     0       0         2       0          0      0\n</code></pre></div>          </div>\n        </blockquote>\n      </blockquote>\n    </li>\n    <li>\n      <p>Change into the <code class=\"language-plaintext highlighter-rouge\">/data/share/</code></p>\n    </li>\n    <li>\n      <p>Create a file, <code class=\"language-plaintext highlighter-rouge\">test.job</code> with the following contents:</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>Universe = vanilla\nExecutable = /data/share/test.sh\nLog = test.$(process).log\nOutput = test.$(process).out\nError = test.$(process).err\nrequest_cpus = 1\nQueue 10\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p>Create a file <code class=\"language-plaintext highlighter-rouge\">test.sh</code> with the following:</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>#!/bin/bash\necho \"$(hostname)\"\nsleep 1\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p>Run <code class=\"language-plaintext highlighter-rouge\">chmod +x test.sh</code></p>\n    </li>\n    <li>\n      <p>Run <code class=\"language-plaintext highlighter-rouge\">condor_submit test.job</code></p>\n    </li>\n    <li>\n      <p>(Quickly) Run <code class=\"language-plaintext highlighter-rouge\">condor_q</code> to see the queue status. You can invoke this repeatedly to watch the queue update.</p>\n    </li>\n    <li>\n      <p>Run <code class=\"language-plaintext highlighter-rouge\">cat *.out</code> and you should see the hostnames where the jobs were run</p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h1 id=\"infrastructure-graph\">Infrastructure Graph</h1>\n\n<p>Terraform has the ability to produce a graph showing the relationship of resources in your infrastructure. We will produce a graphic for our current terraform plan:</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Infrastructure Graph</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Run:</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>terraform graph | dot -Tpng &gt; graph.png\n</code></pre></div>      </div>\n\n      <p>You may need the <code class=\"language-plaintext highlighter-rouge\">graphviz</code> package installed in order to produce the graph</p>\n    </li>\n    <li>\n      <p>Open up <code class=\"language-plaintext highlighter-rouge\">graph.png</code> in an image viewer</p>\n\n      <blockquote class=\"question\">\n        <question-title></question-title>\n\n        <p>What did the output look like?</p>\n\n        <blockquote class=\"solution\">\n          <solution-title></solution-title>\n          <figure id=\"figure-1\" style=\"max-width: 90%;\"><img src=\"../../images/graph.png\" alt=\"A simple graph. \" width=\"888\" height=\"635\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/graph.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 1</strong>:</span> A simple graph showing the structure of the infrastructure in this lesson</figcaption></figure>\n        </blockquote>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>This is a very simple resrouce graph:</p>\n\n<figure id=\"figure-2\" style=\"max-width: 90%;\"><img src=\"../../images/graph.png\" alt=\"A simple graph. \" width=\"888\" height=\"635\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/graph.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 2</strong>:</span> A simple graph showing the structure of the infrastructure in this lesson</figcaption></figure>\n\n<p>The dependencies follow the arrows, the NFS depends on the keypair being setup. The <code class=\"language-plaintext highlighter-rouge\">test</code> machine (central manager) depends on the NFS server being available (and having an IP), the exec nodes depend on the central manager server. This is a somewhat simplified view, there are more dependencies which are not shown for simplicity (e.g. the exec nodes depend on NFS)</p>\n\n<p>If you have variables this can produce a more complex dependency graph:</p>\n\n<figure id=\"figure-3\" style=\"max-width: 90%;\"><img src=\"../../images/graph2.png\" alt=\"A more complex graph showing variables. \" width=\"1385\" height=\"635\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/graph2.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 3</strong>:</span> A more complex graph showing variables</figcaption></figure>\n\n<p>Once you develop complex infrastructure, these graphics become less useful.</p>\n\n<h1 id=\"tearing-everything-down\">Tearing Everything Down</h1>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Cleanup</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Simple delete your <code class=\"language-plaintext highlighter-rouge\">main.tf</code> file (or rename it without the <code class=\"language-plaintext highlighter-rouge\">.tf</code> extension)</p>\n    </li>\n    <li>\n      <p>Run <code class=\"language-plaintext highlighter-rouge\">terraform apply</code>. Terraform will see that the resource is no longer part of your code and remove it.</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>openstack_compute_keypair_v2.my-cloud-key: Refreshing state... (ID: my-key)\nopenstack_compute_instance_v2.nfs: Refreshing state... (ID: 0b58d613-48f2-49c4-9d8a-3623d17f1c93)\nopenstack_compute_instance_v2.test: Refreshing state... (ID: e433f772-6f17-4609-aa61-053f7602533f)\nopenstack_compute_instance_v2.exec[0]: Refreshing state... (ID: 034a4206-b0ad-4d0e-9c75-27d3966f99ac)\nopenstack_compute_instance_v2.exec[1]: Refreshing state... (ID: fe576776-397e-4f1f-a8e7-4a9203764567)\n\nAn execution plan has been generated and is shown below.\nResource actions are indicated with the following symbols:\n  - destroy\n\nTerraform will perform the following actions:\n\n  - openstack_compute_instance_v2.exec[0]\n\n  - openstack_compute_instance_v2.exec[1]\n\n  - openstack_compute_instance_v2.nfs\n\n  - openstack_compute_instance_v2.test\n\n  - openstack_compute_keypair_v2.my-cloud-key\n\n\nPlan: 0 to add, 0 to change, 5 to destroy.\n\nDo you want to perform these actions?\n  Terraform will perform the actions described above.\n  Only 'yes' will be accepted to approve.\n\n  Enter a value:\n</code></pre></div>      </div>\n    </li>\n  </ol>\n</blockquote>\n\n<h2 id=\"destroy-time-provisioners\">Destroy time provisioners</h2>\n\n<p>Sometimes, immediately terminating the VM is not ideal behaviour. Especially if you’re managing a cluster like HTCondor which can gracefully terminate jobs, you might want to permit that. Terraform provides ‘destroy-time provisioners’, code snippets that are run before the VM is destroyed. If they return successfully, destruction continues. If they exit with an error code, then destruction is halted. We can write a simple one for HTCondor like so:</p>\n\n<div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">set</span> <span class=\"nt\">-ex</span>\ncondor_drain <span class=\"si\">$(</span><span class=\"nb\">hostname</span><span class=\"si\">)</span> <span class=\"o\">||</span> <span class=\"nb\">true</span><span class=\"p\">;</span>\n<span class=\"nv\">my_ip</span><span class=\"o\">=</span><span class=\"si\">$(</span>/sbin/ifconfig eth0 | <span class=\"nb\">grep</span> <span class=\"s1\">'inet '</span> | <span class=\"nb\">awk</span> <span class=\"s1\">'{print $2}'</span><span class=\"si\">)</span>\n<span class=\"c\"># Find slots which have an address associated with us.</span>\n<span class=\"nv\">slots</span><span class=\"o\">=</span><span class=\"si\">$(</span>condor_status <span class=\"nt\">-autoformat</span> Name State MyAddress | <span class=\"nb\">grep</span> <span class=\"s2\">\"&lt;</span><span class=\"k\">${</span><span class=\"nv\">my_ip</span><span class=\"k\">}</span><span class=\"s2\">?9618\"</span> | <span class=\"nb\">wc</span> <span class=\"nt\">-l</span><span class=\"si\">)</span>\n<span class=\"c\"># If there are more than one slots, leave it.</span>\n<span class=\"k\">if</span> <span class=\"o\">((</span> slots <span class=\"o\">&gt;</span> 1 <span class=\"o\">))</span><span class=\"p\">;</span> <span class=\"k\">then\n    </span><span class=\"nb\">exit </span>1<span class=\"p\">;</span>\n<span class=\"k\">else</span>\n    <span class=\"c\"># Otherwise, poweroff.</span>\n    /usr/sbin/condor_off <span class=\"nt\">-graceful</span>\n    <span class=\"nb\">exit </span>0<span class=\"p\">;</span>\n<span class=\"k\">fi</span>\n</code></pre></div></div>\n\n<p>Which can be provided to your VM like:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>provisioner \"remote-exec\" {\n  when = \"destroy\"\n\n  scripts = [\n    \"prepare-restart.sh\",\n  ]\n\n  connection {\n    type        = \"ssh\"\n    user        = \"centos\"\n    private_key = \"${file(\"~/.ssh/id_rsa\")}\"\n  }\n}\n</code></pre></div></div>\n\n<p>Terraform will SSH in with those credentials, copy over the script in <code class=\"language-plaintext highlighter-rouge\">prepare-restart.sh</code>, and execute it.</p>\n\n<h1 id=\"usegalaxyeus-terraform-usage\">UseGalaxy.eu’s Terraform Usage</h1>\n\n<p>All of <a href=\"https://github.com/usegalaxy-eu/infrastructure/\">our virtual infrastructure</a> is managed, publicly, with Terraform. We hope that this can inspire others and give people ideas of the sort of things they can accomplish with Terraform. If you have questions over the way we have done certain things, feel free to file an issue and ask us!</p>\n"],"ref_slides":["### Why Terraform\n\n- Managing complex infrastructure is not easy\n\n- Needs to be reproducible\n\n- Needs to be failure resistant\n\n---\n\n### Pets vs Cattle\n\n.pull-left[\n- A special, lovingly raised server\n- When they become ill you nurse them back to health\n- Everyone is sad when it dies\n]\n\n.pull-right[\n- Generic and replacable\n- If one gets sick, you just kill it\n- If one dies, no one is sad\n]\n\n![On the left is a very cute cat with big eyes, on the right is a picture of cows.](../../images/pets-vs-cattle.jpg)\n\n---\n\n## Terraform\n\n\"Infrastructure as Code\"\n\n- Write code\n- Plan changes\n- Create reproducible infrastructure\n\n---\n\n### Write: Infrastructure as Code\n\n- Your infrastructure is completely specified by easy-to-edit text files\n\n- Collaborate on infrastructure using git/hg/etc.\n\n- Automate everything using one piece of software (instead of OpenStack CLI + AWS CLI + ... )\n\n```ini\nresource \"openstack_compute_instance_v2\" \"my-server\" {\n  name            = \"my-server\"\n  image_name      = \"CentOS 7\"\n  flavor_name     = \"m1.large\"\n}\n\nresource \"aws_route53_record\" \"my.server\" {\n  name    = \"my.server.example.org\"\n  records = [\"${openstack_compute_instance_v2.my-server.access_ip_v4}\"]\n}\n```\n\n---\n\n### Plan: your changes\n\n- See how changes will affect resources\n\n- Preview the planned changes before applying them\n\n\n![Text in the terminal showing that an openstack compute keypair my-cloud-key is being created. Plan: 2 to add, 0 to change, 0 to destroy](../../images/plan.png \"Terraform plan\")\n\n???\n\nEasy to see which resources need to be recreated, can produce a nice graph of their dependencies.\n\n---\n\n### Create: Reproducible Infrastructure\n\n- Combine resources across providers (VM from OpenStack, DNS from Amazon, everything done in correct order)\n\n- Consistently reproduce the same infrastructure in a new cloud, new project.\n\n.image-70[\n![Graph of requirements showing relationship between provider, instance, and things like the keypair to be added](../../images/graph2.png \"A more complex graph showing variables\")\n]\n\n???\n\nThis was a fantastically useful feature for UseGalaxy.eu, we transitioned smoothly between two OpenStack clouds because we just could say `terraform apply` in our new cloud, our entire infrastructure was reproduced.\n\n---\n\n### Manage Many Resources\n\n```\nACME     Alicloud     Archive    Arukas     AWS     Azure Azure Stack     Bitbucket\nBrightbox    CenturyLinkCloud     Chef     Circonus Cloudflare     CloudScale.ch\nCloudStack    Cobbler     Consul     Datadog DigitalOcean     DNS     DNSMadeEasy\nDNSimple     Docker     Dyn External     F5 BIG-IP     Fastly    FlexibleEngine     GitHub\nGitlab Google Cloud     Grafana     Helm    Heroku     Hetzner Cloud     HTTP\nHuaweiCloud     Icinga2     Ignition    InfluxDB     Kubernetes     Librato Linode\nLocal     Logentries    LogicMonitor     Mailgun     MySQL Netlify     New Relic\nNomad    NS1     Null     Nutanix 1&1     OpenStack     OpenTelekomCloud\nOpsGenie     Oracle Cloud Infrastructure     Oracle Cloud Platform Oracle Public\nCloud     OVH     Packet    PagerDuty     Palo Alto Networks     PostgreSQL PowerDNS\nProfitBricks     RabbitMQ    Rancher     Random     RightScale Rundeck     RunScope\nScaleway    SoftLayer     StatusCake     Spotinst TelefonicaOpenCloud     Template\nTencentCloud    Terraform     Terraform Enterprise     TLS Triton     UltraDNS\nVault    VMware vCloud Director     VMware NSX-T     VMware vSphere\n```\n\n???\n\nManage VMs across AWS, GCE, OpenStack, and other Clouds\n\nManage DNS entries with various providers\n\nManage Database users/tables/authorizations\n\nManage GitHub repository permissions\n\n---\n\n### Advanced Features\n\nIf you find you love it, many advanced features:\n\n- modules for code re-use\n- Custom plugins\n- Provisioning VMs\n- GitHub integration\n"],"video_library":{"tutorial":null,"slides":null,"demo":null,"both":null,"session":null},"hands_on":true,"slides":true,"mod_date":"2022-10-18 14:23:35 +0000","pub_date":"2018-10-27 07:51:23 +0000","version":24,"api":"https://training.galaxyproject.org/training-material/api/topics/admin/tutorials/terraform/tutorial.json","tools":[],"supported_servers":[],"topic_name_human":"Galaxy Server administration","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools: []\n","tours":false,"video":false,"translations":{"tutorial":[],"slides":[],"video":false},"license":"CC-BY-4.0","type":"tutorial"}