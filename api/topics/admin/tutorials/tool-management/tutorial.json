{"layout":"tutorial_hands_on","title":"Galaxy Tool Management with Ephemeris","questions":["How to install, update, and maintain Galaxy tools?","How to extract a list of tools from a workflow or Galaxy instance?"],"objectives":["Learn about Ephemeris","Extract a list of tools from a workflow","Install these tools on a given Galaxy"],"time_estimation":"45m","key_points":["Ephemeris and automation help with the tool management on Galaxy","There are tool management best practices you can learn from","Do not manage your Galaxy tools manually"],"contributors":[{"name":"Martin Čech","email":"marten@bx.psu.edu","matrix":"martenson:matrix.org","orcid":"0000-0002-9318-1781","elixir_node":"cz","contact_for_training":true,"location":{"country":"USA","lat":37.0,"lon":-122.0},"fediverse":"https://mastodon.world/@martenson","fediverse_flavor":"mastodon","joined":"2017-09","affiliations":["elixir-europe"],"id":"martenson","url":"https://training.galaxyproject.org/training-material/api/contributors/martenson.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/martenson/"},{"name":"Helena Rasche","orcid":"0000-0001-9760-8992","maintainer_contact":"gitter","matrix":"hexylena:matrix.org","joined":"2017-09","elixir_node":"nl","affiliations":["gallantries","by-covid","erasmusmc","elixir-europe","elixir-converge"],"former_affiliations":["deNBI","avans-atgm","uni-freiburg"],"contact_for_training":false,"location":{"country":"NL","lat":51.91,"lon":4.46},"id":"hexylena","url":"https://training.galaxyproject.org/training-material/api/contributors/hexylena.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/hexylena/"},{"name":"Nicola Soranzo","matrix":"nsoranzo:matrix.org","orcid":"0000-0003-3627-5340","twitter":"NicolaSoranzo","joined":"2017-09","elixir_node":"uk","fediverse":"https://mstdn.science/@nsoranzo","fediverse_flavor":"mastodon","linkedin":"nicola-soranzo-7884125","affiliations":["earlham","elixir-europe"],"id":"nsoranzo","url":"https://training.galaxyproject.org/training-material/api/contributors/nsoranzo.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/nsoranzo/"}],"subtopic":"features","tags":["tools","git-gat"],"recordings":[{"captioners":["cat-bro"],"date":"2021-06-28","galaxy_version":"21.05","length":"27M","youtube_id":"pda0v9b3vO4","speakers":["cat-bro"]},{"captioners":["eancelet"],"date":"2021-02-15","galaxy_version":"21.01","length":"47M","youtube_id":"7Qqwrzn--YI","speakers":["cat-bro"]}],"js_requirements":{"mathjax":null,"mermaid":false},"short_id":"T00023","url":"/topics/admin/tutorials/tool-management/tutorial.html","topic_name":"admin","tutorial_name":"tool-management","dir":"topics/admin/tutorials/tool-management","symlink":null,"id":"admin/tool-management","ref_tutorials":["<p>This tutorial will introduce you to one of Galaxy’s associated projects - <a href=\"https://ephemeris.readthedocs.io/\">Ephemeris</a>. Ephemeris is a small Python library and set of scripts for managing the bootstrapping of Galaxy plugins - tools, index data, and workflows. It aims to help automate, and limit the quantity of manual actions admins have to do in order to maintain a Galaxy instance.</p>\n\n<blockquote class=\"agenda\">\n  <agenda-title></agenda-title>\n\n<ol id=\"markdown-toc\">\n  <li><a href=\"#background\" id=\"markdown-toc-background\">Background</a></li>\n  <li><a href=\"#requirements\" id=\"markdown-toc-requirements\">Requirements</a></li>\n  <li><a href=\"#extracting-tools\" id=\"markdown-toc-extracting-tools\">Extracting Tools</a></li>\n  <li><a href=\"#installing-tools\" id=\"markdown-toc-installing-tools\">Installing Tools</a></li>\n  <li><a href=\"#tool-testing\" id=\"markdown-toc-tool-testing\">Tool Testing</a></li>\n  <li><a href=\"#obtaining-a-tool-list\" id=\"markdown-toc-obtaining-a-tool-list\">Obtaining a Tool List</a></li>\n  <li><a href=\"#production-best-practices\" id=\"markdown-toc-production-best-practices\">Production Best Practices</a></li>\n</ol>\n\n</blockquote>\n\n<!--SNIPPET-->\n<blockquote class=\"comment\">   <div class=\"box-title comment-title\" id=\"comment-galaxy-admin-training-path\"><i class=\"far fa-comment-dots\" aria-hidden=\"true\"></i> Comment: Galaxy Admin Training Path</div>   <p>The yearly Galaxy Admin Training follows a specific ordering of tutorials. Use this timeline to help keep track of where you are in Galaxy Admin Training.</p>   <ol id=\"git-gat-timeline\">                    <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html\">             <div>Step 1</div>             <div>ansible-galaxy</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/backup-cleanup/tutorial.html\">             <div>Step 2</div>             <div>backup-cleanup</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/customization/tutorial.html\">             <div>Step 3</div>             <div>customization</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/tus/tutorial.html\">             <div>Step 4</div>             <div>tus</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/cvmfs/tutorial.html\">             <div>Step 5</div>             <div>cvmfs</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/apptainer/tutorial.html\">             <div>Step 6</div>             <div>apptainer</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"active\">         <a href=\"/training-material/topics/admin/tutorials/tool-management/tutorial.html\">             <div>Step 7</div>             <div>tool-management</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/reference-genomes/tutorial.html\">             <div>Step 8</div>             <div>reference-genomes</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/data-library/tutorial.html\">             <div>Step 9</div>             <div>data-library</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/dev/tutorials/bioblend-api/tutorial.html\">             <div>Step 10</div>             <div>dev/bioblend-api</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/connect-to-compute-cluster/tutorial.html\">             <div>Step 11</div>             <div>connect-to-compute-cluster</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/job-destinations/tutorial.html\">             <div>Step 12</div>             <div>job-destinations</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/pulsar/tutorial.html\">             <div>Step 13</div>             <div>pulsar</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/celery/tutorial.html\">             <div>Step 14</div>             <div>celery</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/gxadmin/tutorial.html\">             <div>Step 15</div>             <div>gxadmin</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/reports/tutorial.html\">             <div>Step 16</div>             <div>reports</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/monitoring/tutorial.html\">             <div>Step 17</div>             <div>monitoring</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/tiaas/tutorial.html\">             <div>Step 18</div>             <div>tiaas</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/sentry/tutorial.html\">             <div>Step 19</div>             <div>sentry</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/ftp/tutorial.html\">             <div>Step 20</div>             <div>ftp</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/beacon/tutorial.html\">             <div>Step 21</div>             <div>beacon</div>         </a>     </li>           </ol> </blockquote>\n<p><!--END_SNIPPET--></p>\n\n<h1 id=\"background\">Background</h1>\n\n<p>You are an administrator of a Galaxy server. A colleague has approached you with a request to run a specific <a href=\"/training-material/topics/sequence-analysis/tutorials/mapping/workflows/mapping.ga\">Galaxy workflow</a> on their data. In order to enable this workflow for your users, you will have to:</p>\n\n<ul>\n  <li>identify what tools are required for the workflow</li>\n  <li>install these tools and their dependencies on your Galaxy instance.</li>\n</ul>\n\n<h1 id=\"requirements\">Requirements</h1>\n\n<p>To run this tutorial, you will need to <a href=\"https://ephemeris.readthedocs.io/en/latest/installation.html\">install Ephemeris</a>. You would normally install it on your workstation, but during training courses we recommend to install it on the same virtual machine used for the Galaxy server.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Installing Ephemeris in a Python virtual environment</hands-on-title>\n\n  <ol>\n    <li>Install the Python <code class=\"language-plaintext highlighter-rouge\">venv</code> package if it is not already available. On Ubuntu this can be done with <code class=\"language-plaintext highlighter-rouge\">sudo apt install python3-venv</code></li>\n    <li>Create a virtual environment just for ephemeris, activate it and install ephemeris inside it:\n      <div class=\"language-console highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"go\">python3 -m venv ~/ephemeris_venv\n. ~/ephemeris_venv/bin/activate\npip install ephemeris\n</span></code></pre></div>      </div>\n    </li>\n  </ol>\n</blockquote>\n\n<h1 id=\"extracting-tools\">Extracting Tools</h1>\n\n<p>A common request you will experience as an administrator is “I want to run this workflow”. Since this is such a common workflow, Galaxy has a built in way to accomplish it. We can use Ephemeris to extract a list of tools from a Galaxy workflow document, and then use Ephemeris to install these tools and specific versions into your Galaxy.</p>\n\n<p>However, Galaxy workflow files are complex JSON documents, and the process of mapping the tool IDs to a ToolShed repository and revision is not trivial. Workflow files contain tool IDs which look like:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>toolshed.g2.bx.psu.edu/repos/devteam/fastqc/fastqc/0.71\ntoolshed.g2.bx.psu.edu/repos/bgruening/trim_galore/trim_galore/0.4.3.1\ntoolshed.g2.bx.psu.edu/repos/iuc/multiqc/multiqc/1.6\ntoolshed.g2.bx.psu.edu/repos/devteam/bowtie2/bowtie2/2.3.4.2\ntoolshed.g2.bx.psu.edu/repos/devteam/samtools_stats/samtools_stats/2.0.1\ntoolshed.g2.bx.psu.edu/repos/devteam/bamtools_filter/bamFilter/2.4.1\ntoolshed.g2.bx.psu.edu/repos/devteam/samtools_stats/samtools_stats/2.0.1\n</code></pre></div></div>\n\n<p>In order to actually install these tools, we need to convert each tool ID into a ToolShed repository name and revision. For example, FastQC version 0.71 corresponds to revision <code class=\"language-plaintext highlighter-rouge\">ff9530579d1f</code> in the ToolShed.</p>\n\n<div class=\"language-yaml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"pi\">-</span> <span class=\"na\">name</span><span class=\"pi\">:</span> <span class=\"s\">fastqc</span>\n  <span class=\"na\">owner</span><span class=\"pi\">:</span> <span class=\"s\">devteam</span>\n  <span class=\"na\">revisions</span><span class=\"pi\">:</span>\n  <span class=\"pi\">-</span> <span class=\"s\">ff9530579d1f</span>\n  <span class=\"na\">tool_panel_section_label</span><span class=\"pi\">:</span> <span class=\"s\">Tools from workflows</span>\n  <span class=\"na\">tool_shed_url</span><span class=\"pi\">:</span> <span class=\"s\">https://toolshed.g2.bx.psu.edu</span>\n</code></pre></div></div>\n\n<p>Ephemeris can take care of this process. Let’s practice this on a real workflow.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Extracting a list of tools from a workflow</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Download the mapping workflow:</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div data-cmd=\"true\" class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>wget https://training.galaxyproject.org/training-material/topics/sequence-analysis/tutorials/mapping/workflows/mapping.ga\n</code></pre></div>        </div>\n      </blockquote>\n    </li>\n    <li>\n      <p>Use the Ephemeris <a href=\"https://ephemeris.readthedocs.io/en/latest/commands/workflow-to-tools.html\"><code class=\"language-plaintext highlighter-rouge\">workflow-to-tools</code></a> command to extract the tool list from this workflow into a file named <code class=\"language-plaintext highlighter-rouge\">workflow_tools.yml</code> in the folder <code class=\"language-plaintext highlighter-rouge\">tools</code>.</p>\n\n      <blockquote class=\"question\">\n        <question-title></question-title>\n        <p>What did your command look like?</p>\n\n        <blockquote class=\"solution\">\n          <solution-title></solution-title>\n          <blockquote class=\"code-in\">\n            <code-in-title>Bash</code-in-title>\n            <div data-cmd=\"true\" class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>workflow-to-tools <span class=\"nt\">-w</span> mapping.ga <span class=\"nt\">-o</span> tools/workflow_tools.yml <span class=\"nt\">-l</span> Mapping\n</code></pre></div>            </div>\n\n            <p>Or as a diff:</p>\n\n            <div data-commit=\"Add a tool list to install\" class=\"language-diff highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"gd\">--- /dev/null\n</span><span class=\"gi\">+++ b/tools/workflow_tools.yml\n</span><span class=\"p\">@@ -0,0 +1,41 @@</span>\n<span class=\"gi\">+install_tool_dependencies: True\n+install_repository_dependencies: True\n+install_resolver_dependencies: True\n+\n+tools:\n+- name: fastqc\n+  owner: devteam\n+  revisions:\n+  - e7b2202befea\n+  tool_panel_section_label: Mapping\n+  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n+- name: trim_galore\n+  owner: bgruening\n+  revisions:\n+  - 949f01671246\n+  tool_panel_section_label: Mapping\n+  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n+- name: multiqc\n+  owner: iuc\n+  revisions:\n+  - f7985e0479b9\n+  tool_panel_section_label: Mapping\n+  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n+- name: bowtie2\n+  owner: devteam\n+  revisions:\n+  - 09b2cdb7ace5\n+  tool_panel_section_label: Mapping\n+  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n+- name: samtools_stats\n+  owner: devteam\n+  revisions:\n+  - 24c5d43cb545\n+  tool_panel_section_label: Mapping\n+  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n+- name: bamtools_filter\n+  owner: devteam\n+  revisions:\n+  - cb20f99fd45b\n+  tool_panel_section_label: Mapping\n+  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n</span><span class=\"err\">\n</span></code></pre></div>            </div>\n          </blockquote>\n        </blockquote>\n      </blockquote>\n    </li>\n    <li>\n      <p>Inspect the <code class=\"language-plaintext highlighter-rouge\">workflow_tools.yml</code> file, which contains a tool list in YAML format.</p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h1 id=\"installing-tools\">Installing Tools</h1>\n\n<p>Now that you have extracted a list of tools, let’s install these on your Galaxy instance. In order to accomplish this, you will need:</p>\n\n<ul>\n  <li>The URL of your Galaxy server</li>\n  <li>The API key for your account, which must be an admin</li>\n</ul>\n\n<!--SNIPPET-->\n<blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-getting-your-api-key\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-getting-your-api-key\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Getting your API key</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p>Galaxy admin accounts are specified as a comma-separated email list in the <code class=\"language-plaintext highlighter-rouge\">admin_users</code> directive of <code class=\"language-plaintext highlighter-rouge\">galaxy.yml</code> . If you have set up your Galaxy server using the <a href=\"/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html\">Galaxy Installation with Ansible</a> tutorial, this is set to <code class=\"language-plaintext highlighter-rouge\">admin@example.org</code>.</p>   <ol>   <li>In your browser, open your Galaxy homepage</li>   <li>Log in, or register a new account, if it’s the first time you’re logging in</li>   <li>Go to <code class=\"language-plaintext highlighter-rouge\">User -&gt; Preferences</code> in the top menu bar, then click on <code class=\"language-plaintext highlighter-rouge\">Manage API key</code></li>   <li>If there is no current API key available, click on <code class=\"language-plaintext highlighter-rouge\">Create a new key</code> to generate it</li>   <li>Copy your API key to somewhere convenient, you will need it throughout this tutorial</li> </ol> </blockquote>\n<p><!--END_SNIPPET--></p>\n\n<p>There are two ways to install tools, depending on how you specify the tools to install:</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Installing a single tool</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Use the Ephemeris <a href=\"https://ephemeris.readthedocs.io/en/latest/commands/shed-tools.html\"><code class=\"language-plaintext highlighter-rouge\">shed-tools</code></a> command to install the tool <code class=\"language-plaintext highlighter-rouge\">bwa</code>, owned by <code class=\"language-plaintext highlighter-rouge\">devteam</code> into a section named <code class=\"language-plaintext highlighter-rouge\">Mapping</code></p>\n\n      <blockquote class=\"question\">\n        <question-title></question-title>\n        <p>What did your command look like?</p>\n\n        <blockquote class=\"solution\">\n          <solution-title></solution-title>\n          <p>Use your Galaxy URL and API key in the example command below:</p>\n\n          <div data-cmd=\"true\" class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>shed-tools <span class=\"nb\">install</span> <span class=\"nt\">-g</span> https://galaxy.example.org <span class=\"nt\">-a</span> &lt;api-key&gt; <span class=\"nt\">--name</span> bwa <span class=\"nt\">--owner</span> devteam <span class=\"nt\">--section_label</span> Mapping\n</code></pre></div>          </div>\n        </blockquote>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"tip\">\n  <tip-title>Certificate issues (GAT, uncommon)</tip-title>\n\n  <p>If your Galaxy instance is served via the HTTPS protocol (as it should be!), ephemeris will use the <a href=\"https://requests.readthedocs.io\">requests</a> Python library to encrypt the communication with Galaxy. Therefore, if your Galaxy uses a self-signed SSL certificate, <code class=\"language-plaintext highlighter-rouge\">shed-tools</code> may fail with a <code class=\"language-plaintext highlighter-rouge\">CERTIFICATE_VERIFY_FAILED</code> error.</p>\n\n  <p>Under Ubuntu, you can allow the use of the unrecognized certificate as follows:</p>\n  <ol>\n    <li>Get hold of the Certificate Authority (CA) certificate used to sign your Galaxy SSL certificate. For a <a href=\"https://github.com/galaxyproject/dagobah-training\">Galaxy Admin Training</a> course, this is usually the <a href=\"https://letsencrypt.org/certs/fakelerootx1.pem\">Fake LE Root X1 certificate</a>.</li>\n    <li>Copy the CA certificate file into <code class=\"language-plaintext highlighter-rouge\">/usr/local/share/ca-certificates/</code> with a <code class=\"language-plaintext highlighter-rouge\">.crt</code> extension.</li>\n    <li>Run <code class=\"language-plaintext highlighter-rouge\">update-ca-certificates</code> as root.</li>\n    <li>Execute <code class=\"language-plaintext highlighter-rouge\">export REQUESTS_CA_BUNDLE=/etc/ssl/certs/ca-certificates.crt</code>, as explained in <a href=\"https://requests.readthedocs.io/en/master/user/advanced/#ssl-cert-verification\">requests docs</a>.</li>\n  </ol>\n\n  <p>Now you should be able to execute successfully the <code class=\"language-plaintext highlighter-rouge\">shed-tools</code> commands.</p>\n</blockquote>\n\n<p>This provides an easy way to do a one-off installation of a tool, but is not very convenient if you want to install many tools.\nFor that, you can install from a YAML file:</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Installing tools from a tool list</hands-on-title>\n\n  <ol>\n    <li>\n      <p>(optional) Watch the installation proceed by running <code class=\"language-plaintext highlighter-rouge\">journalctl -f</code> in a separate remote shell.</p>\n    </li>\n    <li>\n      <p>Use the Ephemeris <a href=\"https://ephemeris.readthedocs.io/en/latest/commands/shed-tools.html\"><code class=\"language-plaintext highlighter-rouge\">shed-tools</code></a> command to install all of the tools from the <code class=\"language-plaintext highlighter-rouge\">workflow_tools.yml</code> file on your Galaxy.</p>\n\n      <blockquote class=\"question\">\n        <question-title></question-title>\n        <p>What did your command look like?</p>\n\n        <blockquote class=\"solution\">\n          <solution-title></solution-title>\n          <p>Use your Galaxy URL and API key in the example command below:</p>\n\n          <div data-cmd=\"true\" class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>shed-tools <span class=\"nb\">install</span> <span class=\"nt\">-g</span> https://galaxy.example.org <span class=\"nt\">-a</span> &lt;api-key&gt; <span class=\"nt\">-t</span> workflow_tools.yml\n</code></pre></div>          </div>\n        </blockquote>\n      </blockquote>\n    </li>\n    <li>\n      <p>Open your Galaxy’s admin interface and check that the tools have been installed.</p>\n    </li>\n    <li>\n      <p>Using the UI import the workflow file that you used, <a href=\"/training-material/topics/sequence-analysis/tutorials/mapping/workflows/mapping.ga\">mapping.ga</a>.</p>\n      <ol>\n        <li>Right-click or Ctrl-click on the link above and copy the link address</li>\n        <li>On your Galaxy instance click on <code class=\"language-plaintext highlighter-rouge\">Workflow</code>, then <code class=\"language-plaintext highlighter-rouge\">Import</code>.  Paste the URL into the <code class=\"language-plaintext highlighter-rouge\">Import Archived URL</code> field.</li>\n      </ol>\n    </li>\n  </ol>\n</blockquote>\n\n<p>Occasionally the tool installation may fail due to network issues; if it does, just re-run the <code class=\"language-plaintext highlighter-rouge\">shed-tools</code> installation process until it succeeds. This is a known issue the developers are working on.</p>\n\n<!--SNIPPET-->\n<blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-opening-a-split-screen-in-byobu\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-opening-a-split-screen-in-byobu\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Opening a split screen in byobu</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <tip-title>Opening a split screen in byobu</tip-title>   <p><kbd>Shift-F2</kbd>: Create a horizontal split</p>   <p><kbd>Shift-Left/Right/Up/Down</kbd>: Move focus among splits</p>   <p><kbd>Ctrl-F6</kbd>:  Close split in focus</p>   <p><kbd>Ctrl-D</kbd>:  (Linux, Mac users) Close split in focus</p>   <p>There are more byobu commands described in this <a href=\"https://gist.github.com/devhero/7b9a7281db0ac4ba683f\">gist</a></p> </blockquote>\n<p><!--END_SNIPPET--></p>\n\n<blockquote class=\"tip\">\n  <tip-title>Can I install tools without restarting?</tip-title>\n  <p>Yes. The default tool config (<code class=\"language-plaintext highlighter-rouge\">config/tool_conf.xml.sample</code>, copy to <code class=\"language-plaintext highlighter-rouge\">config/tool_conf.xml</code> to modify) has an option, <code class=\"language-plaintext highlighter-rouge\">monitor=\"true\"</code> set in the root <code class=\"language-plaintext highlighter-rouge\">&lt;toolbox&gt;</code> tag. This instructs Galaxy to watch the tool files referenced in that config and load or reload them as necessary. It will also add any tools you have added.</p>\n</blockquote>\n\n<blockquote class=\"tip\">\n  <tip-title>Can I install tools without a ToolShed?</tip-title>\n  <p>Yes. The <code class=\"language-plaintext highlighter-rouge\">galaxy_local_tools</code> option for the <code class=\"language-plaintext highlighter-rouge\">galaxyproject.galaxy</code> Ansible role can be used to install local tools, or you can manage them in another way that fits your workflow better. UseGalaxy.eu, for example, maintains a repository of tools that are not installed from the ToolShed to aid their local developers. This is deployed to the server using the <code class=\"language-plaintext highlighter-rouge\">git</code> module, rather than the Galaxy Ansible role.</p>\n</blockquote>\n\n<h1 id=\"tool-testing\">Tool Testing</h1>\n\n<p>Having the tools installed is a good first step, but your users will expect that they actually work as well. You can use Ephemeris to automatically test all of the installed tools.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Test the installed tools</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Use the Ephemeris <a href=\"https://ephemeris.readthedocs.io/en/latest/commands/shed-tools.html#test\"><code class=\"language-plaintext highlighter-rouge\">shed-tools</code></a> command to test the <code class=\"language-plaintext highlighter-rouge\">bamtools_filter</code> tool on your Galaxy.</p>\n\n      <blockquote class=\"question\">\n        <question-title></question-title>\n        <p>What did your command look like?</p>\n\n        <blockquote class=\"solution\">\n          <solution-title></solution-title>\n          <p>Use your Galaxy URL and API key in the example command below:</p>\n\n          <div data-cmd=\"true\" class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>shed-tools <span class=\"nb\">test</span> <span class=\"nt\">-g</span> https://galaxy.example.org <span class=\"nt\">-a</span> &lt;api-key&gt; <span class=\"nt\">--name</span> bamtools_filter <span class=\"nt\">--owner</span> devteam\n</code></pre></div>          </div>\n        </blockquote>\n      </blockquote>\n    </li>\n    <li>\n      <p>Shed-tools test outputs a file with details of <code class=\"language-plaintext highlighter-rouge\">tool_test_output.json</code> with details of jobs that have run.  Have a look at this file.</p>\n    </li>\n  </ol>\n</blockquote>\n\n<p>This can give you some more confidence that things are working correctly. Oftentimes, users provide workflows for biological domains that we are not familiar with, so knowing how we can test these tools is impossible for us as admins. Leveraging the built-in tool test cases can give you reassurance that things are functional before you inform your users of the new tools.</p>\n\n<blockquote class=\"tip\">\n  <tip-title>Tool test reports</tip-title>\n  <p>The ephemeris <code class=\"language-plaintext highlighter-rouge\">shed-tools test</code> command produces an output file <code class=\"language-plaintext highlighter-rouge\">tool_test_output.json</code> with information about the test jobs that have run. Galaxyproject’s <a href=\"https://github.com/galaxyproject/planemo\">Planemo</a> can be used to generate <a href=\"https://planemo.readthedocs.io/en/latest/commands/test_reports.html?highlight=test_reports#test-reports-command\">test reports</a> from tool_test_output.json in HTML and other formats.</p>\n</blockquote>\n\n<h1 id=\"obtaining-a-tool-list\">Obtaining a Tool List</h1>\n\n<p>Sometimes a user might ask you to install all the tools they were previously using on another Galaxy instance. Ephemeris can produce a <code class=\"language-plaintext highlighter-rouge\">tool_list.yaml</code> file for all the tools installed on a server.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Obtain UseGalaxy.eu's tool list</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Use the Ephemeris <a href=\"https://ephemeris.readthedocs.io/en/latest/commands/get-tool-list.html\"><code class=\"language-plaintext highlighter-rouge\">get-tool-list</code></a> command to obtain the full set of tools installed on UseGalaxy.eu</p>\n\n      <blockquote class=\"question\">\n        <question-title></question-title>\n        <p>What did your command look like?</p>\n\n        <blockquote class=\"solution\">\n          <solution-title></solution-title>\n          <p>This command does not require authentication and can be used to obtain the tool list from any public Galaxy server:</p>\n\n          <blockquote class=\"code-in\">\n            <code-in-title>Bash</code-in-title>\n            <div data-cmd=\"true\" class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>get-tool-list <span class=\"nt\">-g</span> <span class=\"s2\">\"https://usegalaxy.eu\"</span> <span class=\"nt\">-o</span> <span class=\"s2\">\"eu_tool_list.yaml\"</span>\n</code></pre></div>            </div>\n          </blockquote>\n        </blockquote>\n      </blockquote>\n    </li>\n    <li>\n      <p>Inpect the first few lines of tool list: Run <code class=\"language-plaintext highlighter-rouge\">head -n 20 eu_tool_list.yaml</code>.</p>\n    </li>\n  </ol>\n</blockquote>\n\n<p>We will not install all the tools from the EU Galaxy server as that server likely has more tools than any other Galaxy instance, but it is useful as an example of how you can use Ephemeris to facilitate the mirroring of another Galaxy instance.</p>\n\n<blockquote class=\"tip\">\n  <tip-title>Non-shed tools</tip-title>\n  <p>The output of <code class=\"language-plaintext highlighter-rouge\">get-tool-list</code> only includes ToolShed tools, not local non-TS tools.</p>\n</blockquote>\n\n<blockquote class=\"tip\">\n  <tip-title>But how many tools is it really?</tip-title>\n  <p>If you’ve seen the <a href=\"https://usegalaxy.eu/tools/view\">European Galaxy tools view</a> (this is available on any galaxy! Just access <code class=\"language-plaintext highlighter-rouge\">/tools/view</code>)\nyou’ll notice they report somewhere over 2700 tools, however the <code class=\"language-plaintext highlighter-rouge\">get-tool-list</code> output lists significantly fewer tools.</p>\n\n  <p>This is for a couple reasons:</p>\n  <ul>\n    <li>That’s the number of repositories that are installed, and some repositories include multiple tools (e.g. <a href=\"https://toolshed.g2.bx.psu.edu/view/iuc/circos/df7356989ac1\"><code class=\"language-plaintext highlighter-rouge\">circos</code></a> has quite a few)</li>\n    <li>This only lists ToolShed tools, while EU also includes a number of non-TS tools</li>\n    <li>There are a number of tools built into Galaxy (e.g. the Collection Operation tools)</li>\n  </ul>\n</blockquote>\n\n<h1 id=\"production-best-practices\">Production Best Practices</h1>\n\n<p>The servers which are part of the <code class=\"language-plaintext highlighter-rouge\">usegalaxy.*</code> network use Ephemeris extensively to manage their large tool sets.</p>\n\n<p>Interestingly, UseGalaxy.eu and UseGalaxy.org.au have different approaches:</p>\n<ul>\n  <li>EU maintains <a href=\"https://github.com/usegalaxy-eu/usegalaxy-eu-tools\">YAML files roughly per domain</a>, it is not as clear of an ordering. They maintain a YAML file where humans add the tools which should be installed in a given category, and lock files are automatically generated from these with the latest revision if it is missing. They follow a cycle of updating the lock files with the latest available revisions of tools, and then installing from these lock files any missing revisions. They use a <a href=\"https://build.galaxyproject.eu/job/usegalaxy-eu/job/install-tools/\">Jenkins server</a> to automatically run tool installation weekly.</li>\n  <li>AU maintains <a href=\"https://github.com/usegalaxy-au/usegalaxy-au-tools/tree/master/usegalaxy.org.au\">a separate YAML file per tool panel section</a> as a record of all installed tools on the server.  They accept tool requests as pull requests and a Jenkins server is notified when a pull request is merged so that the tool can be automatically installed and tested. Like EU, they run automatic updates of installed tools once a week.</li>\n  <li>Together, <code class=\"language-plaintext highlighter-rouge\">usegalaxy.*</code> are working on a collaborative approach at <a href=\"https://github.com/galaxyproject/usegalaxy-tools\">galaxyproject/usegalaxy-tools</a> but this is not consumption ready yet.</li>\n</ul>\n\n<p>If running ephemeris directly is not your preference, there is an Ansible <a href=\"https://github.com/galaxyproject/ansible-galaxy-tools\">role</a> and a sample <a href=\"https://github.com/afgane/galaxy-tools-playbook\">playbook</a> that can help automate some tasks.</p>\n\n<blockquote class=\"tip\">\n  <tip-title>What if environments are not working</tip-title>\n  <p>It sometimes happens in Galaxy, that one environment isn’t working anymore. It mostly happens from the start when it does happen. You can remove the environment on disk, or use the “Manage Dependencies” interface, select the environment, and delete it. Then re-install the dependency through the same Manage Dependencies interface.</p>\n</blockquote>\n\n<blockquote class=\"tip\">\n  <tip-title>Can you install multiple tools simultaneously?</tip-title>\n  <p>Previous experience with this is not good, there was a lot of unsafe code that would do things simultaneously that would destroy config files. With conda this is not recommended either, as this can corrupt conda environments. A solution for this is how <a href=\"https://github.com/usegalaxy-eu/usegalaxy-eu-tools\">UseGalaxy.eu does it</a>, where they keep the full list of tools they want to install, and then a CI server (Jenkins) installs them. In this way they can enforce that only a single install process is running at any time.</p>\n</blockquote>\n\n<blockquote class=\"tip\">\n  <tip-title>Certificate Issues (GAT Only)</tip-title>\n  <p>If a student is running <code class=\"language-plaintext highlighter-rouge\">shed-tools</code> on the VM, then it should work without certificate issues, because we installed the Fake LE X1 CA certificate, meaning that to your VM, the certificate chain is valid.\nWe cannot (and would not recommend) setting that certificate on your local machine. That is the first way that comes to mind, that running an ephemeris command could generate that error.</p>\n</blockquote>\n\n<blockquote class=\"tip\">\n  <tip-title>Uninstalling tools</tip-title>\n  <p>While there is a function to accomplish this in <a href=\"https://github.com/galaxyproject/bioblend\">BioBlend</a>, it has not been <a href=\"https://github.com/galaxyproject/ephemeris/issues/83\">included in Ephemeris yet.</a> If you’re looking for a way to contribute to Galaxy, this would be great :)</p>\n</blockquote>\n\n<blockquote class=\"tip\">\n  <tip-title>\"Recommended way\" to install tools</tip-title>\n  <p>There is no one recommended way. Different people like to do different things. Some of us install things through the GUI still, some of us use ephemeris just for the automation.</p>\n\n  <p>EU and others try and force all tool installation to go through ephemeris to make sure that rebuilding a server in case of disaster is easy. Anything not managed through their files will be lost.</p>\n\n  <p>Others do a more mixed approach:</p>\n\n  <blockquote class=\"quote\">\n    <p>typically use Ephemeris, when I have to re-deploy a Galaxy instance (and thus install all tools) or during a Galaxy maintenance, when I want to update all installed toolshed tools in one go. Otherwise, when I need to install a specific version of one tool I use the GUI.</p>\n  </blockquote>\n\n  <p>There is no one right answer.</p>\n</blockquote>\n\n<blockquote class=\"tip\">\n  <tip-title>Tools not showing up? Refresh the toolbox!</tip-title>\n  <p>Sometimes the toolbox will fail to reload. You can correct for this by manually triggering the toolbox reload with a query:</p>\n\n  <div class=\"language-console highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"gp\">curl -X PUT https://galaxy.example.org/api/configuration/toolbox -H \"x-api-key: $</span>GALAXY_API_KEY<span class=\"s2\">\"\n</span></code></pre></div>  </div>\n\n  <p>This will request the toolbox to reload and you can check after if it’s discovered your newly installed tools.</p>\n</blockquote>\n\n<!--\n<!--SNIPPET-->\n<blockquote class=\"comment\">   <div class=\"box-title comment-title\" id=\"comment-got-lost-along-the-way\"><i class=\"far fa-comment-dots\" aria-hidden=\"true\"></i> Comment: Got lost along the way?</div>   <p>If you missed any steps, you can compare against the <a href=\"https://github.com/hexylena/git-gat/tree/step-7\">reference files</a>, or see what changed since <a href=\"https://github.com/hexylena/git-gat/compare/step-6...step-7#files_bucket\">the previous tutorial</a>.</p>   <p>If you’re using <code class=\"language-plaintext highlighter-rouge\">git</code> to track your progress, remember to add your changes and commit with a good commit message!</p> </blockquote>\n<p><!--END_SNIPPET-->\n–&gt;</p>\n\n<!--SNIPPET-->\n<blockquote class=\"comment\">   <div class=\"box-title comment-title\" id=\"comment-galaxy-admin-training-path-1\"><i class=\"far fa-comment-dots\" aria-hidden=\"true\"></i> Comment: Galaxy Admin Training Path</div>   <p>The yearly Galaxy Admin Training follows a specific ordering of tutorials. Use this timeline to help keep track of where you are in Galaxy Admin Training.</p>   <ol id=\"git-gat-timeline\">                    <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html\">             <div>Step 1</div>             <div>ansible-galaxy</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/backup-cleanup/tutorial.html\">             <div>Step 2</div>             <div>backup-cleanup</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/customization/tutorial.html\">             <div>Step 3</div>             <div>customization</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/tus/tutorial.html\">             <div>Step 4</div>             <div>tus</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/cvmfs/tutorial.html\">             <div>Step 5</div>             <div>cvmfs</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/apptainer/tutorial.html\">             <div>Step 6</div>             <div>apptainer</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"active\">         <a href=\"/training-material/topics/admin/tutorials/tool-management/tutorial.html\">             <div>Step 7</div>             <div>tool-management</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/reference-genomes/tutorial.html\">             <div>Step 8</div>             <div>reference-genomes</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/data-library/tutorial.html\">             <div>Step 9</div>             <div>data-library</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/dev/tutorials/bioblend-api/tutorial.html\">             <div>Step 10</div>             <div>dev/bioblend-api</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/connect-to-compute-cluster/tutorial.html\">             <div>Step 11</div>             <div>connect-to-compute-cluster</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/job-destinations/tutorial.html\">             <div>Step 12</div>             <div>job-destinations</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/pulsar/tutorial.html\">             <div>Step 13</div>             <div>pulsar</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/celery/tutorial.html\">             <div>Step 14</div>             <div>celery</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/gxadmin/tutorial.html\">             <div>Step 15</div>             <div>gxadmin</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/reports/tutorial.html\">             <div>Step 16</div>             <div>reports</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/monitoring/tutorial.html\">             <div>Step 17</div>             <div>monitoring</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/tiaas/tutorial.html\">             <div>Step 18</div>             <div>tiaas</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/sentry/tutorial.html\">             <div>Step 19</div>             <div>sentry</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/ftp/tutorial.html\">             <div>Step 20</div>             <div>ftp</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/beacon/tutorial.html\">             <div>Step 21</div>             <div>beacon</div>         </a>     </li>           </ol> </blockquote>\n<p><!--END_SNIPPET--></p>\n"],"ref_slides":["## Galaxy tools\n\n* A Galaxy `tool` or `wrapper` is an XML file describing how some software program works\n  * allows Galaxy to display the tool interface and execute the software\n  * describes all software requirements, tests, inputs and outputs, help text, citations\n* The underlying software packages needed to execute the tool command are called `requirements` or `dependencies`\n* A toolshed `repository` is a code archive in Tool Shed containing Galaxy tool(s)\n\n???\n\nA Galaxy `tool` or `wrapper` is an XML file describing how some software program works\n\nThe wrapper xml file contains definitions of the tool input form and instructions to translate form entries\ninto a command to execute the tool\n\nUnderlying software packages could be packages like samtools or biopython.\n\nA repository in the Galaxy Tool Shed is a versioned code archive containing one or more Galaxy tools\n\n---\n\n## The tool panel\n.left-column50[\n![Tool panel](../../images/tool-management-02-tool-panel.png)\n]\n\n.right-column50[\n\n- Panel on left-hand side of Galaxy UI\n\n- Contains Galaxy tools organised into sections\n\n- Some tools are distributed together with Galaxy (\"built-in tools\") \n\n- Tools can be installed from the Galaxy Tool Shed.\n\n- Customisable: admins can choose which tools are installed and how the tool panel is organised\n]\n\n???\n\nThe tool panel on the left hand side of a Galaxy site contains all\nof the tools available on that Galaxy instance, arranged into sections.\n\nIn this picture the Text Manipulation section has been expanded.\n\nThere are tools that come with the galaxy code such as the uploader, but the vast majority of tools\non a public galaxy have been installed from the toolshed.\n\nThe contents and layout of the tool panel are customisable.\n\n---\n\nclass: left\n\n## Tool configuration files\n\n`tool_conf.xml` (default `tool_conf.xml.sample`)\n- Contains built-in galaxy tools (tools in galaxy codebase)\n- Can contain manually added tools\n\n`shed_tool_conf.xml`\n- Contains tools downloaded from the tool shed\n- Managed by galaxy\n\n`integrated_tool_panel.xml`\n- Contains all tools from `tool_conf.xml` and `shed_tool_conf.xml`\n- Automatically generated by Galaxy\n- Can be edited to change the layout of the tool panel\n\n???\n\nThe contents of the tool panel are defined by three configuration files\n\nThe tool_conf file contains galaxy built in tools and manually added tools\n\nThe shed_tool_conf file is managed by galaxy and contains all tools installed from the tool shed\n\nThe integrated_tool_panel file contains all of the tools from tool_conf and\nshed_tool_conf and can be edited to change the layout of the tool panel\n\n---\n\nclass: left\n\n`tool_conf.xml`\n```xml\n<toolbox monitor=\"true\">\n    <section id=\"getext\" name=\"Get Data\">\n        <tool file=\"data_source/upload.xml\"/>\n        <tool file=\"data_source/ucsc_tablebrowser.xml\"/>\n...\n```\n\n`shed_tool_conf.xml`\n```xml\n<toolbox tool_path=\"../shed_tools\">  <!-- path to installed repositories -->\n  <section id=\"assembly\" name=\"Assembly\" version=\"\">\n    <tool file=\"toolshed.g2.bx.psu.edu/repos/iuc/shovill/196a599ec43d/shovill/shovill.xml\"\n          guid=\"toolshed.g2.bx.psu.edu/repos/iuc/shovill/shovill/0.8.0\">\n      <tool_shed>toolshed.g2.bx.psu.edu</tool_shed>\n      <repository_name>shovill</repository_name>\n      <repository_owner>iuc</repository_owner>\n      <installed_changeset_revision>196a599ec43d</installed_changeset_revision>\n      <id>toolshed.g2.bx.psu.edu/repos/iuc/shovill/shovill/0.8.0</id>\n      <version>0.8.0</version>\n    </tool>\n...\n```\n\n???\n\n\nThe tool_conf file contains paths to local tool wrapper XML files.\n\nEach tool element is within a section, telling galaxy where to put the\ntool in the panel.\n\nThe shed_tool_conf file also contains paths to tool wrapper XML files\nwhere they are installed (a complex directory structure)\n\nIt contains some metadata for each tool.\n\n---\n\n## Tool Shed\n\n- Galaxy \"App Store\"\n- It is a free service that hosts repositories containing Galaxy tools.\n- The Tool Shed is a hosting (not a development) platform.\n  - Each repository should link to its development repository.\n- https://toolshed.g2.bx.psu.edu/\n\n???\n\nThe tool shed is Galaxy's app store.\n\nIt's a free service hosts repositories containing Galaxy tools\nand can be found at this URL.\n\nIt's not a development platform: tools are usually maintained\nin open source github repos and uploaded to the toolshed.\n\n---\n\n#####https://toolshed.g2.bx.psu.edu/\n![Toolshed](../../images/tool-management-01-toolshed.png)\n\n???\n\nThe Galaxy tool shed has thousands of tools (almost 8000 as of October 2020)\n\nYou can go to this site to search for toolshed tools by category, or search\nfor them by name\n\n---\n\nclass: left\n\n## Ways to add tools\n\nYou can add tools to Galaxy either\n\n* Manually - useful for tool development.\n* From the Tool Shed\n  * Through the admin UI in Galaxy\n  * Using **ephemeris** (recommended)\n\n???\n\nTools can be added manually or from the toolshed.\n\nToolshed tools can be installed through the admin UI but using ephemeris is recommended.\n\n---\n\n## How to add tools manually\n\n- To add a local tool by hand:\n  - Add an entry to tool_conf.xml pointing to the local tool's xml file\n  - if `tool_conf.xml` does not exist it can be copied from `tool_conf.xml.sample`\n- To add local tools with the [galaxyproject.galaxy Ansible role][galaxy-role]:\n  - Set `galaxy_local_tools` to the local tool paths\n  - Run the playbook\n- Tool dependencies need to be installed separately, unless\n  `conda_auto_install: true` is set in `galaxy.yml` (not recommended for\n  production)\n\n\n[galaxy-role]: https://galaxy.ansible.com/galaxyproject/galaxy\n\n???\n\nTools can be added manually to the tool_conf.xml file.\n\nIf this doesn't exist it can be copied from the default file tool_conf.xml.sample.\n\nThere is also a variable in the galaxy ansible role for adding these.\n\nThe dependecies need to be installed separately.\n\n---\n\n## How to install Tool Shed tools through the UI\n\n- From the Galaxy admin UI, select \"Tool Management > Install and Uninstall\"\n- Find the repository with the tool(s) you want to install\n- Install the tool repository into Galaxy\n\n???\n\nAn administrator can look up any tool from the main toolshed in the\nadmin panel and click the 'Install' button.\n\n---\n\n## Advantages of using the Tool Shed\n\n- Installing from the Tool Shed takes care of\n  - dependencies\n  - reference data tables\n  - configuration files\n- Multiple versions (\"installable revisions\") of a repository can be installed to preserve reproducibility\n\n???\n\nInstalling from the tool shed will install tool dependencies.\n\nThis is typically a conda virtual environment containing every package that the tool requires.\n\nA toolshed tool might have multiple revisions.\n\nThis is important for reproducibility.\n\nIf you use a tool in an analysis on a public galaxy server it will be there forever.\n\nIf you need to rerun your analysis in a year's time, the tool you have used will still\nbe there even if a is a newer revision of the tool has been installed.\n\n---\n\n## Which Tool Shed?\n\n- The Main Tool Shed ( https://toolshed.g2.bx.psu.edu ) serves all Galaxies worldwide.\n  - Everybody can create a repository.\n  - Repositories are public, including their whole history.\n- The Test Tool Shed ( https://testtoolshed.g2.bx.psu.edu ) can be used for repositories not yet production-ready.\n- Local sheds can be run e.g. for private or custom-licensed tools.\n- The list of available Tool Sheds for a Galaxy instance is defined in `tool_sheds_conf.xml`:\n\n.reduce90[\n```xml\n<?xml version=\"1.0\"?>\n<tool_sheds>\n    <tool_shed name=\"Galaxy Main Tool Shed\" url=\"https://toolshed.g2.bx.psu.edu/\"/>\n<!-- Test Tool Shed should be used only for testing purposes.\n    <tool_shed name=\"Galaxy Test Tool Shed\" url=\"https://testtoolshed.g2.bx.psu.edu/\"/>\n-->\n</tool_sheds>\n```\n]\n\n???\n\nRepositories in the test tool shed are also public.\n\nThe toolshed is a web app backed by a database and anybody can run one, but we discourage running local tool shed.\n\nBy default, Galaxy only accepts tools from the main toolshed but also contains a\ncommented out entry for the test toolshed.\n\n---\n\n## What happens when installing a repo from the Tool Shed\n\n* The repository is downloaded\n* If needed, the tool's dependencies are installed\n* If needed, reference data tables are installed\n* An entry for each tool is created in the Galaxy database\n* The tools are added to `shed_tool_conf.xml`\n\n???\n\nThe repository is downloaded\n\nThe tool's dependencies are installed if needed (they may already be there)\n\nIf needed, reference data tables are installed\n\nAn entry for each tool is created in the Galaxy database (or the tool install database depending on the configuration of galaxy)\n\nThe tools are added to `shed_tool_conf.xml`\n\n---\n\n## How to install with Ephemeris\n\n* Find the repository you want to install.\n* Run `shed-tools install` with the repository details\n\n???\n\nFind a repository to install from the tool shed and\ninstall it with the ephemeris `shed-tools` command\n\n---\n\n# Ephemeris\n\nSmall Python library for Galaxy Management\n\n* Can install:\n\t- Tools\n\t- Reference data\n\t- Workflows\n\t- Data libraries\n* Can also test tools\n* `$ pip install ephemeris`\n* https://github.com/galaxyproject/ephemeris\n* https://ephemeris.readthedocs.io\n\n???\n\nEphemeris is a Python library for Galaxy management.\n\nIt can be used to install tools, reference data, workflows and data libraries onto a Galaxy Instance.\n\nIt can also be used to run tool tests.\n\nEphemeris can be installed with pip.\n\nEphemeris manages tools through the Galaxy API.\n\nThere is no need to be using ephemeris commands from the server running Galaxy (though you can).\n\n---\n\n## Get installed tool list for a Galaxy instance\n\n```console\nget-tool-list [-g GALAXY] [-u USER] [-p PASSWORD] [-a API_KEY]\n  [-h] [-v] \n\t-o OUTPUT\n\t[--include_tool_panel_id]\n\t[--skip_tool_panel_name]\n\t[--skip_changeset_revision]\n\t[--get_data_managers]  # admin only\n\t[--get_all_tools]  # admin only\n```\n\n???\n\nEphemeris can be used to get a list of installed tools for any public galaxy instance\n\nAn API key is not required for this but some options are not available\nunless an admin API key is provided.\n\n---\n\n```yaml\ntools:\n- name: 'column_maker'\n  owner: 'devteam'\n  tool_panel_section_label: 'Text Manipulation'\n  revisions:\n  - '464b9305180e'\t# 1.2.0\n  tool_shed_url: 'toolshed.g2.bx.psu.edu'\n- name: 'bwa'\n  owner: 'devteam'\n  revisions:\n  - '051eba708f43'  # 0.7.15.2\n  - '4d82cf59895e'  # 0.7.16.2\n  tool_panel_section_label: 'Mapping'\n  tool_shed_url: 'toolshed.g2.bx.psu.edu'\n- name: 'tabular_to_fasta'\n  owner: 'devteam'\n  revisions:\n  - '0b4e36026794'  # v1.1.0\n  tool_panel_section_label: 'Convert Formats'\n  tool_shed_url: 'toolshed.g2.bx.psu.edu'\n```\n\n???\n\nThe output contains all of the information we would need to install tools on a different galaxy instance.\n\nThe revisions correspond to tool versions. There are comments to highlight this.\n\nThere are two different revisions of bwa corresponding to two different versions.\n\n---\n\n## Install/Update/Test tools\n\n```console\nshed-tools install [-h] [-v] [-g GALAXY] [-u USER] [-p PASSWORD] [-a API_KEY]\n\t[--log_file LOG_FILE]\n\t[-t TOOL_LIST_FILE]\n\t[-y TOOL_YAML]\n\t[--name NAME]\n\t[--owner OWNER]\n\t[--revisions [REVISIONS [REVISIONS ...]]]\n\t[--toolshed TOOL_SHED_URL]\n\t[--install_tool_dependencies]\n\t[--skip_install_resolver_dependencies]\n\t[--skip_install_repository_dependencies]\n\t[--test]\n\t[--test_existing]\n\t[--test_json TEST_JSON]\n\t[--test_user_api_key TEST_USER]\n\t[--test_user TEST_USER]\n\t[--section TOOL_PANEL_SECTION_ID]\n\t[--section_label TOOL_PANEL_SECTION_LABEL]\n\t[--latest]\n```\n\n* Ansible role: https://github.com/galaxyproject/ansible-galaxy-tools\n* Sample playbook: https://github.com/afgane/galaxy-tools-playbook\n\n???\n\nA galaxy administrator can install tools by providing their administrator API key.\n\nThey can specify the name, owner and section label or provide a yaml list of tools (TOOL_LIST_FILE)\n\n---\n\n## Example: Installing circos\n\n.left[\n(1)\n```yaml\nshed-tools install -g <galaxy url> -a <api key> \\\n  --name circos --owner iuc --section_label 'Graph/Display Data'\n```\n\n(2)\n```yaml\nshed-tools install -g <galaxy url> -a <api key> -t tools.yml\n```\n\n`tools.yml`\n```yaml\ntools:\n- name: circos\n  owner: iuc\n  tool_panel_section_label: Graph/Display Data\n```\n]\n\n???\n\nshed-tools can be used to install a tool from command line arguments\nor from a yaml file containing one or more tools.\n\nThese two examples are equivalent to each other.\n\nThe advantage of the second approach is that many tools be listed\nin tools.yml to be installed at the same time\n\nThe argument 'revisions' can also be provided to install a\nspecific revision or more than one revision of the repository.\n\nIn the absence of a 'revisions' argument, shed-tools will \ninstall the latest revision of the tool.\n\n---\n\n## Test tools\n\n```console\nshed-tools test [-h] [-v] [--log_file LOG_FILE] [-g GALAXY] [-u USER]\n  [-p PASSWORD] [-a API_KEY] [-t TOOL_LIST_FILE]\n  [-y TOOL_YAML] [--name NAME] [--owner OWNER]\n  [--revisions [REVISIONS [REVISIONS ...]]]\n  [--toolshed TOOL_SHED_URL] [--test_json TEST_JSON]\n  [--test_user_api_key TEST_USER_API_KEY]\n  [--test_user TEST_USER]\n  [--parallel_tests PARALLEL_TESTS]\n```\n\n???\n\nA good tool comes with tests: instructions within the wrapper to run the tool\nwith test input and see whether the tool produces the expected output.\n\nYou need to be an an administrator to install tools but any galaxy user\nwith an API key can run tool tests.\n\n---\n\n## Tool test output\n\n- List of tests that have passed and tests that have failed\n- `tool_test_output.json` file with details of all of the test jobs\nincluding their standard outputs\n- planemo (https://planemo.readthedocs.io/en/latest/) \ncan be used to generate test reports from `tool_test_output.json`\n(`pip install planemo`)\n\n???\n\nRunning tool tests with ephemeris will yield\n- a list of tool tests that have passed and failed and\n- a more detailed file of data from the test jobs that is useful for debugging.\n\nThe python library planemo (also\npart of the galaxy project) can be used generate a user-friendly\nreport from the json data.\n\n---\n\n## List tools from a Galaxy workflow\n\n```console\nworkflow-to-tools\n  -w WORKFLOW_FILES [WORKFLOW_FILES ...]\n        A space separated list of galaxy workflow description\n        files in json format\n  -o OUTPUT_FILE\n        The output file with a yml tool list\n  -l PANEL_LABEL\n        The name of the panel where the tools will show up in\n        Galaxy.If not specified: \"Tools from workflows\"\n\n```\n\n???\n\nFrom a downloaded workflow file, workflow-to-tools generates a yaml list of \nall toolshed tools required to run that workflow\n\n---\n\n## Setup data libraries\n\n```console\nsetup-data-libraries [-h] [-v] [-g GALAXY] [-u USER] [-p PASSWORD] [-a API_KEY]\n\t-i INFILE\n\t[--training]\n\t[--legacy]\n```\n\n???\n\nAn administrator can use the ephemeris command setup-data-libraries to upload\nshared data files\n\n---\n```yaml\ndestination:\n  type: library\n  name: \"Cool Training Library\"\n  description: \"A longer description.\"\n  synopsis: \"Optional - does anyone ever set this?\"\nitems:\n  - name: \"Test Folder 1\"\n    description: \"Description of what is in Test Folder 1\"\n    items:\n      - url: https://example.org/cliques-high-representatives.fa\n        src: url\n        ext: fasta\n        info: \"A cool longer description.\"\n        dbkey: \"hg19\"\n  - name: \"Test data segmentation-fold\"\n    items:\n      - url: https://example.org/tests/test-data/workflow-test_cd-box_kturns.xml\n        name: workflow-test_cd-box_kturns.xml\n        info: Downloaded from https://example.org/\n        src: url\n        ext: xml\n```\n\n???\n\nA yaml file describing two folders with one file each to upload to galaxy's shared data.\n\nContains instructions to download the file contents from public URLs\n\n---\n\n## Wait for Galaxy\n\n\n```console\n$ galaxy-wait -g http://localhost:8080 -v\n[00] Galaxy not up yet... HTTPConnectionPool(host='localhost', port=8080):\n\t Max retries exceeded with url: /api/version (Caused\n[01] Galaxy not up yet... HTTPConnectionPool(host='localhost', port=8080):\n\t Max retries exceeded with url: /api/version (Caused\n[02] Galaxy not up yet... HTTPConnectionPool(host='localhost', port=8080):\n\t Max retries exceeded with url: /api/version (Caused\n[03] Galaxy not up yet... HTTPConnectionPool(host='localhost', port=8080):\n\t Max retries exceeded with url: /api/version (Caused\n[04] Galaxy not up yet... HTTPConnectionPool(host='localhost', port=8080):\n\t Max retries exceeded with url: /api/version (Caused\n[05] Galaxy not up yet... HTTPConnectionPool(host='localhost', port=8080):\n\t Max retries exceeded with url: /api/version (Caused\n\nGalaxy Version: 17.05\n```\n\n???\n\ngalaxy-wait sends an API request to a galaxy server to check whether it is running and able to accept the request.\n\nIf the server is ready it will return straight away.\n\nIf not it will keep sending requests.\n\nThis is useful if you want to run any of the other commands such as shed-tools\ninstall and you don't know whether Galaxy will be ready.\n\n---\n\n# More on Tool Management\n\n- Repository structure\n- Reference data\n- Dependencies\n\n---\n\nclass: normal\n### Simple tool shed repository (`remove_beginning`)\n\n```\n.\n├── remove_beginning.pl          # optional accompanying script\n├── remove_beginning.xml         # tool wrapper\n├── .shed.yml                    # metadata file\n└── test-data                    # subdirectory for test data\n    ├── 1.bed                    # test input file\n    └── eq-removebeginning.dat   # test output file\n```\n\n???\n\nA tool shed repository containing one tool: remove_beginning.\n\nThe repository contains\n- a perl script that is executed from code in the wrapper\n- test input and output for the tool's tests\n- a metadata file for the toolshed.\n\n---\nclass: normal\n## `.shed.yml` file\n\nContains repository's metadata.\n\n```yaml\ncategories:\n- Text Manipulation\ndescription: Remove lines from the beginning of a file.\nlong_description: |\n  This tool removes the specified number of lines from the beginning\n  of the input dataset.\nname: remove_beginning\nowner: devteam\nremote_repository_url: https://github.com/galaxyproject/tools-devteam/tree/master/tools/remove_beginning\ntype: unrestricted\n```\n\n???\n\nThe tool name and owner are set in the metadata file.\n\nThe file also contains the development url for the tool. \n\nThe development URL is displayed in the toolshed as a link to the tool's files within its development environment.\n\nThis is the github repo you would go to raise an issue the the tool or make a pull request to improve the tool.\n\n---\n\nclass: normal\n## Complex tool shed repository (`varscan`)\n\n```\n.\n├── macros.xml                         # defines tool macros\n├── .shed.yml\n├── test-data\n│   ├── control_chrM.bam\n│   ├── fasta_indexes.loc              # Loc file for tests\n...\n│   └── varscan_mpileup_result1.vcf\n├── tool-data\n│   └── fasta_indexes.loc.sample       # Sample loc file\n├── tool_data_table_conf.xml.sample    # Sample data table\n├── tool_data_table_conf.xml.test      # Data table for tests\n├── varscan_copynumber.xml             # wrapper for tool #1\n├── varscan_mpileup.xml                # wrapper for tool #2\n├── varscan.py\n└── varscan_somatic.xml                # wrapper for tool #3\n```\n\n???\n\nThis is a more complex toolshed repository containing three tool wrappers related to the same software.\n\nInstalling this repository will add three tools to the tool panel.\n\n---\n\n## Data tables and loc files\n\n- Several tools need to access **reference data**, e.g. genome sequences or indexes for aligner\n- A *loc file* is a tab-separated file containing metadata and paths for a set of reference data\n- A *data table* describes the columns of a loc file used by a tool\n- Installing CVMFS provides access to a large amount of reference data.  There are also\n  data manager tools for installing reference data.\n- You can read more about this in the [Reference Genomes in Galaxy slides](../reference-genomes/slides.html)\n  - See also: [Reference Data with CVMFS](../cvmfs/slides.html)\n\n???\n\nSometimes tools will need reference data such as genomes.\n\nLoc files and data tables are used to link tools with reference files.\n\nIf CVMFS is installed a lot of your reference data needs will be taken care of.\n\nThere are data manager tools in the toolshed for installing reference data for tools.\n\nThese can be run from the admin panel or using ephemeri\n\n---\n\n## Suite repositories\n\n- Suites can be used to split up a set of tools into multiple repositories\n  - A suite is a single repository that 'depends' on many others\n  - When you install the suite, all 'dependency repositories' will be installed too\n- With a tweak to `.shed.yml`, [Planemo](https://planemo.readthedocs.io) can upload a directory of tools to the TS as a suite of separate tools\n- Examples: suite_samtools, suite_hicexplorer\n\n???\n\nThere are also repositories in the Tool Shed that are suite repositories.\n\nSuite repositories can be used to install multiple tool shed repositories at once.\n\nFor example: there are many tools associated with samtools owned by the IUC, such as samtools_view or samtools_mpileup.\n\nInstalling samtools_suite will result in all of these samtools repositories being installed.\n\n---\n\n## Resolving Galaxy Tool Dependencies\n\n- The recommended method for resolving tool dependencies is with containers: **Apptainer/Singularity** or **Docker**\n- It is also possible to use **Conda** to resolve dependencies.\n- You can read more about this in the [Tool Dependencies and Containers slides](../../../dev/tutorials/containers/slides.html)\n\n???\n\nThe preferred method for resolving tool dependencies is through containers. Apptainer particularly works well in the context of cluster jobs. It is also possible to use non-container dependency resolution methods. There is further reading available on this topic.\n"],"hands_on":true,"slides":true,"mod_date":"2024-05-29 14:28:52 +0000","pub_date":"2019-01-27 22:09:32 +0000","version":62,"api":"https://training.galaxyproject.org/training-material/api/topics/admin/tutorials/tool-management/tutorial.json","tools":[],"supported_servers":[],"topic_name_human":"Galaxy Server administration","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools: []\n","tours":false,"video":false,"slides_recordings":[{"captioners":["cat-bro"],"date":"2021-06-28","galaxy_version":"21.05","length":"17M","youtube_id":"8Rdho_eUeKc","speakers":["cat-bro"]}],"translations":{"tutorial":[],"slides":[],"video":false},"license":"CC-BY-4.0","type":"tutorial"}