{"layout":"tutorial_slides","title":"Reference Genomes in Galaxy","zenodo_link":"","questions":null,"objectives":["Have an understanding of the way in which Galaxy stores and uses reference data","Be able to download and use data managers to add a reference genome and its pre-calculated indices into the Galaxy reference data system","Use an Ansible playbook for all of the above"],"time_estimation":"1h","key_points":["Understand how Galaxy stores and uses its reference data","Understand how to manually add a reference genome and tool indices if required","Understand and how to use data managers to make all of this much much easier"],"contributions":{"authorship":["slugger70","afgane"],"editing":["hexylena","natefoo"]},"requirements":[{"type":"internal","topic_name":"admin","tutorials":["ansible","ansible-galaxy"]}],"subtopic":"data","js_requirements":{"mathjax":null,"mermaid":false},"short_id":"S00021","url":"/topics/admin/tutorials/reference-genomes/slides.html","topic_name":"admin","tutorial_name":"reference-genomes","dir":"topics/admin/tutorials/reference-genomes","symlink":null,"id":"admin/reference-genomes","ref_tutorials":["<h1 id=\"overview\">Overview</h1>\n\n<h2 id=\"the-problem\">The problem</h2>\n\n<p>The Galaxy server administrator needed to know how to update each type of reference data, how to run the indexers, where to get the data from, and how to update Galaxy’s <em>Tool Data Table</em> and <em>location</em> configuration files.</p>\n\n<h2 id=\"data-managers-to-the-rescue\">Data managers to the rescue</h2>\n\n<p>Data Managers are a special class of Galaxy tool which allows for the download and/or creation of data that is stored within Tool Data Tables and their underlying flat location (e.g. .loc) files. These tools handle the creation of indices and the addition of entries/lines to the data table / .loc file via the Galaxy admin interface.</p>\n\n<p>Data Managers can be defined locally in the data manager and tool data table configuration files or installed through the Tool Shed. When Data Managers are installed from the Tool Shed, their configuration is added to the shed versions of the data manager configuration and tool data table configuration files.</p>\n\n<p>They are a flexible framework for adding reference data to Galaxy (not just genomic data). They are workflow compatible and can run via the Galaxy API. Data managers automatically update the appropriate location files when new data are installed.</p>\n\n<p>For more background details on data managers, check out:</p>\n<ul>\n  <li><a href=\"https://galaxyproject.org/admin/tools/data-managers/\">The data managers documentation on the hub</a></li>\n  <li><a href=\"https://galaxyproject.org/admin/tools/data-managers/how-to/define/\">How to define a data manager for a tool</a></li>\n  <li>There is also discussion of this topic in <a href=\"/training-material/topics/admin/tutorials/reference-genomes/slides.html\">the Reference Genomes in Galaxy slides</a></li>\n</ul>\n\n<blockquote class=\"comment\">\n  <comment-title>Pre-built data are available</comment-title>\n\n  <p>The usegalaxy.* servers and Galaxy Community have a large amount of reference data online and available for use by your Galaxy server. For instructions on how to access and use these data, see <a href=\"/training-material/topics/admin/tutorials/cvmfs/tutorial.html\">the Reference Data with CVMFS tutorial</a>.</p>\n\n  <p>If your data are not available as part of the CVMFS repository, Galaxy Data Managers can be used to locally install and build reference data.</p>\n\n</blockquote>\n\n<blockquote class=\"agenda\">\n  <agenda-title></agenda-title>\n\n<ol id=\"markdown-toc\">\n  <li><a href=\"#overview\" id=\"markdown-toc-overview\">Overview</a>    <ol>\n      <li><a href=\"#the-problem\" id=\"markdown-toc-the-problem\">The problem</a></li>\n      <li><a href=\"#data-managers-to-the-rescue\" id=\"markdown-toc-data-managers-to-the-rescue\">Data managers to the rescue</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#galaxy-reference-data-components\" id=\"markdown-toc-galaxy-reference-data-components\">Galaxy Reference Data Components</a></li>\n  <li><a href=\"#installing-and-using-data-managers-with-the-galaxy-ui\" id=\"markdown-toc-installing-and-using-data-managers-with-the-galaxy-ui\">Installing and Using Data Managers with the Galaxy UI</a>    <ol>\n      <li><a href=\"#install-a-the-fetch-genome-data-manager-from-the-tool-shed\" id=\"markdown-toc-install-a-the-fetch-genome-data-manager-from-the-tool-shed\">Install a the Fetch Genome Data Manager from the Tool Shed</a></li>\n      <li><a href=\"#download-and-install-a-reference-genome-sequence\" id=\"markdown-toc-download-and-install-a-reference-genome-sequence\">Download and install a reference genome sequence</a></li>\n      <li><a href=\"#download-and-install-the-bwa-data-manager\" id=\"markdown-toc-download-and-install-the-bwa-data-manager\">Download and install the BWA data manager</a></li>\n      <li><a href=\"#build-the-bwa-index-for-a-reference-genome\" id=\"markdown-toc-build-the-bwa-index-for-a-reference-genome\">Build the BWA index for a reference genome</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#installing-and-using-data-managers-from-the-command-line-with-ephemeris\" id=\"markdown-toc-installing-and-using-data-managers-from-the-command-line-with-ephemeris\">Installing and Using Data Managers from the command line with Ephemeris</a>    <ol>\n      <li><a href=\"#install-a-the-fetch-genome-data-manager-from-the-tool-shed-1\" id=\"markdown-toc-install-a-the-fetch-genome-data-manager-from-the-tool-shed-1\">Install a the Fetch Genome Data Manager from the Tool Shed</a></li>\n      <li><a href=\"#download-and-install-a-reference-genome-sequence-1\" id=\"markdown-toc-download-and-install-a-reference-genome-sequence-1\">Download and install a reference genome sequence</a></li>\n      <li><a href=\"#download-and-install-the-bwa-data-manager-1\" id=\"markdown-toc-download-and-install-the-bwa-data-manager-1\">Download and install the BWA data manager</a></li>\n      <li><a href=\"#build-the-bwa-index-for-a-reference-genome-1\" id=\"markdown-toc-build-the-bwa-index-for-a-reference-genome-1\">Build the BWA index for a reference genome</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#verify-that-bwa-can-access-the-new-reference-data\" id=\"markdown-toc-verify-that-bwa-can-access-the-new-reference-data\">Verify that BWA can access the new reference data</a></li>\n</ol>\n\n</blockquote>\n\n<!--SNIPPET-->\n<blockquote class=\"comment\">   <div class=\"box-title comment-title\" id=\"comment-galaxy-admin-training-path\"><i class=\"far fa-comment-dots\" aria-hidden=\"true\"></i> Comment: Galaxy Admin Training Path</div>   <p>The yearly Galaxy Admin Training follows a specific ordering of tutorials. Use this timeline to help keep track of where you are in Galaxy Admin Training.</p>   <ol id=\"git-gat-timeline\">                    <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html\">             <div>Step 1</div>             <div>ansible-galaxy</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/backup-cleanup/tutorial.html\">             <div>Step 2</div>             <div>backup-cleanup</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/customization/tutorial.html\">             <div>Step 3</div>             <div>customization</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/tus/tutorial.html\">             <div>Step 4</div>             <div>tus</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/cvmfs/tutorial.html\">             <div>Step 5</div>             <div>cvmfs</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/apptainer/tutorial.html\">             <div>Step 6</div>             <div>apptainer</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/tool-management/tutorial.html\">             <div>Step 7</div>             <div>tool-management</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"active\">         <a href=\"/training-material/topics/admin/tutorials/reference-genomes/tutorial.html\">             <div>Step 8</div>             <div>reference-genomes</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/data-library/tutorial.html\">             <div>Step 9</div>             <div>data-library</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/dev/tutorials/bioblend-api/tutorial.html\">             <div>Step 10</div>             <div>dev/bioblend-api</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/connect-to-compute-cluster/tutorial.html\">             <div>Step 11</div>             <div>connect-to-compute-cluster</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/job-destinations/tutorial.html\">             <div>Step 12</div>             <div>job-destinations</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/pulsar/tutorial.html\">             <div>Step 13</div>             <div>pulsar</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/celery/tutorial.html\">             <div>Step 14</div>             <div>celery</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/gxadmin/tutorial.html\">             <div>Step 15</div>             <div>gxadmin</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/reports/tutorial.html\">             <div>Step 16</div>             <div>reports</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/monitoring/tutorial.html\">             <div>Step 17</div>             <div>monitoring</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/tiaas/tutorial.html\">             <div>Step 18</div>             <div>tiaas</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/sentry/tutorial.html\">             <div>Step 19</div>             <div>sentry</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/ftp/tutorial.html\">             <div>Step 20</div>             <div>ftp</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/beacon/tutorial.html\">             <div>Step 21</div>             <div>beacon</div>         </a>     </li>           </ol> </blockquote>\n<p><!--END_SNIPPET--></p>\n\n<h1 id=\"galaxy-reference-data-components\">Galaxy Reference Data Components</h1>\n\n<p>As discussed in the overview, Galaxy Data Managers handle the population of numerous Galaxy components. From the highest level to the lowest:</p>\n\n<ul>\n  <li>Addition of tool data table entries into the shed version of the tool data table configuration file, <code class=\"language-plaintext highlighter-rouge\">shed_tool_data_table_conf.xml</code>. Multiple data tables with the same <code class=\"language-plaintext highlighter-rouge\">name</code> attribute are automatically merged by Galaxy.</li>\n  <li>Population of the corresponding location (<code class=\"language-plaintext highlighter-rouge\">.loc</code>) file when new reference data are installed. The <code class=\"language-plaintext highlighter-rouge\">.loc</code> file used corresponds to the Data Manager and its specific version that was executed to install the data. The path to the location file can be found in the Data Manager’s entry in the tool data table configuration file (above).</li>\n  <li>Generation of the reference data on disk, underneath the directory specified by <code class=\"language-plaintext highlighter-rouge\">tool_data_path</code> in <code class=\"language-plaintext highlighter-rouge\">galaxy.yml</code>.</li>\n</ul>\n\n<h1 id=\"installing-and-using-data-managers-with-the-galaxy-ui\">Installing and Using Data Managers with the Galaxy UI</h1>\n\n<h2 id=\"install-a-the-fetch-genome-data-manager-from-the-tool-shed\">Install a the Fetch Genome Data Manager from the Tool Shed</h2>\n\n<blockquote class=\"comment\">\n  <comment-title>Galaxy Configuration</comment-title>\n\n  <p>No special configuration for Galaxy beyond creating an admin user is necessary in order to use Data Managers. However, you may want to be aware of the <code class=\"language-plaintext highlighter-rouge\">enable_data_manager_user_view</code> option, which enables unprivileged user to browse data installed via Data Managers. This option is not required, and users will be able to <em>use</em> data installed via Data Managers regardless.</p>\n\n  <p>Data are installed in the path specified by <code class=\"language-plaintext highlighter-rouge\">tool_data_path</code> in <code class=\"language-plaintext highlighter-rouge\">galaxy.yml</code>. If you prefer to keep hand-managed reference data separate from DM-managed reference data, you can set <code class=\"language-plaintext highlighter-rouge\">galaxy_data_manager_data_path</code> instead.</p>\n\n</blockquote>\n\n<blockquote class=\"tip\">\n  <tip-title>Intall with Ephemeris</tip-title>\n  <p>This hands-on exercise installs data managers and reference data through the Galaxy UI, but you are encouraged to install tools in a deterministic, recordable way through the use of Ephemeris, which is described in <a href=\"#installing-and-using-data-managers-from-the-command-line-with-ephemeris\">the Installing and Using Data Managers from the command line with Ephemeris section</a> below.</p>\n</blockquote>\n\n<p>We will install a data manager that can fetch the various genome sequences from multiple sources.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Install the Fetch Genome Data Manager</hands-on-title>\n\n  <ol>\n    <li>Access the <strong>Admin</strong> menu from the top bar (you need to be logged-in with an email specified in the <code class=\"language-plaintext highlighter-rouge\">admin_users</code> setting)</li>\n    <li>Click <strong>Install and Uninstall</strong>, which can be found on the left, under <strong>Tool Management</strong></li>\n    <li>Enter <code class=\"language-plaintext highlighter-rouge\">fetch_genome</code> in the search interface</li>\n    <li>Click on the first hit, having <code class=\"language-plaintext highlighter-rouge\">devteam</code> as owner</li>\n    <li>Click the <strong>Install</strong> button for the latest revision</li>\n  </ol>\n</blockquote>\n\n<p>View in the file system where the various elements land. Have a look in the configuration files located in config directory.</p>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <p>What did this tool installation change?</p>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <ul>\n      <li>The data manager and its data tables are added to the Galaxy-managed “shed” versions of the data manager config (<code class=\"language-plaintext highlighter-rouge\">/srv/galaxy/var/config/shed_data_manager_conf.xml</code>) and data table config (<code class=\"language-plaintext highlighter-rouge\">/srv/galaxy/var/config/shed_tool_data_table_conf.xml</code>)</li>\n      <li>The data manager tool is installed along side other Galaxy tools in the shed tools directory</li>\n    </ul>\n\n    <blockquote class=\"code-in\">\n      <code-in-title>Bash</code-in-title>\n      <p>Let’s investigate the data manager config file.</p>\n      <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">cat</span> /srv/galaxy/var/config/shed_data_manager_conf.xml\n</code></pre></div>      </div>\n    </blockquote>\n\n    <blockquote class=\"code-out code-max-300\">\n      <code-out-title>Bash</code-out-title>\n      <div class=\"language-xml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nt\">&lt;data_managers&gt;&lt;data_manager</span> <span class=\"na\">id=</span><span class=\"s\">\"fetch_genome_all_fasta_dbkeys\"</span> <span class=\"na\">guid=</span><span class=\"s\">\"toolshed.g2.bx.psu.edu/repos/devteam/data_manager_fetch_genome_dbkeys_all_fasta/data_manager/fetch_genome_all_fasta_dbkeys/0.0.1\"</span> <span class=\"na\">shed_conf_file=</span><span class=\"s\">\"/srv/galaxy/var/config/shed_tool_conf.xml\"</span><span class=\"nt\">&gt;</span>\n        <span class=\"nt\">&lt;tool</span> <span class=\"na\">file=</span><span class=\"s\">\"toolshed.g2.bx.psu.edu/repos/devteam/data_manager_fetch_genome_dbkeys_all_fasta/4d3eff1bc421/data_manager_fetch_genome_dbkeys_all_fasta/data_manager/data_manager_fetch_genome_all_fasta_dbkeys.xml\"</span> <span class=\"na\">guid=</span><span class=\"s\">\"toolshed.g2.bx.psu.edu/repos/devteam/data_manager_fetch_genome_dbkeys_all_fasta/data_manager_fetch_genome_all_fasta_dbkey/0.0.4\"</span><span class=\"nt\">&gt;&lt;tool_shed&gt;</span>toolshed.g2.bx.psu.edu<span class=\"nt\">&lt;/tool_shed&gt;&lt;repository_name&gt;</span>data_manager_fetch_genome_dbkeys_all_fasta<span class=\"nt\">&lt;/repository_name&gt;&lt;repository_owner&gt;</span>devteam<span class=\"nt\">&lt;/repository_owner&gt;&lt;installed_changeset_revision&gt;</span>4d3eff1bc421<span class=\"nt\">&lt;/installed_changeset_revision&gt;&lt;id&gt;</span>toolshed.g2.bx.psu.edu/repos/devteam/data_manager_fetch_genome_dbkeys_all_fasta/data_manager_fetch_genome_all_fasta_dbkey/0.0.4<span class=\"nt\">&lt;/id&gt;&lt;version&gt;</span>0.0.4<span class=\"nt\">&lt;/version&gt;&lt;/tool&gt;&lt;data_table</span> <span class=\"na\">name=</span><span class=\"s\">\"all_fasta\"</span><span class=\"nt\">&gt;</span>\n            <span class=\"nt\">&lt;output&gt;</span>\n                <span class=\"nt\">&lt;column</span> <span class=\"na\">name=</span><span class=\"s\">\"value\"</span><span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;column</span> <span class=\"na\">name=</span><span class=\"s\">\"dbkey\"</span><span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;column</span> <span class=\"na\">name=</span><span class=\"s\">\"name\"</span><span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;column</span> <span class=\"na\">name=</span><span class=\"s\">\"path\"</span> <span class=\"na\">output_ref=</span><span class=\"s\">\"out_file\"</span><span class=\"nt\">&gt;</span>\n                    <span class=\"nt\">&lt;move</span> <span class=\"na\">type=</span><span class=\"s\">\"file\"</span><span class=\"nt\">&gt;</span>\n                        <span class=\"nt\">&lt;source&gt;</span>${path}<span class=\"nt\">&lt;/source&gt;</span>\n                        <span class=\"nt\">&lt;target</span> <span class=\"na\">base=</span><span class=\"s\">\"${GALAXY_DATA_MANAGER_DATA_PATH}\"</span><span class=\"nt\">&gt;</span>${dbkey}/seq/${path}<span class=\"nt\">&lt;/target&gt;</span>\n                    <span class=\"nt\">&lt;/move&gt;</span>\n                    <span class=\"nt\">&lt;value_translation&gt;</span>${GALAXY_DATA_MANAGER_DATA_PATH}/${dbkey}/seq/${path}<span class=\"nt\">&lt;/value_translation&gt;</span>\n                    <span class=\"nt\">&lt;value_translation</span> <span class=\"na\">type=</span><span class=\"s\">\"function\"</span><span class=\"nt\">&gt;</span>abspath<span class=\"nt\">&lt;/value_translation&gt;</span>\n                <span class=\"nt\">&lt;/column&gt;</span>\n            <span class=\"nt\">&lt;/output&gt;</span>\n        <span class=\"nt\">&lt;/data_table&gt;</span>\n        <span class=\"nt\">&lt;data_table</span> <span class=\"na\">name=</span><span class=\"s\">\"__dbkeys__\"</span><span class=\"nt\">&gt;</span>\n            <span class=\"nt\">&lt;output&gt;</span>\n                <span class=\"nt\">&lt;column</span> <span class=\"na\">name=</span><span class=\"s\">\"value\"</span><span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;column</span> <span class=\"na\">name=</span><span class=\"s\">\"name\"</span><span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;column</span> <span class=\"na\">name=</span><span class=\"s\">\"len_path\"</span> <span class=\"na\">output_ref=</span><span class=\"s\">\"out_file\"</span><span class=\"nt\">&gt;</span>\n                    <span class=\"nt\">&lt;move</span> <span class=\"na\">type=</span><span class=\"s\">\"file\"</span><span class=\"nt\">&gt;</span>\n                        <span class=\"nt\">&lt;source&gt;</span>${len_path}<span class=\"nt\">&lt;/source&gt;</span>\n                        <span class=\"nt\">&lt;target</span> <span class=\"na\">base=</span><span class=\"s\">\"${GALAXY_DATA_MANAGER_DATA_PATH}\"</span><span class=\"nt\">&gt;</span>${value}/len/${len_path}<span class=\"nt\">&lt;/target&gt;</span>\n                    <span class=\"nt\">&lt;/move&gt;</span>\n                    <span class=\"nt\">&lt;value_translation&gt;</span>${GALAXY_DATA_MANAGER_DATA_PATH}/${value}/len/${len_path}<span class=\"nt\">&lt;/value_translation&gt;</span>\n                    <span class=\"nt\">&lt;value_translation</span> <span class=\"na\">type=</span><span class=\"s\">\"function\"</span><span class=\"nt\">&gt;</span>abspath<span class=\"nt\">&lt;/value_translation&gt;</span>\n                <span class=\"nt\">&lt;/column&gt;</span>\n            <span class=\"nt\">&lt;/output&gt;</span>\n        <span class=\"nt\">&lt;/data_table&gt;</span>\n    <span class=\"nt\">&lt;/data_manager&gt;</span>\n</code></pre></div>      </div>\n    </blockquote>\n\n    <blockquote class=\"code-in\">\n      <code-in-title>Bash</code-in-title>\n      <p>Let’s also investigate the tool data table config file.</p>\n      <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">cat</span> /srv/galaxy/var/config/shed_tool_data_table_conf.xml\n</code></pre></div>      </div>\n    </blockquote>\n\n    <blockquote class=\"code-out code-max-300\">\n      <code-out-title>Bash</code-out-title>\n      <div class=\"language-xml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"cp\">&lt;?xml version=\"1.0\" ?&gt;</span>\n<span class=\"nt\">&lt;tables&gt;</span>\n    <span class=\"nt\">&lt;table</span> <span class=\"na\">name=</span><span class=\"s\">\"all_fasta\"</span> <span class=\"na\">comment_char=</span><span class=\"s\">\"#\"</span><span class=\"nt\">&gt;</span>\n        <span class=\"nt\">&lt;columns&gt;</span>value, dbkey, name, path<span class=\"nt\">&lt;/columns&gt;</span>\n        <span class=\"nt\">&lt;file</span> <span class=\"na\">path=</span><span class=\"s\">\"/srv/galaxy/var/tool-data/toolshed.g2.bx.psu.edu/repos/devteam/data_manager_fetch_genome_dbkeys_all_fasta/4d3eff1bc421/all_fasta.loc\"</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;tool_shed_repository&gt;</span>\n            <span class=\"nt\">&lt;tool_shed&gt;</span>toolshed.g2.bx.psu.edu<span class=\"nt\">&lt;/tool_shed&gt;</span>\n            <span class=\"nt\">&lt;repository_name&gt;</span>data_manager_fetch_genome_dbkeys_all_fasta<span class=\"nt\">&lt;/repository_name&gt;</span>\n            <span class=\"nt\">&lt;repository_owner&gt;</span>devteam<span class=\"nt\">&lt;/repository_owner&gt;</span>\n            <span class=\"nt\">&lt;installed_changeset_revision&gt;</span>4d3eff1bc421<span class=\"nt\">&lt;/installed_changeset_revision&gt;</span>\n        <span class=\"nt\">&lt;/tool_shed_repository&gt;</span>\n    <span class=\"nt\">&lt;/table&gt;</span>\n    <span class=\"nt\">&lt;table</span> <span class=\"na\">name=</span><span class=\"s\">\"__dbkeys__\"</span> <span class=\"na\">comment_char=</span><span class=\"s\">\"#\"</span><span class=\"nt\">&gt;</span>\n        <span class=\"nt\">&lt;columns&gt;</span>value, name, len_path<span class=\"nt\">&lt;/columns&gt;</span>\n        <span class=\"nt\">&lt;file</span> <span class=\"na\">path=</span><span class=\"s\">\"/srv/galaxy/var/tool-data/toolshed.g2.bx.psu.edu/repos/devteam/data_manager_fetch_genome_dbkeys_all_fasta/4d3eff1bc421/dbkeys.loc\"</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;tool_shed_repository&gt;</span>\n            <span class=\"nt\">&lt;tool_shed&gt;</span>toolshed.g2.bx.psu.edu<span class=\"nt\">&lt;/tool_shed&gt;</span>\n            <span class=\"nt\">&lt;repository_name&gt;</span>data_manager_fetch_genome_dbkeys_all_fasta<span class=\"nt\">&lt;/repository_name&gt;</span>\n            <span class=\"nt\">&lt;repository_owner&gt;</span>devteam<span class=\"nt\">&lt;/repository_owner&gt;</span>\n            <span class=\"nt\">&lt;installed_changeset_revision&gt;</span>4d3eff1bc421<span class=\"nt\">&lt;/installed_changeset_revision&gt;</span>\n        <span class=\"nt\">&lt;/tool_shed_repository&gt;</span>\n    <span class=\"nt\">&lt;/table&gt;</span>\n<span class=\"nt\">&lt;/tables&gt;</span>\n</code></pre></div>      </div>\n    </blockquote>\n\n  </blockquote>\n\n</blockquote>\n\n<h2 id=\"download-and-install-a-reference-genome-sequence\">Download and install a reference genome sequence</h2>\n\n<p>Next, we will install some reference data. Specifically, we will grab sacCer2 (version 2 of the <em>Saccharomyces cerevisiae</em> genome).</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Download and install sacCer2</hands-on-title>\n\n  <ol>\n    <li>Access the Admin menu from the top bar</li>\n    <li>\n      <p><a href=\"https://my.gat.galaxy.training/?path=/admin/data_manager\">Click <strong>Local Data</strong></a>, which can be found on the left, under <strong>Server</strong></p>\n\n      <p>You should see something like this:</p>\n\n      <p><a href=\"../../images/dm-admin-local-data.png\" rel=\"noopener noreferrer\"><img src=\"../../images/dm-admin-local-data.png\" alt=\"nearly empty data manager tool list in Galaxy. \" width=\"954\" height=\"461\" loading=\"lazy\" /></a></p>\n\n      <p>If you instead see the message “You do not currently have any Data Managers installed,” you may need to restart your Galaxy server.</p>\n    </li>\n    <li>\n      <p><a href=\"https://my.gat.galaxy.training/?path=/admin/data_manager/table/all_fasta\">Click <strong>all_fasta</strong></a> under <strong>View Tool Data Table Entries</strong></p>\n\n      <p>You should see the current contents of <code class=\"language-plaintext highlighter-rouge\">tool-data/all_fasta.loc</code>, which will be empty.</p>\n    </li>\n    <li>\n      <p>Click <strong>Local Data</strong> to return to the previous page</p>\n    </li>\n    <li>Click <span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/devteam/data_manager_fetch_genome_dbkeys_all_fasta/data_manager_fetch_genome_all_fasta_dbkey/0.0.4\" title=\"Create DBKey and Reference Genome - fetching tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Create DBKey and Reference Genome - fetching</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.0.4)</span> under <strong>Installed Data Managers</strong>.\n      <ul>\n        <li><i class=\"fas fa-filter\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-select</span> <em>“Use existing dbkey or create a new one”</em>: <code class=\"language-plaintext highlighter-rouge\">Existing</code></li>\n        <li><i class=\"fas fa-filter\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-select</span> <em>“DBKEY to assign to data”</em>: <code class=\"language-plaintext highlighter-rouge\">sacCer2</code></li>\n        <li><i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-text</span> <em>“Name of sequence”</em>: <code class=\"language-plaintext highlighter-rouge\">S. cerevisiae June 2008 (SGD/sacCer2)</code></li>\n        <li><i class=\"fas fa-filter\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-select</span> <em>“Choose the source for the reference genome”</em>: <code class=\"language-plaintext highlighter-rouge\">UCSC</code></li>\n      </ul>\n\n      <blockquote class=\"details\">\n        <details-title>What do these fields mean?</details-title>\n\n        <p>The data manager tool form fields correspond to the columns in the tool data table, as referenced in <code class=\"language-plaintext highlighter-rouge\">shed_tool_data_table_conf.xml</code>.</p>\n\n        <table>\n          <thead>\n            <tr>\n              <th>Tool Field</th>\n              <th>Tool Data Table Entry</th>\n              <th>Purpose</th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr>\n              <td><em>ID for sequence</em></td>\n              <td><code class=\"language-plaintext highlighter-rouge\">value</code> column in <code class=\"language-plaintext highlighter-rouge\">all_fasta</code></td>\n              <td>Identifier of specific build of the genome, if it differs from the DBKEY. Used for variant builds such as the <code class=\"language-plaintext highlighter-rouge\">hg19female</code> build of <code class=\"language-plaintext highlighter-rouge\">hg19</code>.</td>\n            </tr>\n            <tr>\n              <td><em>DBKEY to assign to data</em></td>\n              <td><code class=\"language-plaintext highlighter-rouge\">dbkey</code> column in <code class=\"language-plaintext highlighter-rouge\">all_fasta</code></td>\n              <td>Identifier of the genome, the UCSC build ID for UCSC builds like <code class=\"language-plaintext highlighter-rouge\">hg19</code>.</td>\n            </tr>\n            <tr>\n              <td><em>Name of sequence</em></td>\n              <td><code class=\"language-plaintext highlighter-rouge\">name</code> column in <code class=\"language-plaintext highlighter-rouge\">all_fasta</code></td>\n              <td>Display name of the genome, displayed in Galaxy tool dropdowns.</td>\n            </tr>\n          </tbody>\n        </table>\n      </blockquote>\n    </li>\n    <li>Click <strong>Execute</strong>. In your history, you will see a new dataset for the data manager run. When the job has finished, go back to the Data Manager view on the Galaxy Admin page (Click <strong>Local Data</strong>).</li>\n    <li>\n      <p>Click <strong>all_fasta</strong> under <em>View Tool Data Table Entries</em></p>\n\n      <p>You should see that <em>sacCer2</em> has been added to all_fasta.</p>\n\n      <p><a href=\"../../images/dm-all-fasta-populated.png\" rel=\"noopener noreferrer\"><img src=\"../../images/dm-all-fasta-populated.png\" alt=\"populated all_fasta data table which now includes sacCer2 in the genome list. \" width=\"628\" height=\"268\" loading=\"lazy\" /></a></p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>View in the file system where the changes to the location file and the reference genome fasta file.</p>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <p>What did this data manager execution change?</p>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <ul>\n      <li>An entry for the <em>sacCer2</em> genome has been added to the <code class=\"language-plaintext highlighter-rouge\">all_fasta.loc</code> file for the <code class=\"language-plaintext highlighter-rouge\">data_manager_fetch_genome_all_fasta_dbkey</code> data manager. The path to the location file can be found in “shed” versions of the data manager config (<code class=\"language-plaintext highlighter-rouge\">/srv/galaxy/var/config/shed_data_manager_conf.xml</code>) and data table config (<code class=\"language-plaintext highlighter-rouge\">/srv/galaxy/var/config/shed_tool_data_table_conf.xml</code>)</li>\n      <li>The data manager tool is installed along side other Galaxy tools in the shed tools directory</li>\n    </ul>\n\n    <blockquote class=\"code-in\">\n      <code-in-title>Bash</code-in-title>\n      <p>Get the path to the <code class=\"language-plaintext highlighter-rouge\">all_fasta.loc</code> file:</p>\n      <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">grep</span> <span class=\"s1\">'data_manager_fetch_genome_dbkeys_all_fasta.*all_fasta.loc'</span> /srv/galaxy/var/config/shed_tool_data_table_conf.xml\n</code></pre></div>      </div>\n    </blockquote>\n\n    <blockquote class=\"code-out\">\n      <code-out-title>Bash</code-out-title>\n      <div class=\"language-xml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>        <span class=\"nt\">&lt;file</span> <span class=\"na\">path=</span><span class=\"s\">\"/srv/galaxy/var/tool-data/toolshed.g2.bx.psu.edu/repos/devteam/data_manager_fetch_genome_dbkeys_all_fasta/4d3eff1bc421/all_fasta.loc\"</span><span class=\"nt\">/&gt;</span>\n</code></pre></div>      </div>\n    </blockquote>\n\n    <blockquote class=\"code-in\">\n      <code-in-title>Bash</code-in-title>\n      <p>Let’s investigate the contents of the location file identified above (the path to yours may be different if you installed a different version of the data manager):</p>\n      <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">cat</span> /srv/galaxy/var/tool-data/toolshed.g2.bx.psu.edu/repos/devteam/data_manager_fetch_genome_dbkeys_all_fasta/4d3eff1bc421/all_fasta.loc\n</code></pre></div>      </div>\n    </blockquote>\n\n    <blockquote class=\"code-out\">\n      <code-out-title>Bash</code-out-title>\n      <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\">#This file lists the locations and dbkeys of all the fasta files</span>\n<span class=\"c\">#under the \"genome\" directory (a directory that contains a directory</span>\n<span class=\"c\">#for each build). The script extract_fasta.py will generate the file</span>\n<span class=\"c\">#all_fasta.loc. This file has the format (white space characters are</span>\n<span class=\"c\">#TAB characters):</span>\n<span class=\"c\">#</span>\n<span class=\"c\">#&lt;unique_build_id&gt;  &lt;dbkey&gt;     &lt;display_name&gt;  &lt;file_path&gt;</span>\n<span class=\"c\">#</span>\n<span class=\"c\">#So, all_fasta.loc could look something like this:</span>\n<span class=\"c\">#</span>\n<span class=\"c\">#apiMel3    apiMel3 Honeybee (Apis mellifera): apiMel3      /path/to/genome/apiMel3/apiMel3.fa</span>\n<span class=\"c\">#hg19canon  hg19        Human (Homo sapiens): hg19 Canonical        /path/to/genome/hg19/hg19canon.fa</span>\n<span class=\"c\">#hg19full   hg19        Human (Homo sapiens): hg19 Full         /path/to/genome/hg19/hg19full.fa</span>\n<span class=\"c\">#</span>\n<span class=\"c\">#Your all_fasta.loc file should contain an entry for each individual</span>\n<span class=\"c\">#fasta file. So there will be multiple fasta files for each build,</span>\n<span class=\"c\">#such as with hg19 above.</span>\n<span class=\"c\">#</span>\nsacCer2\tsacCer2\tS. cerevisiae June 2008 <span class=\"o\">(</span>SGD/sacCer2<span class=\"o\">)</span>\t/srv/galaxy/var/tool-data/sacCer2/seq/sacCer2.fa\n</code></pre></div>      </div>\n    </blockquote>\n\n    <blockquote class=\"code-in\">\n      <code-in-title>Bash</code-in-title>\n      <p>Finally, verify that we have some sequences in the genome fasta file:</p>\n      <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">grep</span> <span class=\"s1\">'^&gt;'</span> /srv/galaxy/var/tool-data/sacCer2/seq/sacCer2.fa\n</code></pre></div>      </div>\n    </blockquote>\n\n    <blockquote class=\"code-out\">\n      <code-out-title>Bash</code-out-title>\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>&gt;2micron\n&gt;chrI\n&gt;chrII\n&gt;chrIII\n&gt;chrIV\n&gt;chrIX\n&gt;chrM\n&gt;chrV\n&gt;chrVI\n&gt;chrVII\n&gt;chrVIII\n&gt;chrX\n&gt;chrXI\n&gt;chrXII\n&gt;chrXIII\n&gt;chrXIV\n&gt;chrXV\n&gt;chrXVI\n</code></pre></div>      </div>\n    </blockquote>\n\n  </blockquote>\n\n</blockquote>\n\n<h2 id=\"download-and-install-the-bwa-data-manager\">Download and install the BWA data manager</h2>\n\n<p>Having the genome is a prerequisite for our ultimate goal, which is to use the sacCer2 genome as a <em>reference genome</em> for the BWA tool. BWA, like many tools, needs an <em>index</em> of the reference genome, and has its own format for that index. Thankfully, the BWA/BWA-MEM data manager will build that index for us.</p>\n\n<p>In this part we will repeat the same process as when we installed the Fetch Genome data manager, except that we will install the BWA/BWA-MEM data manager this time.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Install the BWA/BWA-MEM Data Manager </hands-on-title>\n\n  <ol>\n    <li>Access the <strong>Admin</strong> menu from the top bar</li>\n    <li>Click <strong>Install and Uninstall</strong>, which can be found on the left, under <strong>Tool Management</strong></li>\n    <li>Enter <code class=\"language-plaintext highlighter-rouge\">bwa_mem_index</code> in the search interface</li>\n    <li>Click on the first hit, having <code class=\"language-plaintext highlighter-rouge\">devteam</code> as owner</li>\n    <li>Click the <strong>Install</strong> button for the latest revision</li>\n  </ol>\n</blockquote>\n\n<h2 id=\"build-the-bwa-index-for-a-reference-genome\">Build the BWA index for a reference genome</h2>\n\n<p>In this part we will actually build the BWA index for sacCer2. It will automatically be added to our list of available reference genomes in the BWA tool.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Build the sacCer2 BWA index</hands-on-title>\n\n  <ol>\n    <li>Access the Admin menu from the top bar</li>\n    <li>Click <strong>Local Data</strong>, which can be found on the left, under <strong>Server</strong></li>\n    <li>Click <strong><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/devteam/data_manager_bwa_mem_index_builder/bwa_mem_index_builder_data_manager/0.0.5\" title=\"BWA-MEM index - builder tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>BWA-MEM index - builder</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.0.5)</span></strong> under <strong>Installed Data Managers</strong>.\n      <ul>\n        <li><i class=\"fas fa-filter\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-select</span> <em>“Source Fasta Sequence”</em>: <code class=\"language-plaintext highlighter-rouge\">S. cerevisiae June 2008 (SGD/sacCer2)</code></li>\n      </ul>\n    </li>\n    <li>Click <strong>Execute</strong>.</li>\n    <li>\n      <p>Verify that the new BWA index for sacCer2 has been built and the .loc file has been filled in. From the <strong>Local Data</strong> page in the Admin section, click on <strong>bwa_mem_indexes</strong> under <em>View Tool Data Table Entries</em></p>\n\n      <p><em>S. cerevisiae</em> sacCer2 should now appear in the list!</p>\n    </li>\n  </ol>\n</blockquote>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <p>What changes were made by the <strong>BWA-MEM index builder</strong>?</p>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <ul>\n      <li>An entry for the <em>sacCer2</em> BWA/BWA-MEM index has been added to the <code class=\"language-plaintext highlighter-rouge\">bwa_mem_index.loc</code> file for the <code class=\"language-plaintext highlighter-rouge\">data_manager_bwa_mem_index_builder</code> data manager.</li>\n      <li>A symlink to the sacCer2 genome fasta file installed by the Fetch Genome data manager above was created in the sacCer2 BWA index directory, <code class=\"language-plaintext highlighter-rouge\">/srv/galaxy/var/tool-data/sacCer2/bwa_mem_index/sacCer2/</code>.</li>\n      <li>The BWA/BWA-MEM index for the sacCer2 genome has been built.</li>\n    </ul>\n\n    <blockquote class=\"code-in\">\n      <code-in-title>Bash</code-in-title>\n\n      <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">ls</span> <span class=\"nt\">-l</span> /srv/galaxy/var/tool-data/sacCer2/bwa_mem_index/sacCer2\n</code></pre></div>      </div>\n    </blockquote>\n\n    <blockquote class=\"code-out\">\n      <code-out-title>Bash</code-out-title>\n      <div class=\"language-console highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"go\">total 20800\n</span><span class=\"gp\">lrwxrwxrwx 1 galaxy galaxy       20 Dec  9 18:29 sacCer2.fa -&gt;</span><span class=\"w\"> </span>../../seq/sacCer2.fa\n<span class=\"go\">-rw-r--r-- 1 galaxy galaxy       14 Dec  9 18:29 sacCer2.fa.amb\n-rw-r--r-- 1 galaxy galaxy      591 Dec  9 18:29 sacCer2.fa.ann\n-rw-r--r-- 1 galaxy galaxy 12163076 Dec  9 18:29 sacCer2.fa.bwt\n-rw-r--r-- 1 galaxy galaxy  3040750 Dec  9 18:29 sacCer2.fa.pac\n-rw-r--r-- 1 galaxy galaxy  6081552 Dec  9 18:29 sacCer2.fa.sa\n</span></code></pre></div>      </div>\n    </blockquote>\n\n  </blockquote>\n\n</blockquote>\n\n<h1 id=\"installing-and-using-data-managers-from-the-command-line-with-ephemeris\">Installing and Using Data Managers from the command line with Ephemeris</h1>\n\n<p>The same process described in the previous section can also be performed from the command line, e.g. in a CI/CD\npipeline, using Ephemeris. For a more in-depth look at Ephemeris, especially in the tool installation context, please see <a href=\"/training-material/topics/admin/tutorials/tool-management/tutorial.html\">the Galaxy Tool Management with Ephemeris tutorial</a>.</p>\n\n<p>In order to accomplish this, you will need:</p>\n\n<ul>\n  <li>The URL of your Galaxy server</li>\n  <li>The API key for your account, which must be an admin</li>\n</ul>\n\n<!--SNIPPET-->\n<blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-getting-your-api-key\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-getting-your-api-key\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Getting your API key</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p>Galaxy admin accounts are specified as a comma-separated email list in the <code class=\"language-plaintext highlighter-rouge\">admin_users</code> directive of <code class=\"language-plaintext highlighter-rouge\">galaxy.yml</code> . If you have set up your Galaxy server using the <a href=\"/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html\">Galaxy Installation with Ansible</a> tutorial, this is set to <code class=\"language-plaintext highlighter-rouge\">admin@example.org</code>.</p>   <ol>   <li>In your browser, open your Galaxy homepage</li>   <li>Log in, or register a new account, if it’s the first time you’re logging in</li>   <li>Go to <code class=\"language-plaintext highlighter-rouge\">User -&gt; Preferences</code> in the top menu bar, then click on <code class=\"language-plaintext highlighter-rouge\">Manage API key</code></li>   <li>If there is no current API key available, click on <code class=\"language-plaintext highlighter-rouge\">Create a new key</code> to generate it</li>   <li>Copy your API key to somewhere convenient, you will need it throughout this tutorial</li> </ol> </blockquote>\n<p><!--END_SNIPPET--></p>\n\n<h2 id=\"install-a-the-fetch-genome-data-manager-from-the-tool-shed-1\">Install a the Fetch Genome Data Manager from the Tool Shed</h2>\n\n<blockquote class=\"hands-on\">\n  <hands-on-title>Install the Fetch Genome Data Manager with Ephemeris</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Re-activate the virtualenv you created for the <a href=\"/training-material/topics/admin/tutorials/tool-management/tutorial.html\">ephemeris tool management tutorial</a>.</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>. ~/ephemeris_venv/bin/activate\n</code></pre></div>        </div>\n      </blockquote>\n\n      <blockquote class=\"tip\">\n        <tip-title>missing?</tip-title>\n\n        <p>then you might need to re-run the steps:</p>\n\n        <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>python3 <span class=\"nt\">-m</span> venv ~/ephemeris_venv\n<span class=\"nb\">.</span> ~/ephemeris_venv/bin/activate\npip <span class=\"nb\">install </span>ephemeris\n</code></pre></div>        </div>\n      </blockquote>\n    </li>\n    <li>\n      <p>Install the <code class=\"language-plaintext highlighter-rouge\">data_manager_fetch_genome_dbkeys_all_fasta</code> data manager tool owned by <code class=\"language-plaintext highlighter-rouge\">devteam</code>.</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <p>Be sure to adjust the value of <code class=\"language-plaintext highlighter-rouge\">-g</code> appropriately for your Galaxy server, and replace the value of <code class=\"language-plaintext highlighter-rouge\">-a</code> with your API key.</p>\n        <div class=\"language-console highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"gp\">shed-tools install -g https://galaxy.example.org -a &lt;api-key&gt;</span><span class=\"w\"> </span><span class=\"nt\">--name</span> data_manager_fetch_genome_dbkeys_all_fasta <span class=\"nt\">--owner</span> devteam\n</code></pre></div>        </div>\n      </blockquote>\n\n      <blockquote class=\"code-out\">\n        <code-out-title></code-out-title>\n        <div class=\"language-console highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"go\">Storing log file in: /tmp/ephemeris_x9xeu8ro\n(1/1) Installing repository data_manager_fetch_genome_dbkeys_all_fasta from devteam to section \"None\" at revision 4d3eff1bc421 (TRT: 0:00:00.401143)\n\trepository data_manager_fetch_genome_dbkeys_all_fasta installed successfully (in 0:00:25.530604) at revision 4d3eff1bc421\nInstalled repositories (1): [('data_manager_fetch_genome_dbkeys_all_fasta', '4d3eff1bc421')]\nSkipped repositories (0): []\nErrored repositories (0): []\nAll repositories have been installed.\nTotal run time: 0:00:25.932659\n</span></code></pre></div>        </div>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h2 id=\"download-and-install-a-reference-genome-sequence-1\">Download and install a reference genome sequence</h2>\n\n<blockquote class=\"hands-on\">\n  <hands-on-title>Download and install sacCer3 with Ephemeris</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Create a config file for <code class=\"language-plaintext highlighter-rouge\">run-data-managers</code> named <code class=\"language-plaintext highlighter-rouge\">fetch-sacCer3.yml</code>:</p>\n\n      <div class=\"language-yaml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"na\">data_managers</span><span class=\"pi\">:</span>\n  <span class=\"pi\">-</span> <span class=\"na\">id</span><span class=\"pi\">:</span> <span class=\"s\">toolshed.g2.bx.psu.edu/repos/devteam/data_manager_fetch_genome_dbkeys_all_fasta/data_manager_fetch_genome_all_fasta_dbkey/0.0.4</span>\n    <span class=\"na\">params</span><span class=\"pi\">:</span>\n      <span class=\"pi\">-</span> <span class=\"s1\">'</span><span class=\"s\">dbkey_source|dbkey'</span><span class=\"err\">:</span> <span class=\"s1\">'</span><span class=\"s\">{{</span><span class=\"nv\"> </span><span class=\"s\">item.dbkey</span><span class=\"nv\"> </span><span class=\"s\">}}'</span>\n      <span class=\"pi\">-</span> <span class=\"s1\">'</span><span class=\"s\">sequence_name'</span><span class=\"err\">:</span> <span class=\"s1\">'</span><span class=\"s\">{{</span><span class=\"nv\"> </span><span class=\"s\">item.name</span><span class=\"nv\"> </span><span class=\"s\">}}'</span>\n      <span class=\"pi\">-</span> <span class=\"s1\">'</span><span class=\"s\">reference_source|reference_source_selector'</span><span class=\"err\">:</span> <span class=\"s1\">'</span><span class=\"s\">ucsc'</span>\n      <span class=\"pi\">-</span> <span class=\"s1\">'</span><span class=\"s\">reference_source|requested_dbkey'</span><span class=\"err\">:</span> <span class=\"s1\">'</span><span class=\"s\">{{</span><span class=\"nv\"> </span><span class=\"s\">item.dbkey</span><span class=\"nv\"> </span><span class=\"s\">}}'</span>\n    <span class=\"na\">items</span><span class=\"pi\">:</span>\n      <span class=\"pi\">-</span> <span class=\"na\">dbkey</span><span class=\"pi\">:</span> <span class=\"s\">sacCer3</span>\n        <span class=\"na\">name</span><span class=\"pi\">:</span> <span class=\"s1\">'</span><span class=\"s\">S.</span><span class=\"nv\"> </span><span class=\"s\">cerevisiae</span><span class=\"nv\"> </span><span class=\"s\">Apr.</span><span class=\"nv\"> </span><span class=\"s\">2011</span><span class=\"nv\"> </span><span class=\"s\">(SacCer_Apr2011/sacCer3)'</span>\n    <span class=\"na\">data_table_reload</span><span class=\"pi\">:</span>\n      <span class=\"pi\">-</span> <span class=\"s\">all_fasta</span>\n      <span class=\"pi\">-</span> <span class=\"s\">__dbkeys__</span>\n</code></pre></div>      </div>\n\n      <blockquote class=\"details\">\n        <details-title>What do these config file compontents mean?</details-title>\n\n        <p>The <code class=\"language-plaintext highlighter-rouge\">run-data-managers</code> config file options correspond to the options in the data manager tool XML file. To locate the tool XML file for the Fetch Genomes data manager, you can search for it in <a href=\"https://toolshed.g2.bx.psu.edu\">the Tool Shed</a> the same way you did when installing it via the UI. You can also open the data manager’s tool form in the UI as if to run it, and, using the drop-down menu at the top right of the tool form, click “See in Tool Shed”. From the Tool Shed, you can click the <strong>Development repository</strong> link and browse to the <a href=\"https://github.com/galaxyproject/tools-iuc/blob/8487d2c73793be0afa5b34388b122e686ac8a094/data_managers/data_manager_fetch_genome_dbkeys_all_fasta/data_manager/data_manager_fetch_genome_all_fasta_dbkeys.xml\">tool XML file, <code class=\"language-plaintext highlighter-rouge\">data_manager/data_manager_fetch_genome_all_fasta_dbkeys.xml</code></a>.</p>\n\n        <table>\n          <thead>\n            <tr>\n              <th><code class=\"language-plaintext highlighter-rouge\">run-data-managers</code> config file component</th>\n              <th>Purpose</th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr>\n              <td><code class=\"language-plaintext highlighter-rouge\">id</code></td>\n              <td>Data manager full (shed) tool ID, this can be found in <code class=\"language-plaintext highlighter-rouge\">shed_data_manager_conf.xml</code></td>\n            </tr>\n            <tr>\n              <td><code class=\"language-plaintext highlighter-rouge\">params</code></td>\n              <td>Data manager tool params, these correspond to <code class=\"language-plaintext highlighter-rouge\">&lt;param&gt;</code> tags in the tool XML file. Nested paramaters are specified using a pipe character (<code class=\"language-plaintext highlighter-rouge\">|</code>).</td>\n            </tr>\n            <tr>\n              <td>param <code class=\"language-plaintext highlighter-rouge\">dbkey_source|dbkey</code></td>\n              <td>Value of <code class=\"language-plaintext highlighter-rouge\">&lt;param name=\"dbkey\" ...&gt;</code> in <code class=\"language-plaintext highlighter-rouge\">&lt;conditional name=\"dbkey_source\"&gt;</code>.</td>\n            </tr>\n            <tr>\n              <td>param <code class=\"language-plaintext highlighter-rouge\">sequence_name</code></td>\n              <td>Value of <code class=\"language-plaintext highlighter-rouge\">&lt;param name=\"sequence_name\" ...&gt;</code>.</td>\n            </tr>\n            <tr>\n              <td>param <code class=\"language-plaintext highlighter-rouge\">reference_source|reference_source_selector</code></td>\n              <td>Value of <code class=\"language-plaintext highlighter-rouge\">&lt;param name=\"reference_source_selector\" ...&gt;</code> in <code class=\"language-plaintext highlighter-rouge\">&lt;conditional name=\"reference_source\"&gt;</code>.</td>\n            </tr>\n            <tr>\n              <td>param <code class=\"language-plaintext highlighter-rouge\">reference_source|requested_dbkey</code></td>\n              <td>Value of <code class=\"language-plaintext highlighter-rouge\">&lt;param name=\"requested_dbkey\" ...&gt;</code> in <code class=\"language-plaintext highlighter-rouge\">&lt;conditional name=\"reference_source\"&gt;</code>.</td>\n            </tr>\n            <tr>\n              <td><code class=\"language-plaintext highlighter-rouge\">items</code></td>\n              <td>A list of variables to template in to <code class=\"language-plaintext highlighter-rouge\">params</code>, referenced in param fields with <code class=\"language-plaintext highlighter-rouge\">{{ item }}</code>. In the case of genomes, for example, you can run this DM with multiple genomes, or you could give multiple URLs.</td>\n            </tr>\n            <tr>\n              <td><code class=\"language-plaintext highlighter-rouge\">data_table_reload</code></td>\n              <td>Names of the data tables you want to reload after your DMs are finished running. This can be important for subsequent data managers.</td>\n            </tr>\n          </tbody>\n        </table>\n\n      </blockquote>\n    </li>\n    <li>\n      <p>Run the Genome Fetch DM with <code class=\"language-plaintext highlighter-rouge\">run-data-managers</code>:</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div class=\"language-console highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"gp\">run-data-managers -g https://galaxy.example.org -a &lt;api-key&gt;</span><span class=\"w\"> </span><span class=\"nt\">--config</span> fetch-sacCer3.yml\n</code></pre></div>        </div>\n      </blockquote>\n\n      <blockquote class=\"code-out\">\n        <code-out-title></code-out-title>\n        <div class=\"language-console highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"go\">Storing log file in: /tmp/ephemeris_f6klyy7v\nRunning data managers that populate the following source data tables: ['all_fasta']\nDispatched job 1. Running DM: \"toolshed.g2.bx.psu.edu/repos/devteam/data_manager_fetch_genome_dbkeys_all_fasta/data_manager_fetch_genome_all_fasta_dbkey/0.0.4\" with parameters: {'dbkey_source|dbkey': 'sacCer3', 'dbkey_source|dbkey_name': 'S. cerevisiae Apr. 2011 (SacCer_Apr2011/sacCer3)', 'reference_source|reference_source_selector': 'ucsc', 'reference_source|requested_dbkey': 'sacCer3'}\nJob 1 finished with state ok.\nRunning data managers that index sequences.\nFinished running data managers. Results:\nSuccessful jobs: 1\nSkipped jobs: 0\nFailed jobs: 0\n</span></code></pre></div>        </div>\n      </blockquote>\n    </li>\n    <li>In the Galaxy UI, access the Admin menu from the top bar</li>\n    <li>Click <strong>Local Data</strong>, which can be found on the left, under <strong>Server</strong></li>\n    <li>\n      <p>Click <strong>all_fasta</strong> under <em>View Tool Data Table Entries</em></p>\n\n      <p>You should see that <em>sacCer3</em> has been added to all_fasta.</p>\n\n      <p><a href=\"../../images/dm-all-fasta-populated-2.png\" rel=\"noopener noreferrer\"><img src=\"../../images/dm-all-fasta-populated-2.png\" alt=\"populated all_fasta data table with sacCer3. \" width=\"1120\" height=\"224\" loading=\"lazy\" /></a></p>\n\n      <blockquote class=\"question\">\n        <question-title></question-title>\n\n        <p>Can we view the changes from the command line? Where are they located?</p>\n\n        <blockquote class=\"solution\">\n          <solution-title></solution-title>\n\n          <p>The <code class=\"language-plaintext highlighter-rouge\">all_fasta.loc</code> file contains the entry for our new genome. If you need a reminder on how to locate it, see the <em>What did this data manager execution change?</em> question in the UI section above.</p>\n\n          <blockquote class=\"code-in\">\n            <code-in-title>Bash</code-in-title>\n            <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">cat</span> /srv/galaxy/var/tool-data/toolshed.g2.bx.psu.edu/repos/devteam/data_manager_fetch_genome_dbkeys_all_fasta/4d3eff1bc421/all_fasta.loc\n</code></pre></div>            </div>\n          </blockquote>\n\n          <blockquote class=\"code-out\">\n            <code-out-title>Bash</code-out-title>\n            <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\">#This file lists the locations and dbkeys of all the fasta files</span>\n<span class=\"c\">#under the \"genome\" directory (a directory that contains a directory</span>\n<span class=\"c\">#for each build). The script extract_fasta.py will generate the file</span>\n<span class=\"c\">#all_fasta.loc. This file has the format (white space characters are</span>\n<span class=\"c\">#TAB characters):</span>\n<span class=\"c\">#</span>\n<span class=\"c\">#&lt;unique_build_id&gt;  &lt;dbkey&gt;     &lt;display_name&gt;  &lt;file_path&gt;</span>\n<span class=\"c\">#</span>\n<span class=\"c\">#So, all_fasta.loc could look something like this:</span>\n<span class=\"c\">#</span>\n<span class=\"c\">#apiMel3    apiMel3 Honeybee (Apis mellifera): apiMel3      /path/to/genome/apiMel3/apiMel3.fa</span>\n<span class=\"c\">#hg19canon  hg19        Human (Homo sapiens): hg19 Canonical        /path/to/genome/hg19/hg19canon.fa</span>\n<span class=\"c\">#hg19full   hg19        Human (Homo sapiens): hg19 Full         /path/to/genome/hg19/hg19full.fa</span>\n<span class=\"c\">#</span>\n<span class=\"c\">#Your all_fasta.loc file should contain an entry for each individual</span>\n<span class=\"c\">#fasta file. So there will be multiple fasta files for each build,</span>\n<span class=\"c\">#such as with hg19 above.</span>\n<span class=\"c\">#</span>\nsacCer2\tsacCer2\tS. cerevisiae June 2008 <span class=\"o\">(</span>SGD/sacCer2<span class=\"o\">)</span>\t/srv/galaxy/var/tool-data/sacCer2/seq/sacCer2.fa\nsacCer3\tsacCer3\tS. cerevisiae Apr. 2011 <span class=\"o\">(</span>SacCer_Apr2011/sacCer3<span class=\"o\">)</span>\t/srv/galaxy/var/tool-data/sacCer3/seq/sacCer3.fa\n</code></pre></div>            </div>\n          </blockquote>\n\n        </blockquote>\n\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"warning\">\n  <warning-title>run-data-managers is not idempotent!</warning-title>\n  <p>Unlike <code class=\"language-plaintext highlighter-rouge\">shed-tools install</code>, the Ephemeris <code class=\"language-plaintext highlighter-rouge\">run-data-managers</code> utility is not idempotent. If run a second time on the same set of inputs, you will end up with two entries in your <code class=\"language-plaintext highlighter-rouge\">all_fasta</code> data table, with the data from the second run overwriting the data from the first run.</p>\n\n  <p>Please see <a href=\"https://github.com/galaxyproject/galaxy/issues/15188\">Galaxy issue #15188</a> for details.</p>\n\n</blockquote>\n\n<h2 id=\"download-and-install-the-bwa-data-manager-1\">Download and install the BWA data manager</h2>\n\n<blockquote class=\"hands-on\">\n  <hands-on-title>Install the BWA/BWA-MEM Data Manager </hands-on-title>\n\n  <ol>\n    <li>\n      <p>Install the <code class=\"language-plaintext highlighter-rouge\">bwa_mem_index_builder_data_manager</code> data manager tool owned by <code class=\"language-plaintext highlighter-rouge\">devteam</code>.</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div class=\"language-console highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"gp\">shed-tools install -g https://galaxy.example.org -a &lt;api-key&gt;</span><span class=\"w\"> </span><span class=\"nt\">--name</span> data_manager_bwa_mem_index_builder <span class=\"nt\">--owner</span> devteam\n</code></pre></div>        </div>\n      </blockquote>\n\n      <blockquote class=\"code-out\">\n        <code-out-title></code-out-title>\n        <div class=\"language-console highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"go\">Storing log file in: /tmp/ephemeris_2dyujjvi\n(1/1) Installing repository data_manager_bwa_mem_index_builder from devteam to section \"None\" at revision 63d5652be07a (TRT: 0:00:00.204350)\n\trepository data_manager_bwa_mem_index_builder installed successfully (in 0:00:05.599382) at revision 63d5652be07a\nInstalled repositories (1): [('data_manager_bwa_mem_index_builder', '63d5652be07a')]\nSkipped repositories (0): []\nErrored repositories (0): []\nAll repositories have been installed.\nTotal run time: 0:00:05.804217\n</span></code></pre></div>        </div>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h2 id=\"build-the-bwa-index-for-a-reference-genome-1\">Build the BWA index for a reference genome</h2>\n\n<blockquote class=\"hands-on\">\n  <hands-on-title>Build the sacCer3 BWA index</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Create a config file for <code class=\"language-plaintext highlighter-rouge\">run-data-managers</code> named <code class=\"language-plaintext highlighter-rouge\">build-sacCer3-bwa.yml</code>:</p>\n\n      <div class=\"language-yaml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"na\">data_managers</span><span class=\"pi\">:</span>\n  <span class=\"pi\">-</span> <span class=\"na\">id</span><span class=\"pi\">:</span> <span class=\"s\">toolshed.g2.bx.psu.edu/repos/devteam/data_manager_bwa_mem_index_builder/bwa_mem_index_builder_data_manager/0.0.5</span>\n    <span class=\"na\">params</span><span class=\"pi\">:</span>\n      <span class=\"pi\">-</span> <span class=\"s1\">'</span><span class=\"s\">all_fasta_source'</span><span class=\"err\">:</span> <span class=\"s1\">'</span><span class=\"s\">{{</span><span class=\"nv\"> </span><span class=\"s\">item.dbkey</span><span class=\"nv\"> </span><span class=\"s\">}}'</span>\n      <span class=\"pi\">-</span> <span class=\"s1\">'</span><span class=\"s\">sequence_name'</span><span class=\"err\">:</span> <span class=\"s1\">'</span><span class=\"s\">{{</span><span class=\"nv\"> </span><span class=\"s\">item.name</span><span class=\"nv\"> </span><span class=\"s\">}}'</span>\n    <span class=\"na\">items</span><span class=\"pi\">:</span>\n      <span class=\"pi\">-</span> <span class=\"na\">dbkey</span><span class=\"pi\">:</span> <span class=\"s\">sacCer3</span>\n        <span class=\"na\">name</span><span class=\"pi\">:</span> <span class=\"s1\">'</span><span class=\"s\">S.</span><span class=\"nv\"> </span><span class=\"s\">cerevisiae</span><span class=\"nv\"> </span><span class=\"s\">Apr.</span><span class=\"nv\"> </span><span class=\"s\">2011</span><span class=\"nv\"> </span><span class=\"s\">(SacCer_Apr2011/sacCer3)'</span>\n    <span class=\"na\">data_table_reload</span><span class=\"pi\">:</span>\n      <span class=\"pi\">-</span> <span class=\"s\">bwa_mem_indexes</span>\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p>Run the BWA-MEM index builder DM with <code class=\"language-plaintext highlighter-rouge\">run-data-managers</code>:</p>\n\n      <blockquote class=\"code-in\">\n        <code-in-title>Bash</code-in-title>\n        <div class=\"language-console highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"gp\">run-data-managers -g https://galaxy.example.org -a &lt;api-key&gt;</span><span class=\"w\"> </span><span class=\"nt\">--config</span> build-sacCer3-bwa.yml\n</code></pre></div>        </div>\n      </blockquote>\n\n      <blockquote class=\"code-out\">\n        <code-out-title></code-out-title>\n        <div class=\"language-console highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"go\">Storing log file in: /tmp/ephemeris_esecdef4\nRunning data managers that populate the following source data tables: ['all_fasta']\nRunning data managers that index sequences.\nDispatched job 2. Running DM: \"toolshed.g2.bx.psu.edu/repos/devteam/data_manager_bwa_mem_index_builder/bwa_mem_index_builder_data_manager/0.0.5\" with parameters: {'all_fasta_source': 'sacCer3', 'sequence_name': 'S. cerevisiae Apr. 2011 (SacCer_Apr2011/sacCer3)'}\nJob 2 finished with state ok.\nFinished running data managers. Results:\nSuccessful jobs: 1\nSkipped jobs: 0\nFailed jobs: 0\n</span></code></pre></div>        </div>\n      </blockquote>\n    </li>\n    <li>In the Galaxy UI, access the Admin menu from the top bar</li>\n    <li>Click <strong>Local Data</strong>, which can be found on the left, under <strong>Server</strong></li>\n    <li>\n      <p>Click <strong>bwa_mem_indexes</strong> under <em>View Tool Data Table Entries</em></p>\n\n      <p>You should see that <em>sacCer3</em> has been added to bwa_mem_indexes. You can also verify this via the command line using the methods you’ve learned above.</p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h1 id=\"verify-that-bwa-can-access-the-new-reference-data\">Verify that BWA can access the new reference data</h1>\n\n<p>Finally, we will verify that the BWA tool can see the new genome indexes.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Configure Galaxy</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Install the BWA and BWA-MEM tools, if needed. If installing with Ephemeris, the repo name for the <code class=\"language-plaintext highlighter-rouge\">--name</code> parameter is <code class=\"language-plaintext highlighter-rouge\">bwa</code> and the owner is <code class=\"language-plaintext highlighter-rouge\">devteam</code>.</p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-install-tools-via-the-admin-ui\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-install-tools-via-the-admin-ui\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Install tools via the Admin UI</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ol>   <li>Open Galaxy in your browser and type <code class=\"language-plaintext highlighter-rouge\">bwa</code> in the tool search box on the left. If “Map with BWA” is among the search results, you can skip the following steps.</li>   <li>Access the Admin menu from the top bar (you need to be logged-in with an email specified in the <code class=\"language-plaintext highlighter-rouge\">admin_users</code> setting)</li>   <li>Click “Install and Uninstall”, which can be found on the left, under “Tool Management”</li>   <li>Enter <code class=\"language-plaintext highlighter-rouge\">bwa</code> in the search interface</li>   <li>Click on the first hit, having <code class=\"language-plaintext highlighter-rouge\">devteam</code> as owner</li>   <li>Click the “Install” button for the latest revision</li>   <li>Enter “Mapping” as the target section and click “OK”.</li> </ol> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>\n      <p>Click the “Home” icon at the top to return to the Galaxy analysis interface</p>\n    </li>\n    <li>\n      <p>Load the <span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/devteam/bwa/bwa/0.7.17.5\" title=\"Map with BWA tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Map with BWA</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.7.17.5)</span> tool and verify that the sacCer2 genome (if you completed the “Galaxy UI” section) and/or sacCer3 genome (if you completed the “command line with Ephemeris” section)  appears in the <i class=\"fas fa-filter\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-select</span> <em>“Using reference genome”</em> option.</p>\n    </li>\n  </ol>\n</blockquote>\n\n<p>How cool is that? No editing <code class=\"language-plaintext highlighter-rouge\">.loc</code> files, no making sure you’ve got TABs instead of spaces. Fully auto!</p>\n\n<!--SNIPPET-->\n<blockquote class=\"comment\">   <div class=\"box-title comment-title\" id=\"comment-galaxy-admin-training-path-1\"><i class=\"far fa-comment-dots\" aria-hidden=\"true\"></i> Comment: Galaxy Admin Training Path</div>   <p>The yearly Galaxy Admin Training follows a specific ordering of tutorials. Use this timeline to help keep track of where you are in Galaxy Admin Training.</p>   <ol id=\"git-gat-timeline\">                    <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html\">             <div>Step 1</div>             <div>ansible-galaxy</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/backup-cleanup/tutorial.html\">             <div>Step 2</div>             <div>backup-cleanup</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/customization/tutorial.html\">             <div>Step 3</div>             <div>customization</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/tus/tutorial.html\">             <div>Step 4</div>             <div>tus</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/cvmfs/tutorial.html\">             <div>Step 5</div>             <div>cvmfs</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/apptainer/tutorial.html\">             <div>Step 6</div>             <div>apptainer</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"disabled\">         <a href=\"/training-material/topics/admin/tutorials/tool-management/tutorial.html\">             <div>Step 7</div>             <div>tool-management</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"active\">         <a href=\"/training-material/topics/admin/tutorials/reference-genomes/tutorial.html\">             <div>Step 8</div>             <div>reference-genomes</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/data-library/tutorial.html\">             <div>Step 9</div>             <div>data-library</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/dev/tutorials/bioblend-api/tutorial.html\">             <div>Step 10</div>             <div>dev/bioblend-api</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/connect-to-compute-cluster/tutorial.html\">             <div>Step 11</div>             <div>connect-to-compute-cluster</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/job-destinations/tutorial.html\">             <div>Step 12</div>             <div>job-destinations</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/pulsar/tutorial.html\">             <div>Step 13</div>             <div>pulsar</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/celery/tutorial.html\">             <div>Step 14</div>             <div>celery</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/gxadmin/tutorial.html\">             <div>Step 15</div>             <div>gxadmin</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/reports/tutorial.html\">             <div>Step 16</div>             <div>reports</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/monitoring/tutorial.html\">             <div>Step 17</div>             <div>monitoring</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/tiaas/tutorial.html\">             <div>Step 18</div>             <div>tiaas</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/sentry/tutorial.html\">             <div>Step 19</div>             <div>sentry</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/ftp/tutorial.html\">             <div>Step 20</div>             <div>ftp</div>         </a>     </li>               <span aria-hidden=\"true\">         <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>     </span>                         <li class=\"\">         <a href=\"/training-material/topics/admin/tutorials/beacon/tutorial.html\">             <div>Step 21</div>             <div>beacon</div>         </a>     </li>           </ol> </blockquote>\n<p><!--END_SNIPPET--></p>\n"],"ref_slides":["# Overview\n\n.large[\n* **Intro to built in datasets**\n* Built in data hierarchy\n* Some problems\n* Data Managers\n* There's just so much of it!\n]\n\n---\n\n# Built in Data\n\n![List_of_data.png](../../images/i06-List_of_data.png)\n\n---\n\n# Data, what data?\n\n.large[\n* Some genomes are large! Human, Mouse, Coral\n* Some tools require indices of the genomes.\n* The indices take a long time to build!\n* Better to pre-build the indices.\n]\n\n---\n\n# Overview\n\n.large[\n* Intro to built in datasets\n* **Built in data hierarchy**\n* Some problems\n* Data Managers\n* There's just so much of it!\n]\n\n---\n\n# Data schematics in Galaxy\n\n![schematic](../../images/data_managers_schematic_overview.png)\n\n---\n\n# Using reference data in a tool\n\n#### bwa.xml\n\n```xml\n<conditional name=\"reference_source\">\n      <param name=\"reference_source_selector\" type=\"select\" label=\"Will you select a reference genome from your history or use a built-in index?\" help=\"Built-ins were indexed using default options. See 'Indexes' section of help below\">\n        <option value=\"cached\">Use a built-in genome index</option>\n        <option value=\"history\">Use a genome from history and build index</option>\n      </param>\n      <when value=\"cached\">\n        <param name=\"ref_file\" type=\"select\" label=\"Using reference genome\" help=\"Select genome from the list\">\n          <options from_data_table=\"bwa_mem_indexes\">\n            <filter type=\"sort_by\" column=\"2\" />\n            <validator type=\"no_options\" message=\"No indexes are available\" />\n          </options>\n          <validator type=\"no_options\" message=\"A built-in reference genome is not available for the build associated with the selected input file\"/>\n        </param>\n      </when>\n      <when value=\"history\">\n\n```\n\n---\n\n# Where are the data tables?\n\n#### tool_data_table_conf.xml\n\n(Usually located in `galaxy/config/`)\n\n```xml\n  <tables>\n    <!-- Locations of indexes in the BWA mapper format -->\n    <table name=\"bwa_mem_indexes\" comment_char=\"#\" allow_duplicate_entries=\"False\">\n      <columns>value, dbkey, name, path</columns>\n      <file path=\"tool-data/bwa_index.loc\" />\n    </table>\n  </tables>\n```\n\n---\n\n# \"loc\" files - Short for location!\n\nbwa_index.loc\n\n```text\n#\n#<unique_build_id>   <dbkey>   <display_name>   <file_path>\n#\nbosTau7 bosTau7 Cow (bosTau7)   /genomes/bosTau7/bwa_mem_index/bosTau7/bosTau7.fa\nce10    ce10    C. elegans (ce10)       /genomes/ce10/bwa_mem_index/ce10/ce10.fa\ndanRer7 danRer7 Zebrafish (danRer7)     /genomes/danRer7/bwa_mem_index/danRer7/danRer7.fa\ndm3     dm3     D. melanogaster Apr. 2006 (BDGP R5/dm3) (dm3)   /genomes/dm3/bwa_mem_index/dm3/dm3.fa\nhg19    hg19    Human (hg19)    /genomes/hg19/bwa_mem_index/hg19/hg19.fa\nhg38    hg38    Human (hg38)    /genomes/hg38/bwa_mem_index/hg38/hg38.fa\nmm10    mm10    Mouse (mm10)    /genomes/mm10/bwa_mem_index/mm10/mm10.fa\n```\n\n---\n\n# Overview\n\n.large[\n* Intro to built in datasets\n* Built in data hierarchy\n* **Some problems**\n* Data Managers\n* There's just so much of it!\n]\n\n---\n\n# Some Problems!\n\n.large[\n* Time consuming!\n  * ~30 minutes work just to add a new genome to 1 tool!\n\n* Administrator needs to know:\n  * how to index **every** tool\n  * expected format of the reference data\n  * format of the .loc file\n]\n\n---\n\n# Typical conversation\n\n> Hi,\n> We have a local install of galaxy andI'm trying to add the reference index files for bwa using the information provided in the following link:\n>\n> ...\n>\n> I have modified the bwa_index.loc file present in the ../tool-data directory by adding the path to where the index is on our server (Also attached). However, even after restarting the server, the ference genome does not show when choosing the \"use a built in index option\". I'm not sure whether the loc file is correctly created, and whether any other configuration file needs to be changed/updated. Help in the matter greatly appreciated\n>\n> Thanks,\n> Aarti\n\n---\n\n# Typical conversation\n\n> Hi Aarti,\n> Check the name of your rf file. If it is hg19.fa, then modified the loc file as\n> \"hg19  hg19  HG19_BWA  /root/Ref_INDEX/HG19BWAIndex/base/hg19.fa\"\n>\n> Avik Datta\n\n---\n\n# Typical conversation\n\n> Also make sure you are using TABs to separate the fields in the .loc file, this has bitten me several times in the past. My vim config places 4 spaces instead of TAB, to deactivate this optin you can do \":set noexpandtab\"\n>\n> Hope it helps,\n> Carlos\n\n---\n\n# Typical conversation\n\n> Hello Carlos,\n> Thanks a lot for the tip. The tab trick has fixed the problem.\n>\n> Regards,\n> Aarti\n\n---\n\n# Other concerns\n\n.large[\n* **Accessible?**\n  * Manually download genome FASTA files\n  * Download, compile, run bwa index; which options?\n* **Reproducible?**\n  * Only if the person performing manual steps keeps good notes\n* **Transparent?**\n  * Send email to sysadmin asking for notes\n  * Restart Galaxy server for new entries\n]\n\n---\n\n# Overview\n\n.large[\n* Intro to built in datasets\n* Built in data hierarchy\n* Some problems\n* **Data Managers**\n* There's just so much of it!\n]\n\n---\n\n# Data Managers\n\n.large[\n* Allows for the **creation of built-in** (reference) data\n\t* underlying data\n\t* data tables\n\t* \\*.loc files\n\n* Specialized Galaxy tools that can only be accessed by an admin\n\n* Defined **locally** or installed from **ToolShed**\n]\n\n---\n\n# Data Managers\n\n.large[\n* **Flexible** framework\n  * Not just genomic data\n  * Run Data Managers through UI\n  * Workflow compatible\n  * API\n* Examples\n  * Adding new genome builds (dbkeys)\n  * Fetching genome (fasta) sequences\n  * Building short read mapper indices for genomes\n]\n\n---\n\n# Special class of Galaxy tool\n\nLooks just like a normal Galaxy tool!\n\n![Data-manager-ui.png](../../images/Data-manager-ui.png)\n\n---\n\n# What does it do?\n\nThe output of the data manager is a JSON description of the new data table entry\n\n![data_table_JSON.png](../../images/data_table_JSON.png)\n\nThis gets turned into a new data table entry\n\n![data_table_entry.png](../../images/data_table_entry.png)\n\nThe index files themselves get placed in the appropriate location.\n\n---\n\n# Data Managers Admin\n\n.large[\n* Located on the Galaxy's Admin Tab under **Local Data**\n]\n![data_managers_tool_list.png](../../images/data_managers_tool_list.png)\n\n---\n\n# Data Managers Admin\n\n.large[\n* UI tools to fetch reference genomes/build indices\n* View progress of index build jobs\n* View contents of tool data tables\n]\n![data_table_ui.png](../../images/data_table_ui.png)\n\n---\n\n# Resources / further reading\n\n.large[\n* Galaxy Wiki Page on Data Managers\n  * Details\n  * Building\n  * Examples\n\nhttps://galaxyproject.org/admin/tools/data-managers/\n]\n\n---\n\n# Exercise Time!\n\n---\n\n# Overview\n\n.large[\n* Intro to built in datasets\n* Built in data hierarchy\n* Some problems\n* Data Managers\n* **There's just so much of it!**\n]\n\n---\n\n# There's a lot of reference data\n\n.large[\n(and it's hard to keep up with)\n]\n![ref_data_prob_flow.png](../../images/ref_data_prob_flow.png)\n\n---\n\n# CernVM-FS to the rescue\n\n* Needed a method of sharing reference data across country efficiently\n* **CVMFS** is an efficient method for read only data sharing between systems\n    * Originally designed for distributed software installation at Cern\n    * Turns out it's really useful for read only data sets as well\n    * HTTP-based, firewall friendly\n* All nodes of Galaxy Main get their reference genomes and indices from CVMFS\n    * Shared via mirroring and caching across the country\n* It's also really useful to share data **globally**\n    * The **usegalaxy.*** initiative has taken full advantage of this.\n\n---\n\n.widen_image[\n![cvmfs_server_distribution.png](../../images/cvmfs_server_distribution.png)\n]\n\n---\n\n# CVM-FS Global Structure\n\n.widen_image[\n![cvmfs_global_structure.png](../../images/cvmfs_global_structure.png)\n]\n\n---\n\n# Exercise #2:\n\n.large[\n**Connect our instances to CVMFS for reference data**\n]\n"],"hands_on":true,"slides":true,"mod_date":"2023-04-20 15:16:14 +0000","pub_date":"2019-01-28 04:08:04 +0000","version":15,"api":"https://training.galaxyproject.org/training-material/api/topics/admin/tutorials/reference-genomes/tutorial.json","tools":["toolshed.g2.bx.psu.edu/repos/devteam/bwa/bwa/0.7.17.5","toolshed.g2.bx.psu.edu/repos/devteam/data_manager_bwa_mem_index_builder/bwa_mem_index_builder_data_manager/0.0.5","toolshed.g2.bx.psu.edu/repos/devteam/data_manager_fetch_genome_dbkeys_all_fasta/data_manager_fetch_genome_all_fasta_dbkey/0.0.4"],"supported_servers":[],"topic_name_human":"Galaxy Server administration","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[{"name":"bwa","owner":"devteam","revisions":"e188dc7a68e6","tool_panel_section_label":"Mapping","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"data_manager_bwa_mem_index_builder","owner":"devteam","revisions":"9e993022c762","tool_panel_section_label":"Data Managers","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"data_manager_fetch_genome_dbkeys_all_fasta","owner":"devteam","revisions":"4d3eff1bc421","tool_panel_section_label":"Data Managers","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"}]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools:\n- name: bwa\n  owner: devteam\n  revisions: e188dc7a68e6\n  tool_panel_section_label: Mapping\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: data_manager_bwa_mem_index_builder\n  owner: devteam\n  revisions: 9e993022c762\n  tool_panel_section_label: Data Managers\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: data_manager_fetch_genome_dbkeys_all_fasta\n  owner: devteam\n  revisions: 4d3eff1bc421\n  tool_panel_section_label: Data Managers\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n","tours":false,"video":false,"slides_recordings":false,"translations":{"tutorial":[],"slides":[],"video":false},"license":"CC-BY-4.0","type":"tutorial","contributors":["blankenberg","slugger70"],"logo":"assets/images/gat.png","redirect_from":["/short/admin/reference-genomes/slides","/short/S00021"]}