{"layout":"tutorial_hands_on","redirect_from":["/topics/instructors/tutorials/galaxy-admin-training/tutorial","/short/teaching/galaxy-admin-training","/short/T00278"],"title":"Galaxy Admin Training","subtopic":"prepare","time_estimation":"60m","questions":["How do I organise a Galaxy Admin Training (GAT)","What do I need to set up?","What should I know during the training?"],"objectives":["Interact with the UseGalaxy.eu admins to arrange for infrastructure","Run a great training!"],"key_points":["Infrastructure is available for running GATs for free from UseGalaxy.eu","This can be very convenient and easy to use","EU provides appropriate DNS entries so you can run trainings with ITs."],"requirements":[{"type":"internal","topic_name":"admin","tutorials":["ansible","terraform"]}],"contributors":[{"name":"Helena Rasche","orcid":"0000-0001-9760-8992","maintainer_contact":"gitter","matrix":"hexylena:matrix.org","joined":"2017-09","elixir_node":"nl","affiliations":["gallantries","by-covid","erasmusmc","elixir-europe","elixir-converge"],"former_affiliations":["deNBI","avans-atgm","uni-freiburg"],"contact_for_training":false,"location":{"country":"NL","lat":51.91,"lon":4.46},"id":"hexylena","url":"https://training.galaxyproject.org/training-material/api/contributors/hexylena.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/hexylena/"}],"js_requirements":{"mathjax":null,"mermaid":false},"short_id":"T00278","url":"/topics/teaching/tutorials/galaxy-admin-training/tutorial.html","topic_name":"teaching","tutorial_name":"galaxy-admin-training","dir":"topics/teaching/tutorials/galaxy-admin-training","symlink":null,"id":"teaching/galaxy-admin-training","ref_tutorials":["<p>Setting up and running a Galaxy Admin Training is not a very complicated process thanks to a significant amount of work that has been put into making it easy and quick.</p>\n\n<p><a href=\"../../images/gat.png\" rel=\"noopener noreferrer\"><img src=\"../../images/gat.png\" alt=\"GAT logo is the GTN logo over a space background and text reading galaxy admin traiing.\" width=\"1000\" height=\"359\" loading=\"lazy\" /></a></p>\n\n<p>This tutorial has multiple audiences who are all adressed within this one tutorial. We encourage everyone involved in hosting a GAT event to read this, so you are aware of all of the moving parts which are required for such an event.</p>\n\n<blockquote class=\"agenda\">\n  <agenda-title></agenda-title>\n\n  <p>In this tutorial, we will see:</p>\n\n<ol id=\"markdown-toc\">\n  <li><a href=\"#planning-your-training\" id=\"markdown-toc-planning-your-training\">Planning Your Training</a>    <ol>\n      <li><a href=\"#requesting-infrastructure\" id=\"markdown-toc-requesting-infrastructure\">Requesting Infrastructure</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#provisioning-the-infrastructure\" id=\"markdown-toc-provisioning-the-infrastructure\">Provisioning the Infrastructure</a>    <ol>\n      <li><a href=\"#eu-admins-setting-up-vms\" id=\"markdown-toc-eu-admins-setting-up-vms\">[EU admins] Setting up VMs</a></li>\n      <li><a href=\"#non-eu-admins-setting-up-the-vms\" id=\"markdown-toc-non-eu-admins-setting-up-the-vms\">[Non-EU admins] Setting up the VMs</a></li>\n      <li><a href=\"#everyone-bootstrapping-the-vms\" id=\"markdown-toc-everyone-bootstrapping-the-vms\">[Everyone] Bootstrapping the VMs</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#testing\" id=\"markdown-toc-testing\">Testing</a></li>\n  <li><a href=\"#starting-your-training\" id=\"markdown-toc-starting-your-training\">Starting Your Training</a></li>\n  <li><a href=\"#during-your-training\" id=\"markdown-toc-during-your-training\">During Your Training</a></li>\n  <li><a href=\"#after-your-training\" id=\"markdown-toc-after-your-training\">After Your Training</a></li>\n  <li><a href=\"#conclusion\" id=\"markdown-toc-conclusion\">Conclusion</a></li>\n</ol>\n\n</blockquote>\n\n<h1 id=\"planning-your-training\">Planning Your Training</h1>\n\n<p>First consider the requirements for your training:</p>\n\n<ul>\n  <li>How many days will the training be?</li>\n  <li>What topics do you want to cover?</li>\n  <li>How many helpers will you need?</li>\n  <li>Will the training be online or in person? Teaching online is slower, so you may not be able to cover as many topic as in person; you may also need more helpers.</li>\n  <li>Do you have your own infrastructure, or do you need to request infrastructure?</li>\n</ul>\n\n<p>We recommend <a href=\"https://github.com/galaxyproject/admin-training/tree/2020-barcelona\">checking out an example schedule from the GAT repository</a> and modifying it based on your needs.</p>\n\n<h2 id=\"requesting-infrastructure\">Requesting Infrastructure</h2>\n\n<p>If you do not have a cloud available that can, at minimum:</p>\n\n<ul>\n  <li>setup VMs which are accessible from where your students are</li>\n  <li>expose ports 20, 80, 443 (optional), 8080 (optional but nice)</li>\n</ul>\n\n<p>Then consider <a href=\"mailto:galaxy@informatik.uni-freiburg.de?subject=Hosting%20a%20GAT\">contacting UseGalaxy.eu</a> and let us know you’d like to host a GAT event. Tell us the number of students and dates of the event.</p>\n\n<h1 id=\"provisioning-the-infrastructure\">Provisioning the Infrastructure</h1>\n\n<p>Skip to the section on setting up below that is appropriate for you</p>\n\n<h2 id=\"eu-admins-setting-up-vms\">[EU admins] Setting up VMs</h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>EU: Setting up VMs</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Open a PR editing the <a href=\"https://github.com/usegalaxy-eu/infrastructure/blob/master/gat.tf#L1\">count variable</a> and increasing it to the desired number of VMs.</p>\n    </li>\n    <li>\n      <p>Merge</p>\n    </li>\n    <li>\n      <p>Once deployed, clone/pull the repository locally and run <code class=\"language-plaintext highlighter-rouge\">./bin/process-training-output.sh</code></p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>$ ./bin/process-training-output.sh\nubuntu  gat-0.training.galaxyproject.eu ...\nubuntu  gat-1.training.galaxyproject.eu ...\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p>Place this in the <a href=\"http://gxy.io/gatmachines\">GAT Machines</a> spreadsheet in the correct tab.</p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h2 id=\"non-eu-admins-setting-up-the-vms\">[Non-EU admins] Setting up the VMs</h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Non-EU: Setting up VMs</hands-on-title>\n\n  <ol>\n    <li>\n      <p>If you have your own cloud, setup VMs per student. We strongly recommend:</p>\n\n      <ul>\n        <li>Ubuntu 18.04+</li>\n        <li>8Gb RAM</li>\n        <li>2 VCPUs</li>\n      </ul>\n\n      <p>If you’re using terraform, you can take inspiration from <a href=\"https://github.com/usegalaxy-eu/infrastructure/blob/master/gat.tf\">UseGalaxy.eu’s terraform configuration</a></p>\n    </li>\n    <li>\n      <p>Place the list of usernames and IPs and passwords in the <a href=\"http://gxy.io/gatmachines\">GAT Machines</a> spreadsheet in the correct tab.</p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h2 id=\"everyone-bootstrapping-the-vms\">[Everyone] Bootstrapping the VMs</h2>\n\n<p>Once your VMs are running, great! Now you’ll need to bootstrap the instances and prepare them for student use.</p>\n\n<p>The GAT team maintains some infrastructure to handle the bootstrapping in <a href=\"https://github.com/galaxyproject/admin-training/tree/2020-bcc/bootstrap-instances\">the GAT repository</a></p>\n\n<p>We use a more complicated hosts file in the project, as we have multiple pools of VMs across global regions. This is seen in the <code class=\"language-plaintext highlighter-rouge\">workshop_eu</code> and <code class=\"language-plaintext highlighter-rouge\">workshop_oz</code> groups, and the corresponding commands in the Makefile. However, this distinction of regions is not necessary. The most simple hosts file looks like:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code># Your Machines\n[workshop_instances]\n192.0.2.1\n192.0.2.2\n192.0.2.3\n...\n\n# Some variables for those machines\n[workshop_instances:vars]\nansible_host_key_checking = false\nansible_user = ubuntu\nansible_become = true\nansible_ssh_private_key_file = ~/admintraining.key\nset_password = true      # Generate a random password\n</code></pre></div></div>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Everyone: Setting up VMs</hands-on-title>\n\n  <ol>\n    <li>\n      <p><code class=\"language-plaintext highlighter-rouge\">git clone https://github.com/galaxyproject/admin-training/</code> and change into that repo</p>\n    </li>\n    <li>\n      <p><code class=\"language-plaintext highlighter-rouge\">cd bootstrap-instances</code></p>\n    </li>\n    <li>\n      <p>In the <code class=\"language-plaintext highlighter-rouge\">hosts</code> file, edit the <code class=\"language-plaintext highlighter-rouge\">[workshop_eu]</code> section to list all of your IPs or DNS entries.</p>\n\n      <p>You can specify <code class=\"language-plaintext highlighter-rouge\">ansible_user=something</code> if it uses a different username, and <code class=\"language-plaintext highlighter-rouge\">ansible_password=password</code> for each machine. E.g.</p>\n\n      <p>A range of DNS entries (<code class=\"language-plaintext highlighter-rouge\">gat-0</code> to <code class=\"language-plaintext highlighter-rouge\">gat-39</code>)</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>[workshop_]\ngat-[0:39].training.galaxyproject.eu\n</code></pre></div>      </div>\n\n      <p>Some IPs</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>[workshop_eu]\n192.0.2.1\n192.0.2.2\n192.0.2.3\n192.0.2.4\n</code></pre></div>      </div>\n\n      <p>Some IPs with additional information</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>[workshop_eu]\n192.0.2.1 ansible_password=2121\n192.0.2.2 ansible_password=1212\n192.0.2.3 ansible_password=4321\n192.0.2.4 ansible_password=1235\n\n[workshop_instances:vars]\nansible_user = myuser\n</code></pre></div>      </div>\n\n      <p>Remove the <code class=\"language-plaintext highlighter-rouge\">workshop_oz</code> from the top of the file under <code class=\"language-plaintext highlighter-rouge\">[workshop_instances:children]</code></p>\n    </li>\n    <li>\n      <p>Setup a python virtualenv and activate it.</p>\n    </li>\n    <li>\n      <p>Install the requirements (listed in <code class=\"language-plaintext highlighter-rouge\">requirements.txt</code>)</p>\n    </li>\n    <li>\n      <p>Run <code class=\"language-plaintext highlighter-rouge\">make all</code></p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>The last command runs the <code class=\"language-plaintext highlighter-rouge\">playbook.yml</code>, which in turn does a large number of things:</p>\n\n<ul>\n  <li>Bootstraps python on the machine if it isn’t available already (Ubuntu stopped including it for some reason.)</li>\n  <li>(Generates if needed) and copies an SSH key to all of the machines to make login easier (this is stored in <code class=\"language-plaintext highlighter-rouge\">id_rsa</code> and <code class=\"language-plaintext highlighter-rouge\">id_rsa.pub</code> in the same directory as the makefile.)</li>\n  <li>This key is set as the ubuntu user’s key, and added to their authorized_keys, to permit them to run ansible easily on that machine (if they don’t configure the local connection correctly.)\n    <ul>\n      <li>(When pulsar is in use) the pulsar machines are provisioned identically to the ones where Galaxy is setup, so the students can login passwordlessly to their pulsar machine.</li>\n    </ul>\n  </li>\n  <li>Updates packages (slow)</li>\n  <li>Installs basic dependencies (emacs, vim, nano, git, etc.)</li>\n  <li>Adds the <code class=\"language-plaintext highlighter-rouge\">gat-cli</code> script to <code class=\"language-plaintext highlighter-rouge\">/usr/bin/gat</code></li>\n  <li>Optionally sets a password to the machine\n    <ul>\n      <li>If you set <code class=\"language-plaintext highlighter-rouge\">set_password=true</code> in the hosts file, you can set a password on machines.</li>\n      <li>This is useful when your machines only have an SSH key on them, and no password set for students.</li>\n    </ul>\n  </li>\n  <li>Reboots the machines</li>\n</ul>\n\n<h1 id=\"testing\">Testing</h1>\n\n<p>Once your VMs are ready, you should test ALL of the lessons you intend to teach. Most of the training should be fine, but sometimes changes in e.g. Galaxy versions or the availability of newer versions of some ansible modules will indicate you should test the training as you plan to teach it, and update the training materials where relevant.</p>\n\n<h1 id=\"starting-your-training\">Starting Your Training</h1>\n\n<p>We recommend providing a website <a href=\"https://github.com/galaxyproject/admin-training/tree/2020-barcelona\">similar to our GitHub repository</a> (or using our repository! Ask us for a branch.) with at minimum the following links:</p>\n\n<ul>\n  <li><strong>Q&amp;A</strong> pointing to a Google document where students can ask questions.\n    <ul>\n      <li>In our experience this is an excellent format for discussion: it allows students to ask as many questions as they have, and responses can be given in real-time right below each question.</li>\n      <li>Additionally images and complex formatting is easy</li>\n      <li>Lastly, it’s <em>anonymous</em> which many students prefer.</li>\n    </ul>\n  </li>\n  <li><strong>Chat</strong> pointing to <code class=\"language-plaintext highlighter-rouge\">https://gxy.io/gatchat</code> (or your preferred channel)</li>\n  <li><strong>VM List</strong> pointing to <code class=\"language-plaintext highlighter-rouge\">https://gxy.io/gatmachines</code> (or your own spreadsheet)</li>\n  <li>The slides and tutorials for your training.</li>\n</ul>\n\n<h1 id=\"during-your-training\">During Your Training</h1>\n\n<p>During planning for BCC2020 we found that monitoring student progress would be extremely difficult, it was not a situation we had encountered before as this was the first remote GAT during the pandemic. So we developed a small utility, the <code class=\"language-plaintext highlighter-rouge\">gat-cli</code>, which assists in monitoring students’ progress.</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>$ gat\nGalaxy Admin Training (gat) tool:\n\n  gat status-ansible     [Admin] Check status of ansible training\n  gat status-galaxy      [Admin] Check status of ansible-galaxy training\n  gat status-cvmfs       [Admin] Check status of cvmfs training\n  gat status-pulsar      [Admin] Check status of pulsar training\n</code></pre></div></div>\n\n<p>Each of these commands run a couple checks on their local machine. For example the <code class=\"language-plaintext highlighter-rouge\">status-galaxy</code> command checks:</p>\n\n<ul>\n  <li>Check that the <code class=\"language-plaintext highlighter-rouge\">postgresql</code> service is running</li>\n  <li>Does a db named <code class=\"language-plaintext highlighter-rouge\">galaxy</code> exist</li>\n  <li>Does http://localhost:8080/api/version respond with <em>some</em> content</li>\n  <li>Check that the <code class=\"language-plaintext highlighter-rouge\">galaxy</code> service is running</li>\n  <li>Check that the <code class=\"language-plaintext highlighter-rouge\">nginx</code> service is running</li>\n  <li>Does https://localhost:443/api/version respond with <em>some</em> content</li>\n</ul>\n\n<p>However, the <code class=\"language-plaintext highlighter-rouge\">gat</code> command is only available on the VMs, so we’ve written an ansible task (wrapped in the Makefile) which SSHs into every machine, and runs the gat command for you:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>$ make check-galaxy-eu\ngat-19    postgres ✘ ✘ galaxy(http) ✘ SysD-gxy ✘ SysD-nginx ✘ galaxy(ssl) ✘\ngat-22    postgres ✔ ✘ galaxy(http) ✘ SysD-gxy ✘ SysD-nginx ✘ galaxy(ssl) ✘\ngat-2     postgres ✔ ✔ galaxy(http) ✔ SysD-gxy ✘ SysD-nginx ✘ galaxy(ssl) ✘\ngat-15    postgres ✔ ✘ galaxy(http) ✘ SysD-gxy ✘ SysD-nginx ✘ galaxy(ssl) ✘\ngat-24    postgres ✔ ✘ galaxy(http) ✘ SysD-gxy ✘ SysD-nginx ✘ galaxy(ssl) ✘\ngat-6     postgres ✘ ✘ galaxy(http) ✘ SysD-gxy ✘ SysD-nginx ✘ galaxy(ssl) ✘\n</code></pre></div></div>\n\n<p>You can see a checkmark reported for every step completed by students, giving you a nice overview of how many students have completed each step, and if you’re ready to move on. Additionally you know precisely which students you should reach out to check in with, if they aren’t progressing. The <code class=\"language-plaintext highlighter-rouge\">-eu</code> again refers to the specific pool of machines, and if you’re using a different hosts file, with different group names, you may need to edit the Makefile accordingly.</p>\n\n<p>There are other <code class=\"language-plaintext highlighter-rouge\">make check-</code> commands for each of the <code class=\"language-plaintext highlighter-rouge\">gat</code> status commands. Run <code class=\"language-plaintext highlighter-rouge\">make</code> to list all of them.</p>\n\n<h1 id=\"after-your-training\">After Your Training</h1>\n\n<p>Once your training is concluded, go through the questions students have asked in the Google Doc, and consider contributing them back to the training materials with Tips and Question boxes covering these student questions. Here is <a href=\"https://github.com/galaxyproject/training-material/pull/1922\">an example pull request</a> when we did this after BCC2020.</p>\n\n<h1 id=\"conclusion\">Conclusion</h1>\n\n"],"ref_slides":[],"hands_on":true,"slides":false,"mod_date":"2023-11-03 14:30:27 +0000","pub_date":"2020-11-04 23:36:15 +0000","version":4,"api":"https://training.galaxyproject.org/training-material/api/topics/teaching/tutorials/galaxy-admin-training/tutorial.json","tools":[],"supported_servers":[],"topic_name_human":"Teaching and Hosting Galaxy training","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools: []\n","tours":false,"video":false,"slides_recordings":false,"translations":{"tutorial":[],"slides":[],"video":false},"license":"CC-BY-4.0","type":"tutorial"}