{"layout":"tutorial_slides","title":"Functionally Assembled Terrestrial Ecosystem Simulator (FATES)","zenodo_link":"https://doi.org/10.5281/zenodo.4108341","requirements":[{"type":"internal","topic_name":"climate","tutorials":["introduction"]}],"questions":["What is FATES?","How can I use FATES?"],"objectives":["Have an understanding of what FATES is and how it works"],"time_estimation":"30m","tags":["climate","ecology"],"key_points":["FATES is a numerical terrestrial ecosystem model used in climate models"],"contributors":["rosiealice","annefou"],"js_requirements":{"mathjax":null,"mermaid":false},"short_id":"S00036","url":"/topics/climate/tutorials/fates/slides.html","topic_name":"climate","tutorial_name":"fates","dir":"topics/climate/tutorials/fates","symlink":null,"id":"climate/fates","ref_tutorials":["<p>Terrestrial ecosystem models have been widely used to study the impact of climate changes on vegetation and terrestrial biogeochemical cycles in climate modelling community. They are also more and more applied in ecological studies to help ecologists to better understand the processes. But the technical challenges are still too high for most of the ecologists to use them. This practical aims at familiarizing you (especially ecologists) with running a terrestrial ecosystem model (i.e., CLM-FATES) at site-level in Galaxy and analyzing the model results.\nIt will also teach you on how to create Galaxy workflow for your site-level CLM-FATES simulations to make your research fully reproducible. We hope this tutorial will promote the use of CLM-FATES and other terrestrial ecosystem models by a broader community.</p>\n\n<blockquote class=\"agenda\">\n  <agenda-title></agenda-title>\n\n  <p>In this tutorial, we will cover:</p>\n\n<ol id=\"markdown-toc\">\n  <li><a href=\"#get-clm-fates-input-data\" id=\"markdown-toc-get-clm-fates-input-data\">Get CLM-FATES input data</a></li>\n  <li><a href=\"#setting-up-a-clm-fates-simulation\" id=\"markdown-toc-setting-up-a-clm-fates-simulation\">Setting up a CLM-FATES simulation</a></li>\n  <li><a href=\"#quick-visualization-with-panoply\" id=\"markdown-toc-quick-visualization-with-panoply\">Quick visualization with Panoply</a>    <ol>\n      <li><a href=\"#opening-up-panoply\" id=\"markdown-toc-opening-up-panoply\">Opening up Panoply</a></li>\n      <li><a href=\"#inspect-metadata\" id=\"markdown-toc-inspect-metadata\">Inspect metadata</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#using-galaxy-tools-for-analysing-your-clm-fates-simulation\" id=\"markdown-toc-using-galaxy-tools-for-analysing-your-clm-fates-simulation\">Using Galaxy tools for analysing your CLM-FATES simulation</a></li>\n  <li><a href=\"#convert-your-analysis-history-into-a-galaxy-workflow\" id=\"markdown-toc-convert-your-analysis-history-into-a-galaxy-workflow\">Convert your analysis history into a Galaxy workflow</a></li>\n  <li><a href=\"#change-your-clm-fates-case-and-rerun-your-workflow\" id=\"markdown-toc-change-your-clm-fates-case-and-rerun-your-workflow\">Change your CLM-FATES case and rerun your workflow</a></li>\n  <li><a href=\"#share-your-work\" id=\"markdown-toc-share-your-work\">Share your work</a></li>\n  <li><a href=\"#conclusion\" id=\"markdown-toc-conclusion\">Conclusion</a></li>\n</ol>\n\n</blockquote>\n\n<blockquote class=\"comment\">\n  <comment-title>Background</comment-title>\n\n  <p>FATES is the “Functionally Assembled Terrestrial Ecosystem Simulator”, which is a vegetation demographic model (<span class=\"citation\"><a href=\"#Fisher2017\">Fisher <i>et al.</i> 2017</a></span>).\nFATES needs what we call a “Host Land Model” (HLM) to run and in this tutorial\nwe will be using the <a href=\"http://www.cesm.ucar.edu/models/clm/\">Community Land Model</a>\nof the <a href=\"https://github.com/ESCOMP/CTSM\">Community Terrestrial Systems Model</a> (CLM-CTSM).\nFATES was derived from the CLM Ecosystem Demography model (CLM(ED)), which was documented in\n<span class=\"citation\"><a href=\"#Fisher2015\"><b>Taking off the training wheels: the properties of a dynamic vegetation model without climate envelopes, CLM4.5(ED)</b> 2015</a></span> and <span class=\"citation\"><a href=\"#Koven2020\">Koven <i>et al.</i> 2020</a></span>.\nAnd this technical note was first published as an appendix to <a href=\"https://pdfs.semanticscholar.org/396c/b9f172cb681421ed78325a2237bfb428eece.pdf\">that paper</a>.\nThe <a href=\"https://fates-docs.readthedocs.io/en/latest/index.html\">FATES documentation</a> will provide some more insight on FATES too.</p>\n\n</blockquote>\n\n<h1 id=\"get-clm-fates-input-data\">Get CLM-FATES input data</h1>\n\n<p>Preparing CLM-FATES input data is out of scope for this tutorial. We assume the input data tarball contains the following folders:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>atm   cpl   lnd   share\n</code></pre></div></div>\n\n<p>Each sub-folder will then contain all the necessary inputs for running your CLM-FATES case. For instance, ‘atm’ contains all the meteorological forcing data for running CLM-FATES. ‘lnd’ contains the data required to describe surface conditions (e.g., soil depth) for the model. More details about the model inputdata can be found in <a href=\"https://escomp.github.io/ctsm-docs/versions/master/html/tech_note/Ecosystem/CLM50_Tech_Note_Ecosystem.html#model-input-requirements\">CLM and FATES documentation</a>.\nFor the purpose of this tutorial, input data for a single point location (ALP1) on the Norwegian alpine tundra ecosystem (Latitude: 61.0243N, Longitude: 8.12343E, Elevation: 1208 m) has been prepared and is ready to use. This is a site included in the modelling platform developed under [EMERALD project] (https://www.mn.uio.no/geo/english/research/projects/emerald/). More details about the sites can be found in <span class=\"citation\"><a href=\"#Klanderud2015\">Klanderud <i>et al.</i> 2015</a></span> and  <span class=\"citation\"><a href=\"#Vandvik2020\">Vandvik <i>et al.</i> 2020</a></span></p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Data upload</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Create a new history for this tutorial. If you are not inspired, you can name it <em>fates</em>.</p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-creating-a-new-history\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-creating-a-new-history\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Creating a new history</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p>Click the <i class=\"fas fa-plus\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">new-history</span> icon at the top of the history panel:</p>   <p><img src=\"/training-material/shared/images/history_create_new.svg\" alt=\"UI for creating new history\" /></p>   <!-- the original drawing can be found here https://docs.google.com/drawings/d/1cCBrLAo4kDGic5QyB70rRiWJAKTenTU8STsKDaLcVU8/edit?usp=sharing --> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>\n      <p>Import the <a href=\"https://doi.org/10.5281/zenodo.4108341\">input data</a> and the <a href=\"https://doi.org/10.5281/zenodo.4126404\">restart dataset from Zenodo</a>\nor from the shared data library. Restart dataset will be used if you want to initialize the model from exisiting experiments rather than running the model from a cold start to shorten spin-up time needed for the model.</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>https://zenodo.org/record/4108341/files/inputdata_version2.0.0_ALP1.tar\nhttps://zenodo.org/record/4126404/files/CTSM_FATES-EMERALD_version2.0.0_ALP1_restart_2300-01-01.tar\n</code></pre></div>      </div>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-importing-via-links\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-importing-via-links\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Importing via links</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Copy the link location</li>   <li>     <p>Click <i class=\"fas fa-upload\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-upload</span> <strong>Upload Data</strong> at the top of the tool panel</p>   </li>   <li>Select <i class=\"fa fa-edit\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-wf-edit</span> <strong>Paste/Fetch Data</strong></li>   <li>     <p>Paste the link(s) into the text field</p>   </li>   <li>     <p>Press <strong>Start</strong></p>   </li>   <li><strong>Close</strong> the window</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-importing-data-from-a-data-library\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-importing-data-from-a-data-library\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Importing data from a data library</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p>As an alternative to uploading the data from a URL or your computer, the files may also have been made available from a <em>shared data library</em>:</p>   <ol>   <li>Go into <strong>Shared data</strong> (top panel) then <strong>Data libraries</strong></li>   <li>Navigate to  the correct folder as indicated by your instructor.     <ul>       <li>On most Galaxies tutorial data will be provided in a folder named <strong>GTN - Material –&gt; Topic Name -&gt; Tutorial Name</strong>.</li>     </ul>   </li>   <li>Select the desired files</li>   <li>Click on <strong>Add to History</strong> <i class=\"fas fa-caret-down\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-dropdown</span> near the top and select <strong>as Datasets</strong> from the dropdown menu</li>   <li>     <p>In the pop-up window, choose</p>     <ul>       <li><em>“Select history”</em>: the history you want to import the data to (or create a new one)</li>     </ul>   </li>   <li>Click on <strong>Import</strong></li> </ol> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>\n      <p>Check the datatype (for both files) is <strong>tar</strong></p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-changing-the-datatype\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-changing-the-datatype\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Changing the datatype</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Click on the <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>   <li>In the central panel, click <i class=\"fas fa-database\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-chart-select-data</span> <strong>Datatypes</strong> tab on the top</li>   <li>In the <i class=\"fas fa-database\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-chart-select-data</span> <strong>Assign Datatype</strong>, select <code class=\"language-plaintext highlighter-rouge\">datatypes</code> from “<em>New type</em>” dropdown     <ul>       <li>Tip: you can start typing the datatype into the field to filter the dropdown menu</li>     </ul>   </li>   <li>Click the <strong>Save</strong> button</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>\n      <p>Rename <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> datasets</p>\n      <ul>\n        <li>Dataset names are the full URL, but this is not very nice to work with, and can even give errors for some tools</li>\n        <li>It is good practice to change the dataset names to something more meaningful and without any special characters\n          <ul>\n            <li>E.g. by stripping off the beginning of the URL</li>\n          </ul>\n        </li>\n        <li>Example: rename <code class=\"language-plaintext highlighter-rouge\">https://zenodo.org/record/4108341/files/inputdata_version2.0.0_ALP1.tar</code> to <code class=\"language-plaintext highlighter-rouge\">inputdata_version2.0.0_ALP1.tar</code></li>\n        <li>Do the same for the other dataset</li>\n      </ul>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-renaming-a-dataset\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-renaming-a-dataset\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Renaming a dataset</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Click on the <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>   <li>In the central panel, change the <strong>Name</strong> field</li>   <li>Click the <strong>Save</strong> button</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h1 id=\"setting-up-a-clm-fates-simulation\">Setting up a CLM-FATES simulation</h1>\n\n<p>We will be using the CTSM/FATES-EMERALD Galaxy tool.This tool is based on the version of <a href=\"https://github.com/NordicESMhub/ctsm/tree/fates_emerald_api\">CLM-FATES</a> that have been adapted to run at the sites included in the EMERALD project. More details about this model version can be found in <a href=\"https://github.com/NordicESMhub/ctsm/blob/fates_emerald_api/README_fates_emerald_api\">README_fates_emerald_api</a></p>\n\n<blockquote class=\"comment\">\n  <comment-title>Tip: Finding your tool</comment-title>\n\n  <p>Different Galaxy servers may have tools available under different sections, therefore it is often useful to use the <strong>search bar</strong> at the top of the tool panel to find your tool.</p>\n\n  <p>Additionally different servers may have multiple, similarly named tools which accomplish similar functions. When following tutorials, you should use precisely the tools that they describe. For real analyses, however, you will need to search among the various options to find the one that works for you.</p>\n\n</blockquote>\n\n<blockquote class=\"comment\">\n  <comment-title>Tip: Pre-selected tool parameters</comment-title>\n\n  <p>When selecting a tool, Galaxy will pre-fill the tool parameters, selecting the first dataset with the corresponding type in your history.\nBe aware that very often, the default pre-selection is incorrect and do not correspond to the required dataset.\nSo always check and update accordingly the tool parameters!</p>\n\n</blockquote>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Creating a new CTSM/FATES-EMERALD case</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/climate/ctsm_fates/ctsm_fates/2.0.1\" title=\"CTSM/FATES-EMERALD tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>CTSM/FATES-EMERALD</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 2.0.1)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“inputdata for running FATES EMERALD”</em>: <code class=\"language-plaintext highlighter-rouge\">inputdata_version2.0.0_ALP1.tar</code> file from your history</li>\n        <li><em>“Name of your case”</em>: ALP1_exp</li>\n        <li>In section <em>“Customize the model run period”</em>:\n          <ul>\n            <li><i class=\"fas fa-filter\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-select</span> <em>“Determines the model run initialization type:</em>: <code class=\"language-plaintext highlighter-rouge\">hybrid</code>\n              <ul>\n                <li><em>“Reference case for hybrid or branch runs”</em>: <code class=\"language-plaintext highlighter-rouge\">ALP1_refcase</code></li>\n                <li><em>“Reference date for hybrid or branch runs (yyyy-mm-dd)”</em>: <code class=\"language-plaintext highlighter-rouge\">2300-01-01</code></li>\n                <li><em>“Run start date (yyyy-mm-dd). Only used for startup or hybrid runs”</em>: <code class=\"language-plaintext highlighter-rouge\">0001-01-01</code></li>\n                <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Restart for running FATES EMERALD”</em>: <code class=\"language-plaintext highlighter-rouge\">CTSM_FATES-EMERALD_version2.0.0_ALP1_restart_2300-01-01.tar</code></li>\n              </ul>\n            </li>\n            <li><em>“Provides a numerical count for STOP_OPTION”</em>: <code class=\"language-plaintext highlighter-rouge\">5</code></li>\n            <li><em>“Sets the run length along with STOP_N and STOP_DATE”</em>: <code class=\"language-plaintext highlighter-rouge\">nyears</code></li>\n          </ul>\n        </li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title>Startup versus Hybrid</comment-title>\n\n        <p>When using <strong>startup</strong>, the FATES model will start from some arbitrary baseline state that is not linked to any previous run.\nStartup runs are typically initialized using a start date of 0001-01-01 except if you change it (start date option).\nFor any scientific study, starting from an arbitraty baseline state implies you would need to run the model for a long period (between 100 and 200 years)\nbefore being able to use the model outputs. For this reason, we usually make a first simulation (spin-up) in <strong>startup</strong> mode and reuse this case as a baseline\nfor our scientific study. We then use <strong>hybrid</strong> type and give additional inputs (restart files) to our simulation case. It is then important to specify the dates\nof your restart files. This is what we do in this tutorial.</p>\n\n      </blockquote>\n    </li>\n    <li>Check that the datatype <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> of your outputs (history file) is <strong><a href=\"https://en.wikipedia.org/wiki/NetCDF\">netcdf</a></strong>\n      <ul>\n        <li>If this is not the case, please change the datatype now</li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title>About CLM-FATES history files</comment-title>\n        <p>All the CLM-FATES history files are organized in a collection.</p>\n\n      </blockquote>\n\n      <blockquote class=\"comment\">\n        <comment-title>About datatypes</comment-title>\n\n        <p>All the history files contain gridded data values written at specified times during the model run.\nDepending on the length of your simulation, you may have one or more history files that you can recognize from their names:\n<code class=\"language-plaintext highlighter-rouge\">ALP1_exp.clm2.h0.yyyy-mm-dd-sssss.nc</code> (for non-monthly history files).\nDatatypes are, by default, automatically guessed. Here, as the prefix is <code class=\"language-plaintext highlighter-rouge\">.nc</code>, the format is not always recognized as <code class=\"language-plaintext highlighter-rouge\">netcdf</code> files.\nTo cope with that, one can change the datatype manually, as shown below.</p>\n      </blockquote>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-changing-the-datatype-1\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-changing-the-datatype-1\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Changing the datatype</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Click on the <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>   <li>In the central panel, click <i class=\"fas fa-database\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-chart-select-data</span> <strong>Datatypes</strong> tab on the top</li>   <li>In the <i class=\"fas fa-database\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-chart-select-data</span> <strong>Assign Datatype</strong>, select <code class=\"language-plaintext highlighter-rouge\">datatypes</code> from “<em>New type</em>” dropdown     <ul>       <li>Tip: you can start typing the datatype into the field to filter the dropdown menu</li>     </ul>   </li>   <li>Click the <strong>Save</strong> button</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>\n      <p><strong>Rename</strong> <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> the output dataset (history file) to <code class=\"language-plaintext highlighter-rouge\">ALP1_exp.nc</code></p>\n\n      <p>Our FATES model has run for 5 years only, so we get a single output file. As previously, we recommend\nto rename all netCDF files so that they do not contain any special characters or dots (except for the file extension) or slashes. Some tools, in\nparticular Panoply, won’t be able to recognize your file if not named properly.</p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-renaming-a-dataset-1\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-renaming-a-dataset-1\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Renaming a dataset</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Click on the <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>   <li>In the central panel, change the <strong>Name</strong> field</li>   <li>Click the <strong>Save</strong> button</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/ecology/xarray_metadata_info/xarray_metadata_info/0.15.1\" title=\"NetCDF xarray Metadata Info tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>NetCDF xarray Metadata Info</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.15.1)</span>  to get metadata information for CLM-FATES netCDF outputs:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Netcdf file”</em>: <code class=\"language-plaintext highlighter-rouge\">ALP1_exp.nc</code></li>\n      </ul>\n    </li>\n    <li><strong>Inspect</strong> <i class=\"far fa-eye\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-eye</span> the generated output files\n      <ul>\n        <li>Identify which variables would provide you some insights about canopy transpiration.</li>\n      </ul>\n\n      <blockquote class=\"question\">\n        <question-title></question-title>\n\n        <ol>\n          <li>What are the short names of the relevant variables? Which one will you pick if you want a result in <strong>mm/s</strong>?</li>\n          <li>What are the dimensions of these variables?</li>\n        </ol>\n\n        <blockquote class=\"solution\">\n          <solution-title></solution-title>\n          <ol>\n            <li><strong>FCTR</strong> is the canopy transpiration in W/m^2 and <strong>QVEGT</strong> is in mm/s. Therefore, we would select the latter.</li>\n            <li>These variables are stored as a function of time and lndgrid and since we have only one grid cell, lngrid=1, hence the time series.</li>\n          </ol>\n        </blockquote>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h1 id=\"quick-visualization-with-panoply\">Quick visualization with Panoply</h1>\n\n<h2 id=\"opening-up-panoply\">Opening up Panoply</h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Launch Panoply</hands-on-title>\n\n  <p><a href=\"https://www.giss.nasa.gov/tools/panoply/\">Panoply</a> plots geo-referenced and other arrays from netCDF and is available as a Galaxy interactive environment and may not be available on all Galaxy servers.</p>\n\n  <blockquote class=\"tip\">\n    <tip-title>Only on UseGalaxy.eu</tip-title>\n    <p>Currently Panoply in Galaxy is available on useGalaxy.eu instance, on the “Interactive tools” tool panel section or,\nas all interactive tools, from the dedicated useGalaxy.eu subdomain: <a href=\"https://live.usegalaxy.eu\">live.useGalaxy.eu</a>.\nYou may have to login again to <a href=\"https://live.usegalaxy.eu\">live.usegalaxy.eu</a> (use the same username and password than on other useGalaxy.eu subdomains)\nand switch to the correct history.</p>\n\n    <p>You can access the tool by clicking <a href=\"https://live.usegalaxy.eu/?tool_id=interactive_tool_panoply\">here to launch it on EU</a></p>\n  </blockquote>\n\n  <ol>\n    <li>Open the <span class=\"tool\" data-tool=\"interactive_tool_panoply\" title=\"Panoply tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Panoply</strong></span></li>\n    <li>Check <strong>ALP1_exp.nc</strong> dataset selected in the netcdf input field</li>\n    <li>Click Run Tool</li>\n    <li>The tool will start running and will stay running permanently</li>\n    <li>Click on the “User” menu at the top and go to “Active Interactive Tools” and locate the Panoply instance you started.</li>\n    <li>Click on your Panoply instance\n      <figure id=\"figure-1\" style=\"max-width: 90%;\"><img src=\"../../images/select_dataset.png\" alt=\"Panoply dataset selection. \" width=\"1539\" height=\"715\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/select_dataset.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 1</strong>:</span> Select dataset</figcaption></figure>\n    </li>\n    <li>Click on <strong>ALP1_exp.nc</strong> dataset</li>\n  </ol>\n</blockquote>\n\n<h2 id=\"inspect-metadata\">Inspect metadata</h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Inspect dataset</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Inspect dataset content</p>\n\n      <p>Here you can look at the dataset (<code class=\"language-plaintext highlighter-rouge\">ALP1_exp.nc</code>) and related variables (FSDS, FSA, AREA_TREE, BIOMASS_CANOPY, etc.)</p>\n\n      <blockquote class=\"question\">\n        <question-title></question-title>\n\n        <ol>\n          <li>What is the long name of <strong>MORTALITY</strong>?</li>\n          <li>What is its physical unit?</li>\n        </ol>\n\n        <blockquote class=\"solution\">\n          <solution-title></solution-title>\n          <ol>\n            <li>Rate of total mortality per PFT (Plat functional types)</li>\n            <li>indiv/ha/yr</li>\n          </ol>\n        </blockquote>\n      </blockquote>\n    </li>\n    <li>\n      <p>Plot the total carbon in live plant leaves (<strong>LEAFC</strong>)</p>\n\n      <p>Cutomize your plot and save it as <strong>png</strong> file in the output folder. Remember that\nif you do not save in the output folder, your plot will get lost.</p>\n      <blockquote class=\"question\">\n        <question-title></question-title>\n        <ol>\n          <li>Can you observe any pattern? Does it make any sense?</li>\n        </ol>\n\n        <blockquote class=\"solution\">\n          <solution-title></solution-title>\n          <ol>\n            <li>We can clearly see a seasonal cycle.</li>\n          </ol>\n          <figure id=\"figure-2\" style=\"max-width: 90%;\"><img src=\"../../images/panoply_LEAFC_ALP1_exp.png\" alt=\"Panoply LEAFC timeseries. \" width=\"592\" height=\"336\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/panoply_LEAFC_ALP1_exp.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 2</strong>:</span> LEAFC</figcaption></figure>\n        </blockquote>\n      </blockquote>\n    </li>\n    <li>\n      <p>Plot the rate of total mortality per PFT (MORTALITY)</p>\n\n      <p>Select a 2D plot with time as x-axis and colored by the rate of total mortality per PFT (Plant functional type).\nMake sure to adjust the y-axis and save your plots in the output folder (as png file).</p>\n      <blockquote class=\"question\">\n        <question-title></question-title>\n        <ol>\n          <li>Can you observe any pattern? Does it make any sense?</li>\n        </ol>\n\n        <blockquote class=\"solution\">\n          <solution-title></solution-title>\n          <ol>\n            <li>We can clearly see a seasonal cycle of PFT2.</li>\n          </ol>\n          <figure id=\"figure-3\" style=\"max-width: 90%;\"><img src=\"../../images/panoply_MORTALITY_ALP1_exp.png\" alt=\"Panoply MORTALITY per PFT. \" width=\"592\" height=\"384\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/panoply_MORTALITY_ALP1_exp.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 3</strong>:</span> total mortality per PFT</figcaption></figure>\n        </blockquote>\n      </blockquote>\n\n      <blockquote class=\"comment\">\n        <comment-title>Quit Panoply properly to save your plots!</comment-title>\n\n        <p>To make sure all your plots stored in <strong>outputs</strong> folder  get exported to Galaxy, you need to quit panoply: <strong>File</strong> –&gt; <strong>Quit Panoply</strong>.</p>\n      </blockquote>\n    </li>\n  </ol>\n</blockquote>\n\n<h1 id=\"using-galaxy-tools-for-analysing-your-clm-fates-simulation\">Using Galaxy tools for analysing your CLM-FATES simulation</h1>\n\n<p>Panoply is a great tool for exploring the results of your simulations but what we would like is to automate the generation of the plots\nso that we can reuse it for any simulations.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Select and plot <b>LEAFC</b></hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/ecology/xarray_select/xarray_select/0.15.1\" title=\"NetCDF xarray Selection tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>NetCDF xarray Selection</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.15.1)</span> to select the total carbon in live plant leaves (<strong>LEAFC</strong>)\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Input netcdf file”</em>: ALP1_exp.nc</li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Tabular of variables”</em>: Metadata info from <code class=\"language-plaintext highlighter-rouge\">ALP1_exp.nc</code> (output of <strong>NetCDF xarray Metadata Info</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><i class=\"fas fa-filter\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-select</span> <em>“Choose the variable to extract”</em>: <code class=\"language-plaintext highlighter-rouge\">LEAFC</code></li>\n      </ul>\n    </li>\n    <li>\n      <p><strong>Rename</strong> <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> dataset to <code class=\"language-plaintext highlighter-rouge\">NetCDF xarray Selection on ALP1_exp.nc</code></p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-renaming-a-dataset-2\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-renaming-a-dataset-2\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Renaming a dataset</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Click on the <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>   <li>In the central panel, change the <strong>Name</strong> field</li>   <li>Click the <strong>Save</strong> button</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_find_and_replace/1.1.3\" title=\"Replace parts of text  tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Replace parts of text </strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.1.3)</span> to clean date column for plotting:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“File to process”</em>: NetCDF xarray Selection on ALP1_exp.nc</li>\n        <li><i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-text</span> <em>“Find pattern”</em>: <code class=\"language-plaintext highlighter-rouge\">00:00:00</code></li>\n        <li><em>“Find-Pattern is a regular expression”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n        <li><em>“Replace all occurences of the pattern”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n        <li><em>“Case-Insensitive search”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n        <li><em>“Find whole-words”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n        <li><em>“Ignore first line”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n        <li><i class=\"fas fa-filter\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-select</span> <em>“Find and Replace text in”</em>: <code class=\"language-plaintext highlighter-rouge\">entire line</code></li>\n      </ul>\n    </li>\n    <li>\n      <p><strong>Rename</strong> <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> dataset to <code class=\"language-plaintext highlighter-rouge\">LEAFC_clean.tabular</code></p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-renaming-a-dataset-3\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-renaming-a-dataset-3\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Renaming a dataset</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Click on the <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>   <li>In the central panel, change the <strong>Name</strong> field</li>   <li>Click the <strong>Save</strong> button</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li><strong>Scatterplot w ggplot2</strong>  <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> to plot the total carbon in live plant leaves (<strong>LEAFC</strong>):\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Input in tabular format”</em>: <code class=\"language-plaintext highlighter-rouge\">LEAFC_clean.tabular</code></li>\n        <li><em>“Column to plot on x-axis”</em>: 1</li>\n        <li><em>“Column to plot on y-axis”</em>: 4</li>\n        <li><em>“Plot title”</em>: <code class=\"language-plaintext highlighter-rouge\">Total carbon in live plant leaves</code></li>\n        <li><em>“Label for x axis”</em>: <code class=\"language-plaintext highlighter-rouge\">Time</code></li>\n        <li><em>“Label for y axis”</em>: <code class=\"language-plaintext highlighter-rouge\">LEAFC (kgC ha-1)</code></li>\n        <li>In <code class=\"language-plaintext highlighter-rouge\">Advanced Options</code>\n          <ul>\n            <li><i class=\"fas fa-filter\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-select</span> <em>“Type of plot”</em>: <code class=\"language-plaintext highlighter-rouge\">Points and Lines</code></li>\n          </ul>\n        </li>\n        <li>In <code class=\"language-plaintext highlighter-rouge\">Output options</code>\n          <ul>\n            <li><em>“width of output”</em>:<code class=\"language-plaintext highlighter-rouge\">19.0</code></li>\n            <li><em>“height of output”</em>: <code class=\"language-plaintext highlighter-rouge\">5.0</code></li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li>\n      <p><strong>View</strong> <i class=\"far fa-eye\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-eye</span> the resulting plot:</p>\n\n      <p><a href=\"../../images/LEAFC_ALP1_exp_ggplot.png\" rel=\"noopener noreferrer\"><img src=\"../../images/LEAFC_ALP1_exp_ggplot.png\" alt=\"Snapshot of LEAFC resulting plot. \" width=\"5700\" height=\"1500\" loading=\"lazy\" /></a></p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h1 id=\"convert-your-analysis-history-into-a-galaxy-workflow\">Convert your analysis history into a Galaxy workflow</h1>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Extract workflow</hands-on-title>\n\n  <ol>\n    <li>Go to the <strong>History Options menu</strong>  <i class=\"fas fa-cog\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-gear</span> menu\n      <ul>\n        <li>Select the <strong>Extract Workflow</strong> option.</li>\n        <li>Remove any unwanted steps, in particular all steps with Panoply as we do not want to have interactive tools in our automated workflow..</li>\n      </ul>\n    </li>\n    <li><strong>Rename</strong> the workflow to something descriptive\n      <ul>\n        <li>For example: <code class=\"language-plaintext highlighter-rouge\">CLM-FATES_ ALP1 simulation (5 years)</code>.</li>\n        <li>If there are any steps that shouldn’t be included in the workflow, you can <strong>uncheck</strong> them.</li>\n      </ul>\n    </li>\n    <li>Click “Create Workflow”\n      <ul>\n        <li>Click on “edit” and check your workflow</li>\n        <li>Check all the steps</li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h1 id=\"change-your-clm-fates-case-and-rerun-your-workflow\">Change your CLM-FATES case and rerun your workflow</h1>\n\n<p>We would like to run a CLM-FATES case where the atmospheric Carbon Dioxyde Concentration (CO2) is increased by a factor of 4.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Compare the two simulations</hands-on-title>\n\n  <p>Using the results from your two CLM-FATES simulations and the generated plots, assess the impact\n of an increase in the atmosperhic CO2 on the outputs of the model.</p>\n\n  <ol>\n    <li>\n      <p>Open the <strong>workflow editor</strong></p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-opening-the-workflow-editor\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-opening-the-workflow-editor\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Opening the workflow editor</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ol>   <li>In the top menu bar, click on <strong>Workflows</strong></li>   <li>Click on the name of the workflow you want to edit <img src=\"/training-material/topics/galaxy-interface/images/edit_workflow.png\" alt=\"Workflow drop down menu showing Edit option\" title=\"When you click on the name of a workflow it will open a drop down menu whose first option is Edit. Select the Edit option to edit the workflow.\" /></li>   <li>Select <i class=\"fa fa-edit\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-wf-edit</span> <strong>Edit</strong> from the dropdown menu to open the workflow in the workflow editor</li> </ol> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>\n      <p>Edit your workflow and customize it to run your new CO2 experiment. For this you would need to:</p>\n      <ul>\n        <li>In “Advanced customization”, change “Atmospheric CO2 molar ratio (by volume) only used when co2_type==constant (umol/mol)” from 367.0 to 1468.0.</li>\n        <li>Add an extra step to extract the first history file from the history collection: <span class=\"tool\" data-tool=\"__EXTRACT_DATASET__\" title=\"Extract Dataset tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Extract Dataset</strong></span>\nand make sure to select “netcdf” in the change datatype field.</li>\n        <li>Generate the corresponding plot.\nThe final workflow would be similar to the one shown below:</li>\n      </ul>\n\n      <figure id=\"figure-4\" style=\"max-width: 90%;\"><img src=\"../../images/fates_workflow.png\" alt=\"Snapshot of FATES workflow. \" width=\"1185\" height=\"491\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/fates_workflow.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 4</strong>:</span> FATES workflow</figcaption></figure>\n\n      <blockquote class=\"question\">\n        <question-title></question-title>\n        <ol>\n          <li>Is the model response to this significant increase of atmospheric CO2 what you expected?\n  Justify your answer.</li>\n          <li>Is the current workflow (in particular the variables selected for the plots) the best choice?\n  What changes/additions would you recommend?</li>\n        </ol>\n\n        <blockquote class=\"solution\">\n          <solution-title></solution-title>\n          <ol>\n            <li>Running 5 years is already sufficient to highlight significant changes.\n<a href=\"../../images/LEAFC_ALP1_4CO2_ggplot.png\" rel=\"noopener noreferrer\"><img src=\"../../images/LEAFC_ALP1_4CO2_ggplot.png\" alt=\"LEAFC 4xCO2. \" width=\"5700\" height=\"1500\" loading=\"lazy\" /></a></li>\n            <li>Many suggestions can be given here. One simple addition can be the generation of plots where\nboth simulations are represented on the same plot.</li>\n          </ol>\n        </blockquote>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h1 id=\"share-your-work\">Share your work</h1>\n\n<p>One of the most important features of Galaxy comes at the end of an analysis. When you have published striking findings, it is important that other researchers are able to reproduce your in-silico experiment. Galaxy enables users to easily share their workflows and histories with others.</p>\n\n<!--SNIPPET-->\n<blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-sharing-your-history\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-sharing-your-history\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Sharing your History</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p>Sharing your history allows others to import and access the datasets, parameters, and steps of your history.</p>   <p>Access the history sharing menu via the History Options dropdown (<i class=\"fas fa-bars\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-history-options</span>), and clicking “<i class=\"fas fa-share-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">history-share</span> Share or Publish”</p>   <ol>   <li><strong>Share via link</strong>     <ul>       <li>Open the <strong>History Options</strong> <i class=\"fas fa-bars\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-history-options</span> menu at the top of your history panel and select “<i class=\"fas fa-share-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">history-share</span> Share or Publish”         <ul>           <li><i class=\"fas fa-toggle-on\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-toggle</span> <strong>Make History accessible</strong></li>           <li>A <strong>Share Link</strong> will appear that you give to others</li>         </ul>       </li>       <li>Anybody who has this link can view and copy your history</li>     </ul>   </li>   <li><strong>Publish your history</strong>     <ul>       <li><i class=\"fas fa-toggle-on\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-toggle</span> <strong>Make History publicly available in Published Histories</strong></li>       <li>Anybody on this Galaxy server will see your history listed under the <em>Shared Data</em> menu</li>     </ul>   </li>   <li><strong>Share only with another user</strong>.     <ul>       <li>Click the <strong>Share with a user</strong> button at the bottom</li>       <li>Enter an email address for the user you want to share with</li>       <li>Your history will be shared only with this user.</li>     </ul>   </li>   <li><strong>Finding histories others have shared with me</strong>     <ul>       <li>Click on <strong>User</strong> menu on the top bar</li>       <li>Select <strong>Histories shared with me</strong></li>       <li>Here you will see all the histories others have shared with you directly</li>     </ul>   </li> </ol>   <p><strong>Note:</strong> If you want to make changes to your history without affecting the shared version, make a copy by going to <strong>History Options</strong> <i class=\"fas fa-bars\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-history-options</span> icon in your history and clicking <em>Copy this History</em></p> </blockquote>\n<p><!--END_SNIPPET--></p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Share history</hands-on-title>\n\n  <ol>\n    <li>Share your history with your neighbour (ask for his/her galaxy username).</li>\n    <li>Find the history shared by your neighbour. Histories shared with specific users can be accessed by those users under their top masthead “User” menu under <code class=\"language-plaintext highlighter-rouge\">Histories shared with me</code>.</li>\n  </ol>\n</blockquote>\n\n<blockquote class=\"comment\">\n  <comment-title>Publish your history to https://workflowhub.eu/</comment-title>\n  <p>One step further is to share your workflow on <a href=\"https://workflowhub.eu\">https://workflowhub.eu</a> where it\nwill be stored in a Galaxy workflow format as well as in <a href=\"https://www.commonwl.org/\">Common Workflow Language</a>.\nIt provides standardised workflow identifiers and descriptions needed for workflow discovery, reuse, preservation, interoperability and monitoring and metadata harvesting using standard protocols.\nPlease note that <a href=\"https://workflowhub.eu\">https://workflowhub.eu</a> is still under active development.</p>\n</blockquote>\n\n<h1 id=\"conclusion\">Conclusion</h1>\n\n<p>We have learnt to run single-point simulations with FATES-CLM and generate workflows for multi-site scenarios.</p>\n"],"ref_slides":["## Evolution of land surface models\n\n![Evolution of land surface models](../../images/lsm_evolution.png)\n\n*reference*: Fisher R.A. & Koven C.D.  JAMES, 2020\n\n???\n\n- Land Surface Models have significantly evolved through time.\n- For instance, representations of numerous processes that are known to impact the dynamics of systems have been incrementally added to Land Surface Models.\n- They have been expanded from their initial simple biophysical configurations.\n- This includes representations of soil moisture dynamics, stomatal functioning, land surface heterogeneity and surface hydrological processes.\n- And plant and soil carbon cycling, dynamic vegetation distributions, fire, urban environments, land cover and management, nitrogen cycling and crops.\n- and latterly plant demographic processes, phosphorus cycling, and plant hydraulics.\n\n---\n\n## Evolution of land surface models\n\n![Global Carbon budget](../../images/lsm_evolution_cb.png)\n\n*reference*: Fisher R.A. & Koven C.D.  JAMES, 2020\n\n???\n\n- The global carbon budget averaged over the last half-century is shown on this figure.\n- For this time period, 82 percent of the total emissions were caused by fossil CO2 emissions and 18 percent by land use change.\n- The total emissions were partitioned among the atmosphere (45 perceent), ocean (24 percent), and land (29 percent), with an unattributed budget imbalance (2 percent).\n- All components except land use change emissions have significantly grown since 1959.\n\n---\n\n## Evolution of land surface models\n\n![Climate feedback](../../images/lsm_evolution_climate_feedback.png)\n\n*reference*: Fisher R.A. & Koven C.D.  JAMES, 2020\n\n???\n\n-  The processes that govern carbon cycle feedbacks are highly affected by both biophysical feedbacks in the Earth system and by land use decisions that are in turn affected by climate impacts on human societies.\n\n---\n\n![Surface processes](../../images/surface_processes.png)\n\nSurface processes play a key role in **extreme events** (heat waves, fires, crop failures, floods, droughts).\n\n???\n\n- Surface processes play a key role in extreme events, such as heat waves, fires, crop failures, floods, droughts.\n\n---\n\n## Evolution of land surface models\n\n![Climate impact](../../images/lsm_evolution_climate_impacts.png)\n\n*reference*: Fisher R.A. & Koven C.D.  JAMES, 2020\n\n???\n\n- Climate change impacts such as drought and fire are mediated by plant biophysical responses to elevated CO2, which are themselves impacted by limitations imposed by nutrient limitations on growth.\n\n---\n\n## Problems with the status quo\n\n\n![Status quo](../../images/lsm_status_quo.png)\n\n1. Perpetual increase in complexity\n\n???\n\n- Developing Land Surface Models by adding complexity in already complex codes is not manageable anymore.\n- To face this perpetual increase in complexity, the community needs to better organize code developments.\n\n\n---\n\n## Land surface modelling in the world\n\n![LSM teams](../../images/lsm_teams.png)\n\n???\n\n- One major issue is that there are few Land Surface Models code developers.\n- And Land surface modeling teams are typically not large enough to be able to tackle all of the interacting processes in a modern Land Surface Model.\n- A wider collaborative approach is required.\n\n---\n## Problems with the status quo\n\n\n![Status quo](../../images/lsm_status_quo.png)\n\n1. Perpetual increase in complexity\n2. Sub-critical development efforts\n3. Over-simplified representation of ecosystems\n\n\n???\n\n- So to summarize, we have 3 major problems to solve:\n- First, the perpetual increase in complexity.\n- Second, the sub-critical development efforts.\n- Third, the over-simplified representation of ecosystems.\n\n---\n\n## Ecological processes in land surface models\n\n\n![Ecological processes](../../images/ecological_processes.png)\n\n???\n\n- On this slide, we show 3 different ways to represent ecological processes in Land Surface Models:\n- On the left, we have the Big Leaf Model which is the kind of default Land Surface Model used in Climate models.\n- Big Leaf models are over simplified and the different types of vegetation do not compete with each other for light or resources.\n- The forst tree community has been typically using a complete opposite approach with Stochastic individual models where you model individual trees with specific location and space.\n- Stochastic aspect comes from the fact that the location of the trees are random and where the plants die is semi-random.\n- These models are great but very expensive.\n- So the cohort model is a compromize between the two approaches.\n\n---\n\n## Solutions\n\n![Status quo](../../images/lsm_status_quo.png)\n\n1. Perpetual increase in complexity\n    - Complexity management\n2. Sub-critical development efforts\n    - Open-source community development\n3. Over-simplified representation of ecosystems\n    - Balanced ecological realism\n\n???\n\n- To develop these kind of models and achieve our final goal which is to improve climate models and better assess the impact of climate changes on our societies, we need:\n- to find a way to manage the complexity of the codes by using a modular approach.\n- make all our development open source and available to all the community.\n- To make compromize and balance ecological realism.\n\n---\n# What is FATES?\n\nFATES stands for the **Functionally Assembled Terrestrial Ecosystem Simulator** and\nis a module with fully **open-source** development:\n\n![FATES](../../images/FATES_NGEET.png)\n\n???\n\n- FATES stands for the Functionally Assembled Terrestrial Ecosystem Simulator.\n- It is fully open source.\n\n---\n\n## FATES open-source\n\n- Available on GitHub: [https://github.com/NGEET/fates](https://github.com/NGEET/fates)\n\n\nIt is designed to operate in a **\"host\"** land surface model, which simulates:\n- plant physiology,\n- competitive processes,\n- ecosystem assembly\nand\n- vegetation distribution\n\n???\n\n- It is available on github.\n- It is designed to operate with a host land surface model.\n- FATES simulates plant physiology, competitive processes, ecosystem assembly and vegetation distribution.\n\n---\n\n## Cohort model\n\n![Concept of Cohort model](../../images/cohort_concept.png)\n\n*reference*: Benchmarking and parameter sensitivity of physiological and vegetation dynamics using the Functionally Assembled Terrestrial Ecosystem Simulator (FATES) at Barro Colorado Island, Panama\nCharles D. Koven et al., 2020.\n\n???\n\n- With FATES, trees have a height and compete for light.\n\n---\n\n## Balanced ecological realism\n\nWhat are the advances allowed by a demographic model?\n\n- Representation of light competition & ecosystem assembly.\n- Prediction of the distribution of plants based on their **functional traits**.\n- **Lags** between climate and vegetation change and growth after **disturbances**.\n- Better representation of **physiological processes** (hydraulics, fire, nutrients).\n\n\n![Ecological realism](../../images/ecological_realism.png)\n\n\n???\n\n- The following advances are enabled with a demongraphic model:\n- A better representation of light competition and ecosystem assembly.\n- The prediction of the distribution of plants based on their functional traits.\n- The lags between climate and vegetation change and growth after disturbances.\n- The better representation of physiological processes such as hydraulics, fire and nutrients.\n\n---\n\n![development](../../images/FATES_development.png)\n\n???\n\n- On this slide, we show how the code developments are taking place.\n- The approach is modular and each component can be developed separately.\n- This approach significantly speed-up developments.\n---\n\n![development cluster](../../images/FATES_development_cluster.png)\n\n???\n\n- Thanks to this modular approach, new groups joined our community and contribute to develop new modules.\n\n---\n\n# Open source, community development\n\n**Growth in participation in FATES**\n\n![FATES community](../../images/FATES_community.png)\n\n???\n\n- Many new developments have been added to FATES and we see an increasing number of developers contributing to the code.\n\n---\n# FATES development\n- About 39 funded researchers.\n- 6 countries, 26+ institutions.\n- 130 participants at the recent planning meeting.\n- 3 Earth System Modelling Centres.\n- More than 11 proposal funded (2020). Many more ongoing.\n\n???\n\n- There are about 39 funded researchers working on the FATES code.\n- These developers are spread in about 6 different countries and more than 26 different institutions.\n- We had more than 130 participants at the recent planning meeting in 2020.\n- About 3 Earth Systemo Modelling Centres are using FATES.\n- And more than 11 proposal funded in 2020 for further developing FATES.\n\n---\n\n# Code complexity management\n\n- Modular complexity: a strategy to manage the proliferation of processes\n\n![FATES code complexity](../../images/FATES_code_complexity.png)\n\n**Reference**: Fisher R.A. & Koven C.D.  “Perspectives on the Future of Land Surface Models and the Challenges of Representing Complex Terrestrial Systems” AGU Perspective article. JAMES, 2020\n\n???\n\n- The code is fully modular and easy to update.\n\n---\n\n## FATES reduced complexity modes\n\n![FATES reduced complexity](../../images/FATES_reduced_complexity.png)\n\n???\n\n- To help code developers, a number of reduced complexity modes were made available.\n\n---\n\n# But that's not all...\n\nFATES (in common with all land surface models that are part of ESMs) remains technically challenging to run.\n- Scripting environment is complicated.\n- Porting model to a new supercomputer is incredibly hard.\n- Running at single sites or regions is more cumbersome than running globally.\n- Tools developed on one platform often do not work on another.\n- Workflows are complicated by computing architecture.\n\n???\n\n- However, we know that more needs to be done for simplifying the usage of FATES and reduce the learning curve.\n- Running FATES remains technically challenging.\n- The scripting environment is complicated,\n- porting the model to new platforms can be incredibly hard,\n- running at single sites or regions is more cumbersome than running the code globally,\n- and workflows are complicated to put in place.\n\n---\n\n# But that's not all...\n\n**Interesting science** is at the interface of the input parameters, model processes and emergent outcomes.\n\n![Learning curve](../../images/FATES_learning_curve.png)\n\n\n**Reference**: Eva Lieungh, Sonya Geange, Hui Tang\n\n???\n\n- Interesting science is at the interface of the input parameters, model processes and emergent outcomes.\n- We know it takes a very long time for a new researcher to run successfully a simple FATES test simulation. In general it takes several months and it is very frustating.\n- However, once researchers manage to run FATES, they usually can contribute and improve the model.\n- FATES in Galaxy aims at reducing the learning curve and help researchers to quickly produce scientific results.\n---\n\n# How can I use FATES in Galaxy?\n\n- With CLM-FATES [Galaxy tool](https://usegalaxy.eu/root?tool_id=toolshed.g2.bx.psu.edu/repos/climate/ctsm_fates/ctsm_fates/2.0.1) for running operational and long simulations.\n- [Galaxy climate JupyterLab](https://live.usegalaxy.eu/?tool_id=interactive_tool_climate_notebook)\n  for learning, developing the model, setting up simulations and visualizing results.\n\n???\n\n- There are two ways to run CLM-FATES in Galaxy and we suggest new users to start with the FATES Galaxy Tool.\n- For more advanced users and if you are willing to develop the FATES model, use the Galaxy Climate JupyterLab where you can develop new features, set up simple test simulations and visualize your results.\n- The Galaxy FATES tool can then be used to run operational and long simulations.\n\n"],"video_library":{"tutorial":{"description":"This tutorial will walk you through a Galaxy analysis step by step","materials":[{"link":"topics/climate/tutorials/fates/tutorial.html","title":"Functionally Assembled Terrestrial Ecosystem Simulator (FATES)","type":"Tutorial"}],"tags":["climate"],"type":"Tutorial","versions":[{"captions":["s3by01"],"date":"2021-02-15","galaxy_version":"21.01","length":"1H20M","link":"0LsEx11eLiI","speakers":["annefou"]}],"gtn_id":"climate/fates","title":"Functionally Assembled Terrestrial Ecosystem Simulator (FATES)","captioned":true},"slides":{"description":"This lecture provides a brief overview of FATES","materials":[{"link":"topics/climate/tutorials/fates/slides.html","title":"Functionally Assembled Terrestrial Ecosystem Simulator (FATES)","type":"Slides"}],"tags":["climate"],"type":"Lecture","versions":[{"captions":["annefou"],"date":"2021-02-15","galaxy_version":"21.01","length":"7M","link":"Z57C7MQG95s","speakers":["awspolly"]}],"gtn_id":"climate/fates","title":"Functionally Assembled Terrestrial Ecosystem Simulator (FATES)","captioned":true},"demo":null,"both":null,"session":{"title":"Functionally Assembled Terrestrial Ecosystem Simulator (FATES)","description":"This session will provide a brief overview of FATES, and guide you through a Galaxy analysis step by step.","videos":["climate/fates/slides","climate/fates/tutorial"]}},"hands_on":true,"slides":true,"mod_date":"2023-12-04 11:46:43 +0000","pub_date":"2020-10-25 21:05:55 +0000","version":73,"workflows":[{"workflow":"CLM-FATES_ALP1_simulation_5years.ga","tests":false,"url":"https://training.galaxyproject.org/training-material/topics/climate/tutorials/fates/workflows/CLM-FATES_ALP1_simulation_5years.ga","path":"topics/climate/tutorials/fates/workflows/CLM-FATES_ALP1_simulation_5years.ga","wfid":"climate-fates","wfname":"clm-fates_alp1_simulation_5years","trs_endpoint":"https://training.galaxyproject.org/training-material/api/ga4gh/trs/v2/tools/climate-fates/versions/clm-fates_alp1_simulation_5years","license":"Apache-2.0","creators":[{"class":"Person","identifier":"https://orcid.org/0000-0002-1784-2920","name":"Anne Fouilloux"}],"name":"CLM-FATES_ ALP1 simulation (5 years)","title":"CLM-FATES_ ALP1 simulation (5 years)","test_results":null,"modified":"2024-06-14 00:15:02 +0000","mermaid":"flowchart TD\n  0[\"ℹ️ Input Dataset\\nInput dataset for CLM-FATES\"];\n  style 0 stroke:#2c3143,stroke-width:4px;\n  1[\"ℹ️ Input Dataset\\nCLM-FATES restart file\"];\n  style 1 stroke:#2c3143,stroke-width:4px;\n  2[\"CTSM/FATES-EMERALD\"];\n  1 -->|output| 2;\n  0 -->|output| 2;\n  3[\"Extract Dataset\"];\n  2 -->|history_files| 3;\n  debf2e31-dbea-46d5-8644-586c9731cdbe[\"Output\\ninput dataset(s) (extracted element)\"];\n  3 --> debf2e31-dbea-46d5-8644-586c9731cdbe;\n  style debf2e31-dbea-46d5-8644-586c9731cdbe stroke:#2c3143,stroke-width:4px;\n  4[\"NetCDF xarray Metadata Info\"];\n  3 -->|output| 4;\n  5[\"NetCDF xarray Selection\"];\n  3 -->|output| 5;\n  4 -->|output| 5;\n  6[\"Replace\"];\n  5 -->|simpleoutput| 6;\n  7[\"Scatterplot with ggplot2\"];\n  6 -->|outfile| 7;"}],"api":"https://training.galaxyproject.org/training-material/api/topics/climate/tutorials/fates/tutorial.json","tools":["__EXTRACT_DATASET__","interactive_tool_panoply","toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_find_and_replace/1.1.3","toolshed.g2.bx.psu.edu/repos/climate/ctsm_fates/ctsm_fates/2.0.1","toolshed.g2.bx.psu.edu/repos/ecology/xarray_metadata_info/xarray_metadata_info/0.15.1","toolshed.g2.bx.psu.edu/repos/ecology/xarray_select/xarray_select/0.15.1","toolshed.g2.bx.psu.edu/repos/iuc/ggplot2_point/ggplot2_point/2.2.1+galaxy2"],"supported_servers":{"exact":[{"url":"https://usegalaxy.eu","name":"UseGalaxy.eu","usegalaxy":true},{"url":"https://usegalaxy.org","name":"UseGalaxy.org (Main)","usegalaxy":true}],"inexact":[]},"topic_name_human":"Climate","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[{"name":"text_processing","owner":"bgruening","revisions":"f46f0e4f75c4","tool_panel_section_label":"Text Manipulation","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"ctsm_fates","owner":"climate","revisions":"b525b88bc941","tool_panel_section_label":"Climate Analysis","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"xarray_metadata_info","owner":"ecology","revisions":"e8650cdf092f","tool_panel_section_label":"GIS Data Handling","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"xarray_select","owner":"ecology","revisions":"6baac361495b","tool_panel_section_label":"GIS Data Handling","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"ggplot2_point","owner":"iuc","revisions":"e3a675da7fd0","tool_panel_section_label":"Graph/Display Data","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"}]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools:\n- name: text_processing\n  owner: bgruening\n  revisions: f46f0e4f75c4\n  tool_panel_section_label: Text Manipulation\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: ctsm_fates\n  owner: climate\n  revisions: b525b88bc941\n  tool_panel_section_label: Climate Analysis\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: xarray_metadata_info\n  owner: ecology\n  revisions: e8650cdf092f\n  tool_panel_section_label: GIS Data Handling\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: xarray_select\n  owner: ecology\n  revisions: 6baac361495b\n  tool_panel_section_label: GIS Data Handling\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: ggplot2_point\n  owner: iuc\n  revisions: e3a675da7fd0\n  tool_panel_section_label: Graph/Display Data\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n","tours":false,"video":true,"translations":{"tutorial":[],"slides":[],"video":true},"license":"CC-BY-4.0","type":"tutorial","logo":"GTN","redirect_from":["/short/climate/fates/slides","/short/S00036"]}