{"layout":"tutorial_hands_on","title":"Calling variants in non-diploid systems","subtopic":"introduction","zenodo_link":"https://doi.org/10.5281/zenodo.1251112","tags":["prokaryote","microgalaxy"],"questions":["How does frequency of mitochondrial polymorphisms change from mother to child?"],"objectives":["Using Galaxy's main site we will see how to call variants in bacteria, viruses, and organelles."],"time_estimation":"1h30m","key_points":["Variation in human mitochondria is a proxy for other haploid systems.","Nucleotide variants in haploid systems may have any frequency between 0 and 1.","Distinguishing true variants from noise is not easy and requires accounting <br> for strand bias and read placement bias.","FreeBayes can be effectively used to call variants in haploid systems."],"contributors":[{"name":"Anton Nekrutenko","email":"anton@nekrut.org","joined":"2017-09","id":"nekrut","url":"https://training.galaxyproject.org/training-material/api/contributors/nekrut.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/nekrut/"},{"name":"Alex Ostrovsky","email":"a.ostrovsky@mac.com","orcid":"0000-0002-7901-7109","joined":"2019-06","id":"astrovsky01","url":"https://training.galaxyproject.org/training-material/api/contributors/astrovsky01.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/astrovsky01/"}],"edam_ontology":["topic_0622","topic_0196","topic_2885","topic_3301","topic_0080","topic_0199"],"js_requirements":{"mathjax":null,"mermaid":false},"short_id":"T00314","url":"/topics/variant-analysis/tutorials/non-dip/tutorial.html","topic_name":"variant-analysis","tutorial_name":"non-dip","dir":"topics/variant-analysis/tutorials/non-dip","symlink":null,"id":"variant-analysis/non-dip","ref_tutorials":["<p>The majority of life on Earth is non-diploid and represented by prokaryotes, viruses, and their derivatives, such as our own mitochondria or plant’s chloroplasts. In non-diploid systems, allele frequencies can range anywhere between 0 and 100% and there could be multiple (not just two) alleles per locus. The main challenge associated with non-diploid variant calling is the difficulty in distinguishing between the sequencing noise (abundant in all NGS platforms) and true low frequency variants. Some of the early attempts to do this well have been accomplished on human mitochondrial DNA although the same approaches will work equally good on viral and bacterial genomes (<span class=\"citation\"><a href=\"#Rebolledo-Jaramillo2014\">Rebolledo-Jaramillo <i>et al.</i> 2014</a></span>, <span class=\"citation\"><a href=\"#Li2015\">Li <i>et al.</i> 2015</a></span>).</p>\n\n<p>As an example of non-diploid systems, we will be using human mitochondrial genome. However, this approach will also work for most bacterial and viral genomes.</p>\n\n<p>There are two ways one can call variants:</p>\n\n<ol>\n  <li>By comparing reads against an existing genome assembly</li>\n  <li>By assembling a genome first and then mapping against that assembly</li>\n</ol>\n\n<figure id=\"figure-1\" style=\"max-width: 90%;\"><img src=\"../../images/ref_vs_assembly.jpg\" alt=\"2 approaches. \" width=\"622\" height=\"831\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/ref_vs_assembly.jpg\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 1</strong>:</span> This figure from <span class=\"citation\"><a href=\"#Olson2015\">Olson <i>et al.</i> 2015</a></span> contrasts the two approaches.</figcaption></figure>\n\n<p>In this tutorial we will take the <em>first</em> path, in which we map reads against an existing assembly. Later in the course, after we learn about assembly approaches, we will try the second approach as well.</p>\n\n<p>The goal of this example is to detect heteroplasmies - variants within mitochondrial DNA. Mitochondria are transmitted maternally, and heteroplasmy frequencies may change dramatically and unpredictably during the transmission due to a germ-line bottleneck (<span class=\"citation\"><a href=\"#Cree2008\">Cree <i>et al.</i> 2008</a></span>). As we mentioned above, the procedure for finding variants in bacterial or viral genomes will be essentially the same.</p>\n\n<p>Datasets representing a child and a mother are available in <a href=\"https://doi.org/10.5281/zenodo.1251112\">Zenodo</a>. These datasets were obtained by paired-end Illumina sequencing of human genomic DNA enriched for mitochondria. The enrichment was performed using long-range PCR with two primer pairs that amplify the entire mitochondrial genome. Samples will therefore still contain a lot of DNA from the nuclear genome, which, in this case, is a contaminant.</p>\n\n<blockquote class=\"agenda\">\n  <agenda-title></agenda-title>\n\n  <p>In this tutorial, we will cover:</p>\n\n<ol id=\"markdown-toc\">\n  <li><a href=\"#importing-data\" id=\"markdown-toc-importing-data\">Importing data</a>    <ol>\n      <li><a href=\"#checking-data-quality\" id=\"markdown-toc-checking-data-quality\">Checking data quality</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#mapping-reads-to-a-reference\" id=\"markdown-toc-mapping-reads-to-a-reference\">Mapping reads to a reference</a></li>\n  <li><a href=\"#postprocessing-mapped-reads\" id=\"markdown-toc-postprocessing-mapped-reads\">Postprocessing mapped reads</a>    <ol>\n      <li><a href=\"#merging-bam-datasets\" id=\"markdown-toc-merging-bam-datasets\">Merging BAM datasets</a></li>\n      <li><a href=\"#removing-duplicates\" id=\"markdown-toc-removing-duplicates\">Removing duplicates</a></li>\n      <li><a href=\"#left-aligning-indels\" id=\"markdown-toc-left-aligning-indels\">Left-aligning indels</a></li>\n      <li><a href=\"#filtering-reads\" id=\"markdown-toc-filtering-reads\">Filtering reads</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#calling-non-diploid-variants\" id=\"markdown-toc-calling-non-diploid-variants\">Calling non-diploid variants</a>    <ol>\n      <li><a href=\"#filtering-variants\" id=\"markdown-toc-filtering-variants\">Filtering variants</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#examining-the-results\" id=\"markdown-toc-examining-the-results\">Examining the results</a>    <ol>\n      <li><a href=\"#visualising-with-vcfiobio\" id=\"markdown-toc-visualising-with-vcfiobio\">Visualising with VCF.IOBIO</a></li>\n      <li><a href=\"#visualising-with-igv\" id=\"markdown-toc-visualising-with-igv\">Visualising with IGV</a></li>\n      <li><a href=\"#comparing-frequencies\" id=\"markdown-toc-comparing-frequencies\">Comparing frequencies</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#conclusion\" id=\"markdown-toc-conclusion\">Conclusion</a></li>\n</ol>\n\n</blockquote>\n\n<h1 id=\"importing-data\">Importing data</h1>\n\n<p>For this tutorial we have prepared a subset of data previously by our group (<span class=\"citation\"><a href=\"#Rebolledo-Jaramillo2014\">Rebolledo-Jaramillo <i>et al.</i> 2014</a></span>). Let’s import these data into Galaxy. They are available from <a href=\"https://usegalaxy.org/library/folders/Fe4842bd0c37b03a7\">this Galaxy Library</a> or via <a href=\"https://zenodo.org/record/582600\">Zenodo</a></p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Get the data</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Create a new history for this tutorial and give it a meaningful name</p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-creating-a-new-history\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-creating-a-new-history\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Creating a new history</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p>Click the <i class=\"fas fa-plus\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">new-history</span> icon at the top of the history panel:</p>   <p><img src=\"/training-material/shared/images/history_create_new.svg\" alt=\"UI for creating new history\" /></p>   <!-- the original drawing can be found here https://docs.google.com/drawings/d/1cCBrLAo4kDGic5QyB70rRiWJAKTenTU8STsKDaLcVU8/edit?usp=sharing --> </blockquote>\n      <p><!--END_SNIPPET--></p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-renaming-a-history\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-renaming-a-history\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Renaming a history</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ol>   <li>Click on <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> (<strong>Edit</strong>) next to the history name (which by default is “Unnamed history”)</li>   <li>Type the new name</li>   <li>Click on <strong>Save</strong></li> </ol>   <p>If you do not have the <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> (<strong>Edit</strong>) next to the history name:</p>   <ol>   <li>Click on <strong>Unnamed history</strong> (or the current name of the history) (<strong>Click to rename history</strong>) at the top of your history panel</li>   <li>Type the new name</li>   <li>Press <kbd>Enter</kbd></li> </ol> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>\n      <p>Import files from <a href=\"https://zenodo.org/record/1251112\">Zenodo</a>:</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>https://zenodo.org/record/1251112/files/raw_child-ds-1.fq\nhttps://zenodo.org/record/1251112/files/raw_child-ds-2.fq\nhttps://zenodo.org/record/1251112/files/raw_mother-ds-1.fq\nhttps://zenodo.org/record/1251112/files/raw_mother-ds-2.fq\n</code></pre></div>      </div>\n    </li>\n    <li>\n      <p>Check that all newly created datasets in your history are assigned datatype\n<code class=\"language-plaintext highlighter-rouge\">fastqsanger</code>, and fix any missing or wrong datatype assignment</p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-changing-the-datatype\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-changing-the-datatype\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Changing the datatype</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Click on the <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>   <li>In the central panel, click <i class=\"fas fa-database\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-chart-select-data</span> <strong>Datatypes</strong> tab on the top</li>   <li>In the <i class=\"fas fa-database\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-chart-select-data</span> <strong>Assign Datatype</strong>, select <code class=\"language-plaintext highlighter-rouge\">fastqsanger</code> from “<em>New type</em>” dropdown     <ul>       <li>Tip: you can start typing the datatype into the field to filter the dropdown menu</li>     </ul>   </li>   <li>Click the <strong>Save</strong> button</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h2 id=\"checking-data-quality\">Checking data quality</h2>\n\n<p>Before proceeding with the analysis, we need to find out how good the data actually is. For this will use <a href=\"https://www.bioinformatics.babraham.ac.uk/projects/fastqc/\">FastQC</a>.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Assess quality of data</hands-on-title>\n\n  <ol>\n    <li>Run <span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/devteam/fastqc/fastqc/0.72+galaxy1\" title=\"FastQC tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>FastQC</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.72+galaxy1)</span> on each of the four FASTQ datasets with the following parameters:\n      <ul>\n        <li><i class=\"far fa-copy\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-files</span> <em>“Short read data from your current history”</em>: all 4 FASTQ datasets selected with <strong>Multiple datasets</strong></li>\n      </ul>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-select-multiple-datasets\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-select-multiple-datasets\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Select multiple datasets</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ol>   <li>Click on <i class=\"far fa-copy\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-files</span> <strong>Multiple datasets</strong></li>   <li>Select several files by keeping the <kbd>Ctrl</kbd> (or <kbd>COMMAND</kbd>) key pressed and clicking on the files of interest</li> </ol> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>Once the FastQC jobs runs, you will be able to look at the HTML reports generated by this tool. The data have generally high quality in this example:</p>\n\n<figure id=\"figure-2\" style=\"max-width: 90%;\"><img src=\"../../images/mt_qc_plot.png\" alt=\"FastQC output plot. \" width=\"870\" height=\"600\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/mt_qc_plot.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 2</strong>:</span> FastQC plot for one of the mitochondrial datasets shows that qualities are acceptable for 250 bp reads (mostly in the green, which is at or above [Phred score](https://en.wikipedia.org/wiki/Phred_quality_score) of 30).</figcaption></figure>\n\n<h1 id=\"mapping-reads-to-a-reference\">Mapping reads to a reference</h1>\n\n<p>Our reads are long (250 bp) so we will use BWA-MEM (<span class=\"citation\"><a href=\"#Li2013\">Li 2013</a></span>) to align them against the reference genome as it has good mapping performance for longer reads (100bp and up).</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Map reads</hands-on-title>\n\n  <ol>\n    <li>Use <span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/devteam/bwa/bwa_mem/0.7.17.1\" title=\"Map with BWA-MEM tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Map with BWA-MEM</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.7.17.1)</span> to map the reads to the reference genome with the following parameters:\n      <ul>\n        <li><em>“Will you select a reference genome from your history or use a built-in index?”</em>: <code class=\"language-plaintext highlighter-rouge\">Use a built-in genome index</code>\n          <ul>\n            <li><em>“Using reference genome”</em>: <code class=\"language-plaintext highlighter-rouge\">Human: hg38</code> (or a similarly named option)</li>\n          </ul>\n        </li>\n        <li><em>“Single or Paired-end reads”</em>: <code class=\"language-plaintext highlighter-rouge\">Paired</code>\n          <ul>\n            <li><i class=\"far fa-copy\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-files</span> <em>“Select first set of reads”</em>: select both <code class=\"language-plaintext highlighter-rouge\">-1</code> datasets selected with <strong>Multiple datasets</strong></li>\n            <li><i class=\"far fa-copy\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-files</span> <em>“Select second set of reads”</em>: select both <code class=\"language-plaintext highlighter-rouge\">-2</code> datasets selected with <strong>Multiple datasets</strong></li>\n          </ul>\n        </li>\n        <li><em>“Set read groups information?”</em>: <code class=\"language-plaintext highlighter-rouge\">Set read groups (SAM/BAM specification)</code>\n          <ul>\n            <li><em>“Auto-assign”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n            <li><em>“Auto-assign”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n            <li><em>“Platform/technology used to produce the reads (PL)”</em>: <code class=\"language-plaintext highlighter-rouge\">ILLUMINA</code></li>\n            <li><em>“Auto-assign”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"comment\">\n  <comment-title>More about selecting datasets</comment-title>\n\n  <p>By selecting datasets 1 and 3 as <strong>Select the first set of reads</strong> and datasets 2 and 4 as <strong>Select the second set of reads</strong>, Galaxy will automatically launch two BWA-MEM jobs using datasets 1,2 and 3,4 generating two resulting BAM files.\nBy setting <strong>Set read groups information</strong> to <code class=\"language-plaintext highlighter-rouge\">Set read groups (SAM/BAM specifications)</code> and clicking <strong>Auto-assign</strong> we will ensure that the reads in the resulting BAM dataset are properly set.</p>\n</blockquote>\n\n<h1 id=\"postprocessing-mapped-reads\">Postprocessing mapped reads</h1>\n\n<h2 id=\"merging-bam-datasets\">Merging BAM datasets</h2>\n\n<p>Because we have set read groups, we can now merge the two BAM dataset into one. This is because read groups label each read as belonging to either <em>mother</em> or <em>child</em>.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Merge multiple datasets into one</hands-on-title>\n\n  <ol>\n    <li>Use <span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/devteam/picard/picard_MergeSamFiles/2.18.2.1\" title=\"MergeSAMFiles tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>MergeSAMFiles</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 2.18.2.1)</span> to merge the BAM datasets with the following parameters:\n      <ul>\n        <li><i class=\"far fa-copy\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-files</span> <em>“Select SAM/BAM dataset or dataset collection”</em>: select both BAM datasets produced by <strong>BWA-MEM</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span></li>\n        <li><em>“Select validation stringency”</em>: <code class=\"language-plaintext highlighter-rouge\">Lenient</code></li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h2 id=\"removing-duplicates\">Removing duplicates</h2>\n\n<p>Preparation of sequencing libraries (at least at the time of writing) for technologies such as Illumina (used in this example) involves PCR amplification. It is required to generate sufficient number of sequencing templates so that a reliable detection can be performed by base callers. PCR has its own biases which are especially profound in cases of multi-template PCR used for construction of sequencing libraries (<span class=\"citation\"><a href=\"#Kanagawa2003\">Kanagawa 2003</a></span>).</p>\n\n<p>Duplicates can be identified based on their outer alignment coordinates or using sequence-based clustering. One of the common ways for identification of duplicate reads is the <strong>MarkDuplicates</strong> utility from <a href=\"https://broadinstitute.github.io/picard/command-line-overview.html\">Picard</a> package which is designed to identify both PCR and optical duplicates.</p>\n\n<blockquote class=\"details\">\n  <details-title>More about MarkDuplicates</details-title>\n\n  <p>Duplicates are identified as read pairs having identical 5’ positions (coordinate and strand) for both reads in a mate pair (and optionally, matching unique molecular identifier reads; see <code class=\"language-plaintext highlighter-rouge\">BARCODE_TAG</code> option). Optical, or more broadly sequencing, duplicates are duplicates that appear clustered together spatially during sequencing and can arise from optical/imagine-processing artifacts or from biochemical processes during clonal amplification and sequencing; they are identified using the <code class=\"language-plaintext highlighter-rouge\">READ_NAME_REGEX</code> and the <code class=\"language-plaintext highlighter-rouge\">OPTICAL_DUPLICATE_PIXEL_DISTANCE</code> options. The tool’s main output is a new SAM or BAM file in which duplicates have been identified in the SAM flags field, or optionally removed (see <code class=\"language-plaintext highlighter-rouge\">REMOVE_DUPLICATE</code> and <code class=\"language-plaintext highlighter-rouge\">REMOVE_SEQUENCING_DUPLICATES</code>), and optionally marked with a duplicate type in the ‘DT’ optional attribute. In addition, it also outputs a metrics file containing the numbers of <code class=\"language-plaintext highlighter-rouge\">READ_PAIRS_EXAMINED</code>, <code class=\"language-plaintext highlighter-rouge\">SECONDARY_OR_SUPPLEMENTARY_RDS</code>, <code class=\"language-plaintext highlighter-rouge\">UNMAPPED_READS</code>, <code class=\"language-plaintext highlighter-rouge\">UNPAIRED_READS</code>, <code class=\"language-plaintext highlighter-rouge\">UNPAIRED_READ DUPLICATES</code>, <code class=\"language-plaintext highlighter-rouge\">READ_PAIR_DUPLICATES</code>, and <code class=\"language-plaintext highlighter-rouge\">READ_PAIR_OPTICAL_DUPLICATES</code>.</p>\n\n  <p>Usage example: <code class=\"language-plaintext highlighter-rouge\">java -jar picard.jar MarkDuplicates I=input.bam O=marked_duplicates.bam M=marked_dup_metrics.txt</code></p>\n</blockquote>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>De-duplicate mapped data</hands-on-title>\n\n  <ol>\n    <li>Use <span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/devteam/picard/picard_MarkDuplicates/2.18.2.2\" title=\"MarkDuplicates tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>MarkDuplicates</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 2.18.2.2)</span> to de-duplicate the merged BAM datasets with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select SAM/BAM dataset or dataset collection”</em>: select the merged BAM dataset produced by <strong>MergeSAMFiles</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span></li>\n        <li><em>“The scoring strategy for choosing the non-duplicate among candidates”</em>: <code class=\"language-plaintext highlighter-rouge\">SUM_OF_BASE_QUALITIES</code></li>\n        <li><em>“The maximum offset between two duplicate clusters in order to consider them optical duplicates”</em>: <code class=\"language-plaintext highlighter-rouge\">100</code></li>\n        <li><em>“Select validation stringency”</em>: <code class=\"language-plaintext highlighter-rouge\">Lenient</code></li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>MarkDuplicates produces a BAM dataset with duplicates removed and also a metrics file. Let’s take a look at the metrics data:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>raw_child-ds-\t55\t27551\t849\t55\t50\t1658\t1\t0.06103\t219750\nraw_mother-ds-\t95\t54973\t1951\t95\t89\t4712\t2\t0.08645\t302188\n</code></pre></div></div>\n\n<p>Column headers are:</p>\n\n<ul>\n  <li>LIBRARY (read group in our case)</li>\n  <li>UNPAIRED_READS_EXAMINED</li>\n  <li>READ_PAIRS_EXAMINED-</li>\n  <li>SECONDARY_OR_SUPPLEMENTARY_RDS</li>\n  <li>UNMAPPED_READS</li>\n  <li>UNPAIRED_READ_DUPLICATES</li>\n  <li>READ_PAIR_DUPLICATES</li>\n  <li>READ_PAIR_OPTICAL_DUPLICATES</li>\n  <li>PERCENT_DUPLICATION</li>\n  <li>ESTIMATED_LIBRARY_SIZE</li>\n</ul>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <ol>\n    <li>What percent of read duplication are found in each read group (child and mother)?</li>\n  </ol>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <ol>\n      <li>The two datasets have ~6% and ~9% duplicates for child and mother, respectively.</li>\n    </ol>\n\n  </blockquote>\n</blockquote>\n\n<h2 id=\"left-aligning-indels\">Left-aligning indels</h2>\n\n<p>Left aligning of indels (a variant of re-aligning) is extremely important for obtaining accurate variant calls. For illustrating how left-aligning works, we expanded on an example provided by <span class=\"citation\"><a href=\"#Tan2015\">Tan <i>et al.</i> 2015</a></span>. Suppose you have a reference sequence and a sequencing read:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>Reference GGGCACACACAGGG\nRead      GGGCACACAGGG\n</code></pre></div></div>\n\n<p>If you look carefully you will see that the read is simply missing a <code class=\"language-plaintext highlighter-rouge\">CA</code> repeat. But it is not apparent to a mapper, so some of possible alignments and corresponding variant calls include:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>Alignment                 Variant Call\n\nGGGCACACACAGGG            Ref: CAC\nGGGCAC--ACAGGG            Alt: C\n\nGGGCACACACAGGG            Ref: ACA\nGGGCA--CACAGGG            Alt: A\n\nGGGCACACACAGGG            Ref: GCA\nGGG--CACACAGGG            Alt: G\n</code></pre></div></div>\n\n<p>The last of these is <em>left-aligned</em>. In this case gaps (represented by dashes) are moved as far left as possible. For a formal definition of left-alignment and variant normalization, see <span class=\"citation\"><a href=\"#Tan2015\">Tan <i>et al.</i> 2015</a></span>.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Left-align indels</hands-on-title>\n\n  <ol>\n    <li>Use <span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/devteam/freebayes/bamleftalign/1.3.1\" title=\"BamLeftAlign tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>BamLeftAlign</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.3.1)</span> to perform left alignment with the following parameters:\n      <ul>\n        <li><em>“Choose the source for the reference genome”</em>: <code class=\"language-plaintext highlighter-rouge\">Locally cached</code></li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select alignment file in BAM format”</em>: select the BAM dataset produced by <strong>MarkDuplicates</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span></li>\n        <li><em>“Using reference genome”</em>: <code class=\"language-plaintext highlighter-rouge\">hg38</code></li>\n        <li><em>“Maximum number of iterations’</em>: <code class=\"language-plaintext highlighter-rouge\">5</code></li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h2 id=\"filtering-reads\">Filtering reads</h2>\n\n<p>Remember that we are trying to call variants in mitochondrial genome. Let focus only on the reads derived from mitochondria genome by filtering everything else out.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Filter BAM data</hands-on-title>\n\n  <ol>\n    <li>Use <span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/devteam/bamtools_filter/bamFilter/2.4.1\" title=\"Filter BAM datasets on a variety of attributes tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Filter BAM datasets on a variety of attributes</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 2.4.1)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“BAM dataset(s) to filter”</em>: select the BAM dataset produced by <strong>BamLeftAlign</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span></li>\n        <li>In <em>“Condition”</em>:\n          <ul>\n            <li>In <em>“1: Condition”</em>:\n              <ul>\n                <li>In <em>“Filter”</em>:\n                  <ul>\n                    <li>In <em>“1: Filter”</em>:\n                      <ul>\n                        <li><em>“Select BAM property to filter on”</em>: <code class=\"language-plaintext highlighter-rouge\">mapQuality</code></li>\n                        <li><em>“Filter on read mapping quality (phred scale)”</em>: <code class=\"language-plaintext highlighter-rouge\">&gt;=20</code></li>\n                      </ul>\n                    </li>\n                    <li>In <em>“2: Filter”</em>:\n                      <ul>\n                        <li><em>“Select BAM property to filter on”</em>: <code class=\"language-plaintext highlighter-rouge\">isPaired</code></li>\n                        <li><em>“Selected mapped reads”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n                      </ul>\n                    </li>\n                    <li>Click on <em>“Insert Filter”</em></li>\n                    <li>In <em>“3: Filter”</em>:\n                      <ul>\n                        <li><em>“Select BAM property to filter on”</em>: <code class=\"language-plaintext highlighter-rouge\">isProperPair</code></li>\n                        <li><em>“Select reads with mapped mate”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n                      </ul>\n                    </li>\n                    <li>Click on <em>“Insert Filter”</em></li>\n                    <li>In <em>“4: Filter”</em>:\n                      <ul>\n                        <li><em>“Select BAM property to filter on”</em>: <code class=\"language-plaintext highlighter-rouge\">reference</code></li>\n                        <li><em>“Select reads with mapped mate”</em>: <code class=\"language-plaintext highlighter-rouge\">chrM</code></li>\n                      </ul>\n                    </li>\n                  </ul>\n                </li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title>Filtering reads</comment-title>\n        <p>Further explanation of the filters used:</p>\n        <ul>\n          <li><em>mapQuality</em> is set to ≥20. Mapping quality reflects the probability that the read is placed incorrectly using <a href=\"https://en.wikipedia.org/wiki/Phred_quality_score\">phred scale</a>. Thus 20 is 1/100 or 1% chance that the read is incorrectly mapped. By setting this parameter to ≥20, we will keep all reads that have 1% or less probability of being mapped incorrectly.</li>\n          <li><em>isPaired</em> will eliminate singleton (unpaired) reads.</li>\n          <li><em>isProperPair</em> will only keep reads that map to the same chromosome and are properly placed.</li>\n          <li><em>reference</em> is set to the mitochondrial chromosome, chrM.</li>\n        </ul>\n      </blockquote>\n    </li>\n  </ol>\n</blockquote>\n\n<h1 id=\"calling-non-diploid-variants\">Calling non-diploid variants</h1>\n\n<p>FreeBayes is widely used for calling variants in diploid systems. However, it can also be used for calling variants in pooled samples where the number of samples is not known. This is the exact scenario we have here: in our sample we have multiple mitochondrial (or bacterial or viral) genomes, but we do not know exactly how many. Thus we will use the <code class=\"language-plaintext highlighter-rouge\">--pooled-continuous</code> option of FreeBayes to generate frequency-based variant calls as well as some other options highlighted below.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Calling variants</hands-on-title>\n\n  <ol>\n    <li>Use <span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/devteam/freebayes/freebayes/1.3.1\" title=\"FreeBayes tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>FreeBayes</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.3.1)</span> to call variants with the following parameters:\n      <ul>\n        <li><em>“Choose the source for the reference genome”</em>: <code class=\"language-plaintext highlighter-rouge\">Locally cached</code></li>\n        <li><em>“Run in batch mode?”</em>: <code class=\"language-plaintext highlighter-rouge\">Run individually</code></li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“BAM dataset”</em>: select the BAM dataset produced by last <strong>Filter</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> step</li>\n        <li><em>“Using reference genome”</em>: <code class=\"language-plaintext highlighter-rouge\">hg38</code></li>\n        <li><em>“Limit variant calling to a set of regions?”</em>: <code class=\"language-plaintext highlighter-rouge\">Limit to region</code>\n          <ul>\n            <li><em>“Region Chromosome”</em>: <code class=\"language-plaintext highlighter-rouge\">chrM</code></li>\n            <li><em>“Region Start”</em>: <code class=\"language-plaintext highlighter-rouge\">1</code></li>\n            <li><em>“Region End”</em>: <code class=\"language-plaintext highlighter-rouge\">16000</code></li>\n          </ul>\n        </li>\n        <li><em>“Choose parameter selection level”</em>: <code class=\"language-plaintext highlighter-rouge\">5: Full list of options</code>\n          <ul>\n            <li><em>“Population model options”</em>: <code class=\"language-plaintext highlighter-rouge\">Set population model options</code>\n              <ul>\n                <li><em>“The expected mutation rate or pairwise nucleotide diversity among the population under analysis”</em>: <code class=\"language-plaintext highlighter-rouge\">0.001</code></li>\n                <li><em>“Set ploidy for the analysis”</em>: <code class=\"language-plaintext highlighter-rouge\">1</code></li>\n                <li><em>“Assume that samples result from pooled sequencing”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n                <li><em>“Output all alleles which pass input filters, regardless of genotyping outcome or model”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title>Population model options</comment-title>\n        <p>The “Population model options” are one of the most important parameter choices to make when calling variants in non-diploid systems.</p>\n      </blockquote>\n\n      <ul>\n        <li><em>“Allelic scope options”</em>: <code class=\"language-plaintext highlighter-rouge\">Set allelic scope options</code>\n          <ul>\n            <li><em>“Ignore SNP alleles”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n            <li><em>“Ignore indels alleles”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n            <li><em>“Ignore multi-nucleotide polymorphisms, MNPs”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n            <li><em>“Ignore complex events (composites of other classes)”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n          </ul>\n        </li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title>Allelic scope options</comment-title>\n        <p>Mitochondria has a number of low complexity regions (mononucleotide repeats). Setting the allelic scope parameters as described above will decrease noise from these regions.</p>\n      </blockquote>\n\n      <ul>\n        <li><em>“Input filters”</em>: <code class=\"language-plaintext highlighter-rouge\">Set input filters</code>\n          <ul>\n            <li><em>“Exclude alignments from analysis if they have a mapping quality less than”</em>: <code class=\"language-plaintext highlighter-rouge\">20</code></li>\n            <li><em>“Exclude alleles from analysis if their supporting base quality less than”</em>: <code class=\"language-plaintext highlighter-rouge\">30</code></li>\n          </ul>\n        </li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title>Filter options</comment-title>\n        <p>Setting <em>Exclude alignments from analysis if they have a mapping quality less than</em> to <code class=\"language-plaintext highlighter-rouge\">20</code> (phred score of 20) will make FreeBayes only consider reliably aligned reads.\nSetting <em>Exclude alleles from analysis if their supporting base quality less than</em> to <code class=\"language-plaintext highlighter-rouge\">30</code> (phred score of 30) will make FreeBayes only consider high quality bases.</p>\n      </blockquote>\n    </li>\n  </ol>\n</blockquote>\n\n<p>FreeBayes will produce a <a href=\"https://samtools.github.io/hts-specs/VCFv4.2.pdf\">VCF</a> dataset similar to what is shown below (you may need to scroll sideways to see it in full). It lists 25 sites of interest. For brevity, the header lines have been removed:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>#CHROM\tPOS\tID\tREF\tALT\tQUAL\tFILTER\tINFO\tFORMAT\traw_child-ds-\traw_mother-ds-\nchrM\t73\t.\tA\tG\t30438.6\t.\tAB=0;ABP=0;AC=2;AF=1;AN=2;AO=949;CIGAR=1X;DP=950;DPB=950;DPRA=0;EPP=144.879;EPPR=5.18177;GTI=0;LEN=1;MEANALT=1;MQM=55.8314;MQMR=60;NS=2;NUMALT=1;ODDS=2187.64;PAIRED=1;PAIREDR=1;PAO=0;PQA=0;PQR=0;PRO=0;QA=34948;QR=37;RO=1;RPL=322;RPP=215.867;RPPR=5.18177;RPR=627;RUN=1;SAF=421;SAP=29.2075;SAR=528;SRF=0;SRP=5.18177;SRR=1;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t1:226:0,226:0:0:226:8314:-739.462,0\t1:724:1,723:1:37:723:26634:-2346.86,0\nchrM\t263\t.\tA\tG\t11603.3\t.\tAB=0;ABP=0;AC=2;AF=1;AN=2;AO=364;CIGAR=1X;DP=364;DPB=364;DPRA=0;EPP=16.755;EPPR=0;GTI=0;LEN=1;MEANALT=1;MQM=60;MQMR=0;NS=2;NUMALT=1;ODDS=982.556;PAIRED=1;PAIREDR=0;PAO=0;PQA=0;PQR=0;PRO=0;QA=13201;QR=0;RO=0;RPL=276;RPP=213.858;RPPR=0;RPR=88;RUN=1;SAF=172;SAP=5.39653;SAR=192;SRF=0;SRP=0;SRR=0;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t1:108:0,108:0:0:108:3896:-350.812,0\t1:256:0,256:0:0:256:9305:-837.344,0\nchrM\t310\t.\tTCC\tCCC\t4471\t.\tAB=0;ABP=0;AC=2;AF=1;AN=2;AO=150;CIGAR=1X2M;DP=171;DPB=180.333;DPRA=0;EPP=7.70068;EPPR=4.45795;GTI=0;LEN=1;MEANALT=2.5;MQM=59.88;MQMR=60;NS=2;NUMALT=1;ODDS=407.373;PAIRED=1;PAIREDR=1;PAO=11;PQA=237;PQR=0;PRO=0;QA=5147;QR=194;RO=6;RPL=113;RPP=86.6265;RPPR=8.80089;RPR=37;RUN=1;SAF=35;SAP=95.6598;SAR=115;SRF=1;SRP=8.80089;SRR=5;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t1:54:0,49:0:0:49:1645:-150.867,0\t1:117:6,101:6:194:101:3502:-315.963,0\nchrM\t513\t.\tGCACACACACAC\tGCACACACACACAC\t2095.84\t.\tAB=0;ABP=0;AC=2;AF=1;AN=2;AO=109;CIGAR=1M2I11M;DP=150;DPB=172.167;DPRA=0;EPP=109.173;EPPR=6.05036;GTI=0;LEN=2;MEANALT=3.5;MQM=60;MQMR=60;NS=2;NUMALT=1;ODDS=225.991;PAIRED=1;PAIREDR=1;PAO=5;PQA=101.5;PQR=101.5;PRO=5;QA=3824;QR=1196;RO=35;RPL=19;RPP=103.436;RPPR=4.56135;RPR=90;RUN=1;SAF=80;SAP=54.8268;SAR=29;SRF=24;SRP=13.4954;SRR=11;TYPE=ins;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t1:34:5,28:5:163:28:996:-74.9521,0\t1:116:30,81:30:1033:81:2828:-161.475,0\nchrM\t750\t.\tA\tG\t47254.6\t.\tAB=0;ABP=0;AC=2;AF=1;AN=2;AO=1459;CIGAR=1X;DP=1459;DPB=1459;DPRA=0;EPP=48.5904;EPPR=0;GTI=0;LEN=1;MEANALT=1;MQM=59.8705;MQMR=0;NS=2;NUMALT=1;ODDS=3230.11;PAIRED=1;PAIREDR=0;PAO=0;PQA=0;PQR=0;PRO=0;QA=53335;QR=0;RO=0;RPL=594;RPP=112.315;RPPR=0;RPR=865;RUN=1;SAF=1007;SAP=461.453;SAR=452;SRF=0;SRP=0;SRR=0;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t1:331:0,331:0:0:331:11988:-1073.7,0\t1:1128:0,1128:0:0:1128:41347:-3719.34,0\nchrM\t1438\t.\tA\tG\t75374.8\t.\tAB=0;ABP=0;AC=2;AF=1;AN=2;AO=2237;CIGAR=1X;DP=2238;DPB=2238;DPRA=0;EPP=47.8812;EPPR=5.18177;GTI=0;LEN=1;MEANALT=1;MQM=59.8605;MQMR=60;NS=2;NUMALT=1;ODDS=5003.07;PAIRED=1;PAIREDR=1;PAO=0;PQA=0;PQR=0;PRO=0;QA=84494;QR=37;RO=1;RPL=1397;RPP=304.171;RPPR=5.18177;RPR=840;RUN=1;SAF=925;SAP=148.392;SAR=1312;SRF=0;SRP=5.18177;SRR=1;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t1:488:0,488:0:0:488:18416:-1656.39,0\t1:1750:1,1749:1:37:1749:66078:-5935.03,0\nchrM\t2706\t.\tA\tG\t39098.5\t.\tAB=0;ABP=0;AC=2;AF=1;AN=2;AO=1222;CIGAR=1X;DP=1235;DPB=1235;DPRA=0;EPP=3.188;EPPR=3.17734;GTI=0;LEN=1;MEANALT=1;MQM=59.9926;MQMR=60;NS=2;NUMALT=1;ODDS=2496.46;PAIRED=1;PAIREDR=1;PAO=0;PQA=0;PQR=0;PRO=0;QA=45333;QR=474;RO=13;RPL=507;RPP=79.8897;RPPR=3.17734;RPR=715;RUN=1;SAF=225;SAP=1062.06;SAR=997;SRF=5;SRP=4.51363;SRR=8;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t1:246:1,245:1:32:245:9136:-818.843,0\t1:989:12,977:12:442:977:36197:-3215.79,0\nchrM\t3197\t.\tT\tC\t130583\t.\tAB=0;ABP=0;AC=2;AF=1;AN=2;AO=3879;CIGAR=1X;DP=3892;DPB=3892;DPRA=0;EPP=59.2643;EPPR=3.17734;GTI=0;LEN=1;MEANALT=1;MQM=59.9938;MQMR=60;NS=2;NUMALT=1;ODDS=12192.8;PAIRED=1;PAIREDR=1;PAO=0;PQA=0;PQR=0;PRO=0;QA=146498;QR=463;RO=13;RPL=2190;RPP=143.521;RPPR=7.18621;RPR=1689;RUN=1;SAF=1459;SAP=519.999;SAR=2420;SRF=7;SRP=3.17734;SRR=6;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t1:1358:4,1354:4:150:1354:50893:-4563.63,0\t1:2534:9,2525:9:313:2525:95605:-8569.92,0\nchrM\t3243\t.\tA\tG\t10397.4\t.\tAB=0;ABP=0;AC=1;AF=0.5;AN=2;AO=1365;CIGAR=1X;DP=3092;DPB=3092;DPRA=0;EPP=116.418;EPPR=46.9792;GTI=0;LEN=1;MEANALT=1;MQM=59.956;MQMR=59.8917;NS=2;NUMALT=1;ODDS=2394.09;PAIRED=1;PAIREDR=1;PAO=0;PQA=0;PQR=0;PRO=0;QA=49004;QR=63273;RO=1727;RPL=849;RPP=179.415;RPPR=105.14;RPR=516;RUN=1;SAF=443;SAP=368.01;SAR=922;SRF=637;SRP=261.033;SRR=1090;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t1:1035:341,694:341:12439:694:24871:-1118.32,0\t0:2057:1386,671:1386:50834:671:24133:0,-2399.65\nchrM\t4769\t.\tA\tG\t48890.4\t.\tAB=0;ABP=0;AC=2;AF=1;AN=2;AO=1545;CIGAR=1X;DP=1545;DPB=1545;DPRA=0;EPP=162.63;EPPR=0;GTI=0;LEN=1;MEANALT=1;MQM=51.4796;MQMR=0;NS=2;NUMALT=1;ODDS=4468.76;PAIRED=1;PAIREDR=0;PAO=0;PQA=0;PQR=0;PRO=0;QA=57939;QR=0;RO=0;RPL=463;RPP=541.537;RPPR=0;RPR=1082;RUN=1;SAF=890;SAP=80.6281;SAR=655;SRF=0;SRP=0;SRR=0;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t1:517:0,517:0:0:517:19209:-1665.33,0\t1:1028:0,1028:0:0:1028:38730:-3308.01,0\nchrM\t5539\t.\tA\tG\t3281.62\t.\tAB=0;ABP=0;AC=1;AF=0.5;AN=2;AO=379;CIGAR=1X;DP=787;DPB=787;DPRA=0;EPP=216.428;EPPR=224.5;GTI=0;LEN=1;MEANALT=1;MQM=54.1504;MQMR=53.777;NS=2;NUMALT=1;ODDS=755.62;PAIRED=1;PAIREDR=1;PAO=0;PQA=0;PQR=0;PRO=0;QA=13803;QR=15250;RO=408;RPL=74;RPP=308.741;RPPR=351.808;RPR=305;RUN=1;SAF=286;SAP=216.428;SAR=93;SRF=318;SRP=279.681;SRR=90;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t0:299:221,78:221:8252:78:2824:0,-485.016\t1:488:187,301:187:6998:301:10979:-358.012,0\nchrM\t7028\t.\tC\tT\t70453.4\t.\tAB=0;ABP=0;AC=2;AF=1;AN=2;AO=2109;CIGAR=1X;DP=2114;DPB=2114;DPRA=0;EPP=63.8084;EPPR=3.44459;GTI=0;LEN=1;MEANALT=1;MQM=55.9113;MQMR=59.2;NS=2;NUMALT=1;ODDS=6416.42;PAIRED=1;PAIREDR=1;PAO=0;PQA=0;PQR=0;PRO=0;QA=78988;QR=192;RO=5;RPL=1123;RPP=22.3353;RPPR=3.44459;RPR=986;RUN=1;SAF=969;SAP=33.1175;SAR=1140;SRF=3;SRP=3.44459;SRR=2;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t1:708:1,707:1:39:707:26465:-2367.64,0\t1:1406:4,1402:4:153:1402:52523:-4692.5,0\nchrM\t7269\t.\tG\tA\t59443.2\t.\tAB=0;ABP=0;AC=2;AF=1;AN=2;AO=1773;CIGAR=1X;DP=1773;DPB=1773;DPRA=0;EPP=129.209;EPPR=0;GTI=0;LEN=1;MEANALT=1;MQM=58.3328;MQMR=0;NS=2;NUMALT=1;ODDS=5563.82;PAIRED=1;PAIREDR=0;PAO=0;PQA=0;PQR=0;PRO=0;QA=66393;QR=0;RO=0;RPL=929;RPP=11.8591;RPPR=0;RPR=844;RUN=1;SAF=848;SAP=10.2718;SAR=925;SRF=0;SRP=0;SRR=0;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t1:619:0,619:0:0:619:23040:-2069.26,0\t1:1154:0,1154:0:0:1154:43353:-3894.52,0\nchrM\t8860\t.\tA\tG\t48674.5\t.\tAB=0;ABP=0;AC=2;AF=1;AN=2;AO=1552;CIGAR=1X;DP=1556;DPB=1556;DPRA=0;EPP=36.1924;EPPR=5.18177;GTI=0;LEN=1;MEANALT=1;MQM=46.5528;MQMR=58.25;NS=2;NUMALT=1;ODDS=4986.6;PAIRED=1;PAIREDR=1;PAO=0;PQA=0;PQR=0;PRO=0;QA=56983;QR=146;RO=4;RPL=845;RPP=29.6556;RPPR=5.18177;RPR=707;RUN=1;SAF=844;SAP=28.8889;SAR=708;SRF=2;SRP=3.0103;SRR=2;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t1:598:0,598:0:0:598:21921:-1876.69,0\t1:958:4,954:4:146:954:35062:-3002.8,0\nchrM\t9477\t.\tG\tA\t31596.7\t.\tAB=0;ABP=0;AC=2;AF=1;AN=2;AO=944;CIGAR=1X;DP=946;DPB=946;DPRA=0;EPP=58.9901;EPPR=3.0103;GTI=0;LEN=1;MEANALT=1;MQM=59.3178;MQMR=60;NS=2;NUMALT=1;ODDS=2909.29;PAIRED=1;PAIREDR=1;PAO=0;PQA=0;PQR=0;PRO=0;QA=35363;QR=67;RO=2;RPL=521;RPP=25.1023;RPPR=7.35324;RPR=423;RUN=1;SAF=469;SAP=3.09311;SAR=475;SRF=1;SRP=3.0103;SRR=1;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t1:329:2,327:2:67:327:12108:-1080.66,0\t1:617:0,617:0:0:617:23255:-2090.4,0\nchrM\t9548\t.\tG\tA\t23689.1\t.\tAB=0;ABP=0;AC=2;AF=1;AN=2;AO=729;CIGAR=1X;DP=730;DPB=730;DPRA=0;EPP=65.6375;EPPR=5.18177;GTI=0;LEN=1;MEANALT=1;MQM=59.7133;MQMR=60;NS=2;NUMALT=1;ODDS=2252;PAIRED=1;PAIREDR=1;PAO=0;PQA=0;PQR=0;PRO=0;QA=26539;QR=38;RO=1;RPL=394;RPP=13.3792;RPPR=5.18177;RPR=335;RUN=1;SAF=339;SAP=10.7579;SAR=390;SRF=1;SRP=5.18177;SRR=0;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t1:261:1,260:1:38:260:9395:-838.704,0\t1:469:0,469:0:0:469:17144:-1542,0\nchrM\t11467\t.\tA\tG\t157655\t.\tAB=0;ABP=0;AC=2;AF=1;AN=2;AO=4755;CIGAR=1X;DP=4759;DPB=4759;DPRA=0;EPP=620.69;EPPR=3.0103;GTI=0;LEN=1;MEANALT=1;MQM=59.9394;MQMR=42.5;NS=2;NUMALT=1;ODDS=15848.9;PAIRED=1;PAIREDR=1;PAO=0;PQA=0;PQR=0;PRO=0;QA=179486;QR=151;RO=4;RPL=3558;RPP=2548.64;RPPR=3.0103;RPR=1197;RUN=1;SAF=1995;SAP=270.266;SAR=2760;SRF=2;SRP=3.0103;SRR=2;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t1:1820:0,1820:0:0:1820:68685:-6177.29,0\t1:2939:4,2935:4:151:2935:110801:-9948.16,0\nchrM\t11719\t.\tG\tA\t86257.7\t.\tAB=0;ABP=0;AC=2;AF=1;AN=2;AO=2676;CIGAR=1X;DP=2687;DPB=2687;DPRA=0;EPP=15.4873;EPPR=12.6832;GTI=0;LEN=1;MEANALT=1;MQM=59.6039;MQMR=60;NS=2;NUMALT=1;ODDS=6603.9;PAIRED=1;PAIREDR=1;PAO=0;PQA=0;PQR=0;PRO=0;QA=96531;QR=397;RO=11;RPL=1384;RPP=9.87851;RPPR=4.78696;RPR=1292;RUN=1;SAF=1292;SAP=9.87851;SAR=1384;SRF=2;SRP=12.6832;SRR=9;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t1:714:3,711:3:109:711:25643:-2282.19,0\t1:1973:8,1965:8:288:1965:70888:-6347.71,0\nchrM\t12308\t.\tA\tG\t63434.1\t.\tAB=0;ABP=0;AC=2;AF=1;AN=2;AO=1900;CIGAR=1X;DP=1905;DPB=1905;DPRA=0;EPP=73.302;EPPR=3.44459;GTI=0;LEN=1;MEANALT=1;MQM=59.9621;MQMR=60;NS=2;NUMALT=1;ODDS=5056.51;PAIRED=1;PAIREDR=1;PAO=0;PQA=0;PQR=0;PRO=0;QA=71094;QR=184;RO=5;RPL=1169;RPP=222.265;RPPR=3.44459;RPR=731;RUN=1;SAF=907;SAP=11.463;SAR=993;SRF=3;SRP=3.44459;SRR=2;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t1:547:5,542:5:184:542:20196:-1799.85,0\t1:1358:0,1358:0:0:1358:50898:-4577.25,0\nchrM\t12372\t.\tG\tA\t58077.1\t.\tAB=0;ABP=0;AC=2;AF=1;AN=2;AO=1737;CIGAR=1X;DP=1741;DPB=1741;DPRA=0;EPP=74.4189;EPPR=5.18177;GTI=0;LEN=1;MEANALT=1;MQM=60;MQMR=60;NS=2;NUMALT=1;ODDS=4910.27;PAIRED=1;PAIREDR=1;PAO=0;PQA=0;PQR=0;PRO=0;QA=64920;QR=149;RO=4;RPL=775;RPP=46.726;RPPR=3.0103;RPR=962;RUN=1;SAF=941;SAP=29.2942;SAR=796;SRF=3;SRP=5.18177;SRR=1;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t1:539:3,536:3:112:536:19922:-1781.72,0\t1:1202:1,1201:1:37:1201:44998:-4043.68,0\nchrM\t13617\t.\tT\tC\t27663.7\t.\tAB=0;ABP=0;AC=2;AF=1;AN=2;AO=846;CIGAR=1X;DP=848;DPB=848;DPRA=0;EPP=303.228;EPPR=3.0103;GTI=0;LEN=1;MEANALT=1;MQM=59.8972;MQMR=60;NS=2;NUMALT=1;ODDS=2549.91;PAIRED=1;PAIREDR=1;PAO=0;PQA=0;PQR=0;PRO=0;QA=31932;QR=78;RO=2;RPL=638;RPP=477.603;RPPR=7.35324;RPR=208;RUN=1;SAF=314;SAP=124.993;SAR=532;SRF=1;SRP=3.0103;SRR=1;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t1:284:0,284:0:0:284:10656:-956.335,0\t1:564:2,562:2:78:562:21276:-1906.39,0\nchrM\t14766\t.\tC\tT\t54363.3\t.\tAB=0;ABP=0;AC=2;AF=1;AN=2;AO=1633;CIGAR=1X;DP=1633;DPB=1633;DPRA=0;EPP=21.2132;EPPR=0;GTI=0;LEN=1;MEANALT=1;MQM=59.9853;MQMR=0;NS=2;NUMALT=1;ODDS=4408.47;PAIRED=1;PAIREDR=0;PAO=0;PQA=0;PQR=0;PRO=0;QA=61054;QR=0;RO=0;RPL=852;RPP=9.71354;RPPR=0;RPR=781;RUN=1;SAF=1113;SAP=470.614;SAR=520;SRF=0;SRP=0;SRR=0;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t1:473:0,473:0:0:473:17508:-1575.01,0\t1:1160:0,1160:0:0:1160:43546:-3916.74,0\nchrM\t14793\t.\tA\tG\t52354.7\t.\tAB=0;ABP=0;AC=2;AF=1;AN=2;AO=1605;CIGAR=1X;DP=1605;DPB=1605;DPRA=0;EPP=123.965;EPPR=0;GTI=0;LEN=1;MEANALT=1;MQM=59.9688;MQMR=0;NS=2;NUMALT=1;ODDS=4357.82;PAIRED=1;PAIREDR=0;PAO=0;PQA=0;PQR=0;PRO=0;QA=58638;QR=0;RO=0;RPL=950;RPP=120.75;RPPR=0;RPR=655;RUN=1;SAF=940;SAP=105.327;SAR=665;SRF=0;SRP=0;SRR=0;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t1:475:0,475:0:0:475:17313:-1557.59,0\t1:1130:0,1130:0:0:1130:41325:-3717.26,0\nchrM\t15301\t.\tG\tA\t67202.5\t.\tAB=0;ABP=0;AC=2;AF=1;AN=2;AO=2029;CIGAR=1X;DP=2036;DPB=2036;DPRA=0;EPP=73.6971;EPPR=4.45795;GTI=0;LEN=1;MEANALT=1.5;MQM=60;MQMR=60;NS=2;NUMALT=1;ODDS=5288.64;PAIRED=1;PAIREDR=1;PAO=0;PQA=0;PQR=0;PRO=0;QA=75132;QR=224;RO=6;RPL=962;RPP=14.8095;RPPR=3.0103;RPR=1067;RUN=1;SAF=1129;SAP=59.1336;SAR=900;SRF=1;SRP=8.80089;SRR=5;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t1:563:2,561:2:75:561:20714:-1856.3,0\t1:1473:4,1468:4:149:1468:54418:-4880.92,0\nchrM\t15326\t.\tA\tG\t73749.6\t.\tAB=0;ABP=0;AC=2;AF=1;AN=2;AO=2200;CIGAR=1X;DP=2201;DPB=2201;DPRA=0;EPP=68.7112;EPPR=5.18177;GTI=0;LEN=1;MEANALT=1;MQM=60;MQMR=60;NS=2;NUMALT=1;ODDS=5718.37;PAIRED=1;PAIREDR=1;PAO=0;PQA=0;PQR=0;PRO=0;QA=82190;QR=38;RO=1;RPL=1013;RPP=32.8937;RPPR=5.18177;RPR=1187;RUN=1;SAF=1088;SAP=3.57883;SAR=1112;SRF=0;SRP=5.18177;SRR=1;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t1:597:1,596:1:38:596:22276:-2000.05,0\t1:1604:0,1604:0:0:1604:59914:-5388.94,0\n</code></pre></div></div>\n\n<h2 id=\"filtering-variants\">Filtering variants</h2>\n\n<p>After filtering the data with stringent input parameters (restricting base quality to a minimum of 30 and mapping quality to a minimum of 20) a considerable amount of variants due to read-alignment bias exists. <a href=\"https://github.com/ekg\">Erik Garrison</a> has a beautiful illustration of various biases potentially affecting called variants and making a locus sequence-able.</p>\n\n<figure id=\"figure-3\" style=\"max-width: 90%;\"><img src=\"../../images/mt_biases.png\" alt=\"Various biases potentially affecting called variants. \" width=\"1175\" height=\"839\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/mt_biases.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 3</strong>:</span> Here you can see that in an ideal case (indicated with a green star) a variant is evenly represent by different areas of sequencing reads (cycle and placement biases) and is balanced across the two strands (strand bias). Allele imbalance is not applicable in our case as it reflects significant deviation from the diploid (50/50) expectation.</figcaption></figure>\n\n<p>A robust tool set for processing VCF data is provided by <a href=\"https://github.com/vcflib/vcflib\">vcflib</a> developed by Erik Garrison, the author of FreeBayes. One way to filter VCF is using <code class=\"language-plaintext highlighter-rouge\">INFO</code> fields of the VCF dataset. If you look at the VCF dataset shown above you will see all comment lines beginning with <code class=\"language-plaintext highlighter-rouge\">##INFO</code>.  These are <code class=\"language-plaintext highlighter-rouge\">INFO</code> fields. Each VCF record contains a list of <code class=\"language-plaintext highlighter-rouge\">INFO</code> tags describing a wide range of properties for each VCF record. You will see that FreeBayes and NVC differ significantly in the number and types of <code class=\"language-plaintext highlighter-rouge\">INFO</code> fields each of these caller generates. This why the two require different filtering strategies.</p>\n\n<p>Among numerous types of data generated by FreeBayes let’s consider the following variant properties:</p>\n\n<ul>\n  <li><code class=\"language-plaintext highlighter-rouge\">##INFO=&lt;ID=DP,Number=1,Type=Integer,Description=\"Total read depth at the locus\"&gt;</code> - This is the number of reads covering a given site.</li>\n  <li><code class=\"language-plaintext highlighter-rouge\">##INFO=&lt;ID=SRP,Number=1,Type=Float,Description=\"Strand balance probability for the reference allele: Phred-scaled upper-bounds estimate of the probability of observing the deviation between SRF and SRR given E(SRF/SRR) ~ 0.5, derived using Hoeffding's inequality\"&gt;</code> - The higher this quantity the better the site as it diminishes the chance of the site having significant strand bias.</li>\n  <li><code class=\"language-plaintext highlighter-rouge\">##INFO=&lt;ID=SAP,Number=A,Type=Float,Description=\"Strand balance probability for the alternate allele: Phred-scaled upper-bounds estimate of the probability of observing the deviation between SAF and SAR given E(SAF/SAR) ~ 0.5, derived using Hoeffding's inequality\"&gt;</code> - The higher this quantity the better the site as it diminishes the chance of the site having significant strand bias  (also see this <a href=\"https://groups.google.com/forum/#!topic/freebayes/fX4TOAqXJrA\">discussion on the freebayes forum</a>).</li>\n  <li><code class=\"language-plaintext highlighter-rouge\">##INFO=&lt;ID=EPP,Number=A,Type=Float,Description=\"End Placement Probability: Phred-scaled upper-bounds estimate of the probability of observing the deviation between EL and ER given E(EL/ER) ~ 0.5, derived using Hoeffding's inequality\"&gt;</code> - The higher this number the lower the chance of having significant placement bias.</li>\n  <li><code class=\"language-plaintext highlighter-rouge\">QUAL</code> - phred scaled variant quality.</li>\n</ul>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Filtering VCF data</hands-on-title>\n\n  <ol>\n    <li>Use <span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/devteam/vcffilter/vcffilter2/1.0.0_rc1+galaxy3\" title=\"VCFfilter tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>VCFfilter</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.0.0_rc1+galaxy3)</span> to filter the variants with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“VCF dataset to filter”</em>: select the VCF dataset produced by <strong>FreeBayes</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span></li>\n        <li>In <em>“more filters”</em>:\n          <ul>\n            <li>In <em>“1: more filters”</em>:\n              <ul>\n                <li><em>“Select the filter type”</em>: <code class=\"language-plaintext highlighter-rouge\">Info filter (-f)</code></li>\n                <li><em>“Specify filtering value”</em>: <code class=\"language-plaintext highlighter-rouge\">SRP &gt; 20</code></li>\n              </ul>\n            </li>\n            <li>Insert more filters:</li>\n            <li>In <em>“2: more filters”</em>:\n              <ul>\n                <li><em>“Select the filter type”</em>: <code class=\"language-plaintext highlighter-rouge\">Info filter (-f)</code></li>\n                <li><em>“Specify filtering value”</em>: <code class=\"language-plaintext highlighter-rouge\">SAP &gt; 20</code></li>\n              </ul>\n            </li>\n            <li>Insert more filters:</li>\n            <li>In <em>“3: more filters”</em>:\n              <ul>\n                <li><em>“Select the filter type”</em>: <code class=\"language-plaintext highlighter-rouge\">Info filter (-f)</code></li>\n                <li><em>“Specify filtering value”</em>: <code class=\"language-plaintext highlighter-rouge\">EPP &gt; 20</code></li>\n              </ul>\n            </li>\n            <li>Insert more filters:</li>\n            <li>In <em>“4: more filters”</em>:\n              <ul>\n                <li><em>“Select the filter type”</em>: <code class=\"language-plaintext highlighter-rouge\">Info filter (-f)</code></li>\n                <li><em>“Specify filtering value”</em>: <code class=\"language-plaintext highlighter-rouge\">QUAL &gt; 20</code></li>\n              </ul>\n            </li>\n            <li>Insert more filters:</li>\n            <li>In <em>“5: more filters”</em>:\n              <ul>\n                <li><em>“Select the filter type”</em>: <code class=\"language-plaintext highlighter-rouge\">Info filter (-f)</code></li>\n                <li><em>“Specify filtering value”</em>: <code class=\"language-plaintext highlighter-rouge\">DP &gt; 20</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title>VCF filter options</comment-title>\n        <p>Filtering FreeBayes VCF for strand bias (<code class=\"language-plaintext highlighter-rouge\">SPR</code> and <code class=\"language-plaintext highlighter-rouge\">SAP</code>), placement bias (<code class=\"language-plaintext highlighter-rouge\">EPP</code>), variant quality (<code class=\"language-plaintext highlighter-rouge\">QUAL</code>), and depth of coverage (<code class=\"language-plaintext highlighter-rouge\">DP</code>).</p>\n      </blockquote>\n    </li>\n  </ol>\n</blockquote>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <ol>\n    <li>How many variants remain after filtering the VCF?</li>\n  </ol>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n    <ol>\n      <li>Two variants remain after filtering the VCF (your results might be different depending on the input and references you use):\n        <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>#CHROM\tPOS\tID\tREF\tALT\tQUAL\tFILTER\tINFO\tFORMAT\traw_child-ds-\traw_mother-ds-\nchrM\t3243\t.\tA\tG\t10397.4\t.\tAB=0;ABP=0;AC=1;AF=0.5;AN=2;AO=1365;CIGAR=1X;DP=3092;DPB=3092;DPRA=0;EPP=116.418;EPPR=46.9792;GTI=0;LEN=1;MEANALT=1;MQM=59.956;MQMR=59.8917;NS=2;NUMALT=1;ODDS=2394.09;PAIRED=1;PAIREDR=1;PAO=0;PQA=0;PQR=0;PRO=0;QA=49004;QR=63273;RO=1727;RPL=849;RPP=179.415;RPPR=105.14;RPR=516;RUN=1;SAF=443;SAP=368.01;SAR=922;SRF=637;SRP=261.033;SRR=1090;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t1:1035:341,694:341:12439:694:24871:-1118.32,0\t0:2057:1386,671:1386:50834:671:24133:0,-2399.65\nchrM\t5539\t.\tA\tG\t3281.62\t.\tAB=0;ABP=0;AC=1;AF=0.5;AN=2;AO=379;CIGAR=1X;DP=787;DPB=787;DPRA=0;EPP=216.428;EPPR=224.5;GTI=0;LEN=1;MEANALT=1;MQM=54.1504;MQMR=53.777;NS=2;NUMALT=1;ODDS=755.62;PAIRED=1;PAIREDR=1;PAO=0;PQA=0;PQR=0;PRO=0;QA=13803;QR=15250;RO=408;RPL=74;RPP=308.741;RPPR=351.808;RPR=305;RUN=1;SAF=286;SAP=216.428;SAR=93;SRF=318;SRP=279.681;SRR=90;TYPE=snp;technology.ILLUMINA=1\tGT:DP:AD:RO:QR:AO:QA:GL\t0:299:221,78:221:8252:78:2824:0,-485.016\t1:488:187,301:187:6998:301:10979:-358.012,0\n</code></pre></div>        </div>\n      </li>\n    </ol>\n  </blockquote>\n</blockquote>\n\n<h1 id=\"examining-the-results\">Examining the results</h1>\n\n<p>For visualizing VCFs Galaxy has two external tool options. The first is called <a href=\"http://vcf.iobio.io/\">VCF.IOBIO</a> developed by <a href=\"http://marthlab.org/\">Gabor Marth’s group</a> at the University of Utah. The second is called <a href=\"http://software.broadinstitute.org/software/igv/\">IGV</a> developed by Broad Institute.</p>\n\n<h2 id=\"visualising-with-vcfiobio\">Visualising with VCF.IOBIO</h2>\n\n<p>VCF.IOBIO can be invoked by expanding a VCF dataset in Galaxy’s history by clicking on it:</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Display data in VCF.IOBIO</hands-on-title>\n\n  <figure id=\"figure-4\" style=\"max-width: 90%;\"><img src=\"../../images/mt_vcf_dataset_expanded.png\" alt=\"Expanded output. \" width=\"576\" height=\"648\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/mt_vcf_dataset_expanded.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 4</strong>:</span> At the bottom there is a link 'display at vcf.iobio'. Clicking on this link will start indexing of VCF datasets, which is required to display them.</figcaption></figure>\n\n  <figure id=\"figure-5\" style=\"max-width: 90%;\"><img src=\"../../images/mt_vcfiobio.png\" alt=\"VCF.IOBIO overview. \" width=\"3802\" height=\"1564\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/mt_vcfiobio.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 5</strong>:</span> There are not that many variants to look at in this example. Nevertheless there are helpful statistics such as Transition/Transversion (Ts/Tn) ratio.</figcaption></figure>\n</blockquote>\n\n<h2 id=\"visualising-with-igv\">Visualising with IGV</h2>\n\n<p>Similarly to VCF.IOBIO expanding a history item representing a VCF dataset will reveal an IGV link:</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Display data in IGV</hands-on-title>\n\n  <figure id=\"figure-6\" style=\"max-width: 90%;\"><img src=\"../../images/mt_vcf_dataset_expanded.png\" alt=\"VCFfilter output expanded. \" width=\"576\" height=\"648\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/mt_vcf_dataset_expanded.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 6</strong>:</span> At the bottom there is a link 'display at IGV: local Human hg38'.</figcaption></figure>\n\n  <p>The difference between ‘local’ and ‘Human hg38’ links is explained in the following video:</p>\n\n  <div class=\"embed-responsive embed-responsive-16by9\"><iframe src=\"https://player.vimeo.com/video/123414437?portrait=0\" webkitallowfullscreen=\"\" mozallowfullscreen=\"\" allowfullscreen=\"\"></iframe></div>\n\n  <p>Visualizing our FreeBayes dataset will produce this:</p>\n\n  <figure id=\"figure-7\" style=\"max-width: 90%;\"><img src=\"../../images/mt_igv.png\" alt=\"IGV interface. \" width=\"1020\" height=\"401\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/mt_igv.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 7</strong>:</span> Here we focus on one particular variant at position 3243 for reasons that will become apparent in the next section.</figcaption></figure>\n</blockquote>\n\n<h2 id=\"comparing-frequencies\">Comparing frequencies</h2>\n\n<p>Visualizing VCF datasets is a good way to get an overall idea of the data, but it does not tell a lot of details. For example, above we have visualized site 3243 using IGV. It is interesting but we need to find out more. One thing we can do is to convert VCF dataset into a tab-delimited representation and with it play a bit more.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Convert VCF to tab-delimited data</hands-on-title>\n\n  <ol>\n    <li>Use <span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/devteam/vcf2tsv/vcf2tsv/1.0.0_rc1+galaxy0\" title=\"VCFtoTab-delimited tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>VCFtoTab-delimited</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.0.0_rc1+galaxy0)</span> to filter the variants with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select VCF dataset to convert”</em>: select the VCF dataset produced by <strong>VCFfilter</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span></li>\n        <li><em>“Report data per sample”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n        <li><em>“Fill empty fields with”</em>: <code class=\"language-plaintext highlighter-rouge\">Nothing</code></li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <ol>\n    <li>Why are there four rows in the VCFtoTab-delimited <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> output when the input VCF had only two rows?</li>\n    <li>How many columns are in the VCFtoTab-delimited <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> output?</li>\n  </ol>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <ol>\n      <li>Since <em>“Report data per sample”</em> was set to <code class=\"language-plaintext highlighter-rouge\">Yes</code>, VCFtoTab-delimited <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> produced two rows for each of the two variants, one row per sample (child and mother).</li>\n      <li>There are 62 (!) columns in the output of VCFtoTab-delimited <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>.</li>\n    </ol>\n  </blockquote>\n</blockquote>\n\n<figure id=\"figure-8\" style=\"max-width: 90%;\"><img src=\"../../images/mt_tab.png\" alt=\"VCFtoTab-delimited output. \" width=\"2476\" height=\"340\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/mt_tab.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 8</strong>:</span> The columns in the above dataset represent INFO and Genotype fields on the original VCF dataset.</figcaption></figure>\n\n<p>Let’s restrict ourselves to a few key columns:</p>\n\n<ul>\n  <li>2 <code class=\"language-plaintext highlighter-rouge\">POS</code> - position along mitochondrial genome</li>\n  <li>4 <code class=\"language-plaintext highlighter-rouge\">REF</code> - reference allele</li>\n  <li>5 <code class=\"language-plaintext highlighter-rouge\">ALT</code> - alternative allele</li>\n  <li>52 <code class=\"language-plaintext highlighter-rouge\">SAMPLE</code> - name of the sample</li>\n  <li>54 <code class=\"language-plaintext highlighter-rouge\">AO</code> - number of alternative observations (how many times do we see the alternative allele at this position in this sample)</li>\n  <li>55 <code class=\"language-plaintext highlighter-rouge\">DP</code> - depth of coverage at this site for this sample</li>\n</ul>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Cut columns from a file</hands-on-title>\n\n  <ol>\n    <li>Use <span class=\"tool\" data-tool=\"Cut1\" title=\"Cut columns from a table tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Cut columns from a table</strong></span> to select specific columns with the following parameters:\n      <ul>\n        <li><em>“Cut columns”</em>: <code class=\"language-plaintext highlighter-rouge\">c2,c4,c5,c52,c54,c55</code></li>\n        <li><em>“Delimited by”</em>: <code class=\"language-plaintext highlighter-rouge\">Tab</code></li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“From”</em>: select the tabular dataset produced by <strong>VCFtoTab-delimited</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span></li>\n      </ul>\n    </li>\n  </ol>\n</blockquote>\n\n<p>Running Cut will generate the following dataset:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>POS  REF ALT     SAMPLE       AO    DP\n--------------------------------------\n3243\tA\tG\traw_child-ds-\t694\t1035\n3243\tA\tG\traw_mother-ds-\t671\t2057\n5539\tA\tG\traw_child-ds-\t78\t299\n5539\tA\tG\traw_mother-ds-\t301\t488\n</code></pre></div></div>\n\n<p>Let’s look at position 3243. At this site, the mother sample has 671 <code class=\"language-plaintext highlighter-rouge\">G</code>s (since <code class=\"language-plaintext highlighter-rouge\">G</code> is the alternative allele) and 2057-671=1386 <code class=\"language-plaintext highlighter-rouge\">A</code>s. The child sample has 694 <code class=\"language-plaintext highlighter-rouge\">G</code>s and 1035-694=341 <code class=\"language-plaintext highlighter-rouge\">A</code>s:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>Allele     A     G\n-------------------\nMother  1386   691\nChild   341    694\n</code></pre></div></div>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <ol>\n    <li>What do you notice about the relative frequencies of the <code class=\"language-plaintext highlighter-rouge\">A</code> and <code class=\"language-plaintext highlighter-rouge\">G</code> alleles between mother and child?</li>\n  </ol>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <ol>\n      <li>The <em>major</em> allele in the mother (<code class=\"language-plaintext highlighter-rouge\">A</code>) becomes the <em>minor</em> allele in the child – a remarkable frequency change due to mitochondrial bottleneck!</li>\n    </ol>\n  </blockquote>\n</blockquote>\n\n<h1 id=\"conclusion\">Conclusion</h1>\n\n<p>This entire analysis is available as a <a href=\"https://usegalaxy.org/u/aun1/h/non-diploid-freebayes\">Galaxy history</a> that you can import into your Galaxy account and play with.</p>\n\n<p>Now you know how to call variants in non-diploid system, so try it on bacteria, viruses, etc.</p>\n"],"ref_slides":[],"hands_on":true,"slides":false,"mod_date":"2024-03-14 16:39:13 +0000","pub_date":"2017-02-16 16:45:19 +0000","version":39,"workflows":[{"workflow":"Calling_variants_in_non-diploid_systems.ga","tests":true,"url":"https://training.galaxyproject.org/training-material/topics/variant-analysis/tutorials/non-dip/workflows/Calling_variants_in_non-diploid_systems.ga","path":"topics/variant-analysis/tutorials/non-dip/workflows/Calling_variants_in_non-diploid_systems.ga","wfid":"variant-analysis-non-dip","wfname":"calling_variants_in_non-diploid_systems","trs_endpoint":"https://training.galaxyproject.org/training-material/api/ga4gh/trs/v2/tools/variant-analysis-non-dip/versions/calling_variants_in_non-diploid_systems","license":null,"creators":[],"name":"Calling variants in non-diploid systems","title":"Calling variants in non-diploid systems","test_results":null,"modified":"2024-06-17 13:07:07 +0000","mermaid":"flowchart TD\n  0[\"ℹ️ Input Dataset\\nraw_child-ds-1.fq\"];\n  style 0 stroke:#2c3143,stroke-width:4px;\n  1[\"ℹ️ Input Dataset\\nraw_child-ds-2.fq\"];\n  style 1 stroke:#2c3143,stroke-width:4px;\n  2[\"ℹ️ Input Dataset\\nraw_mother-ds-1.fq\"];\n  style 2 stroke:#2c3143,stroke-width:4px;\n  3[\"ℹ️ Input Dataset\\nraw_mother-ds-2.fq\"];\n  style 3 stroke:#2c3143,stroke-width:4px;\n  4[\"FastQC\"];\n  0 -->|output| 4;\n  5[\"FastQC\"];\n  1 -->|output| 5;\n  6[\"Map with BWA-MEM\"];\n  0 -->|output| 6;\n  1 -->|output| 6;\n  7[\"FastQC\"];\n  2 -->|output| 7;\n  8[\"FastQC\"];\n  3 -->|output| 8;\n  9[\"Map with BWA-MEM\"];\n  2 -->|output| 9;\n  3 -->|output| 9;\n  10[\"MergeSamFiles\"];\n  9 -->|bam_output| 10;\n  6 -->|bam_output| 10;\n  11[\"MarkDuplicates\"];\n  10 -->|outFile| 11;\n  12[\"BamLeftAlign\"];\n  11 -->|outFile| 12;\n  13[\"Filter\"];\n  12 -->|output_bam| 13;\n  14[\"FreeBayes\"];\n  13 -->|out_file1| 14;\n  15[\"VCFfilter:\"];\n  14 -->|output_vcf| 15;\n  16[\"VCFtoTab-delimited:\"];\n  15 -->|out_file1| 16;\n  17[\"Cut\"];\n  16 -->|out_file1| 17;\n  f2e84a79-a71f-4b5f-a526-55d8cd472a05[\"Output\\ncut_variants\"];\n  17 --> f2e84a79-a71f-4b5f-a526-55d8cd472a05;\n  style f2e84a79-a71f-4b5f-a526-55d8cd472a05 stroke:#2c3143,stroke-width:4px;"}],"api":"https://training.galaxyproject.org/training-material/api/topics/variant-analysis/tutorials/non-dip/tutorial.json","tools":["Cut1","toolshed.g2.bx.psu.edu/repos/devteam/bamtools_filter/bamFilter/2.4.1","toolshed.g2.bx.psu.edu/repos/devteam/bwa/bwa_mem/0.7.17.1","toolshed.g2.bx.psu.edu/repos/devteam/fastqc/fastqc/0.72+galaxy1","toolshed.g2.bx.psu.edu/repos/devteam/freebayes/bamleftalign/1.1.0.46-0","toolshed.g2.bx.psu.edu/repos/devteam/freebayes/bamleftalign/1.3.1","toolshed.g2.bx.psu.edu/repos/devteam/freebayes/freebayes/1.1.0.46-0","toolshed.g2.bx.psu.edu/repos/devteam/freebayes/freebayes/1.3.1","toolshed.g2.bx.psu.edu/repos/devteam/picard/picard_MarkDuplicates/2.18.2.2","toolshed.g2.bx.psu.edu/repos/devteam/picard/picard_MergeSamFiles/2.18.2.1","toolshed.g2.bx.psu.edu/repos/devteam/vcf2tsv/vcf2tsv/1.0.0_rc1+galaxy0","toolshed.g2.bx.psu.edu/repos/devteam/vcffilter/vcffilter2/1.0.0_rc1+galaxy3"],"supported_servers":{"exact":[{"url":"https://usegalaxy.be/","name":"UseGalaxy.be","usegalaxy":false},{"url":"https://usegalaxy.eu","name":"UseGalaxy.eu","usegalaxy":true},{"url":"https://usegalaxy.fr/","name":"UseGalaxy.fr","usegalaxy":false},{"url":"https://usegalaxy.no/","name":"UseGalaxy.no","usegalaxy":false},{"url":"https://usegalaxy.org","name":"UseGalaxy.org (Main)","usegalaxy":true}],"inexact":[{"url":"https://usegalaxy.cz/","name":"UseGalaxy.cz","usegalaxy":false},{"url":"https://usegalaxy.org.au","name":"UseGalaxy.org.au","usegalaxy":true}]},"topic_name_human":"Variant Analysis","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[{"name":"bamtools_filter","owner":"devteam","revisions":"cb20f99fd45b","tool_panel_section_label":"SAM/BAM","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"bwa","owner":"devteam","revisions":"3fe632431b68","tool_panel_section_label":"Mapping","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"fastqc","owner":"devteam","revisions":"e7b2202befea","tool_panel_section_label":"FASTA/FASTQ","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"freebayes","owner":"devteam","revisions":"156b60c1530f","tool_panel_section_label":"Variant Calling","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"freebayes","owner":"devteam","revisions":"57def2d7c093","tool_panel_section_label":"Variant Calling","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"freebayes","owner":"devteam","revisions":"156b60c1530f","tool_panel_section_label":"Variant Calling","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"freebayes","owner":"devteam","revisions":"ef2c525bd8cd","tool_panel_section_label":"Variant Calling","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"picard","owner":"devteam","revisions":"a1f0b3f4b781","tool_panel_section_label":"Picard","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"picard","owner":"devteam","revisions":"f9242e01365a","tool_panel_section_label":"Picard","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"vcf2tsv","owner":"devteam","revisions":"e92b3c0f9224","tool_panel_section_label":"Variant Calling","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"vcffilter","owner":"devteam","revisions":"81972652519c","tool_panel_section_label":"Variant Calling","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"}]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools:\n- name: bamtools_filter\n  owner: devteam\n  revisions: cb20f99fd45b\n  tool_panel_section_label: SAM/BAM\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: bwa\n  owner: devteam\n  revisions: 3fe632431b68\n  tool_panel_section_label: Mapping\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: fastqc\n  owner: devteam\n  revisions: e7b2202befea\n  tool_panel_section_label: FASTA/FASTQ\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: freebayes\n  owner: devteam\n  revisions: 156b60c1530f\n  tool_panel_section_label: Variant Calling\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: freebayes\n  owner: devteam\n  revisions: 57def2d7c093\n  tool_panel_section_label: Variant Calling\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: freebayes\n  owner: devteam\n  revisions: 156b60c1530f\n  tool_panel_section_label: Variant Calling\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: freebayes\n  owner: devteam\n  revisions: ef2c525bd8cd\n  tool_panel_section_label: Variant Calling\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: picard\n  owner: devteam\n  revisions: a1f0b3f4b781\n  tool_panel_section_label: Picard\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: picard\n  owner: devteam\n  revisions: f9242e01365a\n  tool_panel_section_label: Picard\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: vcf2tsv\n  owner: devteam\n  revisions: e92b3c0f9224\n  tool_panel_section_label: Variant Calling\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: vcffilter\n  owner: devteam\n  revisions: 81972652519c\n  tool_panel_section_label: Variant Calling\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n","tours":false,"video":false,"slides_recordings":false,"translations":{"tutorial":[],"slides":[],"video":false},"license":"CC-BY-4.0","type":"tutorial"}