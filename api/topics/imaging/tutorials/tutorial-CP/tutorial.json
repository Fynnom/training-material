{"layout":"tutorial_hands_on","title":"Nucleoli segmentation and feature extraction using CellProfiler","questions":["How do I run an image analysis pipeline on public data using CellProfiler?","How do I analyse the DNA channel of fluorescence siRNA screens?","How do I download public image data into my history?","How do I segment and label cell nuclei?","How do I segment nucleoli (as the absence of DNA)?","How do I combine nuclei and nucleoli into one segmentation mask?","How do I extract the background of an image?","How do I relate the nucleoli to their parent nucleus?","How do I measure the image and object features?","How do I measure the image quality?"],"objectives":["How to download images from a public image repository.","How to segment cell nuclei using CellProfiler in Galaxy.","How to segment cell nucleoli using CellProfiler in Galaxy.","How to extract features for images, nuclei and nucleoli."],"time_estimation":"4H","key_points":["Galaxy workflows can download images from the IDR, selecting specific channels, time points, z-stack positions and crop the image in different ways.","CellProfiler in Galaxy can segment and extract features of any object of interest.","The features and masks can be exported for further analysis."],"contributors":[{"name":"Beatriz Serrano-Solano","email":"beatrizserrano.galaxy@gmail.com","twitter":"BSerranoSolano","linkedin":"beatriz-serrano","matrix":"beatrizserrano:matrix.org","orcid":"0000-0002-5862-6132","joined":"2020-07","id":"beatrizserrano","url":"https://training.galaxyproject.org/training-material/api/contributors/beatrizserrano.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/beatrizserrano/"},{"name":"Jean-Karim Hériché","joined":"2020-07","id":"jkh1","url":"https://training.galaxyproject.org/training-material/api/contributors/jkh1.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/jkh1/"}],"zenodo_link":"","js_requirements":{"mathjax":null,"mermaid":false},"short_id":"T00183","url":"/topics/imaging/tutorials/tutorial-CP/tutorial.html","topic_name":"imaging","tutorial_name":"tutorial-CP","dir":"topics/imaging/tutorials/tutorial-CP","symlink":null,"id":"imaging/tutorial-CP","ref_tutorials":["<p>The nucleolus is a prominent structure of the nucleus of eukaryotic cells and is involved in ribosome biogenesis and cell cycle regulation. In DNA staining of cells, nucleoli can be identified as the absence of DNA in nuclei (<a href=\"#figure-1\">Fig. 1</a>).\nPhenotypes caused by reduced gene function are widely used to elucidate gene function and image-based RNA interference (RNAi) screens are routinely used to find and characterize genes involved in a particular biological process. While screens typically focus on one biological process of interest, the molecular markers used can also inform on other processes. Re-using published screens image data can then be a cost-effective alternative to performing new experiments.\nIn particular, regardless of the targeted biological process, many screens include a DNA label and therefore can also reveal the effect of gene knock-downs on nucleoli.</p>\n\n<figure id=\"figure-1\" style=\"max-width: 90%;\"><img src=\"../../images/tutorial-CP/img_dna_channel.png\" alt=\"DNA channel. \" width=\"804\" height=\"626\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/tutorial-CP/img_dna_channel.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 1</strong>:</span> DNA channel from the screen described in <span class=\"citation\"><a href=\"#Heriche_2014\">“<b>Integration of biological data by kernels on graph nodes allows prediction of new genes involved in mitotic chromosome condensation</b>” 2014</a></span>. The red arrows point at nucleoli.</figcaption></figure>\n\n<p>In this tutorial, we will analyse DNA channel images of publicly available RNAi screens to extract numerical descriptors (i.e. features) of nucleoli.\nThe images and associated metadata will be retrieved from the <a href=\"http://idr.openmicroscopy.org/\">Image Data Resource (IDR)</a>, a repository that collects image datasets of tissues and cells.</p>\n\n<p>To process and analyse the images, we will use <a href=\"http://cellprofiler-manual.s3.amazonaws.com/CellProfiler-3.1.9/index.html\">CellProfiler</a> (<span class=\"citation\"><a href=\"#McQuin_2018\">“<b>CellProfiler 3.0: Next-generation image processing for biology</b>” 2018</a></span>), a popular image analysis software. CellProfiler normally comes as a desktop application in which users can compose image analysis workflows from a series of modules. Many of these modules are now also available as tools in Galaxy.</p>\n\n<p>To fully emulate the behaviour of the standalone CellProfiler in Galaxy, each image analysis workflow needs to have three parts:</p>\n\n<p>1) <strong>StartingModules</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> to initialise the pipeline,</p>\n\n<p>2) tools performing the analysis (<a href=\"#figure-2\">Fig. 2</a>): identification of the nuclei, nucleoli and background, together with the feature extraction,</p>\n\n<p>3) <strong>CellProfiler</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> to actually run the pipeline.</p>\n\n<figure id=\"figure-2\" style=\"max-width: 90%;\"><img src=\"../../images/tutorial-CP/wf.jpg\" alt=\"High-level view of the workflow. \" width=\"2874\" height=\"1156\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/tutorial-CP/wf.jpg\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 2</strong>:</span> High-level view of the workflow</figcaption></figure>\n\n<p>In this tutorial, you will learn how to create a workflow that downloads a selection of images from the IDR, and uses CellProfiler to segment the nuclei and nucleoli. You will also learn how to extract and export features at three different levels: image, nucleus, nucleolus.</p>\n\n<blockquote class=\"agenda\">\n  <agenda-title></agenda-title>\n\n  <p>In this tutorial, we will cover:</p>\n\n<ol id=\"markdown-toc\">\n  <li><a href=\"#get-data\" id=\"markdown-toc-get-data\">Get data</a></li>\n  <li><a href=\"#start-cellprofiler-pipeline\" id=\"markdown-toc-start-cellprofiler-pipeline\">Start CellProfiler pipeline</a></li>\n  <li><a href=\"#object-segmentation\" id=\"markdown-toc-object-segmentation\">Object segmentation</a>    <ol>\n      <li><a href=\"#segment-nuclei\" id=\"markdown-toc-segment-nuclei\">Segment nuclei</a></li>\n      <li><a href=\"#segment-nucleoli\" id=\"markdown-toc-segment-nucleoli\">Segment nucleoli</a></li>\n      <li><a href=\"#combine-segmentation-masks\" id=\"markdown-toc-combine-segmentation-masks\">Combine segmentation masks</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#background-extraction\" id=\"markdown-toc-background-extraction\">Background extraction</a>    <ol>\n      <li><a href=\"#identify-the-foreground\" id=\"markdown-toc-identify-the-foreground\">Identify the foreground</a></li>\n      <li><a href=\"#remove-the-foreground-from-the-original-image\" id=\"markdown-toc-remove-the-foreground-from-the-original-image\">Remove the foreground from the original image</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#feature-extraction\" id=\"markdown-toc-feature-extraction\">Feature extraction</a>    <ol>\n      <li><a href=\"#measure-the-granularity-texture-intensity-size-and-shape\" id=\"markdown-toc-measure-the-granularity-texture-intensity-size-and-shape\">Measure the granularity, texture, intensity, size and shape</a></li>\n      <li><a href=\"#relate-nucleoli-to-their-parent-nucleus\" id=\"markdown-toc-relate-nucleoli-to-their-parent-nucleus\">Relate nucleoli to their parent nucleus</a></li>\n      <li><a href=\"#measure-the-image-quality-related-parameters\" id=\"markdown-toc-measure-the-image-quality-related-parameters\">Measure the image quality-related parameters</a></li>\n      <li><a href=\"#export-the-features-to-a-csv\" id=\"markdown-toc-export-the-features-to-a-csv\">Export the features to a CSV</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#run-the-cellprofiler-pipeline\" id=\"markdown-toc-run-the-cellprofiler-pipeline\">Run the CellProfiler pipeline</a></li>\n  <li><a href=\"#conclusion\" id=\"markdown-toc-conclusion\">Conclusion</a></li>\n</ol>\n\n</blockquote>\n\n<h1 id=\"get-data\">Get data</h1>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Download images from the IDR</hands-on-title>\n\n  <ol>\n    <li>\n      <p>If you are logged in, create a new history for this tutorial.</p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-creating-a-new-history\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-creating-a-new-history\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Creating a new history</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p>Click the <i class=\"fas fa-plus\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">new-history</span> icon at the top of the history panel:</p>   <p><img src=\"/training-material/shared/images/history_create_new.svg\" alt=\"UI for creating new history\" /></p>   <!-- the original drawing can be found here https://docs.google.com/drawings/d/1cCBrLAo4kDGic5QyB70rRiWJAKTenTU8STsKDaLcVU8/edit?usp=sharing --> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>\n      <p><strong>IDR Download</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:</p>\n      <ul>\n        <li><em>“How would you like to specify the IDs of images to download?”</em>: <code class=\"language-plaintext highlighter-rouge\">As text (comma-separated list of IDs or a valid IDR link)</code></li>\n        <li><em>“Image IDs to download”</em>: <code class=\"language-plaintext highlighter-rouge\">http://idr.openmicroscopy.org/webclient/?show=image-295900|image-295905|image-295910|image-295918|image-295928|image-295934</code></li>\n        <li><em>“Name of the channel to download”</em>: <code class=\"language-plaintext highlighter-rouge\">Cy3</code></li>\n        <li><em>“z-plane of images to download”</em>: <code class=\"language-plaintext highlighter-rouge\">0</code></li>\n        <li><em>“Image frame to download”</em>: <code class=\"language-plaintext highlighter-rouge\">0</code></li>\n        <li><em>“Limit the download to a selected region of the image?”</em>: <code class=\"language-plaintext highlighter-rouge\">No, download the entire image plane</code></li>\n        <li><em>“Skip failed retrievals?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n        <li><em>“Download images in a tarball?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n      </ul>\n\n      <blockquote class=\"tip\">\n        <tip-title>Get the IDR link from a manual selection of images</tip-title>\n\n        <p>To get the valid IDR link, go to the <a href=\"http://idr.openmicroscopy.org/webclient/?show=screen-102\">dataset of interest in the IDR</a> and select in the preview of a plate a few images ((figure <a href=\"#figure-3\">Fig. 3</a> - 1)). Once you see them at the bottom of the page (figure <a href=\"#figure-3\">Fig. 3</a> - 2), select them again and click the link button in the top-right corner of the right panel (figure <a href=\"#figure-3\">Fig. 3</a> - 3).</p>\n\n        <figure id=\"figure-3\" style=\"max-width: 90%;\"><img src=\"../../images/tutorial-CP/IDR_interface.jpg\" alt=\"IDR interface. \" width=\"2452\" height=\"1376\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/tutorial-CP/IDR_interface.jpg\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 3</strong>:</span> IDR interface</figcaption></figure>\n      </blockquote>\n\n      <blockquote class=\"comment\">\n        <comment-title></comment-title>\n\n        <p><strong>IMPORTANT:</strong> When the number of images to download is high, it is strongly recommended to enable the option <em>“Download images in a tarball?”</em> in order to improve the performance.</p>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <ol>\n    <li>Why are we taking the <code class=\"language-plaintext highlighter-rouge\">Cy3</code> channel in the <a href=\"http://idr.openmicroscopy.org/webclient/img_detail/295900/\">example data</a>?</li>\n    <li>How could we download 100,000 images in one go?</li>\n  </ol>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <ol>\n      <li>\n        <p>The <code class=\"language-plaintext highlighter-rouge\">Cy3</code> dye was used in the study to stain DNA. Since we want to segment the abscence of DNA, <code class=\"language-plaintext highlighter-rouge\">Cy3</code> is the only channel that we need to download from the IDR.</p>\n      </li>\n      <li>\n        <p>We could upload a text file with the image ids of interest.</p>\n      </li>\n    </ol>\n\n  </blockquote>\n\n</blockquote>\n\n<h1 id=\"start-cellprofiler-pipeline\">Start CellProfiler pipeline</h1>\n\n<p>The tool <strong>Starting Modules</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> comprises the first 4 modules of the standalone CellProfiler. It needs to be the first tool of a workflow because it sets the naming and metadata handling for the rest of tools.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Specify metadata to CellProfiler</hands-on-title>\n\n  <ol>\n    <li><strong>Starting Modules</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:\n      <ul>\n        <li>Images\n          <ul>\n            <li><em>“Do you want to filter only the images? “</em>: <code class=\"language-plaintext highlighter-rouge\">Select the images only</code></li>\n          </ul>\n        </li>\n        <li>Metadata\n          <ul>\n            <li><em>“Do you want to extract the metadata?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes, specify metadata</code>\n              <ul>\n                <li><em>“Metadata extraction method”</em>: <code class=\"language-plaintext highlighter-rouge\">Extract from file/folder names</code></li>\n              </ul>\n            </li>\n            <li><em>“Metadata source”</em>: <code class=\"language-plaintext highlighter-rouge\">File name</code></li>\n            <li><em>“Select the pattern to extract metadata from the file name”</em>: <code class=\"language-plaintext highlighter-rouge\">field1__field2__field3__field4__field5__field6</code></li>\n            <li><em>“Extract metadata from”</em>: <code class=\"language-plaintext highlighter-rouge\">All images</code></li>\n          </ul>\n        </li>\n        <li>NamesAndTypes\n          <ul>\n            <li><em>“Process 3D”</em>: <code class=\"language-plaintext highlighter-rouge\">No, do not process 3D data</code></li>\n            <li><em>“Assign a name to”</em>: <code class=\"language-plaintext highlighter-rouge\">Give every image the same name</code></li>\n            <li><em>“Name to assign these images”</em>: <code class=\"language-plaintext highlighter-rouge\">DNA</code></li>\n            <li><em>“Select the image type”</em>: <code class=\"language-plaintext highlighter-rouge\">Grayscale image</code>\n              <ul>\n                <li><em>“Set intensity range from”</em>: <code class=\"language-plaintext highlighter-rouge\">Image metadata</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n        <li>Groups\n          <ul>\n            <li><em>“Do you want to group your images?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes, group the images</code></li>\n            <li><em>“param”</em>: <code class=\"language-plaintext highlighter-rouge\">field1</code></li>\n          </ul>\n        </li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title></comment-title>\n\n        <p>The images downloaded from the IDR are named following the pattern: <code class=\"language-plaintext highlighter-rouge\">plateName__imageID__cropX__cropY__cropWidth__cropHeight</code>. These fields indicate to which plate the image belongs, what is the identifier of the image in the IDR, and the 4 cropping parameters selected. In our case, the upper-left corner (X, Y) and the width and height from there. We have a total of 6 metadata values encoded in the name of the file, separated by <code class=\"language-plaintext highlighter-rouge\">__</code>. The pattern to extract our metadata from the file name properly is, therefore: <code class=\"language-plaintext highlighter-rouge\">field1__field2__field3__field4__field5__field6</code>. It is important to keep in mind that, for CellProfiler, our <code class=\"language-plaintext highlighter-rouge\">plateName</code> will be called <code class=\"language-plaintext highlighter-rouge\">field1</code>, <code class=\"language-plaintext highlighter-rouge\">imageID</code> will be <code class=\"language-plaintext highlighter-rouge\">field2</code>, <code class=\"language-plaintext highlighter-rouge\">cropX</code> will be <code class=\"language-plaintext highlighter-rouge\">field3</code>, etc. These matches are relevant for a meaningful interpretation of the features.</p>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h1 id=\"object-segmentation\">Object segmentation</h1>\n\n<h2 id=\"segment-nuclei\">Segment nuclei</h2>\n\n<p>Since we are interested in segmenting the nucleoli, you may wonder why we need to segment nuclei first. There are several reasons for that:</p>\n\n<ul>\n  <li>\n    <p>Get the nuclei features. The intensity, size, shape, number of nucleoli per nucleus, etc. can be informative to study the nucleoli.</p>\n  </li>\n  <li>\n    <p>Avoid the detection of wrong spots. In a first segmentation, we detect the nuclei, while in the second pass we will segment the holes (nucleoli). The holes need to fall inside the nuclei, and hence the importance of having them segmented too.</p>\n  </li>\n</ul>\n\n<p>In the first step, we will identify the nuclei that are complete, meaning that they are not touching the borders of the image.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Segment nuclei that are complete within the boundaries of the image</hands-on-title>\n\n  <ol>\n    <li><strong>IdentifyPrimaryObjects</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select the input CellProfiler pipeline”</em>: <code class=\"language-plaintext highlighter-rouge\">output_pipeline</code> (output of <strong>Starting Modules</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Use advanced settings?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes, use advanced settings</code>\n          <ul>\n            <li><em>“Enter the name of the input image (from NamesAndTypes)”</em>: <code class=\"language-plaintext highlighter-rouge\">DNA</code></li>\n            <li><em>“Enter the name of the primary objects to be identified”</em>: <code class=\"language-plaintext highlighter-rouge\">Nuclei</code></li>\n            <li><em>“Typical minimum diameter of objects, in pixel units (Min)”</em>: <code class=\"language-plaintext highlighter-rouge\">15</code></li>\n            <li><em>“Typical maximum diameter of objects, in pixel units (Max)”</em>: <code class=\"language-plaintext highlighter-rouge\">200</code></li>\n            <li><em>“Discard objects outside the diameter range?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n            <li><em>“Discard objects touching the border of the image?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n            <li><em>“Threshold strategy”</em>: <code class=\"language-plaintext highlighter-rouge\">Global</code>\n              <ul>\n                <li><em>“Thresholding method”</em>: <code class=\"language-plaintext highlighter-rouge\">Otsu</code>\n                  <ul>\n                    <li><em>“Two-class or three-class thresholding?”</em>: <code class=\"language-plaintext highlighter-rouge\">Two classes</code></li>\n                    <li><em>“Threshold correction factor”</em>: <code class=\"language-plaintext highlighter-rouge\">0.9</code></li>\n                  </ul>\n                </li>\n              </ul>\n            </li>\n            <li><em>“Method to distinguish clumped objects”</em>: <code class=\"language-plaintext highlighter-rouge\">Shape</code>\n              <ul>\n                <li><em>“Method to draw dividing lines between clumped objects”</em>: <code class=\"language-plaintext highlighter-rouge\">Shape</code>\n                  <ul>\n                    <li><em>“Automatically calculate size of smoothing filter for declumping?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n                    <li><em>“Automatically calculate minimum allowed distance between local maxima?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n                  </ul>\n                </li>\n              </ul>\n            </li>\n            <li><em>“Handling of objects if excessive number of objects identified”</em>: <code class=\"language-plaintext highlighter-rouge\">Continue</code></li>\n          </ul>\n        </li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title></comment-title>\n\n        <ul>\n          <li>The names entered to the input image and objects have to be consistent (case sensitive) with the ones in <em>NamesAndTypes</em> and the tools to follow.</li>\n          <li>The min and max diameter of the objects (<code class=\"language-plaintext highlighter-rouge\">Typical minimum diameter of objects, in pixel units (Min)</code> and <code class=\"language-plaintext highlighter-rouge\">Typical minimum diameter of objects, in pixel units (Max)</code>) will have to be adjusted to the resolution of the images.</li>\n          <li>The <code class=\"language-plaintext highlighter-rouge\">Threshold correction factor</code> is used to adjust the threshold in Otsu’s method. The value depends on the images and it might be useful to test several values and pick the one that works best for a particular kind of image.</li>\n        </ul>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <p>We are using here Otsu’s thresholding method for segmentation. What other segmentation options are available? What is the difference between them?</p>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <p>In the <em>global</em> methods we have <code class=\"language-plaintext highlighter-rouge\">Manual</code>, <code class=\"language-plaintext highlighter-rouge\">Measurement</code>, <code class=\"language-plaintext highlighter-rouge\">Minimum cross entropy</code>, <code class=\"language-plaintext highlighter-rouge\">Otsu</code> and <code class=\"language-plaintext highlighter-rouge\">Robust background</code>. For the <em>adaptive</em> ones we only have <code class=\"language-plaintext highlighter-rouge\">Otsu</code>. Check the parameters’ help to get more information on each one.</p>\n\n  </blockquote>\n\n</blockquote>\n\n<p>From the previous tool, we got a group of objects (nuclei). Now, we want to export the segmentation masks as a single image to check how well the segmentation algorithm is performing. We also want to label the nuclei with their identifiers for future visual inspection of the results. The output of this step will look like (you will only get this image after running the whole workflow):</p>\n\n<figure id=\"figure-4\" style=\"max-width: 90%;\"><img src=\"../../images/tutorial-CP/img_nuclei_labels.png\" alt=\"Identified nuclei with labels. \" width=\"1534\" height=\"1180\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/tutorial-CP/img_nuclei_labels.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 4</strong>:</span> Identified nuclei with labels.</figcaption></figure>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <p>Why are some nuclei not labeled in the image above?</p>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <p>We have indicated to the tool <strong>IdentifyPrimaryObjects</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> that the nuclei that are either outside the diameter range or touching the border should be discarded.</p>\n\n  </blockquote>\n\n</blockquote>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Mask the nuclei detected</hands-on-title>\n\n  <ol>\n    <li><strong>ConvertObjectsToImage</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select the input CellProfiler pipeline”</em>: <code class=\"language-plaintext highlighter-rouge\">output_pipeline</code> (output of <strong>IdentifyPrimaryObjects</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Enter the name of the input objects you want to convert to an image”</em>: <code class=\"language-plaintext highlighter-rouge\">Nuclei</code></li>\n        <li><em>“Enter the name of the resulting image”</em>: <code class=\"language-plaintext highlighter-rouge\">MaskNuclei</code></li>\n        <li><em>“Select the color format”</em>: <code class=\"language-plaintext highlighter-rouge\">Binary (black &amp; white)</code></li>\n      </ul>\n    </li>\n    <li><strong>DisplayDataOnImage</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select the input CellProfiler pipeline”</em>: <code class=\"language-plaintext highlighter-rouge\">output_pipeline</code> (output of <strong>ConvertObjectsToImage</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Display object or image measurements?”</em>: <code class=\"language-plaintext highlighter-rouge\">Object</code>\n          <ul>\n            <li><em>“Enter the name of the input objects”</em>: <code class=\"language-plaintext highlighter-rouge\">Nuclei</code></li>\n            <li><em>“Measurement category”</em>: <code class=\"language-plaintext highlighter-rouge\">Number</code></li>\n          </ul>\n        </li>\n        <li><em>“Enter the name of the image on which to display the measurements”</em>: <code class=\"language-plaintext highlighter-rouge\">DNA</code></li>\n        <li><em>“Display mode”</em>: <code class=\"language-plaintext highlighter-rouge\">Text</code>\n          <ul>\n            <li><em>“Text color”</em>: <code class=\"language-plaintext highlighter-rouge\">#ff0000</code></li>\n            <li><em>“Number of decimals”</em>: <code class=\"language-plaintext highlighter-rouge\">0</code></li>\n          </ul>\n        </li>\n        <li><em>“Name the output image that has the measurements displayed”</em>: <code class=\"language-plaintext highlighter-rouge\">ImageDisplay</code></li>\n      </ul>\n    </li>\n    <li><strong>SaveImages</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select the input CellProfiler pipeline”</em>: <code class=\"language-plaintext highlighter-rouge\">output_pipeline</code> (output of <strong>DisplayDataOnImage</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Select the type of image to save”</em>: <code class=\"language-plaintext highlighter-rouge\">Image</code>\n          <ul>\n            <li><em>“Saved the format to save the image(s)”</em>: <code class=\"language-plaintext highlighter-rouge\">tiff</code></li>\n          </ul>\n        </li>\n        <li><em>“Enter the name of the image to save”</em>: <code class=\"language-plaintext highlighter-rouge\">ImageDisplay</code></li>\n        <li><em>“Select method for constructing file names”</em>: <code class=\"language-plaintext highlighter-rouge\">From image filename</code>\n          <ul>\n            <li><em>“Enter the image name (from NamesAndTypes) to be used as file prefix”</em>: <code class=\"language-plaintext highlighter-rouge\">DNA</code></li>\n            <li><em>“Append a suffix to the image file name?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code>\n              <ul>\n                <li><em>“Text to append to the image name”</em>: <code class=\"language-plaintext highlighter-rouge\">_nucleiNumbers</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n        <li><em>“Overwrite existing files without warning?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title></comment-title>\n\n        <p>The <code class=\"language-plaintext highlighter-rouge\">Text color</code> parameter can be any of your choice, the hexa code is not really relevant. The only consideration is that it needs to be visible on top of the nuclei.</p>\n      </blockquote>\n    </li>\n  </ol>\n</blockquote>\n\n<h2 id=\"segment-nucleoli\">Segment nucleoli</h2>\n\n<p>The nucleoli are lacking intensity in the DNA staining and therefore, we need to enhance the black holes before masking.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Detect and mask dark holes</hands-on-title>\n\n  <ol>\n    <li><strong>EnhanceOrSuppressFeatures</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select the input CellProfiler pipeline”</em>: <code class=\"language-plaintext highlighter-rouge\">output_pipeline</code> (output of <strong>SaveImages</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Enter the name of the input image”</em>: <code class=\"language-plaintext highlighter-rouge\">DNA</code></li>\n        <li><em>“Enter a name for the resulting image”</em>: <code class=\"language-plaintext highlighter-rouge\">DNAdarkholes</code></li>\n        <li><em>“Select the operation”</em>: <code class=\"language-plaintext highlighter-rouge\">Enhance</code>\n          <ul>\n            <li><em>“Feature type”</em>: <code class=\"language-plaintext highlighter-rouge\">Dark holes</code>\n              <ul>\n                <li><em>“Maximum hole size”</em>: <code class=\"language-plaintext highlighter-rouge\">15</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li><strong>MaskImage</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select the input CellProfiler pipeline”</em>: <code class=\"language-plaintext highlighter-rouge\">output_pipeline</code> (output of <strong>EnhanceOrSuppressFeatures</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Enter the name of the input image”</em>: <code class=\"language-plaintext highlighter-rouge\">DNAdarkholes</code></li>\n        <li><em>“Enter the name of the resulting image”</em>: <code class=\"language-plaintext highlighter-rouge\">MaskDNAdarkholes</code></li>\n        <li><em>“Use objects or an image as a mask?”</em>: <code class=\"language-plaintext highlighter-rouge\">Objects</code>\n          <ul>\n            <li><em>“Enter the name objects to mask the input image”</em>: <code class=\"language-plaintext highlighter-rouge\">Nuclei</code></li>\n          </ul>\n        </li>\n        <li><em>“Invert the mask?”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>Now that we have all the holes in one mask, we can segment the nucleoli as individual objects in the same way as we did with the nuclei. All the nucleoli can be then combined into one single image.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Segment nucleoli as individual objects</hands-on-title>\n\n  <ol>\n    <li><strong>IdentifyPrimaryObjects</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select the input CellProfiler pipeline”</em>: <code class=\"language-plaintext highlighter-rouge\">output_pipeline</code> (output of <strong>MaskImage</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Use advanced settings?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes, use advanced settings</code>\n          <ul>\n            <li><em>“Enter the name of the input image (from NamesAndTypes)”</em>: <code class=\"language-plaintext highlighter-rouge\">MaskDNAdarkholes</code></li>\n            <li><em>“Enter the name of the primary objects to be identified”</em>: <code class=\"language-plaintext highlighter-rouge\">Nucleoli</code></li>\n            <li><em>“Typical minimum diameter of objects, in pixel units (Min)”</em>: <code class=\"language-plaintext highlighter-rouge\">2</code></li>\n            <li><em>“Typical maximum diameter of objects, in pixel units (Max)”</em>: <code class=\"language-plaintext highlighter-rouge\">15</code></li>\n            <li><em>“Discard objects touching the border of the image?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n            <li><em>“Threshold strategy”</em>: <code class=\"language-plaintext highlighter-rouge\">Global</code>\n              <ul>\n                <li><em>“Thresholding method”</em>: <code class=\"language-plaintext highlighter-rouge\">Otsu</code>\n                  <ul>\n                    <li><em>“Two-class or three-class thresholding?”</em>: <code class=\"language-plaintext highlighter-rouge\">Two classes</code></li>\n                    <li><em>“Threshold correction factor”</em>: <code class=\"language-plaintext highlighter-rouge\">0.9</code></li>\n                  </ul>\n                </li>\n              </ul>\n            </li>\n            <li><em>“Method to distinguish clumped objects”</em>: <code class=\"language-plaintext highlighter-rouge\">Shape</code>\n              <ul>\n                <li><em>“Method to draw dividing lines between clumped objects”</em>: <code class=\"language-plaintext highlighter-rouge\">Shape</code>\n                  <ul>\n                    <li><em>“Automatically calculate size of smoothing filter for declumping?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n                    <li><em>“Automatically calculate minimum allowed distance between local maxima?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n                  </ul>\n                </li>\n              </ul>\n            </li>\n            <li><em>“Handling of objects if excessive number of objects identified”</em>: <code class=\"language-plaintext highlighter-rouge\">Continue</code></li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li><strong>ConvertObjectsToImage</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select the input CellProfiler pipeline”</em>: <code class=\"language-plaintext highlighter-rouge\">output_pipeline</code> (output of <strong>IdentifyPrimaryObjects</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Enter the name of the input objects you want to convert to an image”</em>: <code class=\"language-plaintext highlighter-rouge\">Nucleoli</code></li>\n        <li><em>“Enter the name of the resulting image”</em>: <code class=\"language-plaintext highlighter-rouge\">MaskNucleoli</code></li>\n        <li><em>“Select the color format”</em>: <code class=\"language-plaintext highlighter-rouge\">Binary (black &amp; white)</code></li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h2 id=\"combine-segmentation-masks\">Combine segmentation masks</h2>\n\n<p>We have now one segmentation mask per image with all the nuclei detected, <code class=\"language-plaintext highlighter-rouge\">MaskNuclei</code>, and another one for the nucleoli, <code class=\"language-plaintext highlighter-rouge\">MaskNucleoli</code>. These are binary masks in which the background is black and the objects detected are white. We would like to check whether both segmentation steps went well. That could be achieved by combining both of them (using different colors) into one image. Here, we are converting the nucleus mask to blue and the nucleoli to magenta. The outcome that you will obtain after the execution of the workflow will look like:</p>\n\n<figure id=\"figure-5\" style=\"max-width: 90%;\"><img src=\"../../images/tutorial-CP/img_combined_masks.png\" alt=\"Combined mask for nuclei and nucleoli. \" width=\"2116\" height=\"1708\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/tutorial-CP/img_combined_masks.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 5</strong>:</span> Combined segmentation masks for nuclei (blue) and nucleoli (magenta).</figcaption></figure>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Convert and save the nuclei and nucleoli masks</hands-on-title>\n\n  <ol>\n    <li><strong>GrayToColor</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select the input CellProfiler pipeline”</em>: <code class=\"language-plaintext highlighter-rouge\">output_pipeline</code> (output of <strong>ConvertObjectsToImage</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Enter the name of the resulting image”</em>: <code class=\"language-plaintext highlighter-rouge\">CombinedMask</code></li>\n        <li><em>“Select a color scheme”</em>: <code class=\"language-plaintext highlighter-rouge\">RGB</code>\n          <ul>\n            <li><em>“Enter the name of the image to be colored red”</em>: <code class=\"language-plaintext highlighter-rouge\">MaskNucleoli</code></li>\n            <li><em>“Relative weight for the red image”</em>: <code class=\"language-plaintext highlighter-rouge\">0.8</code></li>\n            <li><em>“Enter the name of the image to be colored blue”</em>: <code class=\"language-plaintext highlighter-rouge\">MaskNuclei</code></li>\n            <li><em>“Relative weight for the blue image”</em>: <code class=\"language-plaintext highlighter-rouge\">0.5</code></li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li><strong>SaveImages</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select the input CellProfiler pipeline”</em>: <code class=\"language-plaintext highlighter-rouge\">output_pipeline</code> (output of <strong>GrayToColor</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Select the type of image to save”</em>: <code class=\"language-plaintext highlighter-rouge\">Image</code>\n          <ul>\n            <li><em>“Saved the format to save the image(s)”</em>: <code class=\"language-plaintext highlighter-rouge\">tiff</code></li>\n          </ul>\n        </li>\n        <li><em>“Enter the name of the image to save”</em>: <code class=\"language-plaintext highlighter-rouge\">CombinedMask</code></li>\n        <li><em>“Select method for constructing file names”</em>: <code class=\"language-plaintext highlighter-rouge\">From image filename</code>\n          <ul>\n            <li><em>“Enter the image name (from NamesAndTypes) to be used as file prefix”</em>: <code class=\"language-plaintext highlighter-rouge\">DNA</code></li>\n            <li><em>“Append a suffix to the image file name?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code>\n              <ul>\n                <li><em>“Text to append to the image name”</em>: <code class=\"language-plaintext highlighter-rouge\">_combinedMask</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n        <li><em>“Overwrite existing files without warning?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title></comment-title>\n\n        <ul>\n          <li>You can pick any other color of your choice, as long as the contrast is good enough to distinguish both objects.</li>\n          <li>We are saving here a tiff image but any other format of your choice would work too.</li>\n        </ul>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h1 id=\"background-extraction\">Background extraction</h1>\n\n<p>The background extraction is useful for quality control. For instance, in a high-exposed or low-contrast image, the nuclei will not be very different from the background and that may lead to the wrong segmentation.</p>\n\n<p>To extract the background, we first need to get the foreground and subtract it from the original image. We already have the nuclei mask, however, we excluded incomplete nuclei, i.e., those touching the borders or those which sizes are outside the specified range. This means that the mask is not covering all the nuclei and we need to get rid of the constraints to get the complete foreground. At this stage, we want to detect everything with a certain intensity (foreground) and subtract it from the complete image to get the background.</p>\n\n<h2 id=\"identify-the-foreground\">Identify the foreground</h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Segment all nuclei</hands-on-title>\n\n  <ol>\n    <li><strong>IdentifyPrimaryObjects</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select the input CellProfiler pipeline”</em>: <code class=\"language-plaintext highlighter-rouge\">output_pipeline</code> (output of <strong>SaveImages</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Use advanced settings?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes, use advanced settings</code>\n          <ul>\n            <li><em>“Enter the name of the input image (from NamesAndTypes)”</em>: <code class=\"language-plaintext highlighter-rouge\">DNA</code></li>\n            <li><em>“Enter the name of the primary objects to be identified”</em>: <code class=\"language-plaintext highlighter-rouge\">NucleiIncludingTouchingBorders</code></li>\n            <li><em>“Typical minimum diameter of objects, in pixel units (Min)”</em>: <code class=\"language-plaintext highlighter-rouge\">15</code></li>\n            <li><em>“Typical maximum diameter of objects, in pixel units (Max)”</em>: <code class=\"language-plaintext highlighter-rouge\">200</code></li>\n            <li><em>“Discard objects outside the diameter range?”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n            <li><em>“Discard objects touching the border of the image?”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n            <li><em>“Threshold strategy”</em>: <code class=\"language-plaintext highlighter-rouge\">Global</code>\n              <ul>\n                <li><em>“Thresholding method”</em>: <code class=\"language-plaintext highlighter-rouge\">Otsu</code>\n                  <ul>\n                    <li><em>“Two-class or three-class thresholding?”</em>: <code class=\"language-plaintext highlighter-rouge\">Two classes</code></li>\n                    <li><em>“Threshold correction factor”</em>: <code class=\"language-plaintext highlighter-rouge\">0.9</code></li>\n                  </ul>\n                </li>\n              </ul>\n            </li>\n            <li><em>“Method to distinguish clumped objects”</em>: <code class=\"language-plaintext highlighter-rouge\">Shape</code>\n              <ul>\n                <li><em>“Method to draw dividing lines between clumped objects”</em>: <code class=\"language-plaintext highlighter-rouge\">Shape</code>\n                  <ul>\n                    <li><em>“Automatically calculate size of smoothing filter for declumping?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n                    <li><em>“Automatically calculate minimum allowed distance between local maxima?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n                  </ul>\n                </li>\n              </ul>\n            </li>\n            <li><em>“Handling of objects if excessive number of objects identified”</em>: <code class=\"language-plaintext highlighter-rouge\">Continue</code></li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li><strong>ConvertObjectsToImage</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select the input CellProfiler pipeline”</em>: <code class=\"language-plaintext highlighter-rouge\">output_pipeline</code> (output of <strong>IdentifyPrimaryObjects</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Enter the name of the input objects you want to convert to an image”</em>: <code class=\"language-plaintext highlighter-rouge\">NucleiIncludingTouchingBorders</code></li>\n        <li><em>“Enter the name of the resulting image”</em>: <code class=\"language-plaintext highlighter-rouge\">Image_NucleiIncludingTouchingBorders</code></li>\n        <li><em>“Select the color format”</em>: <code class=\"language-plaintext highlighter-rouge\">Binary (black &amp; white)</code></li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h2 id=\"remove-the-foreground-from-the-original-image\">Remove the foreground from the original image</h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Subtract the foreground from the original image</hands-on-title>\n\n  <p><strong>ImageMath</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:</p>\n  <ul>\n    <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select the input CellProfiler pipeline”</em>: <code class=\"language-plaintext highlighter-rouge\">output_pipeline</code> (output of <strong>ConvertObjectsToImage</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n    <li><em>“Enter a name for the resulting image”</em>: <code class=\"language-plaintext highlighter-rouge\">BG</code></li>\n    <li><em>“Operation”</em>: <code class=\"language-plaintext highlighter-rouge\">Subtract</code>\n      <ul>\n        <li>In <em>“First Image”</em>:\n          <ul>\n            <li><em>“Image or measurement?”</em>: <code class=\"language-plaintext highlighter-rouge\">Image</code>\n              <ul>\n                <li><em>“Enter the name of the first image”</em>: <code class=\"language-plaintext highlighter-rouge\">DNA</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n        <li>In <em>“Second Image”</em>:\n          <ul>\n            <li><em>“Image or measurement?”</em>: <code class=\"language-plaintext highlighter-rouge\">Image</code>\n              <ul>\n                <li><em>“Enter the name of the second image”</em>: <code class=\"language-plaintext highlighter-rouge\">Image_NucleiIncludingTouchingBorders</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li><em>“Ignore the image masks?”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n  </ul>\n\n</blockquote>\n\n<h1 id=\"feature-extraction\">Feature extraction</h1>\n\n<p>Now that we have the objects of interest segmented and the background extracted, we can start measuring parameters on them. In particular it is relevant to:</p>\n\n<ul>\n  <li>measure the granularity, texture and intensity of the nuclei and original image,</li>\n  <li>measure the intensity of the original image, the background and foreground,</li>\n  <li>measure the size and shape of nuclei and nucleoli,</li>\n  <li>assess the quality of the original image,</li>\n  <li>measure the area ocuppied by nuclei and nucleoli.</li>\n</ul>\n\n<p>A step that requires special attention is the relationship nucleolus-nucleus. This is useful to compute statistics on the number of nucleoli by nucleus.</p>\n\n<blockquote class=\"comment\">\n  <comment-title></comment-title>\n\n  <p>The order in which the tools in this section are chained is not relevant for the outcome.</p>\n</blockquote>\n\n<h2 id=\"measure-the-granularity-texture-intensity-size-and-shape\">Measure the granularity, texture, intensity, size and shape</h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Measure the granularity, texture, intensity, size and shape</hands-on-title>\n\n  <ol>\n    <li><strong>MeasureGranularity</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select the input CellProfiler pipeline”</em>: <code class=\"language-plaintext highlighter-rouge\">output_pipeline</code> (output of <strong>ImageMath</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li>In <em>“new image”</em>:\n          <ul>\n            <li><i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert new image”</em>\n              <ul>\n                <li><em>“Enter the name of a greyscale image to measure”</em>: <code class=\"language-plaintext highlighter-rouge\">DNA</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li><strong>MeasureTexture</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select the input CellProfiler pipeline”</em>: <code class=\"language-plaintext highlighter-rouge\">output_pipeline</code> (output of <strong>MeasureGranularity</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li>In <em>“new image”</em>:\n          <ul>\n            <li><i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert new image”</em>\n              <ul>\n                <li><em>“Enter the name of an image to measure”</em>: <code class=\"language-plaintext highlighter-rouge\">DNA</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n        <li><em>“Measure images or objects?”</em>: <code class=\"language-plaintext highlighter-rouge\">Objects</code>\n          <ul>\n            <li>In <em>“new object”</em>:\n              <ul>\n                <li><i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert new object”</em>\n                  <ul>\n                    <li><em>“Enter the names of the objects to measure”</em>: <code class=\"language-plaintext highlighter-rouge\">Nuclei</code></li>\n                  </ul>\n                </li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li><strong>MeasureObjectIntensity</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select the input CellProfiler pipeline”</em>: <code class=\"language-plaintext highlighter-rouge\">output_pipeline</code> (output of <strong>MeasureTexture</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li>In <em>“new image”</em>:\n          <ul>\n            <li><i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert new image”</em>\n              <ul>\n                <li><em>“Enter the name of an image to measure”</em>: <code class=\"language-plaintext highlighter-rouge\">DNA</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n        <li>In <em>“new object”</em>:\n          <ul>\n            <li><i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert new object”</em>\n              <ul>\n                <li><em>“Enter the name of the objects to measure”</em>: <code class=\"language-plaintext highlighter-rouge\">Nuclei</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li><strong>MeasureObjectSizeShape</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select the input CellProfiler pipeline”</em>: <code class=\"language-plaintext highlighter-rouge\">output_pipeline</code> (output of <strong>MeasureObjectIntensity</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li>In <em>“new object”</em>:\n          <ul>\n            <li><i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert new object”</em>\n              <ul>\n                <li><em>“Enter the name of the object to measure”</em>: <code class=\"language-plaintext highlighter-rouge\">Nuclei</code></li>\n              </ul>\n            </li>\n            <li><i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert new object”</em>\n              <ul>\n                <li><em>“Enter the name of the object to measure”</em>: <code class=\"language-plaintext highlighter-rouge\">Nucleoli</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <p>Why are we measuring the granularity, texture and intensity of the original image and the nuclei only?</p>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <p>The nucleoli was not stained in the DNA channel and hence, the granularity, texture and intensity are constant values.</p>\n\n  </blockquote>\n\n</blockquote>\n\n<h2 id=\"relate-nucleoli-to-their-parent-nucleus\">Relate nucleoli to their parent nucleus</h2>\n\n<p>It might be relevant to compute some statistics on the number of nucleoli inside each nucleus. CellProfiler has a very interesting module to relate both objects, in which each one of the nucleoli is assigned an identifier and linked to the identifier of its parent nucleus.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Relate nucleoli to their parent nucleus</hands-on-title>\n\n  <ol>\n    <li><strong>RelateObjects</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select the input CellProfiler pipeline”</em>: <code class=\"language-plaintext highlighter-rouge\">output_pipeline</code> (output of <strong>MeasureObjectSizeShape</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Parent objects”</em>: <code class=\"language-plaintext highlighter-rouge\">Nuclei</code></li>\n        <li><em>“Child objects”</em>: <code class=\"language-plaintext highlighter-rouge\">Nucleoli</code></li>\n        <li><em>“Calculate child-parent distances?”</em>: <code class=\"language-plaintext highlighter-rouge\">Both</code>\n          <ul>\n            <li><em>“Calculate distances to other parents?”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n          </ul>\n        </li>\n        <li><em>“Do you want to save the children with parents as a new object set?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h2 id=\"measure-the-image-quality-related-parameters\">Measure the image quality-related parameters</h2>\n\n<p>In this section, we will measure the image quality, the area occupied by the nuclei and nucleoli in the original image and the intensity of the foreground and background.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Measure the image quality</hands-on-title>\n\n  <ol>\n    <li><strong>MeasureImageQuality</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select the input CellProfiler pipeline”</em>: <code class=\"language-plaintext highlighter-rouge\">output_pipeline</code> (output of <strong>RelateObjects</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Calculate blur metrics?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n        <li><em>“Calculate thresholds?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code>\n          <ul>\n            <li><em>“Use all thresholding methods?”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code>\n              <ul>\n                <li>In <em>“new threshold method”</em>:\n                  <ul>\n                    <li><i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert new threshold method”</em>\n                      <ul>\n                        <li><em>“Select a thresholding method”</em>: <code class=\"language-plaintext highlighter-rouge\">Otsu</code>\n                          <ul>\n                            <li><em>“Two-class or three-class thresholding?”</em>: <code class=\"language-plaintext highlighter-rouge\">Two classes</code></li>\n                          </ul>\n                        </li>\n                      </ul>\n                    </li>\n                  </ul>\n                </li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li><strong>MeasureImageAreaOccupied</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select the input CellProfiler pipeline”</em>: <code class=\"language-plaintext highlighter-rouge\">output_pipeline</code> (output of <strong>MeasureImageQuality</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li>In <em>“new area”</em>:\n          <ul>\n            <li><i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert new area”</em>\n              <ul>\n                <li><em>“Measure the area occupied in a binary image, or in objects?”</em>: <code class=\"language-plaintext highlighter-rouge\">Objects</code>\n                  <ul>\n                    <li><em>“Enter the name of the objects to measure”</em>: <code class=\"language-plaintext highlighter-rouge\">Nuclei</code></li>\n                  </ul>\n                </li>\n              </ul>\n            </li>\n            <li><i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert new area”</em>\n              <ul>\n                <li><em>“Measure the area occupied in a binary image, or in objects?”</em>: <code class=\"language-plaintext highlighter-rouge\">Objects</code>\n                  <ul>\n                    <li><em>“Enter the name of the objects to measure”</em>: <code class=\"language-plaintext highlighter-rouge\">Nucleoli</code></li>\n                  </ul>\n                </li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li><strong>MeasureImageIntensity</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select the input CellProfiler pipeline”</em>: <code class=\"language-plaintext highlighter-rouge\">output_pipeline</code> (output of <strong>MeasureImageAreaOccupied</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li>In <em>“new image”</em>:\n          <ul>\n            <li><i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert new image”</em>\n              <ul>\n                <li><em>“Enter the name of the image to measure”</em>: <code class=\"language-plaintext highlighter-rouge\">DNA</code></li>\n                <li><em>“Measure the intensity only from areas enclosed by objects?”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n              </ul>\n            </li>\n            <li><i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert new image”</em>\n              <ul>\n                <li><em>“Enter the name of the image to measure”</em>: <code class=\"language-plaintext highlighter-rouge\">DNA</code></li>\n                <li><em>“Measure the intensity only from areas enclosed by objects?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code>\n                  <ul>\n                    <li><em>“Enter the name of the objects that the intensity will be aggregated within”</em>: <code class=\"language-plaintext highlighter-rouge\">Nuclei</code></li>\n                  </ul>\n                </li>\n              </ul>\n            </li>\n            <li><i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert new image”</em>\n              <ul>\n                <li><em>“Enter the name of the image to measure”</em>: <code class=\"language-plaintext highlighter-rouge\">BG</code></li>\n                <li><em>“Measure the intensity only from areas enclosed by objects?”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <p>In step 3, we are measuring the area occupied by objects for the DNA twice. Why is that?</p>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <p>We want to have the global intensity of the image, so the parameter <em>“Measure the intensity only from areas enclosed by objects?”</em> has to be set to <code class=\"language-plaintext highlighter-rouge\">No</code>. However, we also want to obtain the intensity of the foreground, so only the parts of the images that are enclosed by nuclei.</p>\n\n  </blockquote>\n\n</blockquote>\n\n<h2 id=\"export-the-features-to-a-csv\">Export the features to a CSV</h2>\n\n<p>All the parameters that we have measured related to the images and objects need to be exported to a file for each one of 6 example images analysed.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Export features</hands-on-title>\n\n  <p><strong>ExportToSpreadsheet</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:</p>\n  <ul>\n    <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select the input CellProfiler pipeline”</em>: <code class=\"language-plaintext highlighter-rouge\">output_pipeline</code> (output of <strong>MeasureImageIntensity</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n    <li><em>“Select the column delimiter”</em>: <code class=\"language-plaintext highlighter-rouge\">Tab</code></li>\n    <li><em>“Add a prefix to file names?”</em>: <code class=\"language-plaintext highlighter-rouge\">Do not add prefix to the file name</code></li>\n    <li><em>“Create a GenePattern GCT file?”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n    <li><em>“Export all measurement types?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n  </ul>\n\n</blockquote>\n\n<h1 id=\"run-the-cellprofiler-pipeline\">Run the CellProfiler pipeline</h1>\n\n<p>All the steps in our workflow (except for the <strong>IDR download</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>) have been passing through an <code class=\"language-plaintext highlighter-rouge\">output_pipeline</code> as a parameter. This was the way to assemble all the modules from CellProfiler, now we can run all of them together!</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Run CellProfiler pipeline</hands-on-title>\n\n  <p><strong>CellProfiler</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> with the following parameters:</p>\n  <ul>\n    <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Pipeline file”</em>: <code class=\"language-plaintext highlighter-rouge\">output_pipeline</code> (output of <strong>ExportToSpreadsheet</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n    <li><em>“Are the input images packed into a tar archive?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code>\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“A tarball of images”</em>: <code class=\"language-plaintext highlighter-rouge\">output_tar</code> (output of <strong>IDR Download</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n      </ul>\n    </li>\n    <li><em>“Detailed logging file?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n  </ul>\n\n  <blockquote class=\"comment\">\n    <comment-title></comment-title>\n\n    <p>This is the only time-consuming step of the workflow, as it needs to perform the whole analysis in the input dataset.</p>\n  </blockquote>\n\n</blockquote>\n\n<h1 id=\"conclusion\">Conclusion</h1>\n\n<p>In this tutorial, you have downloaded images from a public image repository into your Galaxy history. After that, you have built and run a typical image analysis pipeline, composed of segmentation of several objects and feature extraction. As an outcome, you got plenty of features to analyse! And some masks to check that the segmentation algorithms worked as expected. Now you are ready to perform your biological data analysis!</p>\n"],"ref_slides":["### What is the nucleoli?\n\n- Membrane-less organelle in the nucleus of the cell\n- Functions: ribosome biogenesis and cell cycle regulation\n\n.image-55[\n  ![image of four cells, one is dividing, and red arrows point to the 5 nucleii](../../images/tutorial-CP/img_dna_channel.png)\n]\n\n???\nIn the DNA channel, the nucleoli is shown as the absence of DNA (red arrows).\n---\n\n\n### Data\n\n- The data can be downloaded from the Image Data Resource ([IDR](http://idr.openmicroscopy.org/))\n\n.image-65[\n  ![screenshot of a complex tool interface showing an array of images (1) and then two selected images below it (2) and a configuration panel on the right (3)](../../images/tutorial-CP/IDR_interface.jpg)\n]\n\n???\nIn the IDR the images can be selected in the user interface (1). The images will then show up at the bottom (2) where they need to be selected once again and then copy the URL from the link icon on the top left (3). That URL contains the image ids that will be downloaded.\nYou can also bring your images by uploading the DNA channel of your images to your Galaxy history.\n---\n\n\n### General Workflow\n\n- The workflow contains 4 basic parts:\n  - Segmentation of the nuclei\n  - Segmentation of the nucleoli that fall inside the nuclei\n  - Background detection\n  - Feature extraction of the images and objects\n\n![screenshot of a galaxy workflow with four sections highlighted by boxes reading nuclei, nucleoli, background, and feature extraction.](../../images/tutorial-CP/wf.jpg \"High-level view of the workflow\")\n\n???\n- Segmentation of the nucleoli: since there is no staining for the nucleoli, the holes need to be detected and segmented.\n- Feature extraction: the order of the tools does not affect the outcome.\n- Background detection: Detection of the foreground and subtraction from the image.\n---\n\n\n### 1) Segment nuclei\n\n  ![Inset to the first portion of the above overview image showing nuclei with 5 steps, starting modules, segment complete nuclei, segmentation mask complete nuclei, label nuclei, and save labelled nuclei.](../../images/tutorial-CP/subwf_nuclei.jpg)\n\n???\nEvery CellProfiler pipeline needs to start by processing the metadata with the tool \"Starting modules\".\n\n- Segment complete nuclei: this tool identifies the nuclei within a certain size and excludes those cells that are touching the borders of the image.\n- Segmentation mask complete nuclei: gathers all the nuclei identified in the previous step in one mask.\n- Label and save labelled nuclei: adds the id of each nucleus on top of it. This can be useful later for a proper interpretation of the data analysis.---\n\n\n### Segmentation and labelling of the nuclei\n\n![a photo of cells in black and white, several cells have red numbers written atop them.](../../images/tutorial-CP/img_nuclei_labels.png \"Identified nuclei with labels\")\n\n???\nResulting image after the first logical step of the workflow in which the nuclei were segmented and labelled.\n---\n\n\n### 2) Segment nucleoli\n\n![Inset of the nucleoli portion of the workflow with the following steps: detect dark holes in nuclei, segment nucleoli that fall inside nuclei, segment nucleoli, convert the segmented nucleoli into an image, combine masks (nuclei+nucleoli), and finally save combined segmentation masks.](../../images/tutorial-CP/subwf_nucleoli.jpg)\n\n\n???\nTo identify the nucleoli the first step is to enhance the dark holes so that they can be segmented.\nThe segmentation of the dark holes will take place only when the dark holes fall inside a nucleus. This is to avoid the detection of wrong objects outside the cell.\nAt this step, the segmentation of the nucleoli can be performed.\nIt will be useful for visual exploration that the masks of the nuclei and nucleoli are saved together into one segmentation mask.\n---\n\n\n### Combined mask: nuclei + nucleoli\n\n![image of the cells again, but now cells are blue and nuclei/nucleoli are red.](../../images/tutorial-CP/img_combined_masks.png \"Nuclei and nucleoli masks combined in which the nuclei are in blue and nucleoli in magenta.\")\n\n???\nThe combination of both masks gives an image with the nuclei in blue and the nucleoli in magenta.\n---\n\n\n### Background extraction\n\n![third inset workflow, background extraction, with steps segment all nuclei, segmentation mask nucleoli including cells touching borders, and extract background.](../../images/tutorial-CP/subwf_background.jpg)\n\n???\n\nThe extraction of the background can be useful to measure features that indicate that the images are artefacts.\nTo get the background we first select the foreground and subtract it from the original image.\nWe have partially detected the foreground in the nuclei segmentation in previous steps. However, that mask only included just those objects within a max and a min pixel size. We also discarded the images touching the borders. Here, we get rid of the constraints and segment all the nuclei.\n\n---\n\n\n### Feature extraction\n\n![The final inset, feature extraction with very small steps.](../../images/tutorial-CP/subwf_feature_extraction.jpg)\n\n- **Important:** Relate nucleoli and parent nucleus\n\n???\nThe features can be extracted from the images and the objects. Depending on which type of object and the interest of the study, different parameters can be measured.\nThe module that relates the objects is useful to export a table with the ids of the nucleoli in relation with their parent nuclei. That's useful for a meaningful interpretation of the data.\n"],"video_library":{"tutorial":null,"slides":null,"demo":null,"both":null,"session":null},"hands_on":true,"slides":true,"mod_date":"2023-11-03 14:30:27 +0000","pub_date":"2020-07-01 17:08:12 +0000","version":20,"workflows":[{"workflow":"main_workflow.ga","tests":false,"url":"https://training.galaxyproject.org/training-material/topics/imaging/tutorials/tutorial-CP/workflows/main_workflow.ga","path":"topics/imaging/tutorials/tutorial-CP/workflows/main_workflow.ga","wfid":"imaging-tutorial-CP","wfname":"main_workflow","trs_endpoint":"https://training.galaxyproject.org/training-material/api/ga4gh/trs/v2/tools/imaging-tutorial-CP/versions/main_workflow","license":null,"creators":[],"name":"CP_pipeline_IDR_training","title":"CP_pipeline_IDR_training","test_results":null,"modified":"2024-06-13 07:34:10 +0000","mermaid":"flowchart TD\n  0[\"Starting modules\"];\n  1[\"Download images\"];\n  2[\"Segment complete nuclei\"];\n  0 -->|output_pipeline| 2;\n  3[\"Segmentation mask complete nuclei\"];\n  2 -->|output_pipeline| 3;\n  4[\"Label nuclei\"];\n  3 -->|output_pipeline| 4;\n  5[\"Save labelled nuclei\"];\n  4 -->|output_pipeline| 5;\n  6[\"Detect dark holes in nuclei\"];\n  5 -->|output_pipeline| 6;\n  7[\"Segment nucleoli that fall inside nuclei\"];\n  6 -->|output_pipeline| 7;\n  8[\"Segment nucleoli\"];\n  7 -->|output_pipeline| 8;\n  9[\"Convert the segmented nucleoli into an image\"];\n  8 -->|output_pipeline| 9;\n  10[\"Combine masks nuclei + nucleoli\"];\n  9 -->|output_pipeline| 10;\n  11[\"Save combined segmentation masks\"];\n  10 -->|output_pipeline| 11;\n  12[\"Segment all nuclei\"];\n  11 -->|output_pipeline| 12;\n  13[\"Segmentation mask nucleoli including cells touching borders\"];\n  12 -->|output_pipeline| 13;\n  14[\"Extract background\"];\n  13 -->|output_pipeline| 14;\n  15[\"Measure the image granularity\"];\n  14 -->|output_pipeline| 15;\n  16[\"Measure the nuclei texture\"];\n  15 -->|output_pipeline| 16;\n  17[\"Measure the nuclei intensity\"];\n  16 -->|output_pipeline| 17;\n  18[\"Measure size and shape of nuclei and nucleoli\"];\n  17 -->|output_pipeline| 18;\n  19[\"Relate nucleoli with their parent nuclei\"];\n  18 -->|output_pipeline| 19;\n  20[\"Measure the image quality\"];\n  19 -->|output_pipeline| 20;\n  21[\"Measure the area occupied by nuclei and nucleoli\"];\n  20 -->|output_pipeline| 21;\n  22[\"Measure the image intensity\"];\n  21 -->|output_pipeline| 22;\n  23[\"Export measurements\"];\n  22 -->|output_pipeline| 23;\n  24[\"Run CellProfiler\"];\n  1 -->|output_tar| 24;\n  23 -->|output_pipeline| 24;"}],"api":"https://training.galaxyproject.org/training-material/api/topics/imaging/tutorials/tutorial-CP/tutorial.json","tools":["toolshed.g2.bx.psu.edu/repos/bgruening/cp_cellprofiler/cp_cellprofiler/3.1.9","toolshed.g2.bx.psu.edu/repos/bgruening/cp_common/cp_common/3.1.9","toolshed.g2.bx.psu.edu/repos/bgruening/cp_convert_objects_to_image/cp_convert_objects_to_image/3.1.9","toolshed.g2.bx.psu.edu/repos/bgruening/cp_display_data_on_image/cp_display_data_on_image/3.1.9","toolshed.g2.bx.psu.edu/repos/bgruening/cp_enhance_or_suppress_features/cp_enhance_or_suppress_features/3.1.9","toolshed.g2.bx.psu.edu/repos/bgruening/cp_export_to_spreadsheet/cp_export_to_spreadsheet/3.1.9","toolshed.g2.bx.psu.edu/repos/bgruening/cp_gray_to_color/cp_gray_to_color/3.1.9","toolshed.g2.bx.psu.edu/repos/bgruening/cp_identify_primary_objects/cp_identify_primary_objects/3.1.9","toolshed.g2.bx.psu.edu/repos/bgruening/cp_image_math/cp_image_math/0.1.0","toolshed.g2.bx.psu.edu/repos/bgruening/cp_mask_image/cp_mask_image/3.1.9","toolshed.g2.bx.psu.edu/repos/bgruening/cp_measure_granularity/cp_measure_granularity/3.1.9","toolshed.g2.bx.psu.edu/repos/bgruening/cp_measure_image_area_occupied/cp_measure_image_area_occupied/3.1.9","toolshed.g2.bx.psu.edu/repos/bgruening/cp_measure_image_intensity/cp_measure_image_intensity/3.1.9","toolshed.g2.bx.psu.edu/repos/bgruening/cp_measure_image_quality/cp_measure_image_quality/3.1.9","toolshed.g2.bx.psu.edu/repos/bgruening/cp_measure_object_intensity/cp_measure_object_intensity/3.1.9","toolshed.g2.bx.psu.edu/repos/bgruening/cp_measure_object_size_shape/cp_measure_object_size_shape/3.1.9","toolshed.g2.bx.psu.edu/repos/bgruening/cp_measure_texture/cp_measure_texture/3.1.9","toolshed.g2.bx.psu.edu/repos/bgruening/cp_relate_objects/cp_relate_objects/3.1.9","toolshed.g2.bx.psu.edu/repos/bgruening/cp_save_images/cp_save_images/3.1.9","toolshed.g2.bx.psu.edu/repos/iuc/idr_download_by_ids/idr_download_by_ids/0.41"],"supported_servers":{"exact":[{"url":"https://usegalaxy.be/","name":"UseGalaxy.be","usegalaxy":false},{"url":"https://usegalaxy.eu","name":"UseGalaxy.eu","usegalaxy":true}],"inexact":[{"url":"https://usegalaxy.cz/","name":"UseGalaxy.cz","usegalaxy":false},{"url":"https://usegalaxy.fr/","name":"UseGalaxy.fr","usegalaxy":false},{"url":"https://usegalaxy.no/","name":"UseGalaxy.no","usegalaxy":false}]},"topic_name_human":"Imaging","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[{"name":"cp_cellprofiler","owner":"bgruening","revisions":"e917a2424690","tool_panel_section_label":"Imaging","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"cp_common","owner":"bgruening","revisions":"e7273daa5ae2","tool_panel_section_label":"Imaging","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"cp_convert_objects_to_image","owner":"bgruening","revisions":"df3ad3ba5c6f","tool_panel_section_label":"Imaging","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"cp_display_data_on_image","owner":"bgruening","revisions":"2484086dee41","tool_panel_section_label":"Imaging","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"cp_enhance_or_suppress_features","owner":"bgruening","revisions":"f2ed92b011a9","tool_panel_section_label":"Imaging","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"cp_export_to_spreadsheet","owner":"bgruening","revisions":"f8fa0f6718a3","tool_panel_section_label":"Imaging","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"cp_gray_to_color","owner":"bgruening","revisions":"31d195bedf6d","tool_panel_section_label":"Imaging","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"cp_identify_primary_objects","owner":"bgruening","revisions":"993faa34333b","tool_panel_section_label":"Imaging","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"cp_image_math","owner":"bgruening","revisions":"c09dcda1143f","tool_panel_section_label":"Imaging","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"cp_mask_image","owner":"bgruening","revisions":"3a05117669cf","tool_panel_section_label":"Imaging","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"cp_measure_granularity","owner":"bgruening","revisions":"a1a961c46d4b","tool_panel_section_label":"Imaging","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"cp_measure_image_area_occupied","owner":"bgruening","revisions":"20dbb1f7ec7b","tool_panel_section_label":"Imaging","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"cp_measure_image_intensity","owner":"bgruening","revisions":"5499dc6f8ac1","tool_panel_section_label":"Imaging","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"cp_measure_image_quality","owner":"bgruening","revisions":"e972e07c7845","tool_panel_section_label":"Imaging","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"cp_measure_object_intensity","owner":"bgruening","revisions":"980aed9e8fd5","tool_panel_section_label":"Imaging","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"cp_measure_object_size_shape","owner":"bgruening","revisions":"79e10d12d90a","tool_panel_section_label":"Imaging","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"cp_measure_texture","owner":"bgruening","revisions":"035a58c7f54a","tool_panel_section_label":"Imaging","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"cp_relate_objects","owner":"bgruening","revisions":"8083a87d2fdf","tool_panel_section_label":"Imaging","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"cp_save_images","owner":"bgruening","revisions":"4ecf93628f97","tool_panel_section_label":"Imaging","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"idr_download_by_ids","owner":"iuc","revisions":"e08b1dc0480c","tool_panel_section_label":"Imaging","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"}]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools:\n- name: cp_cellprofiler\n  owner: bgruening\n  revisions: e917a2424690\n  tool_panel_section_label: Imaging\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: cp_common\n  owner: bgruening\n  revisions: e7273daa5ae2\n  tool_panel_section_label: Imaging\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: cp_convert_objects_to_image\n  owner: bgruening\n  revisions: df3ad3ba5c6f\n  tool_panel_section_label: Imaging\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: cp_display_data_on_image\n  owner: bgruening\n  revisions: 2484086dee41\n  tool_panel_section_label: Imaging\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: cp_enhance_or_suppress_features\n  owner: bgruening\n  revisions: f2ed92b011a9\n  tool_panel_section_label: Imaging\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: cp_export_to_spreadsheet\n  owner: bgruening\n  revisions: f8fa0f6718a3\n  tool_panel_section_label: Imaging\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: cp_gray_to_color\n  owner: bgruening\n  revisions: 31d195bedf6d\n  tool_panel_section_label: Imaging\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: cp_identify_primary_objects\n  owner: bgruening\n  revisions: 993faa34333b\n  tool_panel_section_label: Imaging\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: cp_image_math\n  owner: bgruening\n  revisions: c09dcda1143f\n  tool_panel_section_label: Imaging\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: cp_mask_image\n  owner: bgruening\n  revisions: 3a05117669cf\n  tool_panel_section_label: Imaging\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: cp_measure_granularity\n  owner: bgruening\n  revisions: a1a961c46d4b\n  tool_panel_section_label: Imaging\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: cp_measure_image_area_occupied\n  owner: bgruening\n  revisions: 20dbb1f7ec7b\n  tool_panel_section_label: Imaging\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: cp_measure_image_intensity\n  owner: bgruening\n  revisions: 5499dc6f8ac1\n  tool_panel_section_label: Imaging\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: cp_measure_image_quality\n  owner: bgruening\n  revisions: e972e07c7845\n  tool_panel_section_label: Imaging\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: cp_measure_object_intensity\n  owner: bgruening\n  revisions: 980aed9e8fd5\n  tool_panel_section_label: Imaging\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: cp_measure_object_size_shape\n  owner: bgruening\n  revisions: 79e10d12d90a\n  tool_panel_section_label: Imaging\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: cp_measure_texture\n  owner: bgruening\n  revisions: 035a58c7f54a\n  tool_panel_section_label: Imaging\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: cp_relate_objects\n  owner: bgruening\n  revisions: 8083a87d2fdf\n  tool_panel_section_label: Imaging\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: cp_save_images\n  owner: bgruening\n  revisions: 4ecf93628f97\n  tool_panel_section_label: Imaging\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: idr_download_by_ids\n  owner: iuc\n  revisions: e08b1dc0480c\n  tool_panel_section_label: Imaging\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n","tours":false,"video":false,"translations":{"tutorial":[],"slides":[],"video":false},"license":"CC-BY-4.0","type":"tutorial"}