{"layout":"tutorial_hands_on","title":"Genome Assembly Quality Control","zenodo_link":"https://zenodo.org/record/6947782","tags":["assembly","quality control"],"questions":["Is my genome assembly ready for annotation and/or scaffolding?"],"objectives":["Assess assembly quality"],"time_estimation":"2h","level":"Intermediate","key_points":["Quast, BUSCO and Merqury make it easy to assess the quality of an assembly","Post-processing can be necessary (purging, scaffolding) before annotation"],"contributors":[{"name":"Anthony Bretaudeau","email":"anthony.bretaudeau@inrae.fr","twitter":"abretau","matrix":"abretaud:matrix.org","orcid":"0000-0003-0914-2470","joined":"2017-09","elixir_node":"fr","contact_for_training":true,"location":{"country":"FR","lat":48.11,"lon":-1.64},"fediverse":"https://genomic.social/@abretaud","fediverse_flavor":"mastodon","affiliations":["gallantries","eurosciencegateway","elixir-europe"],"id":"abretaud","url":"https://training.galaxyproject.org/training-material/api/contributors/abretaud.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/abretaud/"},{"name":"Alexandre Cormier","email":"alexandre.cormier@ifremer.fr","twitter":"allanssx","orcid":"0000-0002-7775-8413","joined":"2021-11","id":"alexcorm","url":"https://training.galaxyproject.org/training-material/api/contributors/alexcorm.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/alexcorm/"},{"name":"Erwan Corre","email":"erwan.corre@sb-roscoff.fr","twitter":"r1corre","orcid":"0000-0001-6354-2278","joined":"2019-04","id":"r1corre","url":"https://training.galaxyproject.org/training-material/api/contributors/r1corre.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/r1corre/"},{"name":"Laura Leroi","email":"laura.leroi@ifremer.fr","orcid":"0000-0003-3748-4179","joined":"2021-11","id":"lleroi","url":"https://training.galaxyproject.org/training-material/api/contributors/lleroi.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/lleroi/"},{"name":"Stéphanie Robin","email":"stephanie.robin@inrae.fr","twitter":"robinstphanie1","orcid":"0000-0001-7379-9173","joined":"2021-11","id":"stephanierobin","url":"https://training.galaxyproject.org/training-material/api/contributors/stephanierobin.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/stephanierobin/"}],"follow_up_training":[{"type":"internal","topic_name":"genome-annotation","tutorials":["repeatmasker"]}],"js_requirements":{"mathjax":null,"mermaid":false},"short_id":"T00028","url":"/topics/assembly/tutorials/assembly-quality-control/tutorial.html","topic_name":"assembly","tutorial_name":"assembly-quality-control","dir":"topics/assembly/tutorials/assembly-quality-control","symlink":null,"id":"assembly/assembly-quality-control","ref_tutorials":["<p>In this tutorial, we will assess the assembly quality of 2 assemblies generated with Hifiasm and Flye using PacBio HiFi reads of a species of fungi, <em>Saccharomyces cerevisiae</em> INSC1019 and compare the results with the actual reference genome <a href=\"https://www.ncbi.nlm.nih.gov/genome/?term=Saccharomyces%20cerevisiae\"><em>Saccharomyces cerevisiae</em> S288C</a>.</p>\n\n<blockquote class=\"agenda\">\n  <agenda-title></agenda-title>\n\n  <p>In this tutorial, we will cover:</p>\n\n<ol id=\"markdown-toc\">\n  <li><a href=\"#get-data\" id=\"markdown-toc-get-data\">Get data</a>    <ol>\n      <li><a href=\"#get-data-from-zenodo\" id=\"markdown-toc-get-data-from-zenodo\">Get data from Zenodo</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#evaluation-of-assembly-contiguity-and-correctness-with-quast\" id=\"markdown-toc-evaluation-of-assembly-contiguity-and-correctness-with-quast\">Evaluation of assembly contiguity and correctness with <strong>Quast</strong></a></li>\n  <li><a href=\"#evaluation-of-assembly-completness\" id=\"markdown-toc-evaluation-of-assembly-completness\">Evaluation of assembly completness</a>    <ol>\n      <li><a href=\"#core-genes-completness-with-busco\" id=\"markdown-toc-core-genes-completness-with-busco\">Core genes completness with <strong>BUSCO</strong></a></li>\n      <li><a href=\"#k-mer-based-assembly-evaluation-with-merqury\" id=\"markdown-toc-k-mer-based-assembly-evaluation-with-merqury\">k-mer based assembly evaluation with <strong>Merqury</strong></a></li>\n    </ol>\n  </li>\n  <li><a href=\"#evaluation-against-reference-genome-with-chromeister\" id=\"markdown-toc-evaluation-against-reference-genome-with-chromeister\">Evaluation against reference genome with <strong>Chromeister</strong></a></li>\n  <li><a href=\"#conclusion\" id=\"markdown-toc-conclusion\">Conclusion</a></li>\n</ol>\n\n</blockquote>\n\n<h1 id=\"get-data\">Get data</h1>\n\n<p>We will use long quality reads sequencing data from PacBio HiFi sequencing of <em>Saccharomyces cerevisiae</em> INSC1019 genome. This data is a subset of data from ENA repository <a href=\"https://www.ebi.ac.uk/ena/browser/view/SRR13577847?show=reads\">SRR13577847</a>. We will also use the reference genome assembly downloaded from the <a href=\"https://www.ncbi.nlm.nih.gov/genome/?term=Saccharomyces%20cerevisiae\">NCBI website</a> and we will use it as a comparison with our own assemblies.</p>\n\n<h2 id=\"get-data-from-zenodo\">Get data from Zenodo</h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Data upload from Zenodo</hands-on-title>\n\n  <ol>\n    <li>Create a new history for this tutorial</li>\n    <li>\n      <p>Import the files from <a href=\"https://zenodo.org/record/5702408\">Zenodo</a></p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>https://zenodo.org/record/6947782/files/GCA_000146045.2_genomic.fna\nhttps://zenodo.org/record/6947782/files/Scerevisiae-INSC1019.flye.30x.fa\nhttps://zenodo.org/record/6947782/files/Scerevisiae-INSC1019.hifiasm.30x.fa\nhttps://zenodo.org/record/6947782/files/SRR13577847_subreads.30x.fastq.gz\n</code></pre></div>      </div>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-importing-via-links\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-importing-via-links\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Importing via links</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Copy the link location</li>   <li>     <p>Click <i class=\"fas fa-upload\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-upload</span> <strong>Upload Data</strong> at the top of the tool panel</p>   </li>   <li>Select <i class=\"fa fa-edit\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-wf-edit</span> <strong>Paste/Fetch Data</strong></li>   <li>     <p>Paste the link(s) into the text field</p>   </li>   <li>     <p>Press <strong>Start</strong></p>   </li>   <li><strong>Close</strong> the window</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>\n      <p>Check that the datatype is <code class=\"language-plaintext highlighter-rouge\">fastqsanger.gz</code> for <code class=\"language-plaintext highlighter-rouge\">SRR13577847_subreads.30x.fastq.gz</code></p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-changing-the-datatype\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-changing-the-datatype\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Changing the datatype</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Click on the <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>   <li>In the central panel, click <i class=\"fas fa-database\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-chart-select-data</span> <strong>Datatypes</strong> tab on the top</li>   <li>In the <i class=\"fas fa-database\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-chart-select-data</span> <strong>Assign Datatype</strong>, select <code class=\"language-plaintext highlighter-rouge\">datatypes</code> from “<em>New type</em>” dropdown     <ul>       <li>Tip: you can start typing the datatype into the field to filter the dropdown menu</li>     </ul>   </li>   <li>Click the <strong>Save</strong> button</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h1 id=\"evaluation-of-assembly-contiguity-and-correctness-with-quast\">Evaluation of assembly contiguity and correctness with <strong>Quast</strong></h1>\n\n<p>A way to calculate metrics assembly is to use <strong>QUAST = QUality ASsessment Tool</strong>. Quast is a tool to evaluate genome assemblies by computing various metrics and to compare genome assembly with a reference genome. The manual of Quast is here: <a href=\"http://quast.sourceforge.net/docs/manual.html#sec3\">Quast</a></p>\n\n<blockquote class=\"comment\">\n  <comment-title>QUAST statistics</comment-title>\n\n  <p>QUAST will provide us with the following statistics:</p>\n\n  <ul>\n    <li>Contigs: The total number of contigs in the assembly.</li>\n    <li>Largest contig: The length of the largest contig in the assembly.</li>\n    <li>Total length: The total number of bases in the assembly.</li>\n    <li>Nx: The largest contig length, <em>L</em>, such that contigs of length &gt;= <em>L</em> account for at least <em>x</em>% of the bases of the assembly.</li>\n    <li>NGx: The contig length such that using equal or longer length contigs produces <em>x</em>% of the length of the reference genome, rather than <em>x</em>% of the assembly length.</li>\n    <li>GC content: the percentage of nitrogenous bases which are either guanine or cytosine.</li>\n  </ul>\n\n  <p>If a reference genome is provided, the report also indicates:</p>\n  <ul>\n    <li>Genome fraction (%): total number of aligned bases in the reference genome, divided by the genome size</li>\n    <li>Duplication ratio: total number of aligned bases in the assembly, divided by the total number of aligned bases in the reference genome</li>\n    <li>NGA50: NG50 where the lengths of aligned blocks are counted instead of contig lengths. i.e., if a contig has a misassembly with respect to the reference, the contig is broken into smaller pieces. This metric is computed only if a reference genome is provided.\nLGA50: LG50 where aligned blocks are counted instead of contigs. i.e., if a contig has a misassembly with respect to the reference, the contig is broken into smaller pieces</li>\n  </ul>\n\n  <p>Many other metrics are available when clicking on <code class=\"language-plaintext highlighter-rouge\">Extended report</code>!</p>\n</blockquote>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>assembly evaluation with Quast</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/quast/quast/5.2.0+galaxy0\" title=\"Quast tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Quast</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 5.2.0+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><em>“Use customized names for the input files?”</em>: <code class=\"language-plaintext highlighter-rouge\">No, use datasets names</code></li>\n        <li><i class=\"far fa-copy\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-files</span> <em>“Contigs/scaffolds file”</em>: <code class=\"language-plaintext highlighter-rouge\">Scerevisiae-INSC1019.flye.30x.fa</code> and <code class=\"language-plaintext highlighter-rouge\">Scerevisiae-INSC1019.hifiasm.30x.fa</code></li>\n        <li><em>“Reads options”</em>: <code class=\"language-plaintext highlighter-rouge\">Pacbio SMRT reads</code>\n          <ul>\n            <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“FASTQ file”</em>: <code class=\"language-plaintext highlighter-rouge\">SRR13577847_subreads.30x.fastq.gz</code></li>\n          </ul>\n        </li>\n        <li><em>“Type of assembly”</em>: <code class=\"language-plaintext highlighter-rouge\">Genome</code>\n          <ul>\n            <li><em>“Use a reference genome?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code>\n              <ul>\n                <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Reference genome”</em>: <code class=\"language-plaintext highlighter-rouge\">GCA_000146045.2_genomic.fna</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n        <li><em>“Is genome large (&gt;100Mpb)?”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <p>With the informations generated by Quast, compare the two assemblies to the reference genome</p>\n\n  <ol>\n    <li>Which assembly is closest to the reference genome?</li>\n    <li>What is the longest contig of the Flye and Hifiasm assemblies?</li>\n    <li>What is the N50 of the Flye assembly?</li>\n    <li>Which percentage of reads mapped to each assembly?</li>\n  </ol>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <ol>\n      <li>The Flye assembly, with a genome fraction of 99.57% while Hifiasm have a low genome fraction (75.15%) which can indicate a problematic assembly.</li>\n      <li>The longest contig is 1,438,238 bp for Flye assembly while is 1,795,653 bp for Hifiasm</li>\n      <li>The N50 of the Flye assembly is 929,061 bp.</li>\n      <li>A total of 99.96% of reads mapped were mapped to the Flye assembly while only 91.02% against the Hifiasm assembly.</li>\n    </ol>\n\n    <p>Without a reference genome, it would have been harder to determine that assembly with Hifiasm is problematic. Metrics on the assembly itself are not always sufficient and therefore it is necessary to use other methodologies to ensure the quality of an assembly.</p>\n  </blockquote>\n\n</blockquote>\n\n<h1 id=\"evaluation-of-assembly-completness\">Evaluation of assembly completness</h1>\n\n<h2 id=\"core-genes-completness-with-busco\">Core genes completness with <strong>BUSCO</strong></h2>\n\n<p><strong>BUSCO (Benchmarking Universal Single-Copy Orthologs)</strong> allows a measure for quantitative assessment of genome assembly based on evolutionarily informed expectations of gene content. Details for this tool are here: <a href=\"https://busco.ezlab.org/\">Busco website</a></p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>assessing assembly completness with BUSCO</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/busco/busco/5.3.2+galaxy0\" title=\"Busco tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Busco</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 5.3.2+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-copy\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-files</span> <em>“Sequences to analyse”</em>:<code class=\"language-plaintext highlighter-rouge\">Scerevisiae-INSC1019.flye.30x.fa</code>, <code class=\"language-plaintext highlighter-rouge\">Scerevisiae-INSC1019.hifiasm.30x.fa</code> and <code class=\"language-plaintext highlighter-rouge\">GCA_000146045.2_genomic.fna</code></li>\n        <li><em>“Mode”</em>: <code class=\"language-plaintext highlighter-rouge\">Genome assemblies (DNA)</code>\n          <ul>\n            <li><em>“Use Augustus instead of Metaeuk”</em>: <code class=\"language-plaintext highlighter-rouge\">Use Metaeuk</code></li>\n          </ul>\n        </li>\n        <li><em>“Auto-detect or select lineage?”</em>: <code class=\"language-plaintext highlighter-rouge\">Select lineage</code>\n          <ul>\n            <li><em>“Lineage”</em>: <code class=\"language-plaintext highlighter-rouge\">Saccharomycetes</code></li>\n          </ul>\n        </li>\n        <li><em>“Which outputs should be generated”</em>: <code class=\"language-plaintext highlighter-rouge\">short summary text</code> and <code class=\"language-plaintext highlighter-rouge\">summary image</code></li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <p>Compare the number of BUSCO genes identified in the Flye and Hifiasm assembly to the reference genome. What do you observe ?</p>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <p>Short summary generated by BUSCO indicates that reference genome contains:</p>\n    <ol>\n      <li>2129 Complete BUSCOs (of which 2128 are single-copy and 49 are duplicated),</li>\n      <li>2 fragmented BUSCOs,</li>\n      <li>6 missing BUSCOs.</li>\n    </ol>\n\n    <p>Short summary generated by BUSCO indicates that Flye assembly contains:</p>\n    <ol>\n      <li>2127 complete BUSCOs (2127 single-copy and 49 duplicated),</li>\n      <li>2 fragmented BUSCOs</li>\n      <li>8 missing BUSCOs.</li>\n    </ol>\n\n    <p>Short summary generated by BUSCO indicates that Hifiasm assembly contains:</p>\n    <ol>\n      <li>1663 complete BUSCOs (1662 single-copy and 27 duplicated),</li>\n      <li>5 fragmented BUSCOs</li>\n      <li>469 missing BUSCOs.</li>\n    </ol>\n\n    <p>BUSCO analysis confirms that Flye assembly is better than Hifiasm assembly. Flye is also similar in completness to the reference genome with similar number of complete, fragmented and missing BUSCOs genes.</p>\n\n  </blockquote>\n\n</blockquote>\n\n<p>Despite BUSCO being robust for species that have been widely studied, it can be inaccurate when the newly assembled genome belongs to a taxonomic group that is not well represented in <a href=\"https://www.orthodb.org/\">OrthoDB</a>. Even in a well-represented taxonomic group, the bias on the selection of reference genomes selected to create OrthoDB can lead to an under-scoring of the newly assembled genome and is dependent on the evolution of the genomes. For example, in microsporidia, basal genomes have much lower scores due to the strong drive on gene loss and gain in these organisms.</p>\n\n<h2 id=\"k-mer-based-assembly-evaluation-with-merqury\">k-mer based assembly evaluation with <strong>Merqury</strong></h2>\n\n<p>Meryl will allow us to generate the k-mer profile by decomposing the sequencing data into k-length substrings, counting the occurrence of each k-mer and determining its frequency. Meryl comprises three main modules: one for generating k-mer databases, one for filtering and combining databases, and one for searching databases.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Generate k-mers count distribution</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/meryl/meryl/1.3+galaxy6\" title=\"Meryl tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Meryl</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.3+galaxy6)</span> with the following parameters:\n      <ul>\n        <li><em>“Operation type selector”</em>: <code class=\"language-plaintext highlighter-rouge\">Count operations</code>\n          <ul>\n            <li><em>“Count operations”</em>: <code class=\"language-plaintext highlighter-rouge\">Count: count the ocurrences of canonical k-mers</code></li>\n            <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Input sequences”</em>: <code class=\"language-plaintext highlighter-rouge\">SRR13577847_subreads.30x.fastq.gz</code></li>\n            <li><em>“K-mer size selector”</em>: <code class=\"language-plaintext highlighter-rouge\">Estimate the best k-mer size</code>\n              <ul>\n                <li>“<em>Genome size</em>”: <code class=\"language-plaintext highlighter-rouge\">12000000</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>Merqury is used for reference-free assembly evaluation based on k-mer set operations. By comparing k-mers in a de novo assembly to those found in unassembled high-accuracy reads, Merqury estimates base-level accuracy and completeness. For trios, Merqury can also evaluate haplotype-specific accuracy, completeness, phase block continuity, and switch errors. Multiple visualizations and tables, such as k-mer spectrum plots, are generated for evaluation of the assembly quality.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>K-mer based evaluation with Merqury</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/merqury/merqury/1.3+galaxy2\" title=\"Merqury tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Merqury</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.3+galaxy2)</span> with the following parameters:\n      <ul>\n        <li><em>“Evaluation mode”</em>: <code class=\"language-plaintext highlighter-rouge\">Default mode</code>\n          <ul>\n            <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“K-mer counts database”</em>: <code class=\"language-plaintext highlighter-rouge\">Meryldb</code> (output of <strong>Meryl</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n            <li><em>“Number of assemblies”</em>: <code class=\"language-plaintext highlighter-rouge\">One assembly</code>\n              <ul>\n                <li><i class=\"far fa-copy\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-files</span> <em>“Genome assembly”</em>: <code class=\"language-plaintext highlighter-rouge\">Scerevisiae-INSC1019.flye.30x.fa</code>, <code class=\"language-plaintext highlighter-rouge\">Scerevisiae-INSC1019.hifiasm.30x.fa</code> and <code class=\"language-plaintext highlighter-rouge\">GCA_000146045.2_genomic.fna</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>By default, Merqury generates three collections as output: stats, plots and QV stats. The “stats” and “plots” collection contains the completeness statistics, while the “QV stats” collection contains the quality value statistics.</p>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <p>Compare the k-mers plots for the Flye and Hifiasm assembly and the reference genome. What do you observe ?</p>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <p>Merqury analysis confirms that Flye assembly is better than Hifiasm assembly. Hifiasm <code class=\"language-plaintext highlighter-rouge\">assembly.spectra-cn.fl</code> shows that part of the data is specific to reads (black peak overlapping the red peak) indicating an absence of contigs in the assembly to represent these data.</p>\n\n    <p>Flye it’s similar in completness to the reference genome with a single read peak. We note however that part of the reference genome assembly is specific and absent from the reads (red barplot on the left). This is because the sequencing data is from a different strain (INSC1019) than the reference genome (S288C).</p>\n\n  </blockquote>\n\n</blockquote>\n\n<h1 id=\"evaluation-against-reference-genome-with-chromeister\">Evaluation against reference genome with <strong>Chromeister</strong></h1>\n\n<p>Chromeister is used to generate dotplots to quickly compare sequence sets, even for large genomes. This is provide a synthetic similarity overview, highlighting repetitions, breaks and inversions.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Synteny evaluation with Chromeister</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/chromeister/chromeister/1.5.a+galaxy1\" title=\"Chromeister tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Chromeister</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.5.a+galaxy1)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-copy\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-files</span> <em>“Query sequence”</em>: <code class=\"language-plaintext highlighter-rouge\">Scerevisiae-INSC1019.flye.30x.fa</code> and <code class=\"language-plaintext highlighter-rouge\">Scerevisiae-INSC1019.hifiasm.30x.fa</code></li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Reference sequence”</em>: <code class=\"language-plaintext highlighter-rouge\">GCA_000146045.2_genomic.fna</code></li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <p>Compare the dotplots for the Hifiasm assembly and the reference genome. What do you observe ?</p>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <p><a href=\"../../images/genome-qc/chromeister-dotplot.png\" rel=\"noopener noreferrer\"><img src=\"../../images/genome-qc/chromeister-dotplot.png\" alt=\"Chromeister dotplot. \" width=\"1000\" height=\"1000\" loading=\"lazy\" /></a></p>\n\n    <p>With dotplots, we can quickly detect several inconsistencies between the assembly generated by Hifiasm and the reference genome:</p>\n    <ul>\n      <li>Orange arrows indicate contigs in the reference genome that are absent in the Hifiasm assembly</li>\n      <li>Purple arrow indicates a contig specific to the Hifiasm assembly. This is not necessarily an inconsistency as it is 2 different strains of the same species.</li>\n      <li>Brown arrows indicate contigs that are merged into the Hifiasm assembly. In the case of the top arrow, there is a fusion and a partial inversion.</li>\n      <li>Green arrow indicates a contig partially assembled by Hifiasm.</li>\n    </ul>\n\n  </blockquote>\n\n</blockquote>\n\n<h1 id=\"conclusion\">Conclusion</h1>\n\n<p>This pipeline shows how to evaluate a genome assembly. Once you are satisfied with your genome sequence, you might want to purge it, make scaffolding and directly starting the annotation process!</p>\n"],"ref_slides":["# Genome assembly quality control, or \"the 3C\"\n\n\n<br>\n<br>\n\n.image-100[\n  ![The 3C for genome assembly quality control](../../images/genome-qc/3C.png)\n]\n\n---\n\n.image-30[\n  ![Illustration of genome assembly contiguity](../../images/genome-qc/contiguity.png)\n]\n\n---\n\n### **C**ontiguity\n\n.pull-left[\n\n**Desire**\n- Fewer sequences\n- Longer sequences\n]\n\n.pull-right[\n**Metrics**:\n- Number of sequences\n- Average sequences length\n- Median sequences length\n- Minimum and maximum sequences length\n- N50, NG50, L50, LG50\n- GC content\n- Number and proportion of bases that are N\n\n]\n\n**Sequences**, i.e. a set of contigs and/or scaffolds\n\n---\n\n### N50 & L50\n\n.left[\n**N50**: given a set of sequences of varying lengths, the N50 is defined as **the length L of the shortest contig** for which **longer and equal length contigs cover at least 50% of the assembly**.\n\n**L50**: given a set of sequences of varying lengths, the L50 is defined as **count of smallest number of sequences** whose **length sum makes up 50% of the assembly**.\n]\n\n**N50 describes a sequence length whereas L50 describes a number of sequences.**\n\n---\n\n### N50 & L50\n\n.pull-left[\nExample:\n- Genome size = 100\n- Sequence sorted by size list L = (25, 10, 10, 8 , 7, 7 , 6 , 5, 5, 5, 5, 3, 2, 2 ) = 100\n- 50% of the total length is contained within sequences of at least 8bp: 25 + 10 + 10 + 8 ≥ 50\n]\n\n.image-100[\n  ![Schematic explanation of N50](../../images/genome-qc/N50.png)\n]\n\n**N50 = 8** and **L50 = 4**\n\n.footnote[Alhakami, H., Mirebrahim, H., & Lonardi, S. (2017). A comparative evaluation of genome assembly reconciliation tools. Genome biology, 18(1), 1-14.]\n\n---\n\n### N50 & L50\n\nHowever, the theses statistics may not reflect some assembly improvements.\nIf we connect two sequences longer than N50 or connect two sequences shorter than N50, N50 is not changed. N50 is only improved if we connect a sequence shorter than N50 and a sequence longer than N50.\n\n.image-40[\n![Schematic explanation of N50 and it limits](../../images/genome-qc/N50-limitation.png)\n]\n\n---\n\n### Nx curve\n\n« 50 » is a single point on the Nx curve. The entire Nx curve in fact gives us a better sense of contiguity.\n\n.pull-left[\n![Example of Nx graph for Drosophila assemblies](../../images/genome-qc/Nx-curve.png)\n]\n\n.pull-right[\n![Example of cumulative sequence length graph for Drosophila assemblies](../../images/genome-qc/cumulative-length.png)\n]\n\n---\n\n### QUAST - A tool to evaluate genome assemblies\n\n- **QUAST**: for genome assemblies.\n- **MetaQUAST**: for metagenomic datasets.\n- **QUAST-LG**: for large genomes (e.g., mammalians).\n- **rnaQUAST**: for RNAseq.\n- **Icarus**: an interactive visualizer for these tools.\n\n\nIt also includes:\n- Reads mapping (mi-assemblies evaluation).\n- Kmer representation (KMC)\n- Structural prediction modules (GeneMark,  GlimmerHMM, Barrnap and BUSCO).\n- For metagenomics dataset: MetaGeneMark, Krona tools, BLAST, and SILVA 16S rRNA database.\n\n---\n\n.image-30[\n  ![Illustration of genome assembly completeness](../../images/genome-qc/completeness.png)\n]\n\n---\n\n### Types of completeness\n\n- Assembly size\n- Known vs. unknown nucleotides\n- \"Core\" genes\n- Assembly kmer content\n- Reads mapping and assembly coverage\n\n---\n\n### Assembly size vs estimated\n\nProportion of the original genome represented by the assembly:\n\n.image-100[\n![Formula to estimate assembly size completeness](../../images/genome-qc/assembly-size-qc-formula.png)\n]\n\n\"*\" it’s an estimation, so not perfect. See ![An introduction to get started in genome assembly and annotation](/training-material/topics/assembly/tutorials/get-started-genome-assembly/slides.html) to find methods to determine the genome size.\n\n---\n\n### Known vs. unknown nucleotides\n\nProportion of A, T, G, C versus N (unknown nucleotide).We expect an assembly without unknown nucleotides (N).\n\n---\n\n### \"Core\" genes\n\n\n.pull-left[\nQuantitative assessment of genome assembly based on evolutionarily informed expectations of gene content from near-universal single-copy orthologs.\n.image-70[\n![Formula to estimate assembly completeness for core genes](../../images/genome-qc/busco-formula.png)\n]\n]\n.pull-right[\n.image-70[\n![Example of BUSCO plot for Nosema species (Microsporidia) ](../../images/genome-qc/BUSCO-scores.png)\n]]\n\n.footnote[Tips: Reference databases are constructed using known genomes. Species with few/no close genomes available can have very bad scores.]\n\n---\n\n### Core genes evaluation software\n\n**BUSCO**: Assessing genome assembly and annotation completeness with **B**enchmarking **U**niversal **S**ingle-**C**opy **O**rthologs\n\n.pull-left[\n.image-70[\n![Explanation of orthology classification for creation of BUSCO sets - Universality](../../images/genome-qc/busco_sampling_universality.png)\n]]\n\n.pull-right[\n.image-60[\n![Explanation of orthology classification for creation of BUSCO sets - Duplicability](../../images/genome-qc/busco_sampling_duplicability.png)\n]]\n\nEukaryota: 255 single copy from 70 species; Arthropoda: 1013 single copy from 90 species; Fungi: 758 single copy from 549 species\n\n.footnote[Waterhouse, R. M., Zdobnov, E. M. & Kriventseva, E. V. Correlating Traits of Gene Retention, Sequence Divergence, Duplicability and Essentiality in Vertebrates, Arthropods, and Fungi. Genome Biol Evol 3, 75–86 (2011).]\n\n---\n\n### BUSCO limitations\n\n**The value of the BUSCO is only as good as its reference database.**\n<br>\n\nExample with BUSCO Eukaryotic set:\n.pull-left[\n.image-70[\n![Limitation of BUSCO orthoDB for eukaOrthoDB - part A](../../images/genome-qc/BUSCO_limitations_A.png)\n]]\n.pull-right[\n.image-70[\n![Limitation of BUSCO orthoDB for eukaOrthoDB - part B](../../images/genome-qc/BUSCO_limitations_B.png)\n]]\n\n\n.footnote[Saary, P., Mitchell, A. L. & Finn, R. D. Estimating the quality of eukaryotic genomes recovered from metagenomic analysis with EukCC. Genome Biol 21, 244 (2020).]\n\n---\n\n### BUSCO limitations\n\nThe use of transcriptome alignment of a closely related species or a de novo RNA-Seq assembly of the same species can be another proxy to assess the completeness of the assembly and adress BUSCO limitations.\n\n---\n\n### Assembly kmer content\n\nThe aim is to check assembly coherence against the content within reads that were used to produce the assembly. Basically, how many elements of each frequency on the read’s spectrum ended up being not included in the assembly, included once, included twice etc.\n<br>\n<br>\n\n- Merqury or KAT\n- Histogram is build with read kmer content.\n\n---\n\n### K-mer spectrum plots\n\n.pull-left[\n.image-70[\n![How to read kmer spectrum of reads](../../images/genome-qc/kmer-spectrum-reads.png)\n]]\n.pull-right[\n.image-70[\n![How to read kmer spectrum of an assembly using reads](../../images/genome-qc/kmer-spectrum-assembly.png)\n]]\n\n.footnote[Rhie, A., Walenz, B. P., Koren, S. & Phillippy, A. M. Merqury: reference-free quality, completeness, and phasing assessment for genome assemblies. Genome Biol 21, 245 (2020).]\n\n---\n\n### Assembly kmer content - Homozygous genomes\n\n.image-70[\n![Merqury spectra-cn plot for S.cerevesiae S288C assembly](../../images/genome-qc/kmer-spectra-merqury-homozygous-good.png)\n]\n\n<i class=\"far fa-thumbs-up\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">congratulations</span> Good kmer representation of reads in the assembly\n\n---\n\n### Assembly kmer content - Homozygous genomes\n\n.image-70[\n![Merqury spectra-cn plot for S.cerevesiae S288C assembly in case of missing contigs](../../images/genome-qc/kmer-spectra-merqury-homozygous-bad.png)\n]\n\n<i class=\"fa fa-thumbs-down\"></i> Bad kmer representation of reads in the assembly\n\n---\n\n### Assembly kmer content - Heterozygous genomes\n<br>\n\n.image-70[\n![Merqury spectra-cn plot for highly heterozygous assembly and for which haplotig were purged or collapsed.](../../images/genome-qc/kmer-spectra-merqury-heterozygous-good.png)\n]\n\n<i class=\"far fa-thumbs-up\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">congratulations</span> Good kmer representation of reads in the assembly\n\nThe lost content (the black peak) represents the half of the heterozygous content that is lost when bubbles are collapsed.\n\n---\n\n### Assembly kmer content - Heterozygous genomes\n\n.image-80[\n![Merqury spectra-cn plot for second haplotype of C. gigas.](../../images/genome-qc/kmer-spectra-merqury-c.gigas-hap2.png)\n]\n\n<i class=\"fa fa-thumbs-down\"></i> Bad kmer representation of reads in the assembly\n\n---\n\n### Reads mapping and assembly coverage\n<br>\n\n- **Proportion of mapped vs. unmapped reads** i.e. proportion of missing parts in the assembly\n- **Coverage in terms of redundancy (A)**: number of reads that align to, or \"cover,\" a known reference. \n- **Coverage in terms of the percentage coverage of a reference by reads (B)**: E.g. if 90% of a reference is covered by reads (and 10% not) it is a 90% coverage.\n\n.image-60[\n  ![Illustration of genome assembly correctness](../../images/genome-qc/read-coverage.gif)\n]\n\n---\n\n.image-30[\n  ![Illustration of genome assembly correctness](../../images/genome-qc/correctness.png)\n]\n\n---\n\n### Mistakes into the assembly\n\n** Proportion of the assembly that is free from mistakes**\n<br>\n<br>\n- Indels / SNPs\n- Mis-joins\n- Repeat compressions\n- Unnecessary duplications\n- Rearrangements\n<br>\n<br>\n**→ Align back reads to the assembly and check for inconsistencies**\n\n---\n\n### SNP / indels errors\n\n.image-80[\n![Illustration of SNP errors in a genome assembly.](../../images/genome-qc/snp-indels_errors.png)\n]\n\n---\n\n### Other mis-assemblies\n\n.image-80[\n![Illustration of rearrangements inversions assembly errors.](../../images/genome-qc/misassemblies_1.png)\n]\n\n---\n\n### Other mis-assemblies\n\n.image-80[\n![Illustration of collapsed and expanded repeats assembly errors.](../../images/genome-qc/misassemblies_2.png)\n]\n\n---\n\n### Switch and hamming errors (phased assemblies)\n\n.pull-left[\n.image-70[\n![Illustration of switch and hamming errors in phased genome assembly.](../../images/genome-qc/switch-hamming-errors.png)\n]\nIn red, heterozygous locus from second haplotype. In blue, heterozygous locus from first haplotype.\n]\n\n.pull-right[\n- **Switch error**: a change from one parental allele to another parental allele on a contig. This terminology has been used for measuring reference-based phasing accuracy for two decades. A haplotig is supposed to have no switch errors.\n- **Yak hamming error**: an allele not on the most supported haplotype of a contig. Its main purpose is to test how close a contig is to a haplotig. The yak definition is not widely accepted. The hamming error rate is arguably less important in practice.\n]\n\n.footnote[http://lh3.github.io/2021/04/17/concepts-in-phased-assemblies]\n\n---\n\n# Evaluation against reference genome\n\n\n.image-30[\n![Example of a dot plot between 2 genomes.](../../images/genome-qc/dotplot-dgenies.png)\n]\n\n---\n\n.pull-left[\n.left[\nDot plots are widely used to quickly compare 2 sequence sets. They provide a synthetic overview of:\n- Similarity\n- Specificity\n- Highlighting repetitions, breaks and inversions.\n]\n\n<br>\n\n.image-50[\n![Example of a dot plot between 2 genomes.](../../images/genome-qc/dotplot-dgenies.png)\n]\n]\n\n.pull-right[\n.left[\nA non-exhaustive list of tools for making dot plots:\n- MUMmer dotplot\n- Chromeister\n- D-genies (not yet available into Galaxy)\n]\n\n<br>\n<br>\n<br>\n\n.image-50[\n![Interpret Dot Plots here based on great explanation by Michael Schatz.](../../images/dotplot.png)\n]\n]\n\n---\n\n# Tips\n\n- The quality of an assembly is often validated by using other data from the same individual or from other individuals (RNA-Seq alignment, Hi-C alignment, DNA-Seq alignment,...).\n\n- The positions of the telomeric repeats in the chromosome assemblies are also of interesting to evaluate the correctness.\n\n- The identification of organelles (mitochondria, chloroplast,...) can also inform us about the quality of the assembly in terms of completness. However, the structure of the organelles may lead the assembler to think that they are repeats and he discards them.\n\n- In the case of diploid organisms, one of the classical problems of assemblies is the conservation of the two haplotypes. We obtains particular BUSCO / kmer / assembly size metrics that can be corrected by removing, \"purging\", the haplotigs.\n\n"],"video_library":{"tutorial":null,"slides":null,"demo":null,"both":null,"session":null},"hands_on":true,"slides":true,"mod_date":"2023-11-03 14:30:27 +0000","pub_date":"2022-08-26 14:11:00 +0000","version":18,"workflows":[{"workflow":"main_workflow.ga","tests":false,"url":"https://training.galaxyproject.org/training-material/topics/assembly/tutorials/assembly-quality-control/workflows/main_workflow.ga","path":"topics/assembly/tutorials/assembly-quality-control/workflows/main_workflow.ga","wfid":"assembly-assembly-quality-control","wfname":"main_workflow","trs_endpoint":"https://training.galaxyproject.org/training-material/api/ga4gh/trs/v2/tools/assembly-assembly-quality-control/versions/main_workflow","license":"GPL-3.0-or-later","creators":[{"class":"Person","identifier":"","name":"Erwan Corre"},{"class":"Person","identifier":"","name":"Stéphanie Robin"},{"class":"Person","identifier":"","name":"Anthony Bretaudeau"},{"class":"Person","identifier":"","name":"Alexandre Cormier"},{"class":"Person","identifier":"","name":"Laura Leroi"}],"name":"Genome Assembly Quality Control","title":"Genome Assembly Quality Control","test_results":null,"modified":"2024-06-13 19:24:25 +0000","mermaid":"flowchart TD\n  0[\"ℹ️ Input Dataset\\nGCA_000146045.2_genomic.fna\"];\n  style 0 stroke:#2c3143,stroke-width:4px;\n  1[\"ℹ️ Input Dataset\\nScerevisiae-INSC1019.flye.30x.fa\"];\n  style 1 stroke:#2c3143,stroke-width:4px;\n  2[\"ℹ️ Input Dataset\\nScerevisiae-INSC1019.hifiasm.30x.fa\"];\n  style 2 stroke:#2c3143,stroke-width:4px;\n  3[\"ℹ️ Input Dataset\\nSRR13577847_subreads.30x.fastq.gz\"];\n  style 3 stroke:#2c3143,stroke-width:4px;\n  4[\"Busco\"];\n  0 -->|output| 4;\n  5[\"Busco\"];\n  1 -->|output| 5;\n  6[\"Quast\"];\n  0 -->|output| 6;\n  1 -->|output| 6;\n  2 -->|output| 6;\n  7[\"Busco\"];\n  2 -->|output| 7;\n  8[\"Chromeister\"];\n  0 -->|output| 8;\n  2 -->|output| 8;\n  9[\"Meryl\"];\n  3 -->|output| 9;\n  10[\"Merqury\"];\n  0 -->|output| 10;\n  9 -->|read_db| 10;\n  11[\"Merqury\"];\n  1 -->|output| 11;\n  9 -->|read_db| 11;\n  12[\"Merqury\"];\n  2 -->|output| 12;\n  9 -->|read_db| 12;"}],"api":"https://training.galaxyproject.org/training-material/api/topics/assembly/tutorials/assembly-quality-control/tutorial.json","tools":["toolshed.g2.bx.psu.edu/repos/iuc/busco/busco/5.3.2+galaxy0","toolshed.g2.bx.psu.edu/repos/iuc/chromeister/chromeister/1.5.a+galaxy1","toolshed.g2.bx.psu.edu/repos/iuc/merqury/merqury/1.3+galaxy2","toolshed.g2.bx.psu.edu/repos/iuc/meryl/meryl/1.3+galaxy6","toolshed.g2.bx.psu.edu/repos/iuc/quast/quast/5.2.0+galaxy0"],"supported_servers":{"exact":[{"url":"https://usegalaxy.eu","name":"UseGalaxy.eu","usegalaxy":true},{"url":"https://usegalaxy.fr/","name":"UseGalaxy.fr","usegalaxy":false},{"url":"https://usegalaxy.org.au","name":"UseGalaxy.org.au","usegalaxy":true}],"inexact":[{"url":"https://usegalaxy.cz/","name":"UseGalaxy.cz","usegalaxy":false}]},"topic_name_human":"Assembly","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[{"name":"busco","owner":"iuc","revisions":"41030a6c03b7","tool_panel_section_label":"Annotation","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"chromeister","owner":"iuc","revisions":"b768cc4cca40","tool_panel_section_label":"Multiple Alignments","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"merqury","owner":"iuc","revisions":"f8113c25bc6b","tool_panel_section_label":"Assembly","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"meryl","owner":"iuc","revisions":"29dabd8db6f2","tool_panel_section_label":"Assembly","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"quast","owner":"iuc","revisions":"3061c8b029e5","tool_panel_section_label":"Assembly","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"}]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools:\n- name: busco\n  owner: iuc\n  revisions: 41030a6c03b7\n  tool_panel_section_label: Annotation\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: chromeister\n  owner: iuc\n  revisions: b768cc4cca40\n  tool_panel_section_label: Multiple Alignments\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: merqury\n  owner: iuc\n  revisions: f8113c25bc6b\n  tool_panel_section_label: Assembly\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: meryl\n  owner: iuc\n  revisions: 29dabd8db6f2\n  tool_panel_section_label: Assembly\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: quast\n  owner: iuc\n  revisions: 3061c8b029e5\n  tool_panel_section_label: Assembly\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n","tours":false,"video":false,"translations":{"tutorial":[],"slides":[],"video":false},"license":"CC-BY-4.0","type":"tutorial"}