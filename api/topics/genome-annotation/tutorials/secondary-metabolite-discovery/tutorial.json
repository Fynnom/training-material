{"layout":"tutorial_hands_on","draft":true,"title":"Secondary metabolite discovery","zenodo_link":"https://zenodo.org/records/10652998","questions":["How to discover secondary metabolites produced by microorganisms ?","How to identify the discovered secondary metabolites in compound libraries ?","How to bridge workflow steps using custom scripts ?"],"objectives":["Gene cluster prediction using antiSMAHS.","Extraction of gene cluster products using a custom script.","Query of the products in compound libraries using cheminformatic tools."],"time_estimation":"3H","key_points":["Gene cluster prediction that can be performed for any assembly or genome of microorganisms (procaryotes and fungi).","Bridging of gene annotation and cheminformatics.","Usage of custom script to bridge workflow steps."],"contributors":[{"name":"Paul Zierep","email":"zierep@informatik.uni-freiburg.de","orcid":"0000-0003-2982-388X","joined":"2023-02","affiliations":["uni-freiburg","elixir-europe"],"id":"paulzierep","url":"https://training.galaxyproject.org/training-material/api/contributors/paulzierep.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/paulzierep/"}],"js_requirements":{"mathjax":null,"mermaid":false},"short_id":"T00420","url":"/topics/genome-annotation/tutorials/secondary-metabolite-discovery/tutorial.html","topic_name":"genome-annotation","tutorial_name":"secondary-metabolite-discovery","dir":"topics/genome-annotation/tutorials/secondary-metabolite-discovery","symlink":null,"id":"genome-annotation/secondary-metabolite-discovery","ref_tutorials":["<p>Genome mining is an important source for various bio-active compounds such as antibiotics and fungicides (<span class=\"citation\"><a href=\"#adamek_mining_2017\">Adamek <i>et al.</i> 2017</a></span>).\nOne challenge in secondary metabolite discovery using genome mining requires to annotate biosynthetic gene clusters (BGCs) using dedicated tools such as antiSMASH (<span class=\"citation\"><a href=\"#blin_antismash_2023\">Blin <i>et al.</i> 2023</a></span>) as well as to query the discovered secondary metabolites against compound libraries (<span class=\"citation\"><a href=\"#zierep_sempi_2020\">Zierep <i>et al.</i> 2020</a></span>) in order to identify weather they might posses bio-active properties.</p>\n\n<p>In this toturial we will:</p>\n<ul>\n  <li>Annotate biosynthetic gene clusters (BGCs) using antiSMASH.</li>\n  <li>Extract the predicted compounds  as <code class=\"language-plaintext highlighter-rouge\">SMILES</code> using a custom script.</li>\n  <li>Query the predicted compounds agains the MIBiG (<span class=\"citation\"><a href=\"#terlouw_mibig_2023\">Terlouw <i>et al.</i> 2023</a></span>) which is a dedicated BGC database.</li>\n  <li>Characterize the predicted compounds using dedicated cheminformatic tools.</li>\n</ul>\n\n<blockquote class=\"agenda\">\n  <agenda-title></agenda-title>\n\n  <p>In this tutorial, we will cover:</p>\n\n<ol id=\"markdown-toc\">\n  <li><a href=\"#galaxy-and-data-preparation\" id=\"markdown-toc-galaxy-and-data-preparation\">Galaxy and data preparation</a>    <ol>\n      <li><a href=\"#get-data\" id=\"markdown-toc-get-data\">Get data</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#biosynthetic-gene-clusters-bgcs-detection-and-compound-extraction\" id=\"markdown-toc-biosynthetic-gene-clusters-bgcs-detection-and-compound-extraction\">Biosynthetic gene clusters (BGCs) detection and compound extraction</a>    <ol>\n      <li><a href=\"#download-a-bacterial-genome-with-ncbi-accession-download\" id=\"markdown-toc-download-a-bacterial-genome-with-ncbi-accession-download\">Download a bacterial genome with <strong>NCBI Accession Download</strong></a></li>\n      <li><a href=\"#detect-bgcs-and-predict-nrps--pks-metabolite-structures-with-antismash\" id=\"markdown-toc-detect-bgcs-and-predict-nrps--pks-metabolite-structures-with-antismash\">Detect BGCs and predict NRPS / PKS metabolite structures with <strong>Antismash</strong></a></li>\n      <li><a href=\"#collapse-single-bgc-genbank-files-into-one-with-collapse-collection\" id=\"markdown-toc-collapse-single-bgc-genbank-files-into-one-with-collapse-collection\">Collapse single BGC Genbank files into one with <strong>Collapse Collection</strong></a></li>\n    </ol>\n  </li>\n  <li><a href=\"#use-custom-scripts-in-galaxy-to-bridge-between-workflow-steps\" id=\"markdown-toc-use-custom-scripts-in-galaxy-to-bridge-between-workflow-steps\">Use custom scripts in Galaxy to bridge between workflow steps</a>    <ol>\n      <li><a href=\"#integrate-a-custom-script-into-the-workflow-using-interactive-jupytool-and-notebook\" id=\"markdown-toc-integrate-a-custom-script-into-the-workflow-using-interactive-jupytool-and-notebook\">Integrate a custom script into the workflow using <strong>Interactive JupyTool and notebook</strong></a></li>\n    </ol>\n  </li>\n  <li><a href=\"#cheminformatics\" id=\"markdown-toc-cheminformatics\">Cheminformatics</a>    <ol>\n      <li><a href=\"#convert-the-table-into-a-two-column-table\" id=\"markdown-toc-convert-the-table-into-a-two-column-table\">Convert the table into a two column table</a></li>\n      <li><a href=\"#remove-duplicated-molecules\" id=\"markdown-toc-remove-duplicated-molecules\"><strong>Remove duplicated molecules</strong></a></li>\n      <li><a href=\"#generate-fingerprints-for-the-predicted-secondary-metabolites-and-the-target-database-with-molecule-to-fingerprint\" id=\"markdown-toc-generate-fingerprints-for-the-predicted-secondary-metabolites-and-the-target-database-with-molecule-to-fingerprint\">Generate fingerprints for the predicted secondary metabolites and the target database with <strong>Molecule to fingerprint</strong></a></li>\n      <li><a href=\"#compare-prediction-with-target-db-using-similarity-search\" id=\"markdown-toc-compare-prediction-with-target-db-using-similarity-search\">Compare prediction with target DB using <strong>Similarity Search</strong></a></li>\n      <li><a href=\"#determine-the-novelty-of-the-compounds-using-natural-product-likeness-calculator\" id=\"markdown-toc-determine-the-novelty-of-the-compounds-using-natural-product-likeness-calculator\">Determine the novelty of the compounds using <strong>Natural Product</strong> likeness calculator</a></li>\n      <li><a href=\"#check-drug-likeness-of-the-predicted-compounds\" id=\"markdown-toc-check-drug-likeness-of-the-predicted-compounds\">Check <strong>Drug-likeness</strong> of the predicted compounds</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#conclusion\" id=\"markdown-toc-conclusion\">Conclusion</a></li>\n</ol>\n\n</blockquote>\n\n<h1 id=\"galaxy-and-data-preparation\">Galaxy and data preparation</h1>\n\n<p>Any analysis should get its own Galaxy history. So let’s start by creating a new one and get the data into it.</p>\n\n<h2 id=\"get-data\">Get data</h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title> History Creation and Data Upload </hands-on-title>\n\n  <ol>\n    <li>\n      <p>Create a new history for this tutorial</p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-creating-a-new-history\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-creating-a-new-history\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Creating a new history</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p>Click the <i class=\"fas fa-plus\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">new-history</span> icon at the top of the history panel:</p>   <p><img src=\"/training-material/shared/images/history_create_new.svg\" alt=\"UI for creating new history\" /></p>   <!-- the original drawing can be found here https://docs.google.com/drawings/d/1cCBrLAo4kDGic5QyB70rRiWJAKTenTU8STsKDaLcVU8/edit?usp=sharing --> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>\n      <p>Rename the history</p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-renaming-a-history\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-renaming-a-history\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Renaming a history</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ol>   <li>Click on <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> (<strong>Edit</strong>) next to the history name (which by default is “Unnamed history”)</li>   <li>Type the new name</li>   <li>Click on <strong>Save</strong></li> </ol>   <p>If you do not have the <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> (<strong>Edit</strong>) next to the history name:</p>   <ol>   <li>Click on <strong>Unnamed history</strong> (or the current name of the history) (<strong>Click to rename history</strong>) at the top of your history panel</li>   <li>Type the new name</li>   <li>Press <kbd>Enter</kbd></li> </ol> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>\n      <p>Import the files from <a href=\"https://zenodo.org/records/10652998\">Zenodo</a> or from\nthe shared data library (<code class=\"language-plaintext highlighter-rouge\">GTN - Material</code> -&gt; <code class=\"language-plaintext highlighter-rouge\">genome-annotation</code>\n -&gt; <code class=\"language-plaintext highlighter-rouge\">Secondary metabolite discovery</code>):</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>https://zenodo.org/record/10652998/files/MIBiG_compounds_3.0.sdf\nhttps://zenodo.org/record/10652998/files/gbk2features.ipynb\n</code></pre></div>      </div>\n\n      <p>For this training we need a custom jupyter notebook and a compound library.</p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-importing-via-links\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-importing-via-links\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Importing via links</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Copy the link location</li>   <li>     <p>Click <i class=\"fas fa-upload\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-upload</span> <strong>Upload Data</strong> at the top of the tool panel</p>   </li>   <li>Select <i class=\"fa fa-edit\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-wf-edit</span> <strong>Paste/Fetch Data</strong></li>   <li>     <p>Paste the link(s) into the text field</p>   </li>   <li>     <p>Press <strong>Start</strong></p>   </li>   <li><strong>Close</strong> the window</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>Rename the datasets</li>\n    <li>\n      <p>Check that the datatype is correct</p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-changing-the-datatype\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-changing-the-datatype\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Changing the datatype</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Click on the <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>   <li>In the central panel, click <i class=\"fas fa-database\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-chart-select-data</span> <strong>Datatypes</strong> tab on the top</li>   <li>In the <i class=\"fas fa-database\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-chart-select-data</span> <strong>Assign Datatype</strong>, select <code class=\"language-plaintext highlighter-rouge\">datatypes</code> from “<em>New type</em>” dropdown     <ul>       <li>Tip: you can start typing the datatype into the field to filter the dropdown menu</li>     </ul>   </li>   <li>Click the <strong>Save</strong> button</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>\n      <p>Add useful tags to your datasets</p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-adding-a-tag\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-adding-a-tag\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Adding a tag</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ol>   <li>Click on the dataset to expand it</li>   <li>Click on <strong>Add Tags</strong> <i class=\"fas fa-tags\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-tags</span></li>   <li>Add a tag  starting with <code class=\"language-plaintext highlighter-rouge\">#</code>     <ul>       <li>Tags starting with <code class=\"language-plaintext highlighter-rouge\">#</code> will be automatically propagated to the outputs of tools using this dataset.</li>     </ul>   </li>   <li>Press <kbd>Enter</kbd></li>   <li>Check that the tag appears below the dataset name</li> </ol> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h1 id=\"biosynthetic-gene-clusters-bgcs-detection-and-compound-extraction\">Biosynthetic gene clusters (BGCs) detection and compound extraction</h1>\n\n<p>The general idea of this tutorial is described in the flowchart below. \nZierep et. al. previously created a \nworkflow that combines BGC prediction with natural compound screening in their webserver <a href=\"http://sempi.pharmazie.uni-freiburg.de/\">SeMPI 2.0</a>\n(<span class=\"citation\"><a href=\"#zierep_sempi_2020\">Zierep <i>et al.</i> 2020</a></span>). \nHere, we want to reproduce the workflow using Galaxy, which allows to adjust the workflow and combine it with other\ntools and databases. \nE.g. the workflow could be combined with metagenomic workflows, that allow to screen a vast amount of metagenome assembly genomes (MAGs) for potential novel bioactive compounds.</p>\n\n<figure id=\"figure-1\" style=\"max-width: 90%;\"><img src=\"../../images/bgc_screening/flowchart.drawio.png\" alt=\"Overview flowchart. \" width=\"827\" height=\"563\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/bgc_screening/flowchart.drawio.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 1</strong>:</span> Overview flowchart of the workflow.</figcaption></figure>\n\n<h2 id=\"download-a-bacterial-genome-with-ncbi-accession-download\">Download a bacterial genome with <strong>NCBI Accession Download</strong></h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title> Task description </hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/ncbi_acc_download/ncbi_acc_download/0.2.8+galaxy0\" title=\"NCBI Accession Download tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>NCBI Accession Download</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.2.8+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><em>“Select source for IDs”</em>: <code class=\"language-plaintext highlighter-rouge\">Direct Entry</code>\n          <ul>\n            <li><em>“ID List”</em>: <code class=\"language-plaintext highlighter-rouge\">AL645882.2</code></li>\n          </ul>\n        </li>\n        <li><em>“Molecule Type”</em>: <code class=\"language-plaintext highlighter-rouge\">Nucleotide</code></li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title> Genome download </comment-title>\n\n        <p>This downloads the <code class=\"language-plaintext highlighter-rouge\">Streptomyces coelicolor A3(2) complete genome</code>, \nwhich should be a great source for biosynthetic gene clusters (BGCs).</p>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h2 id=\"detect-bgcs-and-predict-nrps--pks-metabolite-structures-with-antismash\">Detect BGCs and predict NRPS / PKS metabolite structures with <strong>Antismash</strong></h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title> Task description </hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/bgruening/antismash/antismash/6.1.1+galaxy1\" title=\"Antismash tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Antismash</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 6.1.1+galaxy1)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Sequence file in GenBank,EMBL or FASTA format”</em>: <code class=\"language-plaintext highlighter-rouge\">Downloaded Files</code> (output of <strong>NCBI Accession Download</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Taxonomic classification of input sequence”</em>: <code class=\"language-plaintext highlighter-rouge\">Bacteria</code></li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title> BGC detection </comment-title>\n\n        <p>This step uses Antismash for BGC detection. Another tool that could be used is <a href=\"https://prism.adapsyn.com/\">prism</a>.\nBut prism can only be used via a web server and is therefore not integrable into Galaxy workflows.</p>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <ol>\n    <li>How many BGCs are detected for the <code class=\"language-plaintext highlighter-rouge\">Streptomyces coelicolor A3(2) complete genome</code> ?</li>\n    <li>How many BGCs are of type NRPS ?</li>\n  </ol>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <ol>\n      <li>In the HTML report of Antismash you can find 27 BGCs of various types.</li>\n      <li>Of those 27 BGCs 4 are pure NRPS and one more is  classified as NRPS-like.</li>\n    </ol>\n\n  </blockquote>\n\n</blockquote>\n\n<h2 id=\"collapse-single-bgc-genbank-files-into-one-with-collapse-collection\">Collapse single BGC Genbank files into one with <strong>Collapse Collection</strong></h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title> Task description </hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/nml/collapse_collections/collapse_dataset/5.1.0\" title=\"Collapse Collection tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Collapse Collection</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 5.1.0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Collection of files to collapse into single dataset”</em>: <code class=\"language-plaintext highlighter-rouge\">Genbank</code> (output of <strong>Antismash</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Prepend File name”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title> Collapse Genbank files </comment-title>\n\n        <p>Antismash produces one Genbank file for each cluster. Genbank files can contain multiple records. For downstream analysis it is more convenient to combine all clusters into one file.</p>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h1 id=\"use-custom-scripts-in-galaxy-to-bridge-between-workflow-steps\">Use custom scripts in Galaxy to bridge between workflow steps</h1>\n\n<h2 id=\"integrate-a-custom-script-into-the-workflow-using-interactive-jupytool-and-notebook\">Integrate a custom script into the workflow using <strong>Interactive JupyTool and notebook</strong></h2>\n\n<p>For the next steps we need to extract the <code class=\"language-plaintext highlighter-rouge\">SMILES</code> representations of the predicted BGC metabolites.\nAnd convert it into the <code class=\"language-plaintext highlighter-rouge\">.smi</code> format (basically a tabular format that contains names and structures of chemical compounds).</p>\n\n<p>The  <code class=\"language-plaintext highlighter-rouge\">SMILES</code> representations of the predicted BGC metabolites are stored as features of the clusters in the Genbank files.</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>     cand_cluster    1..49828\n                     /SMILES=\"NC(CCCN)C(=O)NC(C(O)C)C(=O)NC(CCCN)C(=O)O\"\n                     /candidate_cluster_number=\"1\"\n                     /contig_edge=\"False\"\n                     /detection_rules=\"cds(Condensation and (AMP-binding or\n                     A-OX))\"\n                     /kind=\"single\"\n                     /product=\"NRPS\"\n                     /protoclusters=\"1\"\n                     /tool=\"antismash\"\n</code></pre></div></div>\n\n<p>There are various tools that can convert Genbank files into GFF (like <span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/cpt/cpt_gbk_to_gff/edu.tamu.cpt.gff3.customGbkToGff/20.1.0.0\" title=\"customGbkToGff tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>customGbkToGff</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 20.1.0.0)</span> and  <span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/bp_genbank2gff3/bp_genbank2gff3/1.1\" title=\"genbank2gff3 tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>genbank2gff3</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.1)</span>). From the GFF one could extract the SMILES string via regex.\nHowever, unfortunately both tools seem to have difficulty to parse SMILES and introduce artefacts like:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>SMILES=CC(%3DO)C(%3DO)O\n</code></pre></div></div>\n\n<p>Therefore we need to quickly prototype our own script, that allows to generate the desired <code class=\"language-plaintext highlighter-rouge\">SMILES</code> representations.\nThis is in fact a great chance to demonstrate how the interactive <span class=\"tool\" data-tool=\"interactive_tool_jupyter_notebook\" title=\"Interactive JupyTool and notebook tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Interactive JupyTool and notebook</strong></span> can be used to connect workflow steps, for which there is no dedicated tool yet available in Galaxy, showing the flexible nature of Galaxy.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title> Task description </hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"interactive_tool_jupyter_notebook\" title=\"Interactive JupyTool and notebook tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Interactive JupyTool and notebook</strong></span> with the following parameters:\n      <ul>\n        <li><em>“Do you already have a notebook?”</em>: <code class=\"language-plaintext highlighter-rouge\">Load a previous notebook</code>\n          <ul>\n            <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“IPython Notebook”</em>: <code class=\"language-plaintext highlighter-rouge\">gbk2features.ipynb</code> (from your history)</li>\n            <li><em>“Execute notebook and return a new one.”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n          </ul>\n        </li>\n        <li>In <em>“User inputs”</em>:\n          <ul>\n            <li><i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert User inputs”</em>\n              <ul>\n                <li><em>“Name for parameter”</em>: <code class=\"language-plaintext highlighter-rouge\">dataset</code> (a file called <code class=\"language-plaintext highlighter-rouge\">dataset</code> will be created in the notebook in the folder <code class=\"language-plaintext highlighter-rouge\">galaxy_inputs</code>)</li>\n                <li><em>“Choose the input type”</em>: <code class=\"language-plaintext highlighter-rouge\">Dataset</code>\n                  <ul>\n                    <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select value”</em>: <code class=\"language-plaintext highlighter-rouge\">Collapse Genbank files</code> (output of <strong>Collapse Collection</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n                  </ul>\n                </li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title> Interactive JupyTool and notebook </comment-title>\n\n        <p>JupyTool notebooks can be executed interactively, which allows to run any code (python / R / bash) dynamically or as a normal tool itself, that executes a provide script and return the output. More information about the JupyTool can be found in the <a href=\"https://training.galaxyproject.org/topics/galaxy-interface/tutorials/jupyterlab/tutorial.html\">Interactive JupyTool Tutorial</a>.</p>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>In this workflow the jupyter notebook is executed and the output collected. If you want to run the notebook interactively. Rerun the tool and set the option <em>“Execute notebook and return a new one.”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code>. Now the notebook will start up interactively and you can play around the the python code.</p>\n\n<p>The code we provide for the notebook looks like this:</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">from</span> <span class=\"n\">Bio</span> <span class=\"kn\">import</span> <span class=\"n\">SeqIO</span>\n<span class=\"kn\">import</span> <span class=\"n\">pandas</span> <span class=\"k\">as</span> <span class=\"n\">pd</span>\n<span class=\"kn\">import</span> <span class=\"n\">numpy</span> <span class=\"k\">as</span> <span class=\"n\">np</span>\n\n<span class=\"n\">input_path</span> <span class=\"o\">=</span> <span class=\"sh\">\"</span><span class=\"s\">galaxy_inputs</span><span class=\"sh\">\"</span>\n\n<span class=\"n\">use_qualifiers</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"sh\">\"</span><span class=\"s\">SMILES</span><span class=\"sh\">\"</span><span class=\"p\">]</span> \n\n<span class=\"n\">feature_list</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n\n<span class=\"k\">for</span> <span class=\"n\">folder</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"p\">.</span><span class=\"nf\">listdir</span><span class=\"p\">(</span><span class=\"n\">input_path</span><span class=\"p\">):</span>\n\n    <span class=\"n\">folder_path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"p\">.</span><span class=\"n\">path</span><span class=\"p\">.</span><span class=\"nf\">join</span><span class=\"p\">(</span><span class=\"n\">input_path</span><span class=\"p\">,</span> <span class=\"n\">folder</span><span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">os</span><span class=\"p\">.</span><span class=\"n\">path</span><span class=\"p\">.</span><span class=\"nf\">isdir</span><span class=\"p\">(</span><span class=\"n\">folder_path</span><span class=\"p\">):</span>\n\n        <span class=\"k\">for</span> <span class=\"nb\">file</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"p\">.</span><span class=\"nf\">listdir</span><span class=\"p\">(</span><span class=\"n\">folder_path</span><span class=\"p\">):</span>\n            <span class=\"n\">file_path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"p\">.</span><span class=\"n\">path</span><span class=\"p\">.</span><span class=\"nf\">join</span><span class=\"p\">(</span><span class=\"n\">folder_path</span><span class=\"p\">,</span> <span class=\"nb\">file</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"sh\">'</span><span class=\"s\">.genbank</span><span class=\"sh\">'</span> <span class=\"ow\">in</span> <span class=\"nb\">file</span><span class=\"p\">:</span>\n                <span class=\"k\">for</span> <span class=\"n\">record</span> <span class=\"ow\">in</span> <span class=\"n\">SeqIO</span><span class=\"p\">.</span><span class=\"nf\">parse</span><span class=\"p\">(</span><span class=\"n\">file_path</span><span class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">genbank</span><span class=\"sh\">\"</span><span class=\"p\">):</span>\n                    <span class=\"c1\">#print(record)\n</span>                    \n                    <span class=\"k\">for</span> <span class=\"n\">feat</span> <span class=\"ow\">in</span> <span class=\"n\">record</span><span class=\"p\">.</span><span class=\"n\">features</span><span class=\"p\">:</span>\n\n                        <span class=\"n\">combined_features</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n                        <span class=\"n\">combined_features</span><span class=\"p\">[</span><span class=\"sh\">'</span><span class=\"s\">ID</span><span class=\"sh\">'</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">record</span><span class=\"p\">.</span><span class=\"nb\">id</span>\n                        <span class=\"n\">combined_features</span><span class=\"p\">[</span><span class=\"sh\">'</span><span class=\"s\">Name</span><span class=\"sh\">'</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">record</span><span class=\"p\">.</span><span class=\"n\">name</span>\n                        <span class=\"n\">combined_features</span><span class=\"p\">[</span><span class=\"sh\">'</span><span class=\"s\">Type</span><span class=\"sh\">'</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">feat</span><span class=\"p\">.</span><span class=\"nb\">type</span>\n                        <span class=\"n\">combined_features</span><span class=\"p\">[</span><span class=\"sh\">'</span><span class=\"s\">Start</span><span class=\"sh\">'</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">feat</span><span class=\"p\">.</span><span class=\"n\">location</span><span class=\"p\">.</span><span class=\"n\">start</span>\n                        <span class=\"n\">combined_features</span><span class=\"p\">[</span><span class=\"sh\">'</span><span class=\"s\">End</span><span class=\"sh\">'</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">feat</span><span class=\"p\">.</span><span class=\"n\">location</span><span class=\"p\">.</span><span class=\"n\">end</span>\n                        <span class=\"n\">combined_features</span><span class=\"p\">[</span><span class=\"sh\">'</span><span class=\"s\">Strand</span><span class=\"sh\">'</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">feat</span><span class=\"p\">.</span><span class=\"n\">location</span><span class=\"p\">.</span><span class=\"n\">strand</span>\n\n                        <span class=\"k\">for</span> <span class=\"n\">qualifier</span> <span class=\"ow\">in</span> <span class=\"n\">feat</span><span class=\"p\">.</span><span class=\"n\">qualifiers</span><span class=\"p\">.</span><span class=\"nf\">items</span><span class=\"p\">():</span>\n                                <span class=\"n\">combined_features</span><span class=\"p\">[</span><span class=\"n\">qualifier</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]]</span> <span class=\"o\">=</span> <span class=\"n\">qualifier</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">][</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n                        \n                        <span class=\"n\">feature_list</span><span class=\"p\">.</span><span class=\"nf\">append</span><span class=\"p\">(</span><span class=\"n\">combined_features</span><span class=\"p\">)</span>\n                \n<span class=\"n\">df</span> <span class=\"o\">=</span> <span class=\"n\">pd</span><span class=\"p\">.</span><span class=\"nc\">DataFrame</span><span class=\"p\">(</span><span class=\"n\">feature_list</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># df trimming is simpler with pandas\n</span><span class=\"n\">df</span><span class=\"p\">.</span><span class=\"nf\">replace</span><span class=\"p\">(</span><span class=\"sh\">''</span><span class=\"p\">,</span> <span class=\"n\">np</span><span class=\"p\">.</span><span class=\"n\">nan</span><span class=\"p\">,</span> <span class=\"n\">inplace</span><span class=\"o\">=</span><span class=\"bp\">True</span><span class=\"p\">)</span>\n<span class=\"n\">df</span> <span class=\"o\">=</span> <span class=\"n\">df</span><span class=\"p\">.</span><span class=\"nf\">dropna</span><span class=\"p\">(</span><span class=\"n\">subset</span><span class=\"o\">=</span><span class=\"n\">use_qualifiers</span><span class=\"p\">)</span>\n\n<span class=\"c1\">#remove extra space antiSMASH bug (https://github.com/antismash/antismash/issues/694)\n</span><span class=\"n\">df</span><span class=\"p\">[</span><span class=\"sh\">'</span><span class=\"s\">SMILES</span><span class=\"sh\">'</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">df</span><span class=\"p\">[</span><span class=\"sh\">'</span><span class=\"s\">SMILES</span><span class=\"sh\">'</span><span class=\"p\">].</span><span class=\"nb\">str</span><span class=\"p\">.</span><span class=\"nf\">replace</span><span class=\"p\">(</span><span class=\"sh\">'</span><span class=\"s\"> </span><span class=\"sh\">'</span><span class=\"p\">,</span> <span class=\"sh\">''</span><span class=\"p\">)</span>\n\n\n<span class=\"c1\">#only keep what is needed downstream\n</span><span class=\"n\">df</span> <span class=\"o\">=</span> <span class=\"n\">df</span><span class=\"p\">.</span><span class=\"n\">loc</span><span class=\"p\">[:,[</span><span class=\"sh\">'</span><span class=\"s\">ID</span><span class=\"sh\">'</span><span class=\"p\">,</span> <span class=\"sh\">'</span><span class=\"s\">Name</span><span class=\"sh\">'</span><span class=\"p\">,</span> <span class=\"sh\">'</span><span class=\"s\">Type</span><span class=\"sh\">'</span><span class=\"p\">,</span> <span class=\"sh\">'</span><span class=\"s\">Start</span><span class=\"sh\">'</span><span class=\"p\">,</span> <span class=\"sh\">'</span><span class=\"s\">End</span><span class=\"sh\">'</span><span class=\"p\">,</span> <span class=\"sh\">'</span><span class=\"s\">Strand</span><span class=\"sh\">'</span><span class=\"p\">,</span> <span class=\"sh\">'</span><span class=\"s\">SMILES</span><span class=\"sh\">'</span><span class=\"p\">]]</span>\n\n<span class=\"n\">df</span><span class=\"p\">.</span><span class=\"nf\">to_csv</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">outputs/collection/feature_table.tsv</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"n\">sep</span><span class=\"o\">=</span><span class=\"sh\">\"</span><span class=\"se\">\\t</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n</code></pre></div></div>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <ol>\n    <li>What does the notebook do ?</li>\n  </ol>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <ol>\n      <li>The notebook creates a table with a row for each <code class=\"language-plaintext highlighter-rouge\">SMILES</code> qualifier.</li>\n    </ol>\n\n  </blockquote>\n\n</blockquote>\n\n<h1 id=\"cheminformatics\">Cheminformatics</h1>\n\n<p>Now, that we have predicted the products of the BGCs found in the <code class=\"language-plaintext highlighter-rouge\">Streptomyces coelicolor A3(2) complete genome</code>,\nwe can compare the chemical structures of the prediction with natural compound libraries to see if some of the compounds \nare similar to other compounds with known bio-activte properties. Those compounds should be further investigated.\nThe natural compound library we are using here comprises all the compounds found in the MIBiG (<span class=\"citation\"><a href=\"#terlouw_mibig_2023\">Terlouw <i>et al.</i> 2023</a></span>).</p>\n\n<h2 id=\"convert-the-table-into-a-two-column-table\">Convert the table into a two column table</h2>\n\n<p>The next two steps convert the generated table into the <code class=\"language-plaintext highlighter-rouge\">.smi</code> format. The <code class=\"language-plaintext highlighter-rouge\">.smi</code> format is basically a specific table format where the first column is a chemical structure and the second column the ID or name of the compound. The table must\nnot have a header.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title> Table to smi format conversion</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_awk_tool/1.1.2\" title=\"Text reformatting tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Text reformatting</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.1.2)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“File to process”</em>: <code class=\"language-plaintext highlighter-rouge\">output_collection</code> (output of <strong>Interactive JupyTool and notebook</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“AWK Program”</em>: <code class=\"language-plaintext highlighter-rouge\">{print $8, $2-$5-$6}</code></li>\n      </ul>\n    </li>\n    <li><span class=\"tool\" data-tool=\"Remove beginning1\" title=\"Remove beginning tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Remove beginning</strong></span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“from”</em>: <code class=\"language-plaintext highlighter-rouge\">outfile</code> (output of <strong>Text reformatting</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n      </ul>\n    </li>\n    <li>\n      <p>Now, that the table is indeed the same as the <code class=\"language-plaintext highlighter-rouge\">.smi</code> format it can also be converted into <code class=\"language-plaintext highlighter-rouge\">.smi</code>.</p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-changing-the-datatype-1\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-changing-the-datatype-1\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Changing the datatype</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Click on the <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>   <li>In the central panel, click <i class=\"fas fa-database\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-chart-select-data</span> <strong>Datatypes</strong> tab on the top</li>   <li>In the <i class=\"fas fa-database\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-chart-select-data</span> <strong>Assign Datatype</strong>, select <code class=\"language-plaintext highlighter-rouge\">smi</code> from “<em>New type</em>” dropdown     <ul>       <li>Tip: you can start typing the datatype into the field to filter the dropdown menu</li>     </ul>   </li>   <li>Click the <strong>Save</strong> button</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h2 id=\"remove-duplicated-molecules\"><strong>Remove duplicated molecules</strong></h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title> Remove duplicated molecules </hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/bgruening/openbabel_remduplicates/openbabel_remDuplicates/3.1.1+galaxy0\" title=\"Remove duplicated molecules tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Remove duplicated molecules</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 3.1.1+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Molecular input file”</em>: (output of <strong>Remove beginning</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Select descriptor for molecule comparison”</em>: <code class=\"language-plaintext highlighter-rouge\">Canonical SMILES</code></li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title> short description </comment-title>\n\n        <p>For the downstream analysis deduplicated molecules are not required. Especially short, hybrid or uncompleted cluster can produce short molecular structures, that appear multiple times in an organisms. These structures can be regarded as artefacts and could probably be removed as well.</p>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h2 id=\"generate-fingerprints-for-the-predicted-secondary-metabolites-and-the-target-database-with-molecule-to-fingerprint\">Generate fingerprints for the predicted secondary metabolites and the target database with <strong>Molecule to fingerprint</strong></h2>\n\n<p>Various molecular fingerprint options can be used to convert the compounds. Details about molecular fingerprint can be found in <span class=\"citation\"><a href=\"#muegge_overview_2016\">Muegge and Mukherjee 2016</a></span> and <span class=\"citation\"><a href=\"#capecchi_one_2020\">Capecchi <i>et al.</i> 2020</a></span>.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title> Task description </hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/bgruening/chemfp/ctb_chemfp_mol2fps/1.5\" title=\"Molecule to fingerprint tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Molecule to fingerprint</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.5)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Molecule file”</em>: (output of <strong>Remove duplicated molecules</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Type of fingerprint”</em>: <code class=\"language-plaintext highlighter-rouge\">Open Babel FP2 fingerprints</code></li>\n      </ul>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/bgruening/chemfp/ctb_chemfp_mol2fps/1.5\" title=\"Molecule to fingerprint tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Molecule to fingerprint</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.5)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Molecule file”</em>: <code class=\"language-plaintext highlighter-rouge\">output</code> (MIBiG_compounds_3.0.sdf)</li>\n        <li><em>“Type of fingerprint”</em>: <code class=\"language-plaintext highlighter-rouge\">Open Babel FP2 fingerprints</code></li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title> Be consitent </comment-title>\n\n        <p>A major application of molecular fingerprints is to determine the similarity of compounds. For the downstream tool\n<span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/bgruening/simsearch/ctb_simsearch/0.2\" title=\"Similarity Search tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Similarity Search</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.2)</span> it is <strong>important</strong> that the same fingerprint are used for the query and target compounds!</p>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>Now that we have converted our compounds into molecular fingerprints, we can compare them to find the closest match between our prediction and the target database.</p>\n\n<h2 id=\"compare-prediction-with-target-db-using-similarity-search\">Compare prediction with target DB using <strong>Similarity Search</strong></h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title> Task description </hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/bgruening/simsearch/ctb_simsearch/0.2\" title=\"Similarity Search tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Similarity Search</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.2)</span> with the following parameters:\n      <ul>\n        <li><em>“Subject database/sequences”</em>: <code class=\"language-plaintext highlighter-rouge\">Chemfp fingerprint file</code>\n          <ul>\n            <li><em>“Query Mode”</em>: <code class=\"language-plaintext highlighter-rouge\">Query molecules are stores in a separate file</code>\n              <ul>\n                <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Query molecules”</em>: (output of <strong>Molecule to fingerprint</strong> for <code class=\"language-plaintext highlighter-rouge\">MIBiG_compounds_3.0.sdf</code> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n                <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Target molecules”</em>: (output of <strong>Molecule to fingerprint</strong> from <strong>Remove duplicated molecules</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n              </ul>\n            </li>\n            <li><em>“select the k nearest neighbors”</em>: <code class=\"language-plaintext highlighter-rouge\">1</code></li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h2 id=\"determine-the-novelty-of-the-compounds-using-natural-product-likeness-calculator\">Determine the novelty of the compounds using <strong>Natural Product</strong> likeness calculator</h2>\n\n<p>Normally, this tool allows to estimate how similar any kind of compound is to a natural product.\nIn our case we know that the compounds are natural compounds. However, by comparing to a large source of known \nnatural products we can estimate the novelty of our predicted structure. This could for example be used to \nmine metagenomic datasets for likely sources of uncharacterized molecular scaffolds.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title> Task description </hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/bgruening/natural_product_likeness/ctb_np-likeness-calculator/2.1\" title=\"Natural Product tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Natural Product</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 2.1)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Molecule file”</em>: (output of <strong>Remove duplicated molecules</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h2 id=\"check-drug-likeness-of-the-predicted-compounds\">Check <strong>Drug-likeness</strong> of the predicted compounds</h2>\n\n<p>Estimates the drug-likeness of molecules, based on eight commonly used molecular properties, and reports a score between 0 (all properties unfavourable) to 1 (all properties favourable). Two possible methods to weight the features are available (QEDw,mo, QEDw,max), as well as an option to leave features unweighted (QEDw,u).</p>\n\n<p>The eight properties used are: molecular weight (MW), octanol–water partition coefficient (ALOGP), number of hydrogen bond donors (HBDs), number of hydrogen bond acceptors (HBAs), molecular polar surface area (PSA), number of rotatable bonds (ROTBs), number of aromatic rings (AROMs) and number of structural alerts (ALERTS).</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title> Task description </hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/bgruening/qed/ctb_silicos_qed/2021.03.4+galaxy0\" title=\"Drug-likeness tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Drug-likeness</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 2021.03.4+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Molecule data in SDF or SMILES format”</em>: (output of <strong>Remove duplicated molecules</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h1 id=\"conclusion\">Conclusion</h1>\n\n<p>In this simple use case the combination of BGC prediction software and cheminformatics was used to detect and characterize novel secondary metabolites.</p>\n"],"ref_slides":[],"video_library":{"tutorial":null,"slides":null,"demo":null,"both":null,"session":null},"hands_on":true,"slides":false,"mod_date":"2024-02-21 12:40:51 +0000","pub_date":"2024-02-21 14:08:32 +0000","version":3,"workflows":[{"workflow":"main_workflow.ga","tests":false,"url":"https://training.galaxyproject.org/training-material/topics/genome-annotation/tutorials/secondary-metabolite-discovery/workflows/main_workflow.ga","path":"topics/genome-annotation/tutorials/secondary-metabolite-discovery/workflows/main_workflow.ga","wfid":"genome-annotation-secondary-metabolite-discovery","wfname":"main_workflow","trs_endpoint":"https://training.galaxyproject.org/training-material/api/ga4gh/trs/v2/tools/genome-annotation-secondary-metabolite-discovery/versions/main_workflow","license":null,"creators":[],"name":"Gene Cluster Product Similarity Search ","title":"Gene Cluster Product Similarity Search ","test_results":null,"modified":"2024-06-13 07:34:10 +0000","mermaid":"flowchart TD\n  0[\"ℹ️ Input Parameter\\nQuery Genomes\"];\n  style 0 fill:#ded,stroke:#393,stroke-width:4px;\n  1[\"ℹ️ Input Dataset\\nJupyter Notebook Genbank2Features\"];\n  style 1 stroke:#2c3143,stroke-width:4px;\n  2[\"ℹ️ Input Dataset\\nTarget Molecules Natural Compound Library\"];\n  style 2 stroke:#2c3143,stroke-width:4px;\n  3[\"NCBI Accession Download\"];\n  0 -->|output| 3;\n  faecdec3-711d-43ba-bb91-38a4b4b3932d[\"Output\\nNCBI Accession Download on input dataset(s): Log\"];\n  3 --> faecdec3-711d-43ba-bb91-38a4b4b3932d;\n  style faecdec3-711d-43ba-bb91-38a4b4b3932d stroke:#2c3143,stroke-width:4px;\n  c8857c6f-ec99-4d29-8c98-be7a63a9f029[\"Output\\nNCBI Accession Download on input dataset(s): Downloaded Files\"];\n  3 --> c8857c6f-ec99-4d29-8c98-be7a63a9f029;\n  style c8857c6f-ec99-4d29-8c98-be7a63a9f029 stroke:#2c3143,stroke-width:4px;\n  4[\"Molecule to fingerprint\"];\n  2 -->|output| 4;\n  5[\"Antismash\"];\n  3 -->|output| 5;\n  cc813ad7-f423-4cb8-ba79-8201abab206a[\"Output\\nAntismash on input dataset(s): HTML report\"];\n  5 --> cc813ad7-f423-4cb8-ba79-8201abab206a;\n  style cc813ad7-f423-4cb8-ba79-8201abab206a stroke:#2c3143,stroke-width:4px;\n  6[\"Collapse clusters in one Genbank entry\"];\n  5 -->|genbank| 6;\n  7[\"Extract SMILES qualifiers\"];\n  1 -->|output| 7;\n  6 -->|output| 7;\n  8[\"Convert table to smi format\"];\n  7 -->|output_collection| 8;\n  9[\"Remove beginning\"];\n  8 -->|outfile| 9;\n  10[\"Remove duplicated molecules\"];\n  9 -->|out_file1| 10;\n  11[\"Molecule to fingerprint\"];\n  10 -->|outfile| 11;\n  12[\"Natural Product\"];\n  10 -->|outfile| 12;\n  13[\"Drug-likeness\"];\n  10 -->|outfile| 13;\n  14[\"Similarity Search\"];\n  11 -->|outfile| 14;\n  4 -->|outfile| 14;"}],"api":"https://training.galaxyproject.org/training-material/api/topics/genome-annotation/tutorials/secondary-metabolite-discovery/tutorial.json","tools":["Remove beginning1","interactive_tool_jupyter_notebook","toolshed.g2.bx.psu.edu/repos/bgruening/antismash/antismash/6.1.1+galaxy1","toolshed.g2.bx.psu.edu/repos/bgruening/chemfp/ctb_chemfp_mol2fps/1.5","toolshed.g2.bx.psu.edu/repos/bgruening/natural_product_likeness/ctb_np-likeness-calculator/2.1","toolshed.g2.bx.psu.edu/repos/bgruening/openbabel_remduplicates/openbabel_remDuplicates/3.1.1+galaxy0","toolshed.g2.bx.psu.edu/repos/bgruening/qed/ctb_silicos_qed/2021.03.4+galaxy0","toolshed.g2.bx.psu.edu/repos/bgruening/simsearch/ctb_simsearch/0.2","toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_awk_tool/1.1.2","toolshed.g2.bx.psu.edu/repos/cpt/cpt_gbk_to_gff/edu.tamu.cpt.gff3.customGbkToGff/20.1.0.0","toolshed.g2.bx.psu.edu/repos/iuc/bp_genbank2gff3/bp_genbank2gff3/1.1","toolshed.g2.bx.psu.edu/repos/iuc/ncbi_acc_download/ncbi_acc_download/0.2.8+galaxy0","toolshed.g2.bx.psu.edu/repos/nml/collapse_collections/collapse_dataset/5.1.0"],"supported_servers":{"exact":[{"url":"https://usegalaxy.eu","name":"UseGalaxy.eu","usegalaxy":true}],"inexact":[]},"topic_name_human":"Genome Annotation","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[{"name":"antismash","owner":"bgruening","revisions":"bc88856eddab","tool_panel_section_label":"Annotation","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"chemfp","owner":"bgruening","revisions":"73de2fe4bf92","tool_panel_section_label":"ChemicalToolBox","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"natural_product_likeness","owner":"bgruening","revisions":"6052dd3fa475","tool_panel_section_label":"ChemicalToolBox","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"openbabel_remduplicates","owner":"bgruening","revisions":"b2569e22b40c","tool_panel_section_label":"ChemicalToolBox","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"qed","owner":"bgruening","revisions":"52a8d34dd08f","tool_panel_section_label":"ChemicalToolBox","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"simsearch","owner":"bgruening","revisions":"0892f7ced10c","tool_panel_section_label":"ChemicalToolBox","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"text_processing","owner":"bgruening","revisions":"d698c222f354","tool_panel_section_label":"Text Manipulation","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"cpt_gbk_to_gff","owner":"cpt","revisions":"a921d6148d88","tool_panel_section_label":"Convert Formats","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"bp_genbank2gff3","owner":"iuc","revisions":"11c3eb512633","tool_panel_section_label":"Annotation","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"ncbi_acc_download","owner":"iuc","revisions":"e063168e0a81","tool_panel_section_label":"Get Data","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"collapse_collections","owner":"nml","revisions":"90981f86000f","tool_panel_section_label":"Collection Operations","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"}]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools:\n- name: antismash\n  owner: bgruening\n  revisions: bc88856eddab\n  tool_panel_section_label: Annotation\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: chemfp\n  owner: bgruening\n  revisions: 73de2fe4bf92\n  tool_panel_section_label: ChemicalToolBox\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: natural_product_likeness\n  owner: bgruening\n  revisions: 6052dd3fa475\n  tool_panel_section_label: ChemicalToolBox\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: openbabel_remduplicates\n  owner: bgruening\n  revisions: b2569e22b40c\n  tool_panel_section_label: ChemicalToolBox\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: qed\n  owner: bgruening\n  revisions: 52a8d34dd08f\n  tool_panel_section_label: ChemicalToolBox\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: simsearch\n  owner: bgruening\n  revisions: '0892f7ced10c'\n  tool_panel_section_label: ChemicalToolBox\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: text_processing\n  owner: bgruening\n  revisions: d698c222f354\n  tool_panel_section_label: Text Manipulation\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: cpt_gbk_to_gff\n  owner: cpt\n  revisions: a921d6148d88\n  tool_panel_section_label: Convert Formats\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: bp_genbank2gff3\n  owner: iuc\n  revisions: 11c3eb512633\n  tool_panel_section_label: Annotation\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: ncbi_acc_download\n  owner: iuc\n  revisions: e063168e0a81\n  tool_panel_section_label: Get Data\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: collapse_collections\n  owner: nml\n  revisions: 90981f86000f\n  tool_panel_section_label: Collection Operations\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n","tours":false,"video":false,"translations":{"tutorial":[],"slides":[],"video":false},"license":"CC-BY-4.0","type":"tutorial","tags":["work-in-progress"]}