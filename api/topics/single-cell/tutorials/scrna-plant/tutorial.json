{"layout":"tutorial_hands_on","title":"Analysis of plant scRNA-Seq Data with Scanpy","subtopic":"end-to-end","priority":3,"redirect_from":["/topics/transcriptomics/tutorials/scrna-plant/tutorial","/short/single-cell/scrna-plant","/short/T00250"],"zenodo_link":"https://zenodo.org/record/4597857","tags":["plants","paper-replication"],"questions":["Can we reclaim cell markers using a different analysis method?","Are highly variable genes paramount to the analysis?"],"objectives":["Perform filtering, dimensionality reduction, and clustering","Generate a DotPlot emulating the original paper using a different analysis tool","Determine robust clusters across scRNA-seq pipelines"],"requirements":[{"type":"internal","topic_name":"single-cell","tutorials":["scrna-scanpy-pbmc3k"]}],"time_estimation":"2H","key_points":["Filtering parameters are dependent on the dataset, and should be explored using scatter or violin plots","A DotPlot is a fantastic way to validate clusters across different analyses"],"contributors":[{"name":"Mehmet Tekman","email":"mtekman89@gmail.com","joined":"2018-11","elixir_node":"de","affiliations":["uni-freiburg"],"former_affiliations":["elixir-europe"],"id":"mtekman","url":"https://training.galaxyproject.org/training-material/api/contributors/mtekman.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/mtekman/"},{"name":"Beatriz Serrano-Solano","email":"beatrizserrano.galaxy@gmail.com","twitter":"BSerranoSolano","linkedin":"beatriz-serrano","matrix":"beatrizserrano:matrix.org","orcid":"0000-0002-5862-6132","joined":"2020-07","id":"beatrizserrano","url":"https://training.galaxyproject.org/training-material/api/contributors/beatrizserrano.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/beatrizserrano/"},{"name":"Cristóbal Gallardo","joined":"2020-11","elixir_node":"de","orcid":"0000-0002-5752-2155","former_affiliations":["uni-freiburg","elixir-europe"],"id":"gallardoalba","url":"https://training.galaxyproject.org/training-material/api/contributors/gallardoalba.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/gallardoalba/"},{"name":"Pavankumar Videm","orcid":"0000-0002-5192-126X","joined":"2017-09","affiliations":["uni-freiburg","elixir-europe"],"id":"pavanvidem","url":"https://training.galaxyproject.org/training-material/api/contributors/pavanvidem.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/pavanvidem/"}],"gitter":"Galaxy-Training-Network/galaxy-single-cell","js_requirements":{"mathjax":null,"mermaid":false},"short_id":"T00250","url":"/topics/single-cell/tutorials/scrna-plant/tutorial.html","topic_name":"single-cell","tutorial_name":"scrna-plant","dir":"topics/single-cell/tutorials/scrna-plant","symlink":null,"id":"single-cell/scrna-plant","ref_tutorials":["<p>Single cell RNA-seq analysis is a cornerstone of developmental research and provides a great level of detail in understanding the underlying dynamic processes within tissues. In the context of plants, this highlights some of the key differentiation pathways that root cells undergo.</p>\n\n<p><a href=\"/training-material/topics/single-cell/images/scrna-plant/scrna-plant1.jpg\" rel=\"noopener noreferrer\"><img src=\"/training-material/topics/single-cell/images/scrna-plant/scrna-plant1.jpg\" alt=\"The various cell subpopulations that are expected within this tutorial. \" width=\"996\" height=\"996\" loading=\"lazy\" /></a></p>\n\n<p>This tutorial replicates the paper <em>“Spatiotemporal Developmental Trajectories in the Arabidopsis Root Revealed Using High-Throughput Single-Cell RNA Sequencing”</em> (<span class=\"citation\"><a href=\"#denyer2019spatiotemporal\">Denyer <i>et al.</i> 2019</a></span>), where the major plant cell types are recovered in the data as well as distinguishing between QC and meristematic cells. The original paper used the Seurat analysis suite (<span class=\"citation\"><a href=\"#satija2015spatial\">Satija <i>et al.</i> 2015</a></span>), but here we will use the ScanPy analysis suite (<span class=\"citation\"><a href=\"#wolf2018scanpy\">Wolf <i>et al.</i> 2018</a></span>) integrated within the single-cell resources in Galaxy (<span class=\"citation\"><a href=\"#tekman2020single\">Tekman <i>et al.</i> 2020</a></span>).</p>\n\n<blockquote class=\"agenda\">\n  <agenda-title></agenda-title>\n\n  <p>In this tutorial, we will cover:</p>\n\n<ol id=\"markdown-toc\">\n  <li><a href=\"#data\" id=\"markdown-toc-data\">Data</a>    <ol>\n      <li><a href=\"#data-upload\" id=\"markdown-toc-data-upload\">Data upload</a></li>\n      <li><a href=\"#csv-to-anndata\" id=\"markdown-toc-csv-to-anndata\">CSV to AnnData</a></li>\n      <li><a href=\"#merge-batches-and-relabel\" id=\"markdown-toc-merge-batches-and-relabel\">Merge Batches and Relabel</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#quality-control\" id=\"markdown-toc-quality-control\">Quality Control</a>    <ol>\n      <li><a href=\"#filtering-the-matrix\" id=\"markdown-toc-filtering-the-matrix\">Filtering the Matrix</a></li>\n      <li><a href=\"#confounder-removal\" id=\"markdown-toc-confounder-removal\">Confounder Removal</a></li>\n      <li><a href=\"#dimensionality-reduction\" id=\"markdown-toc-dimensionality-reduction\">Dimensionality Reduction</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#finding-cell-types\" id=\"markdown-toc-finding-cell-types\">Finding Cell Types</a>    <ol>\n      <li><a href=\"#clustering\" id=\"markdown-toc-clustering\">Clustering</a></li>\n      <li><a href=\"#dotplot-and-validating-cell-types\" id=\"markdown-toc-dotplot-and-validating-cell-types\">DotPlot and Validating Cell Types</a></li>\n      <li><a href=\"#relabel-clusters\" id=\"markdown-toc-relabel-clusters\">Relabel clusters</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#conclusions\" id=\"markdown-toc-conclusions\">Conclusions</a></li>\n</ol>\n\n</blockquote>\n\n<blockquote class=\"comment\">\n  <comment-title></comment-title>\n\n  <p>Please familiarise yourself with the <a href=\"/training-material/topics/single-cell/tutorials/scrna-scanpy-pbmc3k/tutorial.html\">“Clustering 3K PBMCs with ScanPy”</a> tutorial first, as much of the process is the same, and the accompanying slide deck better explains some of the methods and concepts better.</p>\n\n</blockquote>\n\n<h1 id=\"data\">Data</h1>\n\n<p>The <em>Arabidopsis</em> root cells come from two biological replicates which were isolated and profiles using droplet-based scRNA-seq (please see: <a href=\"/training-material/topics/single-cell/tutorials/scrna-preprocessing-tenx/tutorial.html\">“Pre-processing of 10X Single-Cell RNA Datasets”</a>); a “short root” mutant (labelled: <code class=\"language-plaintext highlighter-rouge\">shr</code>) and a wild-type (labelled: <code class=\"language-plaintext highlighter-rouge\">wt</code>):</p>\n\n<ul>\n  <li>GSE123818_Root_single_cell_<strong>shr</strong>_datamatrix.fixednames.transposed.csv.gz</li>\n  <li>GSE123818_Root_single_cell_<strong>wt</strong>_datamatrix.fixednames.transposed.csv.gz</li>\n</ul>\n\n<p>As explained in the Zenodo link, the datasets have been modified to use more common gene names (hence the “fixednames” suffix) and the datasets have been transposed to better suit the AnnData format (hence the “transposed” suffix). The datasets are CSV tabular files which have been compressed using gunzip. We will now import these for analysis.</p>\n\n<h2 id=\"data-upload\">Data upload</h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Data upload</hands-on-title>\n\n  <ol>\n    <li>Create a new history for this tutorial</li>\n    <li>\n      <p>Import the two datasets from <a href=\"https://zenodo.org/record/4597857\">Zenodo</a> or from the shared data library</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>https://zenodo.org/record/4597857/files/GSE123818_Root_single_cell_shr_datamatrix.fixednames.transposed.csv.gz\nhttps://zenodo.org/record/4597857/files/GSE123818_Root_single_cell_wt_datamatrix.fixednames.transposed.csv.gz\n</code></pre></div>      </div>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-importing-via-links\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-importing-via-links\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Importing via links</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Copy the link location</li>   <li>     <p>Click <i class=\"fas fa-upload\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-upload</span> <strong>Upload Data</strong> at the top of the tool panel</p>   </li>   <li>Select <i class=\"fa fa-edit\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-wf-edit</span> <strong>Paste/Fetch Data</strong></li>   <li>     <p>Paste the link(s) into the text field</p>   </li>   <li>     <p>Press <strong>Start</strong></p>   </li>   <li><strong>Close</strong> the window</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-importing-data-from-a-data-library\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-importing-data-from-a-data-library\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Importing data from a data library</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p>As an alternative to uploading the data from a URL or your computer, the files may also have been made available from a <em>shared data library</em>:</p>   <ol>   <li>Go into <strong>Shared data</strong> (top panel) then <strong>Data libraries</strong></li>   <li>Navigate to  the correct folder as indicated by your instructor.     <ul>       <li>On most Galaxies tutorial data will be provided in a folder named <strong>GTN - Material –&gt; Topic Name -&gt; Tutorial Name</strong>.</li>     </ul>   </li>   <li>Select the desired files</li>   <li>Click on <strong>Add to History</strong> <i class=\"fas fa-caret-down\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-dropdown</span> near the top and select <strong>as Datasets</strong> from the dropdown menu</li>   <li>     <p>In the pop-up window, choose</p>     <ul>       <li><em>“Select history”</em>: the history you want to import the data to (or create a new one)</li>     </ul>   </li>   <li>Click on <strong>Import</strong></li> </ol> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>\n      <p>Apply the tags <code class=\"language-plaintext highlighter-rouge\">#shr</code> and <code class=\"language-plaintext highlighter-rouge\">#wt</code> to each of the datasets, with respect to the initial labels. These tags will be inherited for each task that the dataset undergoes.</p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-adding-a-tag\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-adding-a-tag\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Adding a tag</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ol>   <li>Click on the dataset to expand it</li>   <li>Click on <strong>Add Tags</strong> <i class=\"fas fa-tags\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-tags</span></li>   <li>Add a tag  starting with <code class=\"language-plaintext highlighter-rouge\">#</code>     <ul>       <li>Tags starting with <code class=\"language-plaintext highlighter-rouge\">#</code> will be automatically propagated to the outputs of tools using this dataset.</li>     </ul>   </li>   <li>Press <kbd>Enter</kbd></li>   <li>Check that the tag appears below the dataset name</li> </ol> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <p>We can peek at the <code class=\"language-plaintext highlighter-rouge\">#shr</code> file, and determine the dimensionality and naming scheme of the data. The rows and the columns depict different variables.</p>\n\n  <ol>\n    <li>Which are the cell barcodes? Rows or Columns?</li>\n    <li>Which are the gene names? Rows or Columns?</li>\n    <li>How many cells in the dataset?</li>\n    <li>How many genes in the dataset?</li>\n  </ol>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <ol>\n      <li>Rows, notice the long A-C-T-G based names.</li>\n      <li>Columns, “ATXG” are the gene prefixes commonly used by the Arabidopsis genomes.</li>\n      <li>There are 1 099 lines and therefore 1 099 cells</li>\n      <li>If we scroll the preview window all the way to the right we see 27 630 as the last number. Given that the first column are the cell names, we must subtract by 1 to get 27 629 cells.</li>\n    </ol>\n\n  </blockquote>\n\n</blockquote>\n\n<p>If the above feels like a convoluted way to get the dimensionality, that’s because we haven’t imported the data into the right format. For this we need to import both datasets into a single AnnData object (see the <a href=\"/training-material/topics/single-cell/tutorials/scrna-scanpy-pbmc3k/tutorial.html#anndata\">AnnData section in the previous tutorial</a>).</p>\n\n<h2 id=\"csv-to-anndata\">CSV to AnnData</h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Converting the Data</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/anndata_import/anndata_import/0.7.5+galaxy0\" title=\"Import Anndata and loom tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Import Anndata and loom</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.7.5+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><em>“hd5 format to be created”</em>: <code class=\"language-plaintext highlighter-rouge\">Anndata file</code>\n          <ul>\n            <li><em>“Format for the annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">Tabular, CSV, TSV</code>\n              <ul>\n                <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: Multi-select both <code class=\"language-plaintext highlighter-rouge\">SHR</code> and <code class=\"language-plaintext highlighter-rouge\">WT</code> datasets</li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title>Checking Dimensionality</comment-title>\n\n        <p>We can now inspect the dimensionality of the dataset by “peeking” at the dataset in the history and observing the general information, simply by clicking on the name of the dataset.</p>\n\n        <p>The <code class=\"language-plaintext highlighter-rouge\">#shr</code> dataset should show:</p>\n        <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>   [n_obs x n_vars]\n       1099 x 27629\n</code></pre></div>        </div>\n\n        <p>and the <code class=\"language-plaintext highlighter-rouge\">#wt</code> should show:</p>\n        <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>   [n_obs x n_vars]\n       4727 x 27629\n</code></pre></div>        </div>\n\n        <p>where <em>obs</em> refers to our observed cells, and <em>vars</em> references the genes/variables.</p>\n\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>Currently we have two seperate datasets, but we can merge them into one single AnnData object seperated by batch identifiers “shr” and “wt”. To do this, we simply manipulate one of the datasets and concatenate the other onto it.</p>\n\n<h2 id=\"merge-batches-and-relabel\">Merge Batches and Relabel</h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Merging Data</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/anndata_manipulate/anndata_manipulate/0.7.5+galaxy0\" title=\"Manipulate AnnData tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Manipulate AnnData</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.7.5+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">SHR dataset</code> (output of <strong>Import Anndata and loom</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Function to manipulate the object”</em>: <code class=\"language-plaintext highlighter-rouge\">Concatenate along the observations axis</code>\n          <ul>\n            <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix to add”</em>: <code class=\"language-plaintext highlighter-rouge\">WT dataset</code> (output of <strong>Import Anndata and loom</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n          </ul>\n        </li>\n      </ul>\n\n      <blockquote class=\"tip\">\n        <tip-title>Scheduling</tip-title>\n\n        <p>You can queue on the next task without the previous one being complete yet, just ensure that the input dataset for the next task is at least orange and not grey.</p>\n      </blockquote>\n\n      <blockquote class=\"comment\">\n        <comment-title></comment-title>\n\n        <p>At this point, the AnnData dataset batch information has a value of <code class=\"language-plaintext highlighter-rouge\">0</code> for the “SHR” cells and <code class=\"language-plaintext highlighter-rouge\">1</code> for the “WT” cells. This is fine if you wish to remember these two values for the remainder of the analysis since the step below is optional, however for plotting purposes it can just be easier to relabel the batch information with the action text labels <code class=\"language-plaintext highlighter-rouge\">shr</code> and <code class=\"language-plaintext highlighter-rouge\">wt</code>.</p>\n      </blockquote>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/anndata_manipulate/anndata_manipulate/0.7.5+galaxy0\" title=\"Manipulate AnnData tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Manipulate AnnData</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.7.5+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">anndata</code> (output of <strong>Manipulate AnnData</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Function to manipulate the object”</em>: <code class=\"language-plaintext highlighter-rouge\">Rename categories of annotation</code>\n          <ul>\n            <li><em>“Key for observations or variables annotation”</em>: <code class=\"language-plaintext highlighter-rouge\">batch</code></li>\n            <li><em>“Comma-separated list of new categories”</em>: <code class=\"language-plaintext highlighter-rouge\">shr, wt</code></li>\n          </ul>\n        </li>\n      </ul>\n\n      <blockquote class=\"warning\">\n        <warning-title>Order matters!</warning-title>\n\n        <p>The order in which the datasets are concatenated can affect the accuracy of the new labelling. If the <code class=\"language-plaintext highlighter-rouge\">#wt</code> dataset was first selected and then the <code class=\"language-plaintext highlighter-rouge\">#shr</code> dataset concatenated onto it, then the comma-seperated list of new categories above should be inverted.</p>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h1 id=\"quality-control\">Quality Control</h1>\n\n<p>We can confirm that our datasets have been combined into a single object by peeking at the dataset in the history and confirming two things:</p>\n\n<ol>\n  <li>The number of observations is equal to the total of the two initial AnnData datasets.</li>\n  <li>The file size of the new AnnData dataset is approximately equal to the total of the two initial AnnData datasets.</li>\n</ol>\n\n<blockquote class=\"matrix\">\n  <table>\n    <thead>\n      <tr>\n        <th style=\"text-align: right\">Batch</th>\n        <th style=\"text-align: left\">Number of Cells</th>\n        <th style=\"text-align: right\">File Size</th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr>\n        <td style=\"text-align: right\">shr</td>\n        <td style=\"text-align: left\">1099</td>\n        <td style=\"text-align: right\">117.2 MB</td>\n      </tr>\n      <tr>\n        <td style=\"text-align: right\">wt</td>\n        <td style=\"text-align: left\">4727</td>\n        <td style=\"text-align: right\">499.7 MB</td>\n      </tr>\n    </tbody>\n    <tbody>\n      <tr>\n        <td style=\"text-align: right\"><strong>Total</strong></td>\n        <td style=\"text-align: left\">5826</td>\n        <td style=\"text-align: right\">615.6 MB</td>\n      </tr>\n    </tbody>\n  </table>\n</blockquote>\n\n<p>A happy coincidence here is that both datasets already had the exact same variables, so that the merging of the two datasets still yields the same number of genes.</p>\n\n<h2 id=\"filtering-the-matrix\">Filtering the Matrix</h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Generating some metrics</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scanpy_inspect/scanpy_inspect/1.7.1+galaxy0\" title=\"Inspect and manipulate tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Inspect and manipulate</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.7.1+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">anndata</code> (output of <strong>Manipulate AnnData</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Method used for inspecting”</em>: <code class=\"language-plaintext highlighter-rouge\">Calculate quality control metrics, using 'pp.calculate_qc_metrics'</code></li>\n      </ul>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scanpy_plot/scanpy_plot/1.7.1+galaxy0\" title=\"Plot with scanpy tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Plot with scanpy</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.7.1+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">anndata</code> (output of <strong>Manipulate AnnData</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Method used for plotting”</em>: <code class=\"language-plaintext highlighter-rouge\">Generic: Violin plot, using 'pl.violin'</code>\n          <ul>\n            <li><em>“Keys for accessing variables”</em>: <code class=\"language-plaintext highlighter-rouge\">Subset of variables in 'adata.var_names' or fields of '.obs'</code>\n              <ul>\n                <li><em>“Keys for accessing variables”</em>: <code class=\"language-plaintext highlighter-rouge\">n_genes_by_counts, total_counts</code></li>\n              </ul>\n            </li>\n            <li><em>“The key of the observation grouping to consider”</em>: <code class=\"language-plaintext highlighter-rouge\">batch</code></li>\n            <li>In <em>“Violin plot attributes”</em>:\n              <ul>\n                <li><em>“Add a stripplot on top of the violin plot”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code>\n                  <ul>\n                    <li><em>“Add a jitter to the stripplot”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code>\n                      <ul>\n                        <li><em>“Size of the jitter points”</em>: <code class=\"language-plaintext highlighter-rouge\">0.4</code></li>\n                      </ul>\n                    </li>\n                  </ul>\n                </li>\n                <li><em>“Display keys in multiple panels”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>This should result in the following violin plot, where we see the distribution of the number of genes per cell (<code class=\"language-plaintext highlighter-rouge\">n_genes_by_counts</code>) and the library size per cell, where the library size is the total number of mRNA in a cell, regardless of which gene it came from (<code class=\"language-plaintext highlighter-rouge\">total_counts</code>).</p>\n\n<p><a href=\"/training-material/topics/single-cell/images/scrna-plant/violin1.png\" rel=\"noopener noreferrer\"><img src=\"/training-material/topics/single-cell/images/scrna-plant/violin1.png\" alt=\"&quot;Violin Plots per Batch&quot;. \" width=\"1340\" height=\"413\" loading=\"lazy\" /></a></p>\n\n<p>Each dot is a cell, and the x-axis has two groups showing the absolute values of for each batch (<code class=\"language-plaintext highlighter-rouge\">shr</code> and <code class=\"language-plaintext highlighter-rouge\">wt</code>). The y-values correspond to the actual value of each cell, but the x-vales within each group are just random jitter to help see the cells more clearly. The outline of the violin plot shows us the density of each batch, where we can see that most of the cells in the <code class=\"language-plaintext highlighter-rouge\">shr</code> group have an average number of features just below 2000 genes, compared to <code class=\"language-plaintext highlighter-rouge\">wt</code> which has an average number of features just below 4000 genes. If we compare the library size, however, we notice that the outlines are very similar and that the average library sizes across batches are comparable.</p>\n\n<h3 id=\"filter\">Filter</h3>\n\n<p>Most scRNA-seq datasets need to set a minimum threshold of detectability in order to ensure that the cells are of high enough quality to be used for analysis. Conversely, sometimes an upper threshold also should be set to counter the case where a cell is a cell-doublet (in the sense that two cells were captured and sequenced accidentally as a single cell).</p>\n\n<p>The above violin plots suggest quite a few outliers, mostly on the upper-end of the density plots, suggesting a few cell-doublets in the data. The effect of these is not something we cannot easily regress out, and so we must filter them out instead. By looking at the plots, we can see that a good maximum library size here would be 100 000 transcripts, and a good maximum feature size would be 10 000 transcripts.</p>\n\n<p>For this analysis, we will set a minimum threshold of detectability that each cell should count transcripts from at least 200 genes, and that each gene should be expressed in at least 5 cells. These lower-bound thresholds are not so easy to derive from such QC plots, but depend mostly on the type of data you are using. If the number of features and the library sizes were one order of magnitude higher, one might consider also scaling the lower-bound thresholds by one order of magnitude.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Filtering</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scanpy_filter/scanpy_filter/1.7.1+galaxy0\" title=\"Filter tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Filter</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.7.1+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">anndata_out</code> (output of <strong>Inspect and manipulate</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Method used for filtering”</em>: <code class=\"language-plaintext highlighter-rouge\">Filter cell outliers based on counts and numbers of genes expressed, using 'pp.filter_cells'</code>\n          <ul>\n            <li><em>“Filter”</em>: <code class=\"language-plaintext highlighter-rouge\">Minimum number of genes expressed</code>\n              <ul>\n                <li><em>“Minimum number of genes expressed required for a cell to pass filtering”</em>: <code class=\"language-plaintext highlighter-rouge\">100</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scanpy_filter/scanpy_filter/1.7.1+galaxy0\" title=\"Filter tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Filter</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.7.1+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">anndata_out</code> (output of <strong>Filter</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Method used for filtering”</em>: <code class=\"language-plaintext highlighter-rouge\">Filter genes based on number of cells or counts, using 'pp.filter_genes'</code>\n          <ul>\n            <li><em>“Filter”</em>: <code class=\"language-plaintext highlighter-rouge\">Minimum number of cells expressed</code>\n              <ul>\n                <li><em>“Minimum number of cells expressed required for a gene to pass filtering”</em>: <code class=\"language-plaintext highlighter-rouge\">2</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n\n      <p>We now set the upper limits to the analysis.</p>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/anndata_manipulate/anndata_manipulate/0.7.5+galaxy0\" title=\"Manipulate AnnData tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Manipulate AnnData</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.7.5+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">anndata_out</code> (output of <strong>Filter</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Function to manipulate the object”</em>: <code class=\"language-plaintext highlighter-rouge\">Filter observations or variables</code>\n          <ul>\n            <li><em>“What to filter?”</em>: <code class=\"language-plaintext highlighter-rouge\">Observations (obs)</code></li>\n            <li><em>“Type of filtering?”</em>: <code class=\"language-plaintext highlighter-rouge\">By key (column) values</code>\n              <ul>\n                <li><em>“Key to filter”</em>: <code class=\"language-plaintext highlighter-rouge\">n_genes_by_counts</code></li>\n                <li><em>“Type of value to filter”</em>: <code class=\"language-plaintext highlighter-rouge\">Number</code>\n                  <ul>\n                    <li><em>“Filter”</em>: <code class=\"language-plaintext highlighter-rouge\">less than</code></li>\n                    <li><em>“Value”</em>: <code class=\"language-plaintext highlighter-rouge\">12000</code></li>\n                  </ul>\n                </li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/anndata_manipulate/anndata_manipulate/0.7.5+galaxy0\" title=\"Manipulate AnnData tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Manipulate AnnData</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.7.5+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">anndata</code> (output of <strong>Manipulate AnnData</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Function to manipulate the object”</em>: <code class=\"language-plaintext highlighter-rouge\">Filter observations or variables</code>\n          <ul>\n            <li><em>“What to filter?”</em>: <code class=\"language-plaintext highlighter-rouge\">Observations (obs)</code></li>\n            <li><em>“Type of filtering?”</em>: <code class=\"language-plaintext highlighter-rouge\">By key (column) values</code>\n              <ul>\n                <li><em>“Key to filter”</em>: <code class=\"language-plaintext highlighter-rouge\">total_counts</code></li>\n                <li><em>“Type of value to filter”</em>: <code class=\"language-plaintext highlighter-rouge\">Number</code>\n                  <ul>\n                    <li><em>“Filter”</em>: <code class=\"language-plaintext highlighter-rouge\">less than</code></li>\n                    <li><em>“Value”</em>: <code class=\"language-plaintext highlighter-rouge\">120000</code></li>\n                  </ul>\n                </li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>If we inspect the resulting dataset, we see that the number of cells remaining is <code class=\"language-plaintext highlighter-rouge\">5826</code> and the number of genes is <code class=\"language-plaintext highlighter-rouge\">18913</code>, which is still a good number of cells and genes. It is good practice to save the raw data in case we need to use it data, so we “freeze the raw data” into a slot for later safe keeping.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Saving the original matrix</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/anndata_manipulate/anndata_manipulate/0.7.5+galaxy0\" title=\"Manipulate AnnData tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Manipulate AnnData</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.7.5+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">anndata_out</code> (output of <strong>Filter</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Function to manipulate the object”</em>: <code class=\"language-plaintext highlighter-rouge\">Freeze the current state into the 'raw' attribute</code></li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h2 id=\"confounder-removal\">Confounder Removal</h2>\n\n<p>Now we have a set of cells we are reasonably confident contain desirable biological variation (please view the  following segment from <a href=\"/training-material/videos/watch.html?v=single-cell/tutorials/scrna-intro/slides&amp;t=11:28\"><em>“An introduction to scRNA-seq data analysis”</em></a> as a reference for the types of wanted and unwanted variation). We wish to now regress out the library size variation, as it is not indicative of cell type. To do this, we will first ensure that all cells are of the same comparable library size by applying individual size factors to each cell.</p>\n\n<p>We will also apply a log transformation to the cells, as this compresses the variation into a less extreme space, making it easier to see the relative differences between cells.</p>\n\n<p>After normalising and regressing out unwanted factors, we will then scale the data to have unit variance with a zero mean, so that the mean expression of each gene is not a factor in the analysis and only the variation is, ensuring that the later clustering is driven only by the relative variation of the genes, and not neccesarily how expressive those genes are.</p>\n\n<blockquote class=\"tip\">\n  <tip-title>Highly Variable Genes?</tip-title>\n\n  <p>Those of you who are familiar with the <a href=\"/training-material/topics/single-cell/tutorials/scrna-scanpy-pbmc3k/tutorial.html\">ScanPy Tutorial</a> might wonder why we have not reduced the number of genes by performing a highly variable gene selection.\nThe answer is simply that it did not help with this particular dataset, and that by removing the least variable genes in the analysis, it did help us replicate the analysis in the paper. Try it for yourself as an intermediate step (after this analysis) and see!</p>\n</blockquote>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Normalize and Scale</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scanpy_normalize/scanpy_normalize/1.7.1+galaxy0\" title=\"Normalize tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Normalize</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.7.1+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">anndata</code> (output of <strong>Manipulate AnnData</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Method used for normalization”</em>: <code class=\"language-plaintext highlighter-rouge\">Normalize counts per cell, using 'pp.normalize_total'</code>\n          <ul>\n            <li><em>“Target sum”</em>: <code class=\"language-plaintext highlighter-rouge\">10000.0</code></li>\n            <li><em>“Exclude (very) highly expressed genes for the computation of the normalization factor (size factor) for each cell”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scanpy_inspect/scanpy_inspect/1.7.1+galaxy0\" title=\"Inspect and manipulate tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Inspect and manipulate</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.7.1+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">anndata_out</code> (output of <strong>Normalize</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Method used for inspecting”</em>: <code class=\"language-plaintext highlighter-rouge\">Logarithmize the data matrix, using 'pp.log1p'</code></li>\n      </ul>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scanpy_remove_confounders/scanpy_remove_confounders/1.7.1+galaxy0\" title=\"Remove confounders tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Remove confounders</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.7.1+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">anndata_out</code> (output of <strong>Inspect and manipulate</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Method used for plotting”</em>: <code class=\"language-plaintext highlighter-rouge\">Regress out unwanted sources of variation, using 'pp.regress_out'</code>\n          <ul>\n            <li><em>“Keys for observation annotation on which to regress on”</em>: <code class=\"language-plaintext highlighter-rouge\">total_counts</code></li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scanpy_inspect/scanpy_inspect/1.7.1+galaxy0\" title=\"Inspect and manipulate tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Inspect and manipulate</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.7.1+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">anndata_out</code> (output of <strong>Remove confounders</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Method used for inspecting”</em>: <code class=\"language-plaintext highlighter-rouge\">Scale data to unit variance and zero mean, using 'pp.scale'</code>\n          <ul>\n            <li><em>“Maximum value”</em>: <code class=\"language-plaintext highlighter-rouge\">10.0</code></li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h2 id=\"dimensionality-reduction\">Dimensionality Reduction</h2>\n\n<p>Dimensionality reduction is the art of reducing a high dimensional dataset into a low dimensional “embedding” that humans can actually see (i.e. 2 or 3 dimensions), ideally such that the relationships or distances between data points are preserved in this embedding. In the context of single-cell datasets, this essentially means compressing &gt; 10 000 genes into just 2 X/Y variables.</p>\n\n<blockquote class=\"tip\">\n  <tip-title>What is Dimensionality Reduction?</tip-title>\n\n  <p>You can learn more about dimensionality reduction by consulting the following segment from <a href=\"/training-material/videos/watch.html?v=single-cell/tutorials/scrna-intro/slides&amp;t=13:46\"><em>“An introduction to scRNA-seq data analysis”</em></a>.</p>\n\n</blockquote>\n\n<p>This is usually a two step process:</p>\n\n<ol>\n  <li>A Principal Component Analysis (PCA) is used to perform an optimized “rotation” of the ~ 20 000 “unit” gene axes that we have, in order to better fit the data. These new axes or “principal components” are then <em>linear</em> combinations of the original unit axes, with an associated score of how variable each new axis is. By sorting these principal components by most variable to least variable, we can select the top N components and discard the rest, leaving us with most of the variation still in the data. Usually we select the top 40 principal components, which from 20 000 is a <em>huge</em> reduction in the dimensionality of the dataset.</li>\n  <li>We then perform a more complex kind of dimensionality reduction, one that does not assume any linearity in the axes. For scRNA-seq, this is either tSNE or UMAP, with UMAP being the main choice due to how flexible it is in incorporating new data. Though UMAP is capable of working on extremely high dimensional datasets, it is often limited by time and space constraints (read: the computer does not respond in a reasonable timeframe, or it crashes), and so therefore it is quite normal to feed UMAP the output of the PCA as input. This will then be a dimensionality reduction from 50 to 2. With these final 2 dimensions, we can plot the data.</li>\n</ol>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>PCA and UMAP</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scanpy_cluster_reduce_dimension/scanpy_cluster_reduce_dimension/1.7.1+galaxy0\" title=\"Cluster, infer trajectories and embed tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Cluster, infer trajectories and embed</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.7.1+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">anndata_out</code> (output of <strong>Inspect and manipulate</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Method used”</em>: <code class=\"language-plaintext highlighter-rouge\">Computes PCA (principal component analysis) coordinates, loadings and variance decomposition, using 'tl.pca'</code>\n          <ul>\n            <li><em>“Type of PCA?”</em>: <code class=\"language-plaintext highlighter-rouge\">Full PCA</code>\n              <ul>\n                <li><em>“SVD solver to use”</em>: <code class=\"language-plaintext highlighter-rouge\">ARPACK wrapper in SciPy</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scanpy_inspect/scanpy_inspect/1.7.1+galaxy0\" title=\"Inspect and manipulate tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Inspect and manipulate</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.7.1+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">anndata_out</code> (output of <strong>Cluster, infer trajectories and embed</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Method used for inspecting”</em>: <code class=\"language-plaintext highlighter-rouge\">Compute a neighborhood graph of observations, using 'pp.neighbors'</code>\n          <ul>\n            <li><em>“The size of local neighborhood (in terms of number of neighboring data points) used for manifold approximation”</em>: <code class=\"language-plaintext highlighter-rouge\">10</code></li>\n            <li><em>“Number of PCs to use”</em>: <code class=\"language-plaintext highlighter-rouge\">40</code></li>\n          </ul>\n        </li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title></comment-title>\n\n        <p>UMAP relies on a connected graph of cells to operate. Please view the following segment from <a href=\"/training-material/videos/watch.html?v=single-cell/tutorials/scrna-intro/slides&amp;t=13:40\"><em>“An introduction to scRNA-seq data analysis”</em></a> for more information on how this process works.</p>\n      </blockquote>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scanpy_cluster_reduce_dimension/scanpy_cluster_reduce_dimension/1.7.1+galaxy0\" title=\"Cluster, infer trajectories and embed tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Cluster, infer trajectories and embed</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.7.1+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">anndata_out</code> (output of <strong>Inspect and manipulate</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Method used”</em>: <code class=\"language-plaintext highlighter-rouge\">Embed the neighborhood graph using UMAP, using 'tl.umap'</code></li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>With our data now sufficiently “flat” and ready for human consumption, we can now do a naive plot of both the PCA and the UMAP and show cell assignments coloured by batch.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Plot the PCA and UMAP by Batch</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scanpy_plot/scanpy_plot/1.7.1+galaxy0\" title=\"Plot with scanpy tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Plot with scanpy</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.7.1+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">anndata_out</code> (output of <strong>Cluster, infer trajectories and embed</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Method used for plotting”</em>: <code class=\"language-plaintext highlighter-rouge\">Embeddings: Scatter plot in PCA coordinates, using 'pl.pca</code>\n          <ul>\n            <li><em>“Keys for annotations of observations/cells or variables/genes”</em>: <code class=\"language-plaintext highlighter-rouge\">batch</code></li>\n            <li>In <em>“Plot attributes”</em>\n              <ul>\n                <li><em>“Colors to use for plotting categorical annotation groups”</em>: <code class=\"language-plaintext highlighter-rouge\">rainbow (Miscellaneous)</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scanpy_plot/scanpy_plot/1.7.1+galaxy0\" title=\"Plot with scanpy tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Plot with scanpy</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.7.1+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">anndata_out</code> (output of <strong>Cluster, infer trajectories and embed</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Method used for plotting”</em>: <code class=\"language-plaintext highlighter-rouge\">Embeddings: Scatter plot in UMAP basis, using 'pl.umap'</code>\n          <ul>\n            <li><em>“Keys for annotations of observations/cells or variables/genes”</em>: <code class=\"language-plaintext highlighter-rouge\">batch</code></li>\n            <li><em>“Show edges?”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n            <li>In <em>“Plot attributes”</em>\n              <ul>\n                <li><em>“Legend font size”</em>: <code class=\"language-plaintext highlighter-rouge\">14</code></li>\n                <li><em>“Colors to use for plotting categorical annotation groups”</em>: <code class=\"language-plaintext highlighter-rouge\">rainbow (Miscellaneous)</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<table>\n  <thead>\n    <tr>\n      <th style=\"text-align: center\">PCA</th>\n      <th style=\"text-align: center\">UMAP</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td style=\"text-align: center\"><a href=\"/training-material/topics/single-cell/images/scrna-plant/pca_batch.png\" rel=\"noopener noreferrer\"><img src=\"/training-material/topics/single-cell/images/scrna-plant/pca_batch.png\" alt=\"PCA. \" width=\"614\" height=\"429\" loading=\"lazy\" /></a></td>\n      <td style=\"text-align: center\"><a href=\"/training-material/topics/single-cell/images/scrna-plant/umap_batch.png\" rel=\"noopener noreferrer\"><img src=\"/training-material/topics/single-cell/images/scrna-plant/umap_batch.png\" alt=\"UMAP. \" width=\"645\" height=\"429\" loading=\"lazy\" /></a></td>\n    </tr>\n  </tbody>\n</table>\n\n<p>From this, we can see that there is a reasonable overlap in our batches shown both in the PCA and UMAP embeddings. This is good because it shows that though there is <em>some</em> batch effect (i.e. cells from one batch appear to cluster on a different side of the plot than the other) it is not significant enough for there not to be some commonality between the batches.</p>\n\n<p>There are batch correction algorithms for cases where one batch clusters completely seperate from the other, but this is not necessary here.</p>\n\n<h1 id=\"finding-cell-types\">Finding Cell Types</h1>\n\n<h2 id=\"clustering\">Clustering</h2>\n\n<p>Let us cluster the cells and see what cell types we can discover in the plots. The cell types that we wish to recover are those shown in the original paper, as highlighted by the gene markers in the DotPlot below.</p>\n\n<table>\n  <thead>\n    <tr>\n      <th style=\"text-align: center\">UMAP</th>\n      <th style=\"text-align: center\">DotPlot</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td style=\"text-align: center\"><a href=\"/training-material/topics/single-cell/images/scrna-plant/clusters_expected.png\" rel=\"noopener noreferrer\"><img src=\"/training-material/topics/single-cell/images/scrna-plant/clusters_expected.png\" alt=\"PCA. \" width=\"2600\" height=\"1912\" loading=\"lazy\" /></a></td>\n      <td style=\"text-align: center\"><a href=\"/training-material/topics/single-cell/images/scrna-plant/dotplot_expected.png\" rel=\"noopener noreferrer\"><img src=\"/training-material/topics/single-cell/images/scrna-plant/dotplot_expected.png\" alt=\"UMAP. \" width=\"2766\" height=\"2178\" loading=\"lazy\" /></a></td>\n    </tr>\n  </tbody>\n</table>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Generate and Plots Clusters</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scanpy_cluster_reduce_dimension/scanpy_cluster_reduce_dimension/1.7.1+galaxy0\" title=\"Cluster, infer trajectories and embed tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Cluster, infer trajectories and embed</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.7.1+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">anndata_out</code> (output of <strong>Cluster, infer trajectories and embed</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Method used”</em>: <code class=\"language-plaintext highlighter-rouge\">Cluster cells into subgroups, using 'tl.leiden'</code>\n          <ul>\n            <li><em>“Coarseness of the clusterin”</em>: <code class=\"language-plaintext highlighter-rouge\">0.35</code></li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scanpy_plot/scanpy_plot/1.7.1+galaxy0\" title=\"Plot with scanpy tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Plot with scanpy</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.7.1+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">anndata_out</code> (output of <strong>Cluster, infer trajectories and embed</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Method used for plotting”</em>: <code class=\"language-plaintext highlighter-rouge\">Embeddings: Scatter plot in UMAP basis, using 'pl.umap'</code>\n          <ul>\n            <li><em>“Keys for annotations of observations/cells or variables/genes”</em>: <code class=\"language-plaintext highlighter-rouge\">leiden, batch</code></li>\n            <li><em>“Show edges?”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n            <li>In <em>“Plot attributes”</em>:\n              <ul>\n                <li><em>“Location of legend”</em>: <code class=\"language-plaintext highlighter-rouge\">on data</code></li>\n                <li><em>“Legend font size”</em>: <code class=\"language-plaintext highlighter-rouge\">14</code></li>\n                <li><em>“Colors to use for plotting categorical annotation groups”</em>: <code class=\"language-plaintext highlighter-rouge\">rainbow (Miscellaneous)</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title></comment-title>\n\n        <p>We print the legend on the data because it’s easier to see where the cluster labels apply.</p>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p><a href=\"/training-material/topics/single-cell/images/scrna-plant/clusters_found.png\" rel=\"noopener noreferrer\"><img src=\"/training-material/topics/single-cell/images/scrna-plant/clusters_found.png\" alt=\"UMAP Leiden Clusters. \" width=\"1221\" height=\"429\" loading=\"lazy\" /></a></p>\n\n<p>Here we have recovered 13 clusters but we don’t yet know what types they describe. If we have a list of genes that we know are indicative of a certain cell type (i.e. are marker genes) then we can use this to assign labels to our clusters.</p>\n\n<p>Let us here try to recreate the DotPlot from the paper using the clusters we have discovered.</p>\n\n<h2 id=\"dotplot-and-validating-cell-types\">DotPlot and Validating Cell Types</h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Dot Plot</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scanpy_plot/scanpy_plot/1.7.1+galaxy0\" title=\"Plot with scanpy tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Plot with scanpy</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.7.1+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">anndata_out</code> (output of <strong>Cluster, infer trajectories and embed</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Method used for plotting”</em>: <code class=\"language-plaintext highlighter-rouge\">Generic: Makes a dot plot of the expression values, using 'pl.dotplot'</code>\n          <ul>\n            <li><em>“Variables to plot (columns of the heatmaps)”</em>: <code class=\"language-plaintext highlighter-rouge\">Subset of variables in 'adata.var_names'</code>\n              <ul>\n                <li><em>“List of variables to plot”</em>: <code class=\"language-plaintext highlighter-rouge\">AT1G26680,COBL2,AT3G55180,NCED2,AT5G22550,ATL63,RGF8,TEL1,DUF9,AGL42,PLT1,PLT2,PER3,PER9,PBL15,TBL30,AT2G48130,AT3G22620,AED3,T3P18-7,MBK21-8,NPF6-4,CYP71B34,IAMT1,AT1G31950,F14G6-22,GL2,ANL2,PMEI4,MUD21-4,EXPA7,MES15,ADF8,COBL9,TPR14,BHLH144,MYB83,SCPL35,MYB46,COBL4,PIN7,PIN3   </code></li>\n              </ul>\n            </li>\n            <li><em>“The key of the observation grouping to consider”</em>: <code class=\"language-plaintext highlighter-rouge\">leiden</code></li>\n            <li><em>“Number of categories”</em>: <code class=\"language-plaintext highlighter-rouge\">9</code></li>\n            <li><em>“Use ‘raw’ attribute of input if present”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n            <li>In <em>“Group of variables to highlight”</em>:\n              <ul>\n                <li><i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert Group of variables to highlight”</em>\n                  <ul>\n                    <li><em>“Start”</em>: <code class=\"language-plaintext highlighter-rouge\">0</code></li>\n                    <li><em>“End”</em>: <code class=\"language-plaintext highlighter-rouge\">5</code></li>\n                    <li><em>“Label”</em>: <code class=\"language-plaintext highlighter-rouge\">Columella</code></li>\n                  </ul>\n                </li>\n                <li><i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert Group of variables to highlight”</em>\n                  <ul>\n                    <li><em>“Start”</em>: <code class=\"language-plaintext highlighter-rouge\">6</code></li>\n                    <li><em>“End”</em>: <code class=\"language-plaintext highlighter-rouge\">9</code></li>\n                    <li><em>“Label”</em>: <code class=\"language-plaintext highlighter-rouge\">QC</code></li>\n                  </ul>\n                </li>\n                <li><i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert Group of variables to highlight”</em>\n                  <ul>\n                    <li><em>“Start”</em>: <code class=\"language-plaintext highlighter-rouge\">10</code></li>\n                    <li><em>“End”</em>: <code class=\"language-plaintext highlighter-rouge\">11</code></li>\n                    <li><em>“Label”</em>: <code class=\"language-plaintext highlighter-rouge\">NC</code></li>\n                  </ul>\n                </li>\n                <li><i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert Group of variables to highlight”</em>\n                  <ul>\n                    <li><em>“Start”</em>: <code class=\"language-plaintext highlighter-rouge\">12</code></li>\n                    <li><em>“End”</em>: <code class=\"language-plaintext highlighter-rouge\">17</code></li>\n                    <li><em>“Label”</em>: <code class=\"language-plaintext highlighter-rouge\">Endodermis</code></li>\n                  </ul>\n                </li>\n                <li><i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert Group of variables to highlight”</em>\n                  <ul>\n                    <li><em>“Start”</em>: <code class=\"language-plaintext highlighter-rouge\">18</code></li>\n                    <li><em>“End”</em>: <code class=\"language-plaintext highlighter-rouge\">23</code></li>\n                    <li><em>“Label”</em>: <code class=\"language-plaintext highlighter-rouge\">Cortex</code></li>\n                  </ul>\n                </li>\n                <li><i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert Group of variables to highlight”</em>\n                  <ul>\n                    <li><em>“Start”</em>: <code class=\"language-plaintext highlighter-rouge\">24</code></li>\n                    <li><em>“End”</em>: <code class=\"language-plaintext highlighter-rouge\">29</code></li>\n                    <li><em>“Label”</em>: <code class=\"language-plaintext highlighter-rouge\">Atrichoblast</code></li>\n                  </ul>\n                </li>\n                <li><i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert Group of variables to highlight”</em>\n                  <ul>\n                    <li><em>“Start”</em>: <code class=\"language-plaintext highlighter-rouge\">30</code></li>\n                    <li><em>“End”</em>: <code class=\"language-plaintext highlighter-rouge\">34</code></li>\n                    <li><em>“Label”</em>: <code class=\"language-plaintext highlighter-rouge\">Trichoblast</code></li>\n                  </ul>\n                </li>\n                <li><i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert Group of variables to highlight”</em>\n                  <ul>\n                    <li><em>“Start”</em>: <code class=\"language-plaintext highlighter-rouge\">35</code></li>\n                    <li><em>“End”</em>: <code class=\"language-plaintext highlighter-rouge\">39</code></li>\n                    <li><em>“Label”</em>: <code class=\"language-plaintext highlighter-rouge\">Xylem</code></li>\n                  </ul>\n                </li>\n                <li><i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert Group of variables to highlight”</em>\n                  <ul>\n                    <li><em>“Start”</em>: <code class=\"language-plaintext highlighter-rouge\">40</code></li>\n                    <li><em>“End”</em>: <code class=\"language-plaintext highlighter-rouge\">41</code></li>\n                    <li><em>“Label”</em>: <code class=\"language-plaintext highlighter-rouge\">VC</code></li>\n                  </ul>\n                </li>\n              </ul>\n            </li>\n            <li><em>“Custom figure size”</em>: <code class=\"language-plaintext highlighter-rouge\">No: the figure width is set based on the number of variable names and the height is set to 10.</code></li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>By running the above we end up with the following DotPlot:</p>\n\n<p><a href=\"/training-material/topics/single-cell/images/scrna-plant/dotplot_found.png\" rel=\"noopener noreferrer\"><img src=\"/training-material/topics/single-cell/images/scrna-plant/dotplot_found.png\" alt=\"Dotplot In Analyssis. \" width=\"1365\" height=\"545\" loading=\"lazy\" /></a></p>\n\n<p>Notice how we have the Columella, QC and NC sharing the same cluster 11, that the Endodermis is localised in cluster 8, the Cortex in cluster 9, the Trichoblast cells in cluster 3, the Xylem showing strong expression in cluster 12, VC in clusters 4 and 6, and the Atrichoblasts have a mixed expression in a range of clusters. These characteristics are the same as the Dotplot in the original paper.</p>\n\n<p>We can use this Dotplot as a guide to relabel our clusters and give more meaningful annotations to the plots.</p>\n\n<h2 id=\"relabel-clusters\">Relabel clusters</h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Cluster Re-labelling</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/anndata_manipulate/anndata_manipulate/0.7.5+galaxy0\" title=\"Manipulate AnnData tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Manipulate AnnData</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.7.5+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">anndata_out</code> (output of <strong>Cluster, infer trajectories and embed</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Function to manipulate the object”</em>: <code class=\"language-plaintext highlighter-rouge\">Rename categories of annotation</code>\n          <ul>\n            <li><em>“Key for observations or variables annotation”</em>: <code class=\"language-plaintext highlighter-rouge\">leiden</code></li>\n            <li><em>“Comma-separated list of new categories”</em>: <code class=\"language-plaintext highlighter-rouge\">0, 1, 2, trichoblasts, 4, 5, 6, atrichoblasts, endodermis, cortex, 10, columella+QC+NC, xylem</code></li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scanpy_plot/scanpy_plot/1.7.1+galaxy0\" title=\"Plot with scanpy tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Plot with scanpy</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.7.1+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">anndata</code> (output of <strong>Manipulate AnnData</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Method used for plotting”</em>: <code class=\"language-plaintext highlighter-rouge\">Embeddings: Scatter plot in UMAP basis, using 'pl.umap'</code>\n          <ul>\n            <li><em>“Keys for annotations of observations/cells or variables/genes”</em>: <code class=\"language-plaintext highlighter-rouge\">leiden, batch</code></li>\n            <li><em>“Show edges?”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n            <li>In <em>“Plot attributes”</em>:\n              <ul>\n                <li><em>“Location of legend”</em>: <code class=\"language-plaintext highlighter-rouge\">on data</code></li>\n                <li><em>“Legend font size”</em>: <code class=\"language-plaintext highlighter-rouge\">14</code></li>\n                <li><em>“Colors to use for plotting categorical annotation groups”</em>: <code class=\"language-plaintext highlighter-rouge\">rainbow (Miscellaneous)</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p><a href=\"/training-material/topics/single-cell/images/scrna-plant/clusters_found_relabelled.png\" rel=\"noopener noreferrer\"><img src=\"/training-material/topics/single-cell/images/scrna-plant/clusters_found_relabelled.png\" alt=\"Relabelled clusters. \" width=\"1110\" height=\"429\" loading=\"lazy\" /></a></p>\n\n<p>If we look at the clusters now, and compare them to the original image in the paper, we can infer that the meristematic cells are likely to be derived from cluster 1, which shares soft clustering with the trichoblasts suggesting a trajectory pathway which could be explored.</p>\n\n<h1 id=\"conclusions\">Conclusions</h1>\n\n<p>In this tutorial, we have recapitulated the same clustering analysis in the “Spatiotemporal Developmental Trajectories in the Arabidopsis Root Revealed Using High-Throughput Single-Cell RNA Sequencing” <span class=\"citation\"><a href=\"#denyer2019spatiotemporal\">Denyer <i>et al.</i> 2019</a></span> paper, and validated them by comparing DotPlots for specific genes that were used as markers in that paper.</p>\n\n<p>From this point, we can perform a lineage analysis to infer a differentiation pathway between the clusters. For ScanPy there is the PAGA option, however, this does not work so well with the current dataset, so it is encouraged that users use the original Seurat trajectory suite that was given in the paper, or to experiment with Monocle.</p>\n\n<p>Both libraries are available within the RStudio and Jupyter Notebook libraries in the interactive Galaxy envronments which can be found in the <em>“Miscellaneous Tools”</em> section under the <em>“Interactive Tools”</em> subheading. An excellent follow-up tutorial to perform a trajectory analysis in Galaxy using Jupyter notebooks would be the <a href=\"/training-material/topics/single-cell/tutorials/scrna-case_JUPYTER-trajectories/tutorial.html\"><em>“Trajectory Analysis using Python (Jupyter Notebook) in Galaxy”</em></a>.</p>\n\n<p>This entire tutorial can be invoked from the scRNA Plant Workflow shown below:</p>\n\n<p><a href=\"/training-material/topics/single-cell/images/scrna-plant/scrna-plant-workflow.png\" rel=\"noopener noreferrer\"><img src=\"/training-material/topics/single-cell/images/scrna-plant/scrna-plant-workflow.png\" alt=\"scRNA Plant. \" width=\"1313\" height=\"598\" loading=\"lazy\" /></a></p>\n\n<p>The input parameters take two datasets as input, and 5 parameters using the defaults shown in this tutorial: min cells, min genes, max features, max library size, and Leiden clustering resolution. Play with these options to see how robust the analysis really is!</p>\n"],"ref_slides":[],"video_library":{"tutorial":{"description":"This tutorial replicates the paper “Spatiotemporal Developmental Trajectories in the Arabidopsis Root Revealed Using High-Throughput Single-Cell RNA Sequencing” (Denyer et al. 2019), where the major plant cell types are recovered in the data as well as distinguishing between QC and meristematic cells. The original paper used the Seurat analysis suite (Satija et al. 2015), but here we will use the ScanPy analysis suite (Wolf et al. 2018) integrated within the single-cell resources in Galaxy (Tekman et al. 2020).","materials":[{"link":"topics/single-cell/tutorials/scrna-plant/tutorial.html","type":"Tutorial"}],"tags":["transcriptomics","single-cell"],"type":"Tutorial","versions":[{"captions":["mtekman"],"date":"2021-02-15","galaxy_version":"21.01","length":"55M","link":"yKlJ5ESri7o","speakers":["mtekman"]}],"gtn_id":"single-cell/scrna-plant","title":"Analysis of plant scRNA-Seq Data with Scanpy","captioned":true},"slides":null,"demo":null,"both":null,"session":null},"hands_on":true,"slides":false,"mod_date":"2023-11-03 14:30:27 +0000","pub_date":"2021-04-08 10:59:53 +0000","version":9,"workflows":[{"workflow":"main_workflow.ga","tests":false,"url":"https://training.galaxyproject.org/training-material/topics/single-cell/tutorials/scrna-plant/workflows/main_workflow.ga","path":"topics/single-cell/tutorials/scrna-plant/workflows/main_workflow.ga","wfid":"single-cell-scrna-plant","wfname":"main_workflow","trs_endpoint":"https://training.galaxyproject.org/training-material/api/ga4gh/trs/v2/tools/single-cell-scrna-plant/versions/main_workflow","license":null,"creators":[],"name":"scRNA Plant Analysis","title":"scRNA Plant Analysis","test_results":null,"modified":"2024-06-14 00:15:06 +0000","mermaid":"flowchart TD\n  0[\"ℹ️ Input Parameter\\nLeiden Resolution\"];\n  style 0 fill:#ded,stroke:#393,stroke-width:4px;\n  1[\"ℹ️ Input Dataset\\nSHR CSV.gz\"];\n  style 1 stroke:#2c3143,stroke-width:4px;\n  2[\"ℹ️ Input Dataset\\nWT CSV.gz\"];\n  style 2 stroke:#2c3143,stroke-width:4px;\n  3[\"ℹ️ Input Parameter\\nMin Genes\"];\n  style 3 fill:#ded,stroke:#393,stroke-width:4px;\n  4[\"ℹ️ Input Parameter\\nMin Cells\"];\n  style 4 fill:#ded,stroke:#393,stroke-width:4px;\n  5[\"ℹ️ Input Parameter\\nMax Features\"];\n  style 5 fill:#ded,stroke:#393,stroke-width:4px;\n  6[\"ℹ️ Input Parameter\\nMax Lib Size\"];\n  style 6 fill:#ded,stroke:#393,stroke-width:4px;\n  7[\"Import Anndata and loom\"];\n  1 -->|output| 7;\n  8[\"Import Anndata and loom\"];\n  2 -->|output| 8;\n  9[\"Manipulate AnnData\"];\n  7 -->|anndata| 9;\n  8 -->|anndata| 9;\n  10[\"Rename Batches\"];\n  9 -->|anndata| 10;\n  680180f6-edfc-4f66-b265-7a63aaa22b39[\"Output\\nscRNA Concatenated Datasets\"];\n  10 --> 680180f6-edfc-4f66-b265-7a63aaa22b39;\n  style 680180f6-edfc-4f66-b265-7a63aaa22b39 stroke:#2c3143,stroke-width:4px;\n  11[\"QC metrics\"];\n  10 -->|anndata| 11;\n  12[\"Filter genes\"];\n  11 -->|anndata_out| 12;\n  3 -->|output| 12;\n  13[\"Plot Violin\"];\n  11 -->|anndata_out| 13;\n  14[\"Filter Cells\"];\n  12 -->|anndata_out| 14;\n  4 -->|output| 14;\n  15[\"Filter Max Features\"];\n  14 -->|anndata_out| 15;\n  5 -->|output| 15;\n  16[\"Filter Max Library Size\"];\n  15 -->|anndata| 16;\n  6 -->|output| 16;\n  17[\"Save RAW\"];\n  16 -->|anndata| 17;\n  18[\"Norm to 1e4\"];\n  17 -->|anndata| 18;\n  19[\"Log1p\"];\n  18 -->|anndata_out| 19;\n  20[\"Regress total counts\"];\n  19 -->|anndata_out| 20;\n  21[\"Scale\"];\n  20 -->|anndata_out| 21;\n  22[\"PCA\"];\n  21 -->|anndata_out| 22;\n  23[\"Neighborhod\"];\n  22 -->|anndata_out| 23;\n  24[\"UMAP\"];\n  23 -->|anndata_out| 24;\n  25[\"Leiden\"];\n  24 -->|anndata_out| 25;\n  0 -->|output| 25;\n  48cf0465-84ba-461a-bdb9-61625626de42[\"Output\\nscRNA with clusters Dataset\"];\n  25 --> 48cf0465-84ba-461a-bdb9-61625626de42;\n  style 48cf0465-84ba-461a-bdb9-61625626de42 stroke:#2c3143,stroke-width:4px;\n  26[\"Plot PCA batch\"];\n  24 -->|anndata_out| 26;\n  27[\"Plot UMAP batch\"];\n  24 -->|anndata_out| 27;\n  28[\"Plot UMAP leiden, batch\"];\n  25 -->|anndata_out| 28;\n  29[\"Rename Clusters\"];\n  25 -->|anndata_out| 29;\n  30[\"Complex DotPlot\"];\n  25 -->|anndata_out| 30;\n  31[\"Complex DotPlot with new labels\"];\n  29 -->|anndata| 31;\n  32[\"Plot UMAP with new labels\"];\n  29 -->|anndata| 32;"}],"api":"https://training.galaxyproject.org/training-material/api/topics/single-cell/tutorials/scrna-plant/tutorial.json","tools":["toolshed.g2.bx.psu.edu/repos/iuc/anndata_import/anndata_import/0.7.5+galaxy0","toolshed.g2.bx.psu.edu/repos/iuc/anndata_manipulate/anndata_manipulate/0.7.5+galaxy0","toolshed.g2.bx.psu.edu/repos/iuc/scanpy_cluster_reduce_dimension/scanpy_cluster_reduce_dimension/1.7.1+galaxy0","toolshed.g2.bx.psu.edu/repos/iuc/scanpy_filter/scanpy_filter/1.7.1+galaxy0","toolshed.g2.bx.psu.edu/repos/iuc/scanpy_inspect/scanpy_inspect/1.7.1+galaxy0","toolshed.g2.bx.psu.edu/repos/iuc/scanpy_normalize/scanpy_normalize/1.7.1+galaxy0","toolshed.g2.bx.psu.edu/repos/iuc/scanpy_plot/scanpy_plot/1.7.1+galaxy0","toolshed.g2.bx.psu.edu/repos/iuc/scanpy_remove_confounders/scanpy_remove_confounders/1.7.1+galaxy0"],"supported_servers":{"exact":[{"url":"https://usegalaxy.eu","name":"UseGalaxy.eu","usegalaxy":true},{"url":"https://usegalaxy.org","name":"UseGalaxy.org (Main)","usegalaxy":true},{"url":"https://usegalaxy.org.au","name":"UseGalaxy.org.au","usegalaxy":true}],"inexact":[{"url":"https://usegalaxy.be/","name":"UseGalaxy.be","usegalaxy":false},{"url":"https://usegalaxy.cz/","name":"UseGalaxy.cz","usegalaxy":false},{"url":"https://usegalaxy.no/","name":"UseGalaxy.no","usegalaxy":false}]},"topic_name_human":"Single Cell","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[{"name":"anndata_import","owner":"iuc","revisions":"55e35e9203cf","tool_panel_section_label":"Single-cell","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"anndata_manipulate","owner":"iuc","revisions":"9bd945a03d7b","tool_panel_section_label":"Single-cell","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"scanpy_cluster_reduce_dimension","owner":"iuc","revisions":"aaa5da8e73a9","tool_panel_section_label":"Single-cell","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"scanpy_filter","owner":"iuc","revisions":"b409c2486353","tool_panel_section_label":"Single-cell","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"scanpy_inspect","owner":"iuc","revisions":"c5d3684f7c4c","tool_panel_section_label":"Single-cell","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"scanpy_normalize","owner":"iuc","revisions":"ab55fe8030b6","tool_panel_section_label":"Single-cell","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"scanpy_plot","owner":"iuc","revisions":"6adf98e782f3","tool_panel_section_label":"Single-cell","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"scanpy_remove_confounders","owner":"iuc","revisions":"bf2017df9837","tool_panel_section_label":"Single-cell","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"}]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools:\n- name: anndata_import\n  owner: iuc\n  revisions: 55e35e9203cf\n  tool_panel_section_label: Single-cell\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: anndata_manipulate\n  owner: iuc\n  revisions: 9bd945a03d7b\n  tool_panel_section_label: Single-cell\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: scanpy_cluster_reduce_dimension\n  owner: iuc\n  revisions: aaa5da8e73a9\n  tool_panel_section_label: Single-cell\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: scanpy_filter\n  owner: iuc\n  revisions: b409c2486353\n  tool_panel_section_label: Single-cell\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: scanpy_inspect\n  owner: iuc\n  revisions: c5d3684f7c4c\n  tool_panel_section_label: Single-cell\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: scanpy_normalize\n  owner: iuc\n  revisions: ab55fe8030b6\n  tool_panel_section_label: Single-cell\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: scanpy_plot\n  owner: iuc\n  revisions: 6adf98e782f3\n  tool_panel_section_label: Single-cell\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: scanpy_remove_confounders\n  owner: iuc\n  revisions: bf2017df9837\n  tool_panel_section_label: Single-cell\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n","tours":false,"video":false,"translations":{"tutorial":[],"slides":[],"video":false},"license":"CC-BY-4.0","type":"tutorial"}