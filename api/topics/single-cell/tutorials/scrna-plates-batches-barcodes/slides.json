{"layout":"tutorial_slides","logo":"GTN","title":"Plates, Batches, and Barcodes","subtopic":"scintroduction","priority":3,"redirect_from":["/topics/transcriptomics/tutorials/scrna-plates-batches-barcodes/slides","/short/single-cell/scrna-plates-batches-barcodes/slides","/short/S00085"],"video":true,"zenodo_link":"","tags":null,"questions":["What is a batch when it comes to single cells?","What’s the difference between a barcode and an index?","What is batch effect and how do you prevent it?","What is a lane?"],"objectives":["How to set up plates to prevent batch effect","Proper naming conventions when dealing with scRNA-seq samples"],"time_estimation":"1h","key_points":["Balanced batches and replicates allow bioinformatic batch correction","A sequencing lane often contains multiple batches, and is itself a batch effect!"],"contributors":["nomadscientist","mtekman","astrovsky01"],"js_requirements":{"mathjax":7126,"mermaid":false},"short_id":"S00085","url":"/topics/single-cell/tutorials/scrna-plates-batches-barcodes/slides.html","topic_name":"single-cell","tutorial_name":"scrna-plates-batches-barcodes","dir":"topics/single-cell/tutorials/scrna-plates-batches-barcodes","symlink":null,"id":"single-cell/scrna-plates-batches-barcodes","ref_tutorials":[],"ref_slides":["### Sorting Plates\n\n\n.image-100[![slide5](../../images/scrna-intro/wab96wellplate.svg)]\n\n.left[Plates are *N x M* arrays of wells that cells are sorted, to then be individually amplified and sequenced.]\n\n???\n- Sorting plates are 2 dimensional arrays of wells that individual cells are placed into.\n- Each cell in each well is tagged with a unique barcode and then primed to then be amplified and sequenced\n- The method in which this is performed can yield significant pros and cons as we will see.\n\n---\n\n### Sorting Plates\n\n.image-80[![slide6](../../images/scrna-intro/wabexampleplates.png)]\n\n???\n- Here we see 3 different sorting strategies with different advantages for same treatment sample.\n- In the top image: We see all wells are filled, to maximise the number of cells on a plate\n- In the middle image: We see only the inner wells are filled, to maintain a protective border during library preparation\n- In the bottom image: We see a striping pattern, which mitigates contamination of material from adjoining wells\n\n---\n\n### Setting up Plates\n\n.image-75[![slide7](../../images/scrna-intro/wabbatchproblems.png)]\n\n.center[What is the problem with this plate setup?]\n\n???\n- However, if we consider different treatment samples, then we must consider different challenges.\n- What is the advantage of the top example, i.e. Several different treatments on one plate?\n- What is the advantage of the bottom example, i.e. One treatment on one plate?\n\n---\n\n### Setting up Plates\n\n.image-50[![slide7](../../images/scrna-intro/wabbatchproblems.png)]\n\n.center[Batch effect (plate vs plate) cannot be separated from treatment effect in either scenario.]\n\n???\n- Trick question!\n- In both examples, the treatment effect cannot be separated from any technical effect from the plate itself.\n- For example, the biological effect of the yellow cells might just be the technical confounding effect from Batch 1.\n- What can we do instead to reduce the effect of these technical confounding effects across treatments?\n\n---\n### Setting up Plates\n\n.image-50[![slide7](../../images/scrna-intro/wabbalancedbatches.png)]\n\n.left[Either of these are better set-ups. Mixing columns is good, but not required. Ultimately, batch effect can now be separated from variable effect.]\n\n???\n- The answer is that we can balance the treatments across our plates better.\n- By ensuring the same treatment occurs in comparable amounts in different plates, we can reduce the effect that each plate would have on the treatment.\n\n\n---\n\n### Setting up Plates\n\n.image-90[![slide7](../../images/scrna-intro/wabreplicates.png)]\n\n.center[Can't mix samples on plates? Separate replicates evenly and process together.]\n\n???\n- If putting multiple treatments on the same plate is not an option, then having enough separated replicates will also allow for batch correction.\n- Here, you can assess the variation between replicates, and thus batches, as well as between treatments.\n\n---\n\n### What about sequencing lanes?\n\n.center[So now it's time to sequence our samples! How do we combine samples into sequencing lanes?]\n\n.image-90[![slide7](../../images/scrna-intro/wabseqlane.png)]\n\n.center[This works well, but what if you have too many samples for one lane?]\n\n???\n- So now it's time to sequence our samples! How do we combine samples into sequencing lanes?\n- In many cases, it is enough to sequence 1 or 2 plates together in a single sequencing lane.\n- But what if we wish to sequence 8 plates?\n\n---\n\n### What about sequencing lanes?\n\n.center[So now it's time to sequence our samples! How do we combine samples into sequencing lanes?]\n\n.image-90[![slide7](../../images/scrna-intro/wablanesbad.png)]\n\n.center[Does this look ok?]\n\n???\n- In the example show, Treatment A would go to the first sequencing lane.\n- Treatment B would go to the second sequencing lane.\n- Is it okay to sequence different treatments across different sequencing lanes?\n\n--\n\n\n.center[No! You've turned each treatment (A & B) into a batch!]\n\n???\n- No, because you've turned Treatment A and Treatment B into separate batches.\n- This gives us the same unbalanced design we saw with the sorting plates.\n\n---\n\n### What about sequencing lanes?\n\n.image-75[![slide7](../../images/scrna-intro/wablanesgood.png)]\n\n.center[This is the way to balance your batches at the lane-level.]\n\n???\n- Instead we should balance the availability of each treatment across different sequencing lanes\n- This way, each treatment is sequenced at the same time as another treatment, reducing the technical effect from the sequencing on the treatment.\n\n---\n\n### Distinguishing cells in a plate\n\n.image-60[![slide11](../../images/scrna-intro/wabplate.png)]\n\n\n* Cells are selected from a plate by their *barcodes*\n* Barcodes must be unique\n  + e.g. 96 wells in a plate, need 96 barcodes to sequence them together\n\n???\n- How do we distinguish each cell in each well?\n- Do we remember the physical location of that cell on that well, or do we tag it somehow?\n- The answer is that each cell is given a unique barcode that distinguishes from other cells which have different cell barcodes.\n\n---\n\n### What are Cell Barcodes?\n\n.image-100[![Add Barcodes](../../images/scrna-intro/scrna_pbb_barcodes_add.svg)]\n\n* Barcodes are added to *all* transcripts of a *specific* cell\n* Transcripts with different cell barcodes originate from different cells\n\n???\n- What exactly are cell barcodes?\n- These are usually short nucleotide barcodes that are added to all transcripts of a specific cell\n- The idea is that transcripts with different cell barcodes originate from different cells.\n\n---\n\n### What are Cell Barcodes?\n\n.image-100[![Barcodes in Plate](../../images/scrna-intro/scrna_pbb_barcodes_overview.svg)]\n\n* Many different cell barcodes are used across many different cells\n* Each well in a plate contains a cell, indexed by its cell barcode\n\n???\n- Within a plate, many different barcodes are used, and each cell is indexed by the cell barcode assigned to that well.\n\n---\n\n### Questions about Cell Barcodes\n\n\n.image-50[![slide14](../../images/scrna-intro/wabplate.png)]\n\n.left[Assuming you sequence one 96-well plate:]\n\n1. How many cell barcodes are needed for a single lane?\n\n1. How many cell barcodes are needed if you combine 10 plates into a single sequencing lane?\n\n1. What would be the minimum length of the barcodes for each of the previous questions?\n\n???\n- Consider a 12 by 8 plate with 96 wells.\n- How many cell barcodes are needed if you sequence a single plate?\n- How many cell barcodes are needed if you sequence 10 plates into a single sequencing lane?\n- What would be the minimum length of the barcodes for each of the previous questions?\n\n--\n\n.footnote[\n1. *96 unique barcodes per lane*\n1. *96 x 10 = 960 unique barcodes per plate*\n]\n\n???\n- For one plate you would just need 96 unique barcodes\n- For 10 plates you would need 960 unique barcodes\n\n---\n\n### Questions about Cell Barcodes\n\n.left[<small>3) What would be the minimum length of the barcodes for each of the previous questions?</small>]\n\n.pull-left[\n\nA single lane?\n\n * 96 barcodes, 4 nucleotides for each base of a barcode\n\n| Barcodes | Result |\n|---------|------|\n| $$4^2 =  16$$ | <small>No, 2 bases is not enough |\n| $$4^3  = 64$$ | <small>No, 3 bases is not enough |\n| $$4^4 = 256$$ | <small>Yes, 4 bases is enough to cover 96 barcodes (and more!) |\n\n]\n\n???\n- To answer the third question, we need to make some assumptions about the barcodes.\n- If we assume a barcode is made up of a chain of 4 possible nucleotides, then we can solve the problem as a power of 4.\n- For a single lane with only 96 barcodes, we require our barcodes to be of at least 4 base pairs in length.\n\n--\n.pull-right[\n\n10 plates in a single lane?\n\n * 960 barcodes, 4 nucleotides for each base of a barcode\n\n| Barcodes | Result |\n|---------|------|\n|$$4^4 = 256$$ | <small>No, 4 bases is not enough |\n|$$4^5 = 1024$$ | <small>Yes, 5 bases is enough to cover 960 barcodes (just barely!) |\n\n]\n\n???\n- For 10 lanes with 960 barcodes, we require our barcodes to be of at least 5 base pairs in length.\n- However these calculations also make one serious assumption about the barcodes.\n\n---\n\n### Barcode Safeguarding\n\n.pull-left[\n* Is 5 nucleotides really enough to capture 960 cells?\n\n* What could go wrong if all barcodes are separated by 1 bp, as shown?\n]\n\n.pull-right[\n<small>*Edit distance = 1bp*\n\n    AAAAA AAAAC AAAAG AAAAT AAACA AAAGA AAATA ····\n    CCCCC CCCCA CCCCG CCCCT CCCAC CCCGC CCCTC ····\n                        ·\n                        ·\n                        ·\n]\n\n\n\n???\n- For example, we assume that all our barcodes are at minimum separated by a single base pair.\n- This is known as an edit distance of 1.\n- If we assume that every barcode is separated from every other barcode by 1 base pair, then 5 nucleotides is indeed enough to delineate 960 cells.\n- However if there was even just one small sequencing error of 1 base pair on any barcode, it would immediately change that erronous barcode into another real barcode.\n- That is to say, we have no way of detecting sequencing errors if we use an edit distance of 1.\n\n\n---\n\n### Guarding against Sequencing Errors\n\n.pull-left[\n* Sequencing errors can change the cell barcode\n\n* To guard against a 1 bp sequencing error, need to space barcodes by 2 bp\n\n* How many barcodes for a cell barcode of length 5 bp (ED = 2)?\n]\n.pull-right[\n<small>*Edit Distance = 2 bp*\n\n\n    AAAAA AAACC AAAGG AAATT AACCA AAGGA AATTA ····\n    CCCCC CCCAA CCCGG CCCTT CCCAA CCGGC CCTTC ····\n                        ·\n                        ·\n                        ·\n\n]\n\n???\n- Let us try to rectify this by increasing the edit distance to 2.\n- In the example barcodes shown we see barcodes of length 5, separated by 2 base pairs.\n- How many unique cell barcodes can we make given these restrictions?\n\n--\n\n$$ 4^{5-1} = 512 $$\n\n\n???\n- The answer is half the amount that we need.\n\n---\n\n### Edit Distance : General Principle\n\n.pull-left[\ne.g. For barcodes of length N=3:\n\n* Edit Distance of E=1:\n.center[`AAA AAC AAG AAT ACA ACC` ...]\n.center[<small>64 barcodes</small>]\n\n* Edit Distance of E=2:\n.center[`AAA ACC AGG ATT CAA CCC` ...]\n.center[<small>16 barcodes</small>]\n\n* Edit Distance of E=3:\n.center[`AAA CCC GGG TTT`]\n.center[<small>4 barcodes</small>]\n]\n\n???\n- Let us explore this more explicitly.\n- Here we will be using barcodes only of length 3, and we will explore different edit distances of 1, 2, and 3.\n- These yield 64, 16, and 4 barcodes respectively.\n\n\n--\n.pull-right[\nNumber of Barcodes :\n\n$$ 4^{N-(E-1)} $$\n\n.center[For barcodes of length *N*,\nand Edit Distance of *E*.]\n\n]\n\n???\n- This can be summarized by the formula given, where the length of the barcodes, minus one minus the edit distance, gives the number of available barcodes.\n\n---\n\n### How many available barcodes are there?\n\n.pull-left[\n* Barcodes typically limited to 4 main bases {A,C,T,G}.\n\n* Number of available barcodes depends on:\n\n  1. The length of the barcode\n\n  2. The edit distance between adjacent barcodes\n\n* Must take sequencing errors into account\n\n]\n\n???\n- To summarize, barcodes are typically limited to 4 nucleotides, and the number of available barcodes depends on the length and edit distance.\n- This is to ensure that sequencing errors are taken into account.\n\n\n--\n.pull-right[\n* Availability is balance between *barcode size* vs. *sequencing errors*\n\n* Typically between 4-10 bases, range of cells that can be labelled:\n\n   $$[4^4, 4^{10}] = [256, 1048576]$$\n\n\n* True range is lower due to edit distance.\n]\n\n???\n- The availability of barcodes and the number of cells they can label is a design choice, where the technician must balance two opposing forces: barcode size vs sequencing errors.\n- For the size, this means that for a barcode N bases long, there will 4 to the N barcodes available.\n- Typically barcodes tend to span 4 to 10 bases, since longer barcodes tend to be more subjectable to sequencing errors.\n- The true number of barcodes used is smaller than 4 to the N, due to the countermeasures used to space barcodes apart from one another, in order to reduce sequencing errors.\n\n---\n\n### Design Factors in Barcodes\n\nIs it better to use Longer or Shorter Barcodes?\n\n  | Longer | Shorter |\n  |--------|---------|\n  | Offer larger range of barcodes | Offer smaller range of barcodes |\n  | Prone to more sequencing errors | More robust against sequencing errors |\n  | Must increase edit distance significantly | A smaller edit distance is more acceptable |\n  | Can accommodate large edit distances | *Cannot* accommodate large edit distances |\n\n???\n- To weigh the pros and cons of longer and shorter barcodes, we need to take into account the likelihood of sequencing errors for a given size, and the resulting barcode address space given by the edit distance.\n\n---\n\n### Cell Barcodes: Summary\n\n.pull-left[\n\n* A single barcode sequence indexes a single cell\n\n* Every transcript in a specific cell has the same cell barcode\n\n* Barcodes are *designed* for smaller plate-based protocols, while for split-pool and similar techniques they are randomised.\n\n* Barcode use is *limited* by length and read depth\n\n]\n\n???\n- To summarize cell barcodes, we should note the following\n- A single barcode sequence indexes a single cell\n- Every transcript in a specific cell has the same cell barcode\n- Barcodes are designed for smaller plate-based protocols, while for split-pool and similar techniques they are randomised\n- Barcode use is limited by length and read depth\n\n--\n<hline>\n.pull-right[#### Need to balance:\n\n<small>\n\n  | | | |\n|-|-|-|\n| Edit Distance | vs. | Barcode Length |\n| Number of Barcodes | vs. | Plate and Lane Size |\n\n</small>\n]\n\n???\n- The number of reads wanted per cell determines how many cells you run in a sequencing lane, which in turn tells you how many barcodes you need.\n\n---\n\n# Summary\n\n.pull-left[\n\n* Cell Barcodes are sequences attached to transcripts to indicate what cell a transcript came from\n\n* Cell Barcodes are *designed* to the Plate/Lane setup\n\n]\n\n???\n- From the content shown here, you have learned the following.\n- Cell Barcodes are sequences attached to transcripts to indicate what cell a transcript came from\n- Cell Barcodes are designed for the Plate and Lane setup.\n\n\n--\n.pull-right[\n\n* Indicates what cell a transcript came from.\n\n* Reduce sequencing errors\n\n]\n\n???\n- Cell barcodes indicate what cell a transcript came from\n- They reduce sequencing errors when spaced appropriately\n"],"video_library":{"tutorial":null,"slides":null,"demo":null,"both":null,"session":null},"hands_on":false,"slides":true,"mod_date":"2023-10-09 16:30:03 +0000","pub_date":"2019-02-16 20:04:07 +0000","version":4,"api":"https://training.galaxyproject.org/training-material/api/topics/single-cell/tutorials/scrna-plates-batches-barcodes/tutorial.json","tools":[],"supported_servers":{"exact":[],"inexact":[{"name":"UseGalaxy.eu","url":"https://usegalaxy.eu","id":"eu","human":"Galaxy Europe","usegalaxy":true},{"name":"UseGalaxy.org","url":"https://usegalaxy.org","id":"us","human":"Galaxy Main","usegalaxy":true},{"name":"UseGalaxy.org.au","url":"https://usegalaxy.org.au","id":"au","human":"Galaxy Australia","usegalaxy":true},{"name":"UseGalaxy.fr","url":"https://usegalaxy.fr","id":"fr","human":"Galaxy France","usegalaxy":true}]},"topic_name_human":"Single Cell","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools: []\n","tours":false,"translations":{"tutorial":[],"slides":[],"video":true},"license":"CC-BY-4.0","type":"tutorial"}