{"layout":"tutorial_hands_on","title":"Removing the effects of the cell cycle","zenodo_link":"https://zenodo.org/record/7311628/","subtopic":"tricks","priority":2,"questions":["How can I reduce the effects of the cell cycle on my scRNA-seq data?"],"objectives":["Identify the cell cycle genes","Use the cell cycle genes to regress out the effects of the cell cycle","Create PCA plots to understand the impact of the regression"],"requirements":[{"type":"internal","topic_name":"single-cell","tutorials":["scrna-case_alevin","scrna-case_alevin-combine-datasets","scrna-case_basic-pipeline"]}],"time_estimation":"1H","key_points":["Cell cycle genes can conceal what is happening in your data if cells are grouping together according to their stage in the cycle","Identifying the cell cycle genes and using them to regress out the effects of the cell cycle can reveal underlying patterns in the data"],"tags":["10x"],"contributions":{"authorship":["MarisaJL"],"editing":["nomadscientist"],"testing":["hrukkudyr"]},"js_requirements":{"mathjax":null,"mermaid":false},"short_id":"T00248","url":"/topics/single-cell/tutorials/scrna-case_cell-cycle/tutorial.html","topic_name":"single-cell","tutorial_name":"scrna-case_cell-cycle","dir":"topics/single-cell/tutorials/scrna-case_cell-cycle","symlink":null,"id":"single-cell/scrna-case_cell-cycle","ref_tutorials":["<p>Single-cell RNA sequencing can be sensitive to both biological and technical variation, which is why preparing your data carefully is an important part of the analysis. You want the results to reflect the interesting differences in expression between cells that relate to their type or state. Other sources of variation can conceal or confound this, making it harder for you to see what is going on.</p>\n\n<p>One common biological confounder is the cell cycle (<span class=\"citation\"><a href=\"#Luecken2019\">Luecken and Theis 2019</a></span>). Cells express different genes during different parts of the cell cycle, depending on whether they are in their growing phase (G1), duplicating their DNA (the S or Synthesis phase), or dividing in two (G2/M or Mitosis phase). If these cell cycle genes are having a big impact on your data, then you could end up with separate clusters that actually represent cells of the same type that are just at different stages of the cycle.</p>\n\n<p>In this tutorial, we will identify the genes whose expression is known to vary during the cell cycle so that we can use them to regress out (or remove) the effects of the cell cycle on the clustering.</p>\n\n<blockquote class=\"comment\">\n  <comment-title>Other Scanpy and Seurat tutorials</comment-title>\n\n  <p>This tutorial is based on the Scanpy cell cycle regression tutorial (<span class=\"citation\"><a href=\"#ScanpyCC\">Cittaro 2018</a></span>), which was itself based on the Seurat vignette addressing the same issue (<span class=\"citation\"><a href=\"#SeuratCC\">Paul Hoffman 2022</a></span>). However, we will be using a different dataset for this tutorial.</p>\n</blockquote>\n\n<blockquote class=\"agenda\">\n  <agenda-title></agenda-title>\n\n  <p>In this tutorial, we will cover:</p>\n\n<ol id=\"markdown-toc\">\n  <li><a href=\"#get-data\" id=\"markdown-toc-get-data\">Get Data</a></li>\n  <li><a href=\"#important-tips-for-easier-analysis\" id=\"markdown-toc-important-tips-for-easier-analysis\">Important tips for easier analysis</a></li>\n  <li><a href=\"#cell-cycle-scoring\" id=\"markdown-toc-cell-cycle-scoring\">Cell Cycle Scoring</a></li>\n  <li><a href=\"#cell-cycle-regression\" id=\"markdown-toc-cell-cycle-regression\">Cell Cycle Regression</a></li>\n  <li><a href=\"#plotting-the-effects-of-cell-cycle-regression\" id=\"markdown-toc-plotting-the-effects-of-cell-cycle-regression\">Plotting the Effects of Cell Cycle Regression</a>    <ol>\n      <li><a href=\"#prepare-a-table-of-cell-cycle-genes\" id=\"markdown-toc-prepare-a-table-of-cell-cycle-genes\">Prepare a table of cell cycle genes</a></li>\n      <li><a href=\"#create-an-ordered-list-of-gene-names\" id=\"markdown-toc-create-an-ordered-list-of-gene-names\">Create an ordered list of gene names</a></li>\n      <li><a href=\"#mark-the-cell-cycle-genes\" id=\"markdown-toc-mark-the-cell-cycle-genes\">Mark the cell cycle genes</a></li>\n      <li><a href=\"#create-the-annotation-column\" id=\"markdown-toc-create-the-annotation-column\">Create the annotation column</a></li>\n      <li><a href=\"#add-an-annotation-to-the-anndata\" id=\"markdown-toc-add-an-annotation-to-the-anndata\">Add an annotation to the AnnData</a></li>\n      <li><a href=\"#filter-the-cell-cycle-genes\" id=\"markdown-toc-filter-the-cell-cycle-genes\">Filter the cell cycle genes</a></li>\n      <li><a href=\"#plot-the-cell-cycle-genes-before-regression\" id=\"markdown-toc-plot-the-cell-cycle-genes-before-regression\">Plot the cell cycle genes before regression</a></li>\n      <li><a href=\"#plot-the-cell-cycle-genes-after-regression\" id=\"markdown-toc-plot-the-cell-cycle-genes-after-regression\">Plot the cell cycle genes after regression</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#conclusion\" id=\"markdown-toc-conclusion\">Conclusion</a></li>\n</ol>\n\n</blockquote>\n\n<h2 id=\"get-data\">Get Data</h2>\n\n<p>The data used in this tutorial is from a mouse dataset of fetal growth restriction (<span class=\"citation\"><a href=\"#Bacon2018\">Bacon <i>et al.</i> 2018</a></span>). Cell cycle regression should be performed after the data has been filtered, normalised, and scaled. You can download the dataset below or import the history with the starting data.</p>\n\n<blockquote class=\"comment\">\n  <comment-title></comment-title>\n  <ul>\n    <li>If you’ve been working through the Single-cell RNA-seq: Case Study then you can use your dataset from the <a href=\"/training-material/topics/single-cell/tutorials/scrna-case_basic-pipeline/tutorial.html\">Filter, Plot and Explore Single-cell RNA-seq Data</a> tutorial here. Select the <code class=\"language-plaintext highlighter-rouge\">Use_me_Scaled</code> dataset from your history. Rename that dataset as <code class=\"language-plaintext highlighter-rouge\">Processed_Anndata</code>. You will still need to import the S and G2/M gene lists below through Zenodo.</li>\n    <li>At the end of this tutorial, you can return to the main tutorial to plot and explore your data with reduced effects from the cell cycle.</li>\n  </ul>\n</blockquote>\n\n<p>In addition to the scRNA-seq dataset, we will also need lists of the genes that are known to be expressed at different points in the cell cycle. The lists used in this tutorial are part of the HBC tinyatlas and can be downloaded from Zenodo below <span class=\"citation\"><a href=\"#kirchner_hbc_2018\">Kirchner and HBC 2018</a></span>. Between them, they include 97 genes that are expressed during the S and G2/M phases. The expression level of these cycle genes are - mostly - determined by the phases of the cell cycle. Make sure that the file type is tabular (not just the name of the file) - you can choose this when you download the files or change it after the files are in your history.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Option 1: Data upload - Import history</hands-on-title>\n  <p>Sometimes data upload can take a while, so a faster route is to import a history.</p>\n\n  <ol>\n    <li>\n      <p>Import history from: <a href=\"https://humancellatlas.usegalaxy.eu/u/marisa_jl/h/removing-the-effects-of-the-cell-cycle---input-history\">example input history</a></p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-importing-a-history\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-importing-a-history\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Importing a history</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ol>   <li>Open the link to the shared history</li>   <li>Click on the <i class=\"fas fa-plus\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">new-history</span> <em>Import history</em> button on the top right</li>   <li>Enter a title for the new history</li>   <li>Click on <strong>Import</strong></li> </ol> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>\n      <p><strong>Rename</strong> <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> the the history to your name of choice.</p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Option 2: Data upload - Add to history</hands-on-title>\n\n  <ol>\n    <li>\n      <p>Create a new history for this tutorial</p>\n    </li>\n    <li>\n      <p>Import the AnnData object from <a href=\"https://zenodo.org/record/7311628/\">Zenodo</a></p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>https://zenodo.org/record/7311628/files/Processed_AnnData.h5ad\n</code></pre></div>      </div>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-importing-via-links\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-importing-via-links\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Importing via links</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Copy the link location</li>   <li>     <p>Click <i class=\"fas fa-upload\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-upload</span> <strong>Upload Data</strong> at the top of the tool panel</p>   </li>   <li>Select <i class=\"fa fa-edit\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-wf-edit</span> <strong>Paste/Fetch Data</strong></li>   <li>     <p>Paste the link(s) into the text field</p>   </li>   <li>     <p>Press <strong>Start</strong></p>   </li>   <li><strong>Close</strong> the window</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>\n      <p>Rename the dataset <code class=\"language-plaintext highlighter-rouge\">Processed_Anndata</code></p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-renaming-a-dataset\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-renaming-a-dataset\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Renaming a dataset</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Click on the <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>   <li>In the central panel, change the <strong>Name</strong> field</li>   <li>Click the <strong>Save</strong> button</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>\n      <p>Check that the datatype is <code class=\"language-plaintext highlighter-rouge\">h5ad</code></p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-changing-the-datatype\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-changing-the-datatype\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Changing the datatype</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Click on the <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>   <li>In the central panel, click <i class=\"fas fa-database\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-chart-select-data</span> <strong>Datatypes</strong> tab on the top</li>   <li>In the <i class=\"fas fa-database\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-chart-select-data</span> <strong>Assign Datatype</strong>, select <code class=\"language-plaintext highlighter-rouge\">datatypes</code> from “<em>New type</em>” dropdown     <ul>       <li>Tip: you can start typing the datatype into the field to filter the dropdown menu</li>     </ul>   </li>   <li>Click the <strong>Save</strong> button</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Option 2 continued: Data upload - Add to history </hands-on-title>\n\n  <ol>\n    <li>\n      <p>Import the files from <a href=\"https://zenodo.org/record/7311628/\">Zenodo</a></p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>https://zenodo.org/record/7311628//files/sPhase.tabular\nhttps://zenodo.org/record/7311628//files/g2mPhase.tabular\n</code></pre></div>      </div>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-importing-via-links-1\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-importing-via-links-1\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Importing via links</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Copy the link location</li>   <li>     <p>Click <i class=\"fas fa-upload\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-upload</span> <strong>Upload Data</strong> at the top of the tool panel</p>   </li>   <li>Select <i class=\"fa fa-edit\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-wf-edit</span> <strong>Paste/Fetch Data</strong></li>   <li>     <p>Paste the link(s) into the text field</p>   </li>   <li>     <p>Press <strong>Start</strong></p>   </li>   <li><strong>Close</strong> the window</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>\n      <p>Rename the datasets <code class=\"language-plaintext highlighter-rouge\">sPhase</code> and <code class=\"language-plaintext highlighter-rouge\">g2mPhase</code> respectively - be careful not to mix them up!</p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-renaming-a-dataset-1\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-renaming-a-dataset-1\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Renaming a dataset</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Click on the <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>   <li>In the central panel, change the <strong>Name</strong> field</li>   <li>Click the <strong>Save</strong> button</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>\n      <p>Check that the datatype for both is <code class=\"language-plaintext highlighter-rouge\">tabular</code></p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-changing-the-datatype-1\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-changing-the-datatype-1\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Changing the datatype</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Click on the <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>   <li>In the central panel, click <i class=\"fas fa-database\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-chart-select-data</span> <strong>Datatypes</strong> tab on the top</li>   <li>In the <i class=\"fas fa-database\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-chart-select-data</span> <strong>Assign Datatype</strong>, select <code class=\"language-plaintext highlighter-rouge\">datatypes</code> from “<em>New type</em>” dropdown     <ul>       <li>Tip: you can start typing the datatype into the field to filter the dropdown menu</li>     </ul>   </li>   <li>Click the <strong>Save</strong> button</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h1 id=\"important-tips-for-easier-analysis\">Important tips for easier analysis</h1>\n\n<!--SNIPPET-->\n<blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-using-tutorial-mode\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-using-tutorial-mode\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Using tutorial mode</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p>Tools are frequently updated to new versions. Your Galaxy may have multiple versions of the same tool available. By default, you will be shown the latest version of the tool. This may NOT be the same tool used in the tutorial you are accessing. Furthermore, if you use a newer tool in one step, and try using an older tool in the next step… this may fail! To ensure you use the same tool versions of a given tutorial, use the <strong>Tutorial mode</strong> feature.</p>   <ul>   <li>Open your Galaxy server</li>   <li>Click on the <i class=\"fas fa-graduation-cap\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">curriculum</span> icon on the top menu, this will open the GTN inside Galaxy.</li>   <li>Navigate to your tutorial</li>   <li>Tool names in tutorials will be blue buttons that open the correct tool for you</li>   <li><strong>Note:</strong> this does not work for all tutorials (yet)   <img src=\"/training-material/topics/contributing/images/88277962-ddda4a80-cce1-11ea-92cd-41b1df063db0.gif\" alt=\"gif showing how GTN-in-Galaxy works\" /></li>   <li>You can click anywhere in the grey-ed out area outside of the tutorial box to return back to the Galaxy analytical interface</li> </ul>   <blockquote class=\"warning\">   <warning-title>Not all browsers work!</warning-title>   <ul>     <li>We’ve had some issues with Tutorial mode on Safari for Mac users.</li>     <li>Try a <strong>different browser</strong> if you aren’t seeing the button.</li>   </ul> </blockquote> </blockquote>\n<p><!--END_SNIPPET--></p>\n\n<!--SNIPPET-->\n<blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-use-our-single-cell-lab\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-use-our-single-cell-lab\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Use our Single Cell Lab</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p>Did you know we have a unique Single Cell Lab with all our single cell tools highlighted to make it easier to use on Galaxy? We recommend this site for all your single cell analysis needs, particularly for newer users.</p>   <p>The Single Cell Lab currently uses the main European Galaxy infrastructure and power, it’s just organised better for users of particular analyses…like single cell!</p>   <p>Try it out! All your histories/workflows/logins from the general <a href=\"https://usegalaxy.eu\">European Galaxy server</a> will be there!</p>   <ul>   <li><i class=\"fa fa-tv\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">subdomain</span> <a href=\"https://singlecell.usegalaxy.eu\">Single Cell Lab</a></li> </ul> </blockquote>\n<p><!--END_SNIPPET--></p>\n\n<h1 id=\"cell-cycle-scoring\">Cell Cycle Scoring</h1>\n\n<p>The first step towards reducing the effects of the cell cycle on our dataset is cell cycle scoring. The cell cycle scoring algorithm will look at each cell in turn and calculate an S score based on the difference in the mean expression of the S Phase genes and a random sample of the same number of non-cell cycle genes from the same cell. It will do the same for the G2M genes in order to calculate the G2M score. The cells will then be assigned to the most likely phase: S, G2M, or G1, if neither G2M or S score highly. Three columns will be added to the AnnData dataset: <code class=\"language-plaintext highlighter-rouge\">S_score</code>, <code class=\"language-plaintext highlighter-rouge\">G2M_score</code> and <code class=\"language-plaintext highlighter-rouge\">phase</code>.</p>\n\n<question-title></question-title>\n<blockquote class=\"question\">\n\n  <ol>\n    <li>Why don’t we need a list of genes expressed in the G1 Phase?</li>\n  </ol>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <ol>\n      <li>Since we know which genes are expressed in the S and G2/M phases, we can classify cells that are expressing these genes into the S and G2/M phases respectively. Cells that aren’t expressing either the S or G2/M genes must be in the other phase of the cell cycle, so we can classify them as in G1 phase.</li>\n    </ol>\n\n  </blockquote>\n</blockquote>\n\n<blockquote class=\"comment\">\n  <comment-title>When should we regress out the effects of the cell cycle?</comment-title>\n  <p>Cell cycle regression can be particularly important if we are planning to do trajectory analysis down the line or if we have a dataset that is very strongly influenced by the cell cycle <span class=\"citation\"><a href=\"#Luecken2019\">Luecken and Theis 2019</a></span>. However, it isn’t always appropriate to remove the effects of the cell cycle - sometimes they can be useful for distinguishing between dividing and non-dividing cell types. When you are analysing your own data, you might need to try it both ways to determine if the effects of the cell cycle are helpful or not. You could also check whether the cell cycle genes are among the top scoring genes expressed by your cell clusters to get an idea of how strong the effects are.</p>\n</blockquote>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Score the cell cycle genes</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scanpy_inspect/scanpy_inspect/1.7.1+galaxy0\" title=\"Inspect and manipulate tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Inspect and manipulate</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.7.1+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">Processed_Anndata</code> (Input dataset)</li>\n        <li><em>“Method used for inspecting”</em>: <code class=\"language-plaintext highlighter-rouge\">Score cell cycle genes, using 'tl.score_genes_cell_cycle'</code>\n          <ul>\n            <li><em>“Format for the list of genes associated with S phase”</em>: <code class=\"language-plaintext highlighter-rouge\">File</code>\n              <ul>\n                <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“File with the list of genes associated with S phase”</em>: <code class=\"language-plaintext highlighter-rouge\">sPhase</code> (Input dataset)</li>\n              </ul>\n            </li>\n            <li><em>“Format for the list of genes associated with G2M phase”</em>: <code class=\"language-plaintext highlighter-rouge\">File</code>\n              <ul>\n                <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“File with the list of genes associated with G2M phase”</em>: <code class=\"language-plaintext highlighter-rouge\">g2mPhase</code> (Input dataset)</li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li>Rename the output <code class=\"language-plaintext highlighter-rouge\">CellCycle_Annotated</code></li>\n  </ol>\n\n</blockquote>\n\n<h1 id=\"cell-cycle-regression\">Cell Cycle Regression</h1>\n\n<p>The second step after scoring the cell cycle genes is to use these scores to regress out the effects of the cell cycle. Now that we know which phase each of our cells is in, we can work out how this is affecting gene expression in our cells. We can subtract these effects from our data so that they won’t influence our cell clustering. You will need to type the <code class=\"language-plaintext highlighter-rouge\">phase</code> variable in to the <span><strong>Scanpy RegressOut</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i></span> tool to enable it to regress out the cell cycle effects.</p>\n\n<blockquote class=\"details\">\n  <details-title>How does cell cycle regression work?</details-title>\n\n  <p>The <span><strong>Scanpy RegressOut</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i></span> tool will create a linear model of the relationship between gene expression and the cell cycle scores we assigned in the previous step. Basically, this model is a line that shows how gene expression changes as the S or G2M score changes. Each gene will have its own line, so for any S score or G2M score, we could look at the corresponding point on the line to see the expected expression level of that gene.</p>\n\n  <p><span><strong>Scanpy RegressOut</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i></span> will then regress out or remove this expected effect for the genes expressed by each cell, according to the cell’s S and G2M scores. The expected effect is subtracted from the expression data, leaving behind the difference between the expected position on the line and the actual position of each data point. The data points won’t sit exactly on the line because their expression levels aren’t determined completely by the cell cycle - the linear model only tells us what we would expect based on the cell cycle scores alone.</p>\n\n  <p>Understanding how the regression works should help you to see why we’re not just deleting the cell cycle genes from the dataset. We are using these genes that are known to be expressed during different phases to calculate the cell cycle scores and determine the phase each cell is in. We then use this information to work out the effect of the cell cycle on all of the other genes expressed by the cells. Even if they are not cell cycle genes, their expression can still be affected by the cycle. Finally, we remove or regress out the effect of the cell cycle on all the genes, leaving behind the variation that we’re interested in.</p>\n\n</blockquote>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Regress out the effects of the cell cycle</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/ebi-gxa/scanpy_regress_variable/scanpy_regress_variable/1.8.1+galaxy0\" title=\"Scanpy RegressOut tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Scanpy RegressOut</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.8.1+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Input object in AnnData/Loom format”</em>: <code class=\"language-plaintext highlighter-rouge\">CellCycle_Annotated</code> (output of <strong>Inspect and manipulate</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Variables to regress out”</em>: <code class=\"language-plaintext highlighter-rouge\">phase</code></li>\n      </ul>\n    </li>\n    <li>Rename the output <code class=\"language-plaintext highlighter-rouge\">CellCycle_Regressed</code></li>\n  </ol>\n\n</blockquote>\n\n<h1 id=\"plotting-the-effects-of-cell-cycle-regression\">Plotting the Effects of Cell Cycle Regression</h1>\n\n<p>Your data is now ready for further analysis, so you can return to the <a href=\"/training-material/topics/single-cell/tutorials/scrna-case_basic-pipeline/tutorial.html\">Filter, Plot and Explore Single-cell RNA-seq Data</a> tutorial and move on to the Preparing coordinates step there. Make sure that you use the <code class=\"language-plaintext highlighter-rouge\">CellCycle_Regressed</code> dataset (you may want to rename it as <code class=\"language-plaintext highlighter-rouge\">Use_me_Scaled</code> as that is the name used in the main tutorial). However, if you want to understand how cell cycle regression has affected your data then you can work through the following steps first, to visualise where the cell cycle genes are expressed - with or without regression.</p>\n\n<p>In order to look at the cell cycle genes, we first need to label them in our AnnData dataset so that we can select them for plotting. To add a new annotation to the genes or variables, we need a column with entries for each gene, in the same order as in the dataset, and with a header at the top that will become the key for identifying these entries in the AnnData dataset. We want to end up with a column that reads <code class=\"language-plaintext highlighter-rouge\">TRUE</code> for the 97 cell cycle genes and <code class=\"language-plaintext highlighter-rouge\">FALSE</code> for all the other genes.</p>\n\n<p>You might find it easier to create this new column using a spreadsheet and then upload it as a tabular dataset, but it is possible to complete all the steps on Galaxy.</p>\n\n<h2 id=\"prepare-a-table-of-cell-cycle-genes\">Prepare a table of cell cycle genes</h2>\n\n<p>If we’re going to mark all the cell cycle genes, we’ll need a single list of all 97 genes instead of the two separate lists for S Phase and G2/M Phase. We’ll combine the two lists into a single column with 97 entries. We’ll then add a second column that simply reads <code class=\"language-plaintext highlighter-rouge\">TRUE</code> in every row, which we’ll use later to mark these as cell cycle genes in the main dataset.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Create a list of all cell cycle genes</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"cat1\" title=\"Concatenate datasets tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Concatenate datasets</strong></span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Concatenate Dataset”</em>: <code class=\"language-plaintext highlighter-rouge\">sPhase</code> (Input dataset)</li>\n        <li>In <em>“Dataset”</em>:\n          <ul>\n            <li><i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert Dataset”</em>\n              <ul>\n                <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select”</em>: <code class=\"language-plaintext highlighter-rouge\">g2mPhase</code> (Input dataset)</li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/devteam/add_value/addValue/1.0.0\" title=\"Add column tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Add column</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.0.0)</span> with the following parameters:\n      <ul>\n        <li><em>“Add this value”</em>: <code class=\"language-plaintext highlighter-rouge\">TRUE</code></li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“to Dataset”</em>: <code class=\"language-plaintext highlighter-rouge\">out_file1</code> (output of <strong>Concatenate datasets</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n      </ul>\n    </li>\n    <li>Rename the dataset <code class=\"language-plaintext highlighter-rouge\">CC_Genes</code></li>\n  </ol>\n</blockquote>\n\n<h2 id=\"create-an-ordered-list-of-gene-names\">Create an ordered list of gene names</h2>\n\n<p>Next, we’ll need a list of all the genes in our dataset, so that we can mark the ones that are in our cell cycle list. We’ll also add a column of numbers as this will help us keep the gene names in order.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Get the gene names from your dataset</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/anndata_inspect/anndata_inspect/0.7.5+galaxy1\" title=\"Inspect AnnData tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Inspect AnnData</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.7.5+galaxy1)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">CellCycle_Regressed</code> (Input dataset)</li>\n        <li><em>“What to inspect?”</em>: <code class=\"language-plaintext highlighter-rouge\">Key-indexed annotation of variables/features (var)</code></li>\n      </ul>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/table_compute/table_compute/1.2.4+galaxy0\" title=\"Table Compute tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Table Compute</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.2.4+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><em>“Input Single or Multiple Tables”</em>: <code class=\"language-plaintext highlighter-rouge\">Single Table</code>\n          <ul>\n            <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Table”</em>: <code class=\"language-plaintext highlighter-rouge\">var</code> (output of <strong>Inspect AnnData</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n            <li><em>“Type of table operation”</em>: <code class=\"language-plaintext highlighter-rouge\">Drop, keep or duplicate rows and columns</code>\n              <ul>\n                <li><em>“List of columns to select”</em>: <code class=\"language-plaintext highlighter-rouge\">1</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n        <li><em>“Output formatting options”</em>: <code class=\"language-plaintext highlighter-rouge\">Unselect all</code></li>\n      </ul>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/devteam/add_value/addValue/1.0.0\" title=\"Add column tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Add column</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.0.0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“to Dataset”</em>: <code class=\"language-plaintext highlighter-rouge\">table</code> (output of <strong>Table Compute</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Iterate?”</em>: <code class=\"language-plaintext highlighter-rouge\">YES</code></li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title>Keeping the genes in order</comment-title>\n\n        <p>Adding these numbers will enable us to keep the genes in their original order. This is essential for adding the cell cycle gene annotation back into the AnnData dataset.</p>\n      </blockquote>\n    </li>\n    <li>Rename the output <code class=\"language-plaintext highlighter-rouge\">Dataset_Genes</code></li>\n  </ol>\n</blockquote>\n\n<h2 id=\"mark-the-cell-cycle-genes\">Mark the cell cycle genes</h2>\n\n<p>We can now combine our table of cell cycle genes <code class=\"language-plaintext highlighter-rouge\">CC_genes</code> with the table of gene names <code class=\"language-plaintext highlighter-rouge\">Dataset_Genes</code>.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Combine the two tables</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_easyjoin_tool/1.1.2\" title=\"Join tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Join</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.1.2)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“1st file”</em>: <code class=\"language-plaintext highlighter-rouge\">Dataset_Genes</code> (output of <strong>Add column</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Column to use from 1st file”</em>: <code class=\"language-plaintext highlighter-rouge\">c1</code></li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“2nd File”</em>: <code class=\"language-plaintext highlighter-rouge\">CC_Genes</code> (output of <strong>Add column</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Column to use from 2nd file”</em>: <code class=\"language-plaintext highlighter-rouge\">c1</code></li>\n        <li><em>“Output lines appearing in”</em>: <code class=\"language-plaintext highlighter-rouge\">All lines [-a 1 -a 2]</code></li>\n        <li><em>“Value to put in unpaired (empty) fields”</em>: <code class=\"language-plaintext highlighter-rouge\">FALSE</code></li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title>How the cell cycle genes are marked</comment-title>\n\n        <p>When we join the two tables, we’ll ask for any empty fields to be filled in with <code class=\"language-plaintext highlighter-rouge\">FALSE</code>. The cell cycle gene table has an extra column where they are all marked as <code class=\"language-plaintext highlighter-rouge\">TRUE</code> - they will retain these entries when we join the tables, but since there are no entries for the rest of the genes in this column, their rows will be filled in as <code class=\"language-plaintext highlighter-rouge\">FALSE</code>. This will enable us to pick out the cell cycle genes later.</p>\n      </blockquote>\n    </li>\n    <li><span class=\"tool\" data-tool=\"sort1\" title=\"Sort tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Sort</strong></span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Sort Dataset”</em>: <code class=\"language-plaintext highlighter-rouge\">output</code> (output of <strong>Join</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“on column”</em>: <code class=\"language-plaintext highlighter-rouge\">c2</code></li>\n        <li><em>“everything in”</em>: <code class=\"language-plaintext highlighter-rouge\">Ascending order</code></li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title>Putting the genes in order again</comment-title>\n\n        <p>Sorting the genes using the column of numbers we added earlier will put them back in their original order - make sure to sort them in ascending order, otherwise they’ll end up the opposite way around.</p>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <ol>\n    <li>What would happen if any of the cell cycle genes were not present in the dataset?</li>\n    <li>How would we remove these genes from the table?</li>\n  </ol>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <ol>\n      <li>Any cell cycle genes that weren’t in the dataset would have an empty field in the numbered column, which would be filled in with <code class=\"language-plaintext highlighter-rouge\">FALSE</code> when we created the table with the <span><strong>Join</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i></span> tool. These rows would appear at the top of the table after it was sorted.</li>\n      <li>We should check the first rows of the table for any unnumbered genes and then cut these rows out in the next step.</li>\n    </ol>\n\n  </blockquote>\n</blockquote>\n\n<h2 id=\"create-the-annotation-column\">Create the annotation column</h2>\n\n<p>We now have a table with all the gene names in the same order as the main dataset and a column indicating which ones are cell cycle genes. If we cut this column out of the table, then we can add it as a new annotation to the main dataset. We’ll also need to add a column header, which will be used as the key for this annotation in the AnnData dataset.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Create the cell cycle annotation column</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/table_compute/table_compute/1.2.4+galaxy0\" title=\"Table Compute tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Table Compute</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.2.4+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><em>“Input Single or Multiple Tables”</em>: <code class=\"language-plaintext highlighter-rouge\">Single Table</code>\n          <ul>\n            <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Table”</em>: <code class=\"language-plaintext highlighter-rouge\">out_file1</code> (output of <strong>Sort</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n          </ul>\n        </li>\n        <li><em>“Input data has:”</em>: <code class=\"language-plaintext highlighter-rouge\">Unselect all</code>\n          <ul>\n            <li><em>“Type of table operation”</em>: <code class=\"language-plaintext highlighter-rouge\">Drop, keep or duplicate rows and columns</code>\n              <ul>\n                <li><em>“List of columns to select”</em>: <code class=\"language-plaintext highlighter-rouge\">3</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n        <li><em>“Output formatting options”</em>: <code class=\"language-plaintext highlighter-rouge\">Unselect all</code></li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title>Removing rows for missing genes </comment-title>\n\n        <p>If there were any cell cycle genes that weren’t present in the main dataset, we could remove them at this stage by excluding them from the List of rows to select. As before, if we were using a dataset of a different size, we would need to change this parameter to include all the rest of the rows.</p>\n      </blockquote>\n    </li>\n    <li>\n      <p>Create a new <strong>tabular</strong> file from the following</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>CC_genes\n</code></pre></div>      </div>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-creating-a-new-file\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-creating-a-new-file\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Creating a new file</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Click <i class=\"fas fa-upload\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-upload</span> <strong>Upload Data</strong> at the top of the tool panel</li>   <li>Select <i class=\"fa fa-edit\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-wf-edit</span> <strong>Paste/Fetch Data</strong> at the bottom</li>   <li>Paste the file contents into the text field</li>   <li>Change <strong>Type</strong> from “Auto-detect” to <code class=\"language-plaintext highlighter-rouge\">tabular</code>* Press <strong>Start</strong> and <strong>Close</strong> the window</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li><span class=\"tool\" data-tool=\"cat1\" title=\"Concatenate datasets tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Concatenate datasets</strong></span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Concatenate Dataset”</em>: <code class=\"language-plaintext highlighter-rouge\">Pasted Entry</code> dataset</li>\n        <li>In <em>“Dataset”</em>:\n          <ul>\n            <li><i class=\"far fa-plus-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-repeat</span> <em>“Insert Dataset”</em>\n              <ul>\n                <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Select”</em>: <code class=\"language-plaintext highlighter-rouge\">table</code> (output of <strong>Table Compute</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h2 id=\"add-an-annotation-to-the-anndata\">Add an annotation to the AnnData</h2>\n\n<p>We will need to add the annotation to both the annotated dataset <code class=\"language-plaintext highlighter-rouge\">CellCycle_Annotated</code> and to the one that we created by regressing out the cell cycle genes <code class=\"language-plaintext highlighter-rouge\">CellCycle_Regressed</code>. This will allow us to plot the cell cycle genes before and after regression. We can do this using the <span><strong>Manipulate Anndata</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i></span> tool and selecting the correct function from the dropdown menu.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Add the new annotations</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/anndata_manipulate/anndata_manipulate/0.7.5+galaxy1\" title=\"Manipulate AnnData tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Manipulate AnnData</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.7.5+galaxy1)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">CellCycle_Annotated</code> (output of <strong>Inspect and manipulate</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Function to manipulate the object”</em>: <code class=\"language-plaintext highlighter-rouge\">Add new annotation(s) for observations or variables</code>\n          <ul>\n            <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Table with new annotations”</em>: <code class=\"language-plaintext highlighter-rouge\">out_file1</code> (output of <strong>Concatenate datasets</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li>\n      <p>Rename the output <code class=\"language-plaintext highlighter-rouge\">CellCycle_Annotated_CC</code></p>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/anndata_manipulate/anndata_manipulate/0.7.5+galaxy1\" title=\"Manipulate AnnData tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Manipulate AnnData</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.7.5+galaxy1)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">CellCycle_Regressed</code> (output of <strong>Scanpy RegressOut</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Function to manipulate the object”</em>: <code class=\"language-plaintext highlighter-rouge\">Add new annotation(s) for observations or variables</code>\n          <ul>\n            <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Table with new annotations”</em>: <code class=\"language-plaintext highlighter-rouge\">out_file1</code> (output of <strong>Concatenate datasets</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li>Rename the output <code class=\"language-plaintext highlighter-rouge\">CellCycle_Regressed_CC</code></li>\n  </ol>\n\n</blockquote>\n\n<h2 id=\"filter-the-cell-cycle-genes\">Filter the cell cycle genes</h2>\n\n<p>To demonstrate the power of cell cycle regression, we’re going to reduce our expression matrices to contain only the 97 cell cycle genes. This will force our dimension reduction and plotting to be based entirely on cell cycle genes. You wouldn’t do this during analysis, but for proof of principle, let’s go for it!</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Filter the AnnData datasets</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/anndata_manipulate/anndata_manipulate/0.7.5+galaxy1\" title=\"Manipulate AnnData tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Manipulate AnnData</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.7.5+galaxy1)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">CellCycle_Annotated_CC</code> (output of <strong>Manipulate AnnData</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Function to manipulate the object”</em>: <code class=\"language-plaintext highlighter-rouge\">Filter observations or variables</code>\n          <ul>\n            <li><em>“Type of filtering?”</em>: <code class=\"language-plaintext highlighter-rouge\">By key (column) values</code>\n              <ul>\n                <li><em>“Key to filter”</em>: <code class=\"language-plaintext highlighter-rouge\">CC_genes</code></li>\n                <li><em>“Type of value to filter”</em>: <code class=\"language-plaintext highlighter-rouge\">Boolean</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li>\n      <p>Rename the output <code class=\"language-plaintext highlighter-rouge\">CellCycle_Annotated_CC_Only</code></p>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/anndata_manipulate/anndata_manipulate/0.7.5+galaxy1\" title=\"Manipulate AnnData tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Manipulate AnnData</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.7.5+galaxy1)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">CellCycle_Regressed_CC</code> (output of <strong>Manipulate AnnData</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Function to manipulate the object”</em>: <code class=\"language-plaintext highlighter-rouge\">Filter observations or variables</code>\n          <ul>\n            <li><em>“Type of filtering?”</em>: <code class=\"language-plaintext highlighter-rouge\">By key (column) values</code>\n              <ul>\n                <li><em>“Key to filter”</em>: <code class=\"language-plaintext highlighter-rouge\">CC_genes</code></li>\n                <li><em>“Type of value to filter”</em>: <code class=\"language-plaintext highlighter-rouge\">Boolean</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li>Rename the output <code class=\"language-plaintext highlighter-rouge\">CellCycle_Regressed_CC_Only</code></li>\n  </ol>\n\n</blockquote>\n\n<h2 id=\"plot-the-cell-cycle-genes-before-regression\">Plot the cell cycle genes before regression</h2>\n\n<p>Now that we have a dataset that only includes the cell cycle genes, we can visualise their effects in a PCA plot. We first calculate the PCA coordinates, which are a measure of how similar each pair of cells is in terms of the expression of the 97 cell cycle genes we’ve included in the filtered dataset. We will then visualise the cells on a PCA plot where the axes represent the principal components, which reflect the genes (or groups of genes) that had the biggest impact in these calculations.</p>\n\n<p>You will learn more about plotting your data in the <a href=\"/training-material/topics/single-cell/tutorials/scrna-case_basic-pipeline/tutorial.html\">Filter, Plot and Explore</a> tutorial. For now, it is enough to know that each dot on the plot represents a cell and the closer two cells are together, the more similar they are.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Create a PCA Plot of cell cycle genes </hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scanpy_cluster_reduce_dimension/scanpy_cluster_reduce_dimension/1.7.1+galaxy0\" title=\"Cluster, infer trajectories and embed tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Cluster, infer trajectories and embed</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.7.1+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">CellCycle_Annotated_CC_Only</code> (output of <strong>Manipulate AnnData</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Method used”</em>: <code class=\"language-plaintext highlighter-rouge\">Computes PCA (principal component analysis) coordinates, loadings and variance decomposition, using 'tl.pca'</code>\n          <ul>\n            <li><em>“Type of PCA?”</em>: <code class=\"language-plaintext highlighter-rouge\">Full PCA</code></li>\n          </ul>\n        </li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title>Plot all the genes </comment-title>\n\n        <p>Make sure that you de-select the option for the <span><strong>Cluster, infer trajectories and embed</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i></span> tool to use highly variable genes only - some of the cell cycle genes are also HVGs, but we want our plots to include the cell cycle genes that aren’t HVGs too.</p>\n      </blockquote>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scanpy_plot/scanpy_plot/1.7.1+galaxy1\" title=\"Plot tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Plot</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.7.1+galaxy1)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">anndata_out</code> (output of <strong>Cluster, infer trajectories and embed</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Method used for plotting”</em>: <code class=\"language-plaintext highlighter-rouge\">PCA: Plot PCA results, using 'pl.pca_overview'</code>\n          <ul>\n            <li><em>“Keys for annotations of observations/cells or variables/genes”</em>: <code class=\"language-plaintext highlighter-rouge\">phase</code></li>\n            <li>In <em>“Plot attributes”</em>:\n              <ul>\n                <li><em>“Colors to use for plotting categorical annotation groups”</em>: <code class=\"language-plaintext highlighter-rouge\">rainbow (Miscellaneous)</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <ol>\n    <li>Does the plot look as you expected?</li>\n  </ol>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <ol>\n      <li>The PCA plot shows that the three groups of cells are separated out according to what phase of the cell cycle they are in. This is what we would expect to see as we are only looking at the cell cycle genes, which by definition are expressed during particular phases.</li>\n    </ol>\n\n    <figure id=\"figure-1\" style=\"max-width: 90%;\"><img src=\"../../images/scrna-case_cell-cycle/CellCycle_PCA1.png\" alt=\"PCA plot showing three separate clusters of cells in the G1, S and G2M Phases. \" width=\"624\" height=\"429\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/scrna-case_cell-cycle/CellCycle_PCA1.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 1</strong>:</span> PCA Plot of Cell Cycle Genes before regression</figcaption></figure>\n\n  </blockquote>\n</blockquote>\n\n<h2 id=\"plot-the-cell-cycle-genes-after-regression\">Plot the cell cycle genes after regression</h2>\n\n<p>We will now repeat the same steps to create a PCA plot of the filtered dataset after the effects of the cell cycle have been regressed out.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Recreate the PCA plot of cell cycle genes after regression </hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scanpy_cluster_reduce_dimension/scanpy_cluster_reduce_dimension/1.7.1+galaxy0\" title=\"Cluster, infer trajectories and embed tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Cluster, infer trajectories and embed</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.7.1+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">CellCycle_Regressed_CC_Only</code> (output of <strong>Manipulate AnnData</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Method used”</em>: <code class=\"language-plaintext highlighter-rouge\">Computes PCA (principal component analysis) coordinates, loadings and variance decomposition, using 'tl.pca'</code>\n          <ul>\n            <li><em>“Type of PCA?”</em>: <code class=\"language-plaintext highlighter-rouge\">Full PCA</code></li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scanpy_plot/scanpy_plot/1.7.1+galaxy1\" title=\"Plot tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Plot</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.7.1+galaxy1)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">anndata_out</code> (output of <strong>Cluster, infer trajectories and embed</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Method used for plotting”</em>: <code class=\"language-plaintext highlighter-rouge\">PCA: Plot PCA results, using 'pl.pca_overview'</code>\n          <ul>\n            <li><em>“Keys for annotations of observations/cells or variables/genes”</em>: <code class=\"language-plaintext highlighter-rouge\">phase</code></li>\n            <li>In <em>“Plot attributes”</em>:\n              <ul>\n                <li><em>“Colors to use for plotting categorical annotation groups”</em>: <code class=\"language-plaintext highlighter-rouge\">rainbow (Miscellaneous)</code></li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <ol>\n    <li>Does the plot look as you expected?</li>\n  </ol>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <ol>\n      <li>The cells in different phases are now all mixed up together. This makes sense because we are only plotting the cell cycle genes, but the previously strong effects of the cell cycle on these genes have now been regressed out. There are still some differences between the cells (they don’t all end up at the same point on the PCA chart) because the regression only removes the expected effects of the cell cycle, leaving behind any individual variation in the expression of the cell cycle genes.</li>\n    </ol>\n\n    <figure id=\"figure-2\" style=\"max-width: 90%;\"><img src=\"../../images/scrna-case_cell-cycle/CellCycle_PCA2.png\" alt=\"PCA plot showing one big cluster with the cells from G1, S and G2M Phases all mixed up together. \" width=\"624\" height=\"429\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/scrna-case_cell-cycle/CellCycle_PCA2.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 2</strong>:</span> PCA Plot of Cell Cycle Genes after regression</figcaption></figure>\n\n  </blockquote>\n</blockquote>\n\n<p>Comparing the before and after plots, we can clearly see that the effects of the cell cycle have been removed. Although you wouldn’t usually need to filter out the cell cycle genes or create these plots when analysing your own data, hopefully you have found doing it now to be helpful for understanding the impact of cell cycle regression.</p>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <ol>\n    <li>What impact do you think the cell cycle regression will have when you analyse the whole dataset? What would happen if we plotted all of the genes from the main dataset?</li>\n  </ol>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <ol>\n      <li>The regression reduces the impact of the cell cycle on the data - this is why the cells are less separated by phase afterwards. When we analyse the whole <code class=\"language-plaintext highlighter-rouge\">CellCycle_Regressed</code> dataset, with all of the genes, this could allow other differences in gene expression to become more apparent.</li>\n    </ol>\n\n    <p>We wouldn’t expect to see such clear distinctions in PCA plots created using all of the genes (not just the cell cycle ones), even before the regression. Although the cell cycle genes can have a significant effect, these won’t be as obvious when other genes are also being taken into account. However, we will still see a difference after we regress out the effects of the cell cycle - the cells in different phases will become more mixed up together. How much of a difference the regression makes will depend on how strong the effects of the cell cycle are in a particular dataset - you can see the effects on this dataset below. You can also replicate these plots after completing the rest of the <a href=\"/training-material/topics/single-cell/tutorials/scrna-case_basic-pipeline/tutorial.html\">Filter, Plot and Explore</a> tutorial by colouring your PCA plots by phase.</p>\n\n    <figure id=\"figure-3\" style=\"max-width: 90%;\"><img src=\"../../images/scrna-case_cell-cycle/CellCycle_PCA3.png\" alt=\"PCA plot showing some separation between cells in the G1, S and G2M Phases before regression. \" width=\"624\" height=\"429\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/scrna-case_cell-cycle/CellCycle_PCA3.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 3</strong>:</span> PCA Plot using all genes before regression</figcaption></figure>\n\n    <figure id=\"figure-4\" style=\"max-width: 90%;\"><img src=\"../../images/scrna-case_cell-cycle/CellCycle_PCA4.png\" alt=\"PCA plot showing that cells in the G1, S and G2M Phases are more mixed up with each other after the regression. \" width=\"624\" height=\"429\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/scrna-case_cell-cycle/CellCycle_PCA4.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 4</strong>:</span> PCA Plot using all genes after regression</figcaption></figure>\n\n  </blockquote>\n</blockquote>\n\n<h1 id=\"conclusion\">Conclusion</h1>\n\n<p>In this tutorial, you have annotated and scored the cell cycle genes and regressed out the effects of the cell cycle. You have also created PCA plots of the data before and after regression to visualise the effects.</p>\n\n<p>You might want to check your results against this <a href=\"https://humancellatlas.usegalaxy.eu/u/marisa_jl/h/removing-the-effects-of-the-cell-cycle---answer-key\">example history</a>.</p>\n\n<p>You can now continue to analyse this data by returning to the Preparing coordinates step in the <a href=\"/training-material/topics/single-cell/tutorials/scrna-case_basic-pipeline/tutorial.html\">Filter, Plot and Explore</a> tutorial. If you use the <code class=\"language-plaintext highlighter-rouge\">CellCycle_Regressed</code> dataset (which you may now want to rename as <code class=\"language-plaintext highlighter-rouge\">Use_me_Scaled</code> since that is the name used in the main tutorial), you should notice some differences in your results compared to those shown there because the effects of the cell cycle have been regressed out.</p>\n\n<!--SNIPPET-->\n<blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-how-can-i-talk-with-other-users\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-how-can-i-talk-with-other-users\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: How can I talk with other users?</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p><i class=\"far fa-comments\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">feedback</span> To discuss with like-minded scientists, join our <a href=\"http://gxy.io/gtn-slack\">Galaxy Training Network chatspace in Slack</a> and discuss with fellow users of Galaxy single cell analysis tools on <a href=\"https://gtnsmrgsbord.slack.com/archives/C06PBRR40D7\">#single-cell-users</a></p>   <p>We also post new tutorials / workflows there from time to time, as well as any other news.</p>   <p><i class=\"far fa-hand-point-right\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">point-right</span> If you’d like to contribute ideas, requests or feedback as part of the wider community building single-cell and spatial resources within Galaxy, you can also join our <a href=\"https://galaxyproject.org/community/sig/singlecell/\">Single cell &amp; sPatial Omics Community of Practice</a>.</p>   <p><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> You can request tools here on our <a href=\"https://docs.google.com/spreadsheets/d/15hqgqA-RMDhXR-ylKhRF-Dab9Ij2arYSKiEVoPl2df4/edit?usp=sharing\">Single Cell and Spatial Omics Community Tool Request Spreadsheet</a></p> </blockquote>\n<p><!--END_SNIPPET--></p>\n"],"ref_slides":[],"hands_on":true,"slides":false,"mod_date":"2024-06-12 18:23:54 +0000","pub_date":"2023-01-25 09:43:32 +0000","version":35,"workflows":[{"workflow":"main_workflow.ga","tests":false,"url":"https://training.galaxyproject.org/training-material/topics/single-cell/tutorials/scrna-case_cell-cycle/workflows/main_workflow.ga","path":"topics/single-cell/tutorials/scrna-case_cell-cycle/workflows/main_workflow.ga","wfid":"single-cell-scrna-case_cell-cycle","wfname":"main_workflow","trs_endpoint":"https://training.galaxyproject.org/training-material/api/ga4gh/trs/v2/tools/single-cell-scrna-case_cell-cycle/versions/main_workflow","license":null,"creators":[],"name":"Cell Cycle Regression Workflow","title":"Cell Cycle Regression Workflow","test_results":null,"modified":"2024-06-21 00:05:32 +0000","mermaid":"flowchart TD\n  0[\"ℹ️ Input Dataset\\nAnnData After QC, normalisation, scaling\"];\n  style 0 stroke:#2c3143,stroke-width:4px;\n  1[\"ℹ️ Input Dataset\\nS Phase Genes\"];\n  style 1 stroke:#2c3143,stroke-width:4px;\n  2[\"ℹ️ Input Dataset\\nG2M Phase Genes\"];\n  style 2 stroke:#2c3143,stroke-width:4px;\n  3[\"ℹ️ Input Dataset\\nPasted Entry\"];\n  style 3 stroke:#2c3143,stroke-width:4px;\n  4[\"Inspect AnnData\"];\n  0 -->|output| 4;\n  5[\"All Cell Cycle Genes Concatenate S and G2M Genes\"];\n  1 -->|output| 5;\n  2 -->|output| 5;\n  6[\"Inspect and manipulate\"];\n  0 -->|output| 6;\n  2 -->|output| 6;\n  1 -->|output| 6;\n  7[\"Table Compute\"];\n  4 -->|var| 7;\n  8[\"Add column\"];\n  5 -->|out_file1| 8;\n  9[\"Scanpy RegressOut\"];\n  6 -->|anndata_out| 9;\n  026b02d3-97ee-4847-9347-40773ab76356[\"Output\\nScanpy RegressOut on input dataset(s): Regressed out  AnnData\"];\n  9 --> 026b02d3-97ee-4847-9347-40773ab76356;\n  style 026b02d3-97ee-4847-9347-40773ab76356 stroke:#2c3143,stroke-width:4px;\n  10[\"Add column\"];\n  7 -->|table| 10;\n  11[\"Join\"];\n  10 -->|out_file1| 11;\n  8 -->|out_file1| 11;\n  12[\"Sort\"];\n  11 -->|output| 12;\n  13[\"Table Compute\"];\n  12 -->|out_file1| 13;\n  14[\"Concatenate datasets\"];\n  3 -->|output| 14;\n  13 -->|table| 14;\n  15[\"Manipulate AnnData\"];\n  6 -->|anndata_out| 15;\n  14 -->|out_file1| 15;\n  16[\"Manipulate AnnData\"];\n  9 -->|output_h5ad| 16;\n  14 -->|out_file1| 16;\n  17[\"Manipulate AnnData\"];\n  15 -->|anndata| 17;\n  18[\"Manipulate AnnData\"];\n  16 -->|anndata| 18;\n  19[\"Cluster, infer trajectories and embed\"];\n  17 -->|anndata| 19;\n  20[\"Cluster, infer trajectories and embed\"];\n  18 -->|anndata| 20;\n  09d97ef7-ed92-4d90-a597-2032581c2d4a[\"Output\\nCluster, infer trajectories and embed (tl.louvain) on input dataset(s): Annotated data matrix\"];\n  20 --> 09d97ef7-ed92-4d90-a597-2032581c2d4a;\n  style 09d97ef7-ed92-4d90-a597-2032581c2d4a stroke:#2c3143,stroke-width:4px;\n  21[\"Plot\"];\n  19 -->|anndata_out| 21;\n  22[\"Plot\"];\n  20 -->|anndata_out| 22;"}],"api":"https://training.galaxyproject.org/training-material/api/topics/single-cell/tutorials/scrna-case_cell-cycle/tutorial.json","tools":["cat1","sort1","toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_easyjoin_tool/1.1.2","toolshed.g2.bx.psu.edu/repos/devteam/add_value/addValue/1.0.0","toolshed.g2.bx.psu.edu/repos/ebi-gxa/scanpy_regress_variable/scanpy_regress_variable/1.8.1+galaxy0","toolshed.g2.bx.psu.edu/repos/iuc/anndata_inspect/anndata_inspect/0.7.5+galaxy1","toolshed.g2.bx.psu.edu/repos/iuc/anndata_manipulate/anndata_manipulate/0.7.5+galaxy1","toolshed.g2.bx.psu.edu/repos/iuc/scanpy_cluster_reduce_dimension/scanpy_cluster_reduce_dimension/1.7.1+galaxy0","toolshed.g2.bx.psu.edu/repos/iuc/scanpy_inspect/scanpy_inspect/1.7.1+galaxy0","toolshed.g2.bx.psu.edu/repos/iuc/scanpy_plot/scanpy_plot/1.7.1+galaxy1","toolshed.g2.bx.psu.edu/repos/iuc/table_compute/table_compute/1.2.4+galaxy0"],"supported_servers":{"exact":[{"url":"https://usegalaxy.eu","name":"UseGalaxy.eu","usegalaxy":true}],"inexact":[{"url":"https://usegalaxy.org.au","name":"UseGalaxy.org.au","usegalaxy":true}]},"topic_name_human":"Single Cell","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[{"name":"text_processing","owner":"bgruening","revisions":"d698c222f354","tool_panel_section_label":"Text Manipulation","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"add_value","owner":"devteam","revisions":"745871c0b055","tool_panel_section_label":"Text Manipulation","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"scanpy_regress_variable","owner":"ebi-gxa","revisions":"36daab33aecf","tool_panel_section_label":"Single-cell","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"anndata_inspect","owner":"iuc","revisions":"ee98d611afc6","tool_panel_section_label":"Single-cell","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"anndata_manipulate","owner":"iuc","revisions":"3d748954434b","tool_panel_section_label":"Single-cell","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"scanpy_cluster_reduce_dimension","owner":"iuc","revisions":"aaa5da8e73a9","tool_panel_section_label":"Single-cell","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"scanpy_inspect","owner":"iuc","revisions":"c5d3684f7c4c","tool_panel_section_label":"Single-cell","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"scanpy_plot","owner":"iuc","revisions":"aa0c474463c2","tool_panel_section_label":"Single-cell","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"table_compute","owner":"iuc","revisions":"3bf5661c0280","tool_panel_section_label":"Text Manipulation","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"}]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools:\n- name: text_processing\n  owner: bgruening\n  revisions: d698c222f354\n  tool_panel_section_label: Text Manipulation\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: add_value\n  owner: devteam\n  revisions: 745871c0b055\n  tool_panel_section_label: Text Manipulation\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: scanpy_regress_variable\n  owner: ebi-gxa\n  revisions: 36daab33aecf\n  tool_panel_section_label: Single-cell\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: anndata_inspect\n  owner: iuc\n  revisions: ee98d611afc6\n  tool_panel_section_label: Single-cell\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: anndata_manipulate\n  owner: iuc\n  revisions: 3d748954434b\n  tool_panel_section_label: Single-cell\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: scanpy_cluster_reduce_dimension\n  owner: iuc\n  revisions: aaa5da8e73a9\n  tool_panel_section_label: Single-cell\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: scanpy_inspect\n  owner: iuc\n  revisions: c5d3684f7c4c\n  tool_panel_section_label: Single-cell\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: scanpy_plot\n  owner: iuc\n  revisions: aa0c474463c2\n  tool_panel_section_label: Single-cell\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: table_compute\n  owner: iuc\n  revisions: 3bf5661c0280\n  tool_panel_section_label: Text Manipulation\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n","tours":false,"video":false,"slides_recordings":false,"translations":{"tutorial":[],"slides":[],"video":false},"license":"CC-BY-4.0","type":"tutorial","contributors":[{"name":"Marisa Loach","orcid":"0000-0001-6979-6930","twitter":"Marisa_Loach","email":"marisa.loach@open.ac.uk","joined":"2022-10","id":"MarisaJL","url":"https://training.galaxyproject.org/training-material/api/contributors/MarisaJL.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/MarisaJL/"},{"name":"Wendi Bacon","email":"wendi.bacon@open.ac.uk","twitter":"WendiBacon1","matrix":"nomadscientist:matrix.org","joined":"2020-03","elixir_node":"uk","orcid":"0000-0002-8170-8806","bio":"Lecturer at The Open University","fediverse":"https://mstdn.science/@wendibacon1","fediverse_flavor":"mastodon","affiliations":["elixir-europe"],"id":"nomadscientist","url":"https://training.galaxyproject.org/training-material/api/contributors/nomadscientist.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/nomadscientist/"},{"name":"Graeme Tyson","email":"grt67@open.ac.uk","orcid":"0000-0002-1748-2806","joined":"2022-09","id":"hrukkudyr","url":"https://training.galaxyproject.org/training-material/api/contributors/hrukkudyr.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/hrukkudyr/"}]}