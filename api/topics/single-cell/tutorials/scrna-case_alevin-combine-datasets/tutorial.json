{"layout":"tutorial_hands_on","title":"Combining single cell datasets after pre-processing","subtopic":"single-cell-CS","priority":2,"zenodo_link":"https://zenodo.org/records/10852529","questions":["I have some AnnData files from different samples that I want to combine into a single file. How can I combine these and label them within the object?"],"redirect_from":["/topics/transcriptomics/tutorials/scrna-case_alevin-combine-datasets/tutorial","/short/single-cell/scrna-case_alevin-combine-datasets","/short/T00246"],"answer_histories":[{"label":"UseGalaxy.eu","history":"https://usegalaxy.eu/u/j.jakiela/h/combining-datasets-key-history","date":"2024-03-26"},{"label":"All total samples - processed after Alevin into single object (UseGalaxy.eu)","history":"https://usegalaxy.eu/u/j.jakiela/h/all-total-samples-processed-after-alevin-into-single-object","date":"2024-03-26"}],"input_histories":[{"label":"UseGalaxy.eu","history":"https://usegalaxy.eu/u/j.jakiela/h/combining-datasets-input"},{"label":"UseGalaxy.org","history":"https://usegalaxy.org/u/juliajot/h/combining-datasets-input"}],"objectives":["Combine data matrices from different samples in the same experiment","Label the metadata for downstream processing"],"time_estimation":"1H","key_points":["Create a single scanpy-accessible AnnData object from multiple AnnData files, including relevant cell metadata according to the study design","Retreive partially analysed data from a public repository"],"tags":["10x","paper-replication"],"contributions":{"authorship":["nomadscientist","pinin4fjords"],"editing":["hexylena"],"testing":["wee-snufkin"]},"requirements":[{"type":"internal","topic_name":"single-cell","tutorials":["scrna-intro","scrna-umis","scrna-case_alevin"]}],"gitter":"Galaxy-Training-Network/galaxy-single-cell","follow_up_training":[{"type":"internal","topic_name":"single-cell","tutorials":["scrna-case_basic-pipeline"]}],"recordings":[{"youtube_id":"22t-4qvHnow","length":"11M","date":"2023-05-09","speakers":["hrukkudyr"],"captioners":["hrukkudyr"]},{"captioners":["nomadscientist"],"date":"2021-02-15","galaxy_version":"21.09","length":"11M","youtube_id":"U8pVa6csmUE","speakers":["nomadscientist"]}],"js_requirements":{"mathjax":null,"mermaid":false},"short_id":"T00246","url":"/topics/single-cell/tutorials/scrna-case_alevin-combine-datasets/tutorial.html","topic_name":"single-cell","tutorial_name":"scrna-case_alevin-combine-datasets","dir":"topics/single-cell/tutorials/scrna-case_alevin-combine-datasets","symlink":null,"id":"single-cell/scrna-case_alevin-combine-datasets","ref_tutorials":["<p>This tutorial will take you from the multiple AnnData outputs of the <a href=\"https://humancellatlas.usegalaxy.eu/training-material/topics/transcriptomics/tutorials/scrna-case_alevin/tutorial.html\">previous tutorial</a> to a single, combined  AnnData object, ready for all the fun downstream processing. We will also look at how to add in metadata (for instance, SEX or GENOTYPE) for analysis later on.</p>\n\n<blockquote class=\"agenda\">\n  <agenda-title></agenda-title>\n\n  <p>In this tutorial, we will cover:</p>\n\n<ol id=\"markdown-toc\">\n  <li><a href=\"#get-data\" id=\"markdown-toc-get-data\">Get Data</a></li>\n  <li><a href=\"#important-tips-for-easier-analysis\" id=\"markdown-toc-important-tips-for-easier-analysis\">Important tips for easier analysis</a>    <ol>\n      <li><a href=\"#concatenating-objects\" id=\"markdown-toc-concatenating-objects\">Concatenating objects</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#adding-batch-metadata\" id=\"markdown-toc-adding-batch-metadata\">Adding batch metadata</a></li>\n  <li><a href=\"#mitochondrial-reads\" id=\"markdown-toc-mitochondrial-reads\">Mitochondrial reads</a></li>\n  <li><a href=\"#pulling-single-cell-data-from-public-resources\" id=\"markdown-toc-pulling-single-cell-data-from-public-resources\">Pulling single cell data from public resources</a></li>\n  <li><a href=\"#conclusion\" id=\"markdown-toc-conclusion\">Conclusion</a></li>\n</ol>\n\n</blockquote>\n\n<h2 id=\"get-data\">Get Data</h2>\n<p>The sample data is a subset of the reads in a mouse dataset of fetal growth restriction <span class=\"citation\"><a href=\"#Bacon2018\">Bacon <i>et al.</i> 2018</a></span> (see the <a href=\"https://www.ebi.ac.uk/gxa/sc/experiments/E-MTAB-6945/results/tsne\">study in Single Cell Expression Atlas</a> and the <a href=\"https://www.ebi.ac.uk/arrayexpress/experiments/E-MTAB-6945/\">project submission</a>). Each of the 7 samples (N701 –&gt; N707) has been run through the workflow from the <a href=\"https://humancellatlas.usegalaxy.eu/training-material/topics/transcriptomics/tutorials/scrna-case_alevin/tutorial.html\">Alevin tutorial</a>.</p>\n\n<p>You can access the data for this tutorial in multiple ways:</p>\n\n<ol>\n  <li>\n    <p><strong>Your own history</strong> - If you’re feeling confident that you successfully ran a workflow on all 7 samples from the previous tutorial, and that your resulting 7 AnnData objects look right (you can compare with the <a href=\"https://usegalaxy.eu/u/j.jakiela/h/combining-datasets-input\">answer key history</a>), then you can use those! To avoid a million-line history, I recommend dragging the resultant datasets into a fresh history</p>\n\n    <!--SNIPPET-->\n    <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-copy-a-dataset-between-histories\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-copy-a-dataset-between-histories\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Copy a dataset between histories</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p>There 3 ways to copy datasets between histories</p>   <ol>   <li>     <p>From the original history</p>     <ol>       <li>Click on the <i class=\"fas fa-cog\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-gear</span> icon which is on the top of the list of datasets in the history panel</li>       <li>Click on <strong>Copy Datasets</strong></li>       <li>         <p>Select the desired files</p>       </li>       <li>         <p>Give a relevant name to the “New history”</p>       </li>       <li>Validate by ‘Copy History Items’</li>       <li>Click on the new history name in the green box that have just appear to switch to this history</li>     </ol>   </li>   <li>     <p>Using the <i class=\"fas fa-columns\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-columns</span> <strong>Show Histories Side-by-Side</strong></p>     <ol>       <li>Click on the <i class=\"fas fa-caret-down\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-dropdown</span> dropdown arrow top right of the history panel (<strong>History options</strong>)</li>       <li>Click on <i class=\"fas fa-columns\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-columns</span> <strong>Show Histories Side-by-Side</strong></li>       <li>If your target history is not present         <ol>           <li>Click on ‘Select histories’</li>           <li>Click on your target history</li>           <li>Validate by ‘Change Selected’</li>         </ol>       </li>       <li>Drag the dataset to copy from its original history</li>       <li>Drop it in the target history</li>     </ol>   </li>   <li>     <p>From the target history</p>     <ol>       <li>Click on <strong>User</strong> in the top bar</li>       <li>Click on <strong>Datasets</strong></li>       <li>Search for the dataset to copy</li>       <li>Click on its name</li>       <li>Click on <strong>Copy to current History</strong></li>     </ol>   </li> </ol> </blockquote>\n    <p><!--END_SNIPPET--></p>\n  </li>\n  <li><strong>Importing from a history</strong>\n    <ul>\n      <li>You can import <a href=\"https://usegalaxy.eu/u/j.jakiela/h/combining-datasets-input\">this history for usegalaxy.eu</a></li>\n      <li>You can import <a href=\"https://usegalaxy.org/u/juliajot/h/combining-datasets-input\">this history for usegalaxy.org</a></li>\n    </ul>\n\n    <!--SNIPPET-->\n    <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-importing-a-history\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-importing-a-history\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Importing a history</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ol>   <li>Open the link to the shared history</li>   <li>Click on the <i class=\"fas fa-plus\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">new-history</span> <em>Import history</em> button on the top right</li>   <li>Enter a title for the new history</li>   <li>Click on <strong>Import</strong></li> </ol> </blockquote>\n    <p><!--END_SNIPPET--></p>\n\n    <ul>\n      <li>If you want to import the history to another Galaxy server, check how to do it below!</li>\n    </ul>\n\n    <!--SNIPPET-->\n    <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-transfer-entire-histories-from-one-galaxy-server-to-another\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-transfer-entire-histories-from-one-galaxy-server-to-another\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Transfer entire histories from one Galaxy server to another</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p><strong>Transfer a Single Dataset</strong></p>   <p>At the <strong>sender</strong> Galaxy server, <a href=\"/training-material/faqs/galaxy/histories_sharing.html\">set the history to a shared state</a>, then directly capture the <i class=\"fas fa-link\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-link</span> link for a dataset and paste the URL into the <strong>Upload</strong> tool at the <strong>receiver</strong> Galaxy server.</p>   <p><strong>Transfer an Entire History</strong></p>   <p><a href=\"/training-material/faqs/galaxy/account_create.html\">Have an account</a> at two different Galaxy servers, and be logged into both.</p>   <p>At the <strong>sender</strong> Galaxy server</p>   <ol>   <li>Navigate to the history you want to transfer, and <a href=\"/training-material/faqs/galaxy/histories_sharing.html\">set the history to a shared state</a>.</li>   <li>Click into the <strong>History Options</strong> menu in the history panel.</li>   <li>Select from the menu <i class=\"fas fa-archive\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-history-archive</span> <strong>Export History to File</strong>.</li>   <li>Choose the option for <strong>How do you want to export this History?</strong> as <strong>to direct download</strong>.</li>   <li>Click on <strong>Generate direct download</strong>.</li>   <li>Allow the archive generation process to complete. *</li>   <li>Copy the <i class=\"fas fa-link\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-link</span> link for your new archive.</li> </ol>   <p>At the <strong>receiver</strong> Galaxy server</p>   <ol>   <li>Confirm that you are logged into your account.</li>   <li>Click on <strong>Data</strong> in the top menu, and choose <strong>Histories</strong> to reach your <strong>Saved Histories</strong>.</li>   <li>Click on <strong>Import history</strong> in the grey button on the top right.</li>   <li>Paste in your link’s URL from step 7.</li>   <li>Click on <strong>Import History</strong>.</li>   <li>Allow the archive import process to complete. *</li>   <li>The transfered history will be uncompressed and added to your <strong>Saved Histories</strong>.</li> </ol>   <p>* For steps 6 and 13: It is Ok to navigate away for other tasks during processing. If enabled, Galaxy will send you <a href=\"/training-material/faqs/galaxy/account_update_preference.html\">status notifications</a>.</p>   <p><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tip</span> If the history to transfer is large, you may <a href=\"/training-material/faqs/galaxy/histories_copy_dataset.html\">copy just your important datasets into a new history</a>, and create the archive from that new smaller history. Clearing away deleted and purged datasets will make <em>all</em> histories smaller and faster to archive and transfer!</p> </blockquote>\n    <p><!--END_SNIPPET--></p>\n  </li>\n  <li><strong>Uploading from Zenodo</strong> (see below)</li>\n</ol>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Data upload for 7 files</hands-on-title>\n\n  <ol>\n    <li>Create a new history for this tutorial (if you’re not importing the history above)</li>\n    <li>\n      <p>Import the different AnnData files and the experimental design table from <a href=\"https://zenodo.org/records/10852529\">Zenodo</a>.</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>https://zenodo.org/records/10852529/files/Experimental_Design.tabular.tabular \nhttps://zenodo.org/records/10852529/files/N701-400k-AnnData.h5ad\nhttps://zenodo.org/records/10852529/files/N702-400k-AnnData.h5ad\nhttps://zenodo.org/records/10852529/files/N703-400k-AnnData.h5ad\nhttps://zenodo.org/records/10852529/files/N704-400k-AnnData.h5ad\nhttps://zenodo.org/records/10852529/files/N705-400k-AnnData.h5ad\nhttps://zenodo.org/records/10852529/files/N706-400k-AnnData.h5ad\nhttps://zenodo.org/records/10852529/files/N707-400k-AnnData.h5ad\n</code></pre></div>      </div>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-importing-via-links\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-importing-via-links\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Importing via links</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Copy the link location</li>   <li>     <p>Click <i class=\"fas fa-upload\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-upload</span> <strong>Upload Data</strong> at the top of the tool panel</p>   </li>   <li>Select <i class=\"fa fa-edit\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-wf-edit</span> <strong>Paste/Fetch Data</strong></li>   <li>     <p>Paste the link(s) into the text field</p>   </li>   <li>     <p>Press <strong>Start</strong></p>   </li>   <li><strong>Close</strong> the window</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>Rename the datasets</li>\n    <li>\n      <p>Check that the AnnData files datatype is <code class=\"language-plaintext highlighter-rouge\">h5ad</code>, otherwise you will need to change each file to <code class=\"language-plaintext highlighter-rouge\">h5ad</code>!</p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-changing-the-datatype\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-changing-the-datatype\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Changing the datatype</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Click on the <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>   <li>In the central panel, click <i class=\"fas fa-database\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-chart-select-data</span> <strong>Datatypes</strong> tab on the top</li>   <li>In the <i class=\"fas fa-database\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-chart-select-data</span> <strong>Assign Datatype</strong>, select <code class=\"language-plaintext highlighter-rouge\">datatypes</code> from “<em>New type</em>” dropdown     <ul>       <li>Tip: you can start typing the datatype into the field to filter the dropdown menu</li>     </ul>   </li>   <li>Click the <strong>Save</strong> button</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p><i class=\"far fa-eye\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-eye</span> Inspect the <i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <code class=\"language-plaintext highlighter-rouge\">Experimental Design</code> text file. This shows you how each <code class=\"language-plaintext highlighter-rouge\">N70X</code> corresponds to a sample, and whether that sample was from a male or female. This will be important metadata to add to our sample, which we will add very similarly to how you added the <code class=\"language-plaintext highlighter-rouge\">gene_name</code> and <code class=\"language-plaintext highlighter-rouge\">mito</code> metadata previously!</p>\n\n<h1 id=\"important-tips-for-easier-analysis\">Important tips for easier analysis</h1>\n\n<!--SNIPPET-->\n<blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-using-tutorial-mode\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-using-tutorial-mode\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Using tutorial mode</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p>Tools are frequently updated to new versions. Your Galaxy may have multiple versions of the same tool available. By default, you will be shown the latest version of the tool. This may NOT be the same tool used in the tutorial you are accessing. Furthermore, if you use a newer tool in one step, and try using an older tool in the next step… this may fail! To ensure you use the same tool versions of a given tutorial, use the <strong>Tutorial mode</strong> feature.</p>   <ul>   <li>Open your Galaxy server</li>   <li>Click on the <i class=\"fas fa-graduation-cap\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">curriculum</span> icon on the top menu, this will open the GTN inside Galaxy.</li>   <li>Navigate to your tutorial</li>   <li>Tool names in tutorials will be blue buttons that open the correct tool for you</li>   <li><strong>Note:</strong> this does not work for all tutorials (yet)   <img src=\"/training-material/topics/contributing/images/88277962-ddda4a80-cce1-11ea-92cd-41b1df063db0.gif\" alt=\"gif showing how GTN-in-Galaxy works\" /></li>   <li>You can click anywhere in the grey-ed out area outside of the tutorial box to return back to the Galaxy analytical interface</li> </ul>   <blockquote class=\"warning\">   <warning-title>Not all browsers work!</warning-title>   <ul>     <li>We’ve had some issues with Tutorial mode on Safari for Mac users.</li>     <li>Try a <strong>different browser</strong> if you aren’t seeing the button.</li>   </ul> </blockquote> </blockquote>\n<p><!--END_SNIPPET--></p>\n\n<!--SNIPPET-->\n<blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-use-our-single-cell-lab\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-use-our-single-cell-lab\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Use our Single Cell Lab</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p>Did you know we have a unique Single Cell Lab with all our single cell tools highlighted to make it easier to use on Galaxy? We recommend this site for all your single cell analysis needs, particularly for newer users.</p>   <p>The Single Cell Lab currently uses the main European Galaxy infrastructure and power, it’s just organised better for users of particular analyses…like single cell!</p>   <p>Try it out! All your histories/workflows/logins from the general <a href=\"https://usegalaxy.eu\">European Galaxy server</a> will be there!</p>   <ul>   <li><i class=\"fa fa-tv\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">subdomain</span> <a href=\"https://singlecell.usegalaxy.eu\">Single Cell Lab</a></li> </ul> </blockquote>\n<p><!--END_SNIPPET--></p>\n\n<!--SNIPPET-->\n<blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-troubleshooting-errors\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-troubleshooting-errors\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Troubleshooting errors</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p>When something goes wrong in Galaxy, there are a number of things you can do to find out what it was. Error messages can help you figure out whether it was a problem with one of the settings of the tool, or with the input data, or maybe there is a bug in the tool itself and the problem should be reported. Below are the steps you can follow to troubleshoot your Galaxy errors.</p>   <ol>   <li><strong>Expand</strong> the red history dataset by clicking on it.     <ul>       <li>Sometimes you can already see an error message here</li>     </ul>   </li>   <li>     <p><strong>View the error message</strong> by clicking on the <strong>bug icon</strong> <i class=\"fas fa-bug\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-bug</span></p>   </li>   <li><strong>Check the logs.</strong> Output (stdout) and error logs (stderr) of the tool are available:     <ul>       <li>Expand the history item</li>       <li>Click on the <i class=\"fas fa-info-circle\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">details</span> icon</li>       <li>Scroll down to the <strong>Job Information</strong> section to view the 2 logs:         <ul>           <li>Tool Standard Output</li>           <li>Tool Standard Error</li>         </ul>       </li>       <li>For more information about specific tool errors, please see the <a href=\"/training-material/faqs/galaxy/index.html#troubleshooting\">Troubleshooting section</a></li>     </ul>   </li>   <li><strong>Submit a bug report!</strong> If you are still unsure what the problem is.     <ul>       <li>Click on the bug icon <i class=\"fas fa-bug\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-bug</span></li>       <li>Write down any information you think might help solve the problem         <ul>           <li>See <a href=\"/training-material/faqs/galaxy/analysis_troubleshooting_reporting.html\">this FAQ</a> on how to write good bug reports</li>         </ul>       </li>       <li>Click <strong><i class=\"fas fa-bug\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-bug</span> Report</strong> button</li>     </ul>   </li>   <li><strong>Ask for help!</strong>     <ul>       <li>Where?         <ul>           <li>In the <a href=\"https://matrix.to/#/#Galaxy-Training-Network_galaxy-single-cell:gitter.im\">Single cell user community</a></li>           <li>In the <a href=\"https://gitter.im/Galaxy-Training-Network/Lobby\">GTN Matrix Channel</a></li>           <li>In the <a href=\"https://gitter.im/galaxyproject/Lobby\">Galaxy Matrix Channel</a></li>           <li>Browse the <a href=\"https://help.galaxyproject.org/\">Galaxy Help Forum</a> to see if others have encountered the same problem before (or post your question).</li>         </ul>       </li>       <li>When asking for help, it is useful to <a href=\"/training-material/faqs/galaxy/histories_sharing.html\">share a link to your history</a></li>     </ul>   </li> </ol> </blockquote>\n<p><!--END_SNIPPET--></p>\n\n<h2 id=\"concatenating-objects\">Concatenating objects</h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Concatenating AnnData objects</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/anndata_manipulate/anndata_manipulate/0.10.3+galaxy0\" title=\"Manipulate AnnData tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Manipulate AnnData</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.10.3+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">N701-400k</code></li>\n        <li><em>“Function to manipulate the object”</em>: <code class=\"language-plaintext highlighter-rouge\">Concatenate along the observations axis</code></li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix to add”</em>: <code class=\"language-plaintext highlighter-rouge\">Select all the other matrix files from bottom to top, N707 to N702</code></li>\n      </ul>\n\n      <blockquote class=\"warning\">\n        <warning-title>N707 to N702!</warning-title>\n        <p>You are adding files to N701, so do not add N701 to itself!</p>\n      </blockquote>\n\n      <ul>\n        <li><em>“Join method”</em>: <code class=\"language-plaintext highlighter-rouge\">Intersection of variables</code></li>\n        <li><em>“Key to add the batch annotation to obs”</em>: <code class=\"language-plaintext highlighter-rouge\">batch</code></li>\n        <li><em>“Separator to join the existing index names with the batch category”</em>: <code class=\"language-plaintext highlighter-rouge\">-</code></li>\n      </ul>\n    </li>\n    <li>Rename <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> output <code class=\"language-plaintext highlighter-rouge\">Combined Object</code></li>\n  </ol>\n</blockquote>\n\n<p>Now let’s look at what we’ve done! Unfortunately, AnnData objects are quite complicated, so the <i class=\"far fa-eye\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-eye</span> won’t help us too much here. Instead, we’re going to use a tool to look into our object from now on.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Inspecting AnnData Objects</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/anndata_inspect/anndata_inspect/0.10.3+galaxy0\" title=\"Inspect AnnData tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Inspect AnnData</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.10.3+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">Combined object</code></li>\n        <li><em>“What to inspect?”</em>: <code class=\"language-plaintext highlighter-rouge\">General information about the object</code></li>\n      </ul>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/anndata_inspect/anndata_inspect/0.7.5+galaxy1\" title=\"Inspect AnnData tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Inspect AnnData</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.7.5+galaxy1)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">Combined object</code></li>\n        <li><em>“What to inspect?”</em>: <code class=\"language-plaintext highlighter-rouge\">Key-indexed observations annotation (obs)</code></li>\n      </ul>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/anndata_inspect/anndata_inspect/0.7.5+galaxy1\" title=\"Inspect AnnData tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Inspect AnnData</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.7.5+galaxy1)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">Combined object</code></li>\n        <li><em>“What to inspect?”</em>: <code class=\"language-plaintext highlighter-rouge\">Key-indexed annotation of variables/features (var)</code></li>\n      </ul>\n    </li>\n  </ol>\n</blockquote>\n\n<p>Now have a look at the three <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> <strong>Inspect AnnData</strong> outputs.</p>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <ol>\n    <li>How many cells do you have now?</li>\n    <li>Where is <code class=\"language-plaintext highlighter-rouge\">batch</code> information stored?</li>\n  </ol>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <ol>\n      <li>If you look at the <strong>General information</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> output, you can see there are now <code class=\"language-plaintext highlighter-rouge\">331 cells</code>, as the matrix is now 331 cells x 35734 genes. You can see this as well in the <strong>obs</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> (cells) and <strong>var</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> (genes) file sizes.</li>\n      <li>Under <strong>Key-indexed observations annotation (obs)</strong>. Different versions of the Manipulate tool might put the <code class=\"language-plaintext highlighter-rouge\">batch</code> columns in different locations. The tool version in this course puts <code class=\"language-plaintext highlighter-rouge\">batch</code> in the <code class=\"language-plaintext highlighter-rouge\">8th</code> column. Batch refers to the order in which the matrices were added. The files are added from the bottom of the history upwards, so be careful how you set up your histories when running this (i.e. if your first dataset is N703 and the second is N701, the <code class=\"language-plaintext highlighter-rouge\">batch</code> will call N703 <code class=\"language-plaintext highlighter-rouge\">0</code> and N701 <code class=\"language-plaintext highlighter-rouge\">1</code>!)</li>\n    </ol>\n  </blockquote>\n\n</blockquote>\n\n<h1 id=\"adding-batch-metadata\">Adding batch metadata</h1>\n\n<p>I set up the example history with the earliest indices at the bottom.</p>\n\n<figure id=\"figure-1\" style=\"max-width: 90%;\"><img src=\"../../images/scrna-casestudy/wab-history-files-ascending.png\" alt=\"The files are numbered such that dataset #1 is N701, dataset #2 is N702, etc., up through #7 as N707. This puts N707 at the top and N701 at the bottom in the Galaxy history.\" width=\"328\" height=\"642\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/scrna-casestudy/wab-history-files-ascending.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 1</strong>:</span> Correct history ordering for combining datasets in order</figcaption></figure>\n\n<p>Therefore, when it is all concatenated together, the <code class=\"language-plaintext highlighter-rouge\">batch</code> appears as follows:</p>\n\n<table>\n  <thead>\n    <tr>\n      <th>Index</th>\n      <th>Batch</th>\n      <th>Genotype</th>\n      <th>Sex</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>N701</td>\n      <td>0</td>\n      <td>wildtype</td>\n      <td>male</td>\n    </tr>\n    <tr>\n      <td>N702</td>\n      <td>1</td>\n      <td>knockout</td>\n      <td>male</td>\n    </tr>\n    <tr>\n      <td>N703</td>\n      <td>2</td>\n      <td>knockout</td>\n      <td>female</td>\n    </tr>\n    <tr>\n      <td>N704</td>\n      <td>3</td>\n      <td>wildtype</td>\n      <td>male</td>\n    </tr>\n    <tr>\n      <td>N705</td>\n      <td>4</td>\n      <td>wildtype</td>\n      <td>male</td>\n    </tr>\n    <tr>\n      <td>N706</td>\n      <td>5</td>\n      <td>wildtype</td>\n      <td>male</td>\n    </tr>\n    <tr>\n      <td>N707</td>\n      <td>6</td>\n      <td>knockout</td>\n      <td>male</td>\n    </tr>\n  </tbody>\n</table>\n\n<p>If you used Zenodo to import files, they may not have imported in order (i.e. N701 to N707, ascending). In that case, you will need to tweak the parameters of the next tools appropriately to label your batches correctly!</p>\n\n<p>The two critical pieces of metadata in this experiment are <strong>sex</strong> and <strong>genotype</strong>. I will later want to color my cell plots by these parameters, so I want to add them in now!</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Labelling sex</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_replace_in_column/9.3+galaxy0\" title=\"Replace Text in a specific column tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Replace Text in a specific column</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 9.3+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“File to process”</em>: output of <strong>Inspect AnnData: Key-indexed observations annotation (obs)</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li>\n          <p><em>“1. Replacement”</em></p>\n\n          <ul>\n            <li><em>“in column”</em>: <code class=\"language-plaintext highlighter-rouge\">Column: 8</code> - or whichever column <code class=\"language-plaintext highlighter-rouge\">batch</code> is in</li>\n            <li><em>“Find pattern”</em>: <code class=\"language-plaintext highlighter-rouge\">0|1|3|4|5|6</code></li>\n            <li><em>“Replace with”</em>: <code class=\"language-plaintext highlighter-rouge\">male</code></li>\n          </ul>\n        </li>\n        <li><strong>+ Insert Replacement</strong></li>\n        <li>\n          <p><em>“2. Replacement”</em></p>\n\n          <ul>\n            <li><em>“in column”</em>: <code class=\"language-plaintext highlighter-rouge\">Column: 8</code></li>\n            <li><em>“Find pattern”</em>: <code class=\"language-plaintext highlighter-rouge\">2</code></li>\n            <li><em>“Replace with”</em>: <code class=\"language-plaintext highlighter-rouge\">female</code></li>\n          </ul>\n        </li>\n        <li><strong>+ Insert Replacement</strong></li>\n        <li>\n          <p><em>“3. Replacement”</em></p>\n\n          <ul>\n            <li><em>“in column”</em>: <code class=\"language-plaintext highlighter-rouge\">Column: 8</code></li>\n            <li><em>“Find pattern”</em>: <code class=\"language-plaintext highlighter-rouge\">batch</code></li>\n            <li><em>“Replace with”</em>: <code class=\"language-plaintext highlighter-rouge\">sex</code></li>\n          </ul>\n        </li>\n      </ul>\n\n      <p>Run this tool - we will use the output in Step 2.</p>\n\n      <p>From the output of Step 1 we want only the single column containing the sex information - we will ultimately add this into the cell annotation in the AnnData object.</p>\n    </li>\n    <li><span class=\"tool\" data-tool=\"Cut1\" title=\"Cut columns from a table tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Cut columns from a table</strong></span> with the following parameters:\n      <ul>\n        <li><em>“Cut columns”</em>: <code class=\"language-plaintext highlighter-rouge\">c8</code></li>\n        <li><em>“Delimited by”</em>: <code class=\"language-plaintext highlighter-rouge\">Tab</code></li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“From”</em>: output of <strong>Replace text</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span></li>\n      </ul>\n    </li>\n    <li>Rename <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> output <code class=\"language-plaintext highlighter-rouge\">Sex metadata</code></li>\n  </ol>\n</blockquote>\n\n<p>That was so fun, let’s do it all again but for genotype!</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Labelling genotype</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_replace_in_column/9.3+galaxy0\" title=\"Replace Text in a specific column tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Replace Text in a specific column</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 9.3+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“File to process”</em>: output of <strong>Inspect AnnData: Key-indexed observations annotation (obs)</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span></li>\n        <li>\n          <p><em>“1. Replacement”</em></p>\n\n          <ul>\n            <li><em>“in column”</em>: <code class=\"language-plaintext highlighter-rouge\">Column: 8</code></li>\n            <li><em>“Find pattern”</em>: <code class=\"language-plaintext highlighter-rouge\">0|3|4|5</code></li>\n            <li><em>“Replace with”</em>: <code class=\"language-plaintext highlighter-rouge\">wildtype</code></li>\n          </ul>\n        </li>\n        <li><strong>+ Insert Replacement</strong></li>\n        <li>\n          <p><em>“2. Replacement”</em></p>\n\n          <ul>\n            <li><em>“in column”</em>: <code class=\"language-plaintext highlighter-rouge\">Column: 8</code></li>\n            <li><em>“Find pattern”</em>: <code class=\"language-plaintext highlighter-rouge\">1|2|6</code></li>\n            <li><em>“Replace with”</em>: <code class=\"language-plaintext highlighter-rouge\">knockout</code></li>\n          </ul>\n        </li>\n        <li><strong>+ Insert Replacement</strong></li>\n        <li>\n          <p><em>“3. Replacement”</em></p>\n\n          <ul>\n            <li><em>“in column”</em>: <code class=\"language-plaintext highlighter-rouge\">Column: 8</code></li>\n            <li><em>“Find pattern”</em>: <code class=\"language-plaintext highlighter-rouge\">batch</code></li>\n            <li><em>“Replace with”</em>: <code class=\"language-plaintext highlighter-rouge\">genotype</code></li>\n          </ul>\n        </li>\n      </ul>\n\n      <p>Now we want only the column containing the genotype information - we will ultimately add this into the cell annotation in the AnnData object.</p>\n    </li>\n    <li><span class=\"tool\" data-tool=\"Cut1\" title=\"Cut columns from a table tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Cut columns from a table</strong></span> with the following parameters:\n      <ul>\n        <li><em>“Cut columns”</em>: <code class=\"language-plaintext highlighter-rouge\">c8</code></li>\n        <li><em>“Delimited by”</em>: <code class=\"language-plaintext highlighter-rouge\">Tab</code></li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“From”</em>: output of <strong>Replace text</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span></li>\n      </ul>\n    </li>\n    <li>Rename <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> output <code class=\"language-plaintext highlighter-rouge\">Genotype metadata</code></li>\n  </ol>\n</blockquote>\n\n<p>You might want to do this with all sorts of different metadata - which labs handled the samples, which days they were run, etc. Once you’ve added all your metadata columns, we can add them together before plugging them into the AnnData object itself.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Combining metadata columns</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"Paste1\" title=\"Paste two files side by side tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Paste two files side by side</strong></span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Paste”</em>: <code class=\"language-plaintext highlighter-rouge\">Genotype metadata</code></li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“and”</em>: <code class=\"language-plaintext highlighter-rouge\">Sex metadata</code></li>\n        <li><em>“Delimit by”</em>: <code class=\"language-plaintext highlighter-rouge\">Tab</code></li>\n      </ul>\n    </li>\n    <li>Rename <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> output <code class=\"language-plaintext highlighter-rouge\">Cell Metadata</code></li>\n  </ol>\n</blockquote>\n\n<p>Let’s add it to the AnnData object!</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Adding metadata to AnnData object</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/anndata_manipulate/anndata_manipulate/0.10.3+galaxy0\" title=\"Manipulate AnnData tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Manipulate AnnData</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.10.3+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">Combined object</code></li>\n        <li><em>“Function to manipulate the object”</em>: <code class=\"language-plaintext highlighter-rouge\">Add new annotation(s) for observations or variables</code></li>\n        <li><em>“What to annotate?”</em>: <code class=\"language-plaintext highlighter-rouge\">Observations (obs)</code>`</li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Table with new annotations”</em>: <code class=\"language-plaintext highlighter-rouge\">Cell Metadata</code></li>\n      </ul>\n    </li>\n  </ol>\n</blockquote>\n\n<p>Woohoo! We’re there! You can run an <span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/anndata_inspect/anndata_inspect/0.10.3+galaxy0\" title=\"Inspect AnnData tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Inspect AnnData</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.10.3+galaxy0)</span> to check now, but I want to clean up this AnnData object just a bit more first. It would be a lot nicer if ‘batch’ meant something, rather than ‘the order in which the Manipulate AnnData tool added my datasets’.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Labelling batches</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/anndata_manipulate/anndata_manipulate/0.10.3+galaxy0\" title=\"Manipulate AnnData tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Manipulate AnnData</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.10.3+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: output of <strong>Manipulate AnnData - Add new annotations</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span></li>\n        <li><em>“Function to manipulate the object”</em>: <code class=\"language-plaintext highlighter-rouge\">Rename categories of annotation</code></li>\n        <li><em>“Key for observations or variables annotation”</em>: <code class=\"language-plaintext highlighter-rouge\">batch</code></li>\n        <li><em>“Comma-separated list of new categories”</em>: <code class=\"language-plaintext highlighter-rouge\">N701,N702,N703,N704,N705,N706,N707</code></li>\n      </ul>\n    </li>\n    <li>Rename <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> output <code class=\"language-plaintext highlighter-rouge\">Batched Object</code></li>\n  </ol>\n</blockquote>\n\n<p>Huzzah! We are JUST about there. However, while we’ve been focussing on our cell metadata (sample, batch, genotype, etc.) to relabel the ‘observations’ in our object…</p>\n\n<h1 id=\"mitochondrial-reads\">Mitochondrial reads</h1>\n\n<p>Do you remember when we mentioned mitochondria early on in this tutorial? And how often in single cell samples, mitochondrial RNA is often an indicator of stress during dissociation? We should probably do something with our column of true/false in the gene annotation that tells us information about the cells. You will need to do this whether you have combined FASTQ files or are analysing just one.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Calculating mitochondrial RNA in cells</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/ebi-gxa/anndata_ops/anndata_ops/1.9.3+galaxy0\" title=\"AnnData Operations tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>AnnData Operations</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.9.3+galaxy0)</span> with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Input object in hdf5 AnnData format”</em>: <code class=\"language-plaintext highlighter-rouge\">Batched Object</code></li>\n        <li><em>“Format of output object”</em>: <code class=\"language-plaintext highlighter-rouge\">AnnData format</code></li>\n        <li><em>“Gene symbols field in AnnData”</em>: <code class=\"language-plaintext highlighter-rouge\">NA.</code></li>\n        <li><em>“Flag genes that start with these names”</em>: <code class=\"language-plaintext highlighter-rouge\">Insert Flag genes that start with these names</code></li>\n        <li><em>“Starts with”</em>: <code class=\"language-plaintext highlighter-rouge\">True</code></li>\n        <li><em>“Var name”</em>: <code class=\"language-plaintext highlighter-rouge\">mito</code></li>\n      </ul>\n    </li>\n    <li>Rename <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> output <code class=\"language-plaintext highlighter-rouge\">Annotated Object</code></li>\n  </ol>\n</blockquote>\n\n<p><i class=\"far fa-thumbs-up\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">congratulations</span>Well done!  I strongly suggest have a play with the <strong>Inspect AnnData</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> on your final <code class=\"language-plaintext highlighter-rouge\">Pre-processed object</code> to see the wealth of information that has been added. You are now ready to move along to further filtering! There is a cheat that may save you time in the future though…</p>\n\n<h1 id=\"pulling-single-cell-data-from-public-resources\">Pulling single cell data from public resources</h1>\n\n<p>If you happen to be interested in analysing publicly available data, particularly from the <a href=\"https://www.ebi.ac.uk/gxa/sc/home\">Single Cell Expression Atlas</a>, you may be interested in the following tool <span class=\"citation\"><a href=\"#Moreno2020.04.08.032698\">Moreno <i>et al.</i> 2020</a></span> which combines all these steps into one! For this tutorial, the dataset can be seen <a href=\"https://www.ebi.ac.uk/gxa/sc/experiments/E-MTAB-6945/downloads\">at the EBI</a> with experiment id of <code class=\"language-plaintext highlighter-rouge\">E-MTAB-6945</code>. It’s important to note that this matrix is processed somewhat through the SCXA pipeline, which is quite similar to this tutorial, and it contains any and all metadata provided by their pipeline as well as the authors (for instance, more cell or gene annotations).</p>\n\n<p>If you wish, you can have a closer look how to pull this dataset from the Single Cell Expression Atlas by following another tutorial: <a href=\"/training-material/topics/single-cell/tutorials/EBI-retrieval/tutorial.html\">Importing files from public atlases</a>.</p>\n\n<!---\n> <hands-on-title>Retrieving data from Single Cell Expression Atlas</hands-on-title>\n>\n> 1. <span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/ebi-gxa/retrieve_scxa/retrieve_scxa/v0.0.2+galaxy2\" title=\"EBI SCXA Data Retrieval tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>EBI SCXA Data Retrieval</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version v0.0.2+galaxy2)</span> with the following parameters:\n>      - *\"SC-Atlas experiment accession\"*: `E-MTAB-6945`\n>      - *\"Choose the type of matrix to download\"*: `Raw filtered counts`\n>\n>    Now we need to transform this into an AnnData objects\n>\n> 2. <span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/ebi-gxa/scanpy_read_10x/scanpy_read_10x/1.8.1+galaxy9\" title=\"Scanpy Read10x tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Scanpy Read10x</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.8.1+galaxy9)</span> with the following parameters:\n>    - *\"Expression matrix in sparse matrix format (.mtx)\"*: `EBI SCXA Data Retrieval on E-MTAB-6945 matrix.mtx (Raw filtered counts)`\n>    - *\"Gene table\"*:  `EBI SCXA Data Retrieval on E-MTAB-6945 genes.tsv (Raw filtered counts)`\n>    - *\"Barcode/cell table\"*: `EBI SCXA Data Retrieval on E-MTAB-6945 barcodes.tsv (Raw filtered counts)`\n>    - *\"Cell metadata table\"*: `EBI SCXA Data Retrieval on E-MTAB-6945 exp_design.tsv`\n{: .hands_on}\n-->\n\n<h1 id=\"conclusion\">Conclusion</h1>\n\n<figure id=\"figure-2\" style=\"max-width: 90%;\"><img src=\"../../images/scrna-casestudy/wab-combining_datasets_alevin.png\" alt=\"Combining data files. \" width=\"2200\" height=\"1652\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/scrna-casestudy/wab-combining_datasets_alevin.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 2</strong>:</span> Workflow  - Combining datasets</figcaption></figure>\n\n<p>You’ve reached the end of this session!\nYou may be interested in seeing an <a href=\"https://usegalaxy.eu/u/j.jakiela/h/combining-datasets-key-history\">example history</a> and <a href=\"https://usegalaxy.eu/u/j.jakiela/w/combining-datasets-after-pre-processing\">workflow</a>. Note that the workflow might require changing of the <code class=\"language-plaintext highlighter-rouge\">column</code> containing the batch metadata depending on how you are running it and checking the order of the combined datasets. The final object containing the total the reads can be found in <a href=\"https://usegalaxy.eu/u/j.jakiela/h/all-total-samples-processed-after-alevin-into-single-object\">this Galaxy History on UseGalaxy EU</a>.</p>\n\n<!--SNIPPET-->\n<blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-how-can-i-talk-with-other-users\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-how-can-i-talk-with-other-users\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: How can I talk with other users?</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p><i class=\"far fa-comments\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">feedback</span> To discuss with like-minded scientists, join our <a href=\"http://gxy.io/gtn-slack\">Galaxy Training Network chatspace in Slack</a> and discuss with fellow users of Galaxy single cell analysis tools on <a href=\"https://gtnsmrgsbord.slack.com/archives/C06PBRR40D7\">#single-cell-users</a></p>   <p>We also post new tutorials / workflows there from time to time, as well as any other news.</p>   <p><i class=\"far fa-hand-point-right\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">point-right</span> If you’d like to contribute ideas, requests or feedback as part of the wider community building single-cell and spatial resources within Galaxy, you can also join our <a href=\"https://galaxyproject.org/community/sig/singlecell/\">Single cell &amp; sPatial Omics Community of Practice</a>.</p>   <p><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> You can request tools here on our <a href=\"https://docs.google.com/spreadsheets/d/15hqgqA-RMDhXR-ylKhRF-Dab9Ij2arYSKiEVoPl2df4/edit?usp=sharing\">Single Cell and Spatial Omics Community Tool Request Spreadsheet</a></p> </blockquote>\n<p><!--END_SNIPPET--></p>\n","<p>Este tutorial te ayudará a pasar de datos crudos de secuenciación en archivos FASTQ a una matriz de datos en formato AnnData donde cada célula es una fila y cada gen es una columna. Pero, ¿Qué es una matriz de datos y cuál es el formato AnnData? Lo averiguaremos a su debido tiempo. Enfatizamos que este es el primer paso para procesar datos de secuenciación de células únicas para poder realizar su análisis.</p>\n\n<p>De momento, en tus archivos de secuenciación tienes un montón de cadenas del tipo <code class=\"language-plaintext highlighter-rouge\">ATGGGCTT</code>, etc. y lo que necesitas saber es cuántas células tienes y qué genes aparecen en ellas. En la segunda parte de este tutorial abordaremos la combinación de archivos FASTQ y el cómo añadir metadatos (por ejemplo, SEXO o GENOTIPO) para análisis posteriores. Estos son los pasos que requieren más recursos computacionales en los análisis de células únicas, ya que partimos de cientos de millones de lecturas, cada una de ellas con cuatro líneas de texto. Posteriormente, en el análisis, estos datos se convertirán en simples conteos de genes, por ejemplo ‘La célula A tiene 4 GAPDHs’ (‘Cell A has 4 GAPDHs’), que es mucho más sencillo de almacenar.</p>\n\n<p>Debido a la enorme cantidad de datos, hemos reducido la resolución de los archivos FASTQ para poder acelerar el análisis. Una vez que hemos aclarado este punto, todavía tienes que mapear enormes cantidades de lecturas al inmenso genoma murino, así que ¡ve por una taza de café y prepárate para iniciar el análisis!</p>\n\n<blockquote class=\"agenda\">\n  <agenda-title></agenda-title>\n\n  <p>En este tutorial abordaremos:</p>\n\n<ol id=\"markdown-toc\">\n  <li><a href=\"#generar-una-matriz\" id=\"markdown-toc-generar-una-matriz\">Generar una matriz</a>    <ol>\n      <li><a href=\"#obtener-datos\" id=\"markdown-toc-obtener-datos\">Obtener datos</a></li>\n      <li><a href=\"#generar-un-mapa-de-correspondencia-de-transcritos-a-genes\" id=\"markdown-toc-generar-un-mapa-de-correspondencia-de-transcritos-a-genes\">Generar un mapa de correspondencia de transcritos a genes</a></li>\n      <li><a href=\"#generar-el-índice-de-un-transcriptoma-y-cuantificar\" id=\"markdown-toc-generar-el-índice-de-un-transcriptoma-y-cuantificar\">Generar el índice de un transcriptoma y cuantificar</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#control-de-calidad-básico\" id=\"markdown-toc-control-de-calidad-básico\">Control de calidad básico</a>    <ol>\n      <li><a href=\"#generar-una-matriz-sin-procesamiento-en-un-formato-utilizable\" id=\"markdown-toc-generar-una-matriz-sin-procesamiento-en-un-formato-utilizable\">Generar una matriz sin procesamiento en un formato utilizable</a></li>\n      <li><a href=\"#añadir-metadatos-de-genes\" id=\"markdown-toc-añadir-metadatos-de-genes\">Añadir metadatos de genes</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#emptydrops\" id=\"markdown-toc-emptydrops\">emptyDrops</a></li>\n  <li><a href=\"#combinar-archivos-fastq\" id=\"markdown-toc-combinar-archivos-fastq\">Combinar archivos FASTQ</a>    <ol>\n      <li><a href=\"#datos\" id=\"markdown-toc-datos\">Datos</a></li>\n      <li><a href=\"#concatenación-de-objetos\" id=\"markdown-toc-concatenación-de-objetos\">Concatenación de objetos</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#añadir-el-lote-de-metadatos-batch-metadata\" id=\"markdown-toc-añadir-el-lote-de-metadatos-batch-metadata\">Añadir el lote de metadatos (batch metadata)</a></li>\n  <li><a href=\"#lecturas-mitocondriales\" id=\"markdown-toc-lecturas-mitocondriales\">Lecturas mitocondriales</a></li>\n  <li><a href=\"#extraer-datos-de-secuenciación-de-arn-de-células-únicas-desde-bases-de-datos-públicas\" id=\"markdown-toc-extraer-datos-de-secuenciación-de-arn-de-células-únicas-desde-bases-de-datos-públicas\">Extraer datos de secuenciación de ARN de células únicas desde bases de datos públicas</a></li>\n  <li><a href=\"#conclusion\" id=\"markdown-toc-conclusion\">Conclusion</a></li>\n</ol>\n\n</blockquote>\n\n<h1 id=\"generar-una-matriz\">Generar una matriz</h1>\n\n<p>En esta sección te mostraremos los principios de la fase inicial del análisis de Secuenciación de ARN de células únicas, que se basa en generar mediciones de expresión en una matriz. Por simplicidad, nos referiremos a este análisis por sus siglas en inglés scRNA-Seq (single-cell RNA-Seq). Nos concentramos en la metodología basada en goteo (en lugar de las metodologías basadas en placas), ya que es el proceso con más diferencias con respecto a los enfoques convencionales desarrollados para secuenciación de ARN general.</p>\n\n<p>Los datos provenientes de metodologías de goteo están constituidos por tres componentes: códigos de barras, identificadores únicos moleculares (Unique molecular Identifier, o UMIs por sus siglas en inglés) y lecturas de ADN codificante (proveniente de ADN complementario o cDNA). Para poder generar cuantificaciones a nivel celula necesitaremos:</p>\n\n<ul>\n  <li>Procesar los códigos de barras, identificar cuáles corresponden a células ‘reales’, cuáles son meros artefactos, y posiblemente corregir códigos de barras que pudiesen ser producto de errores de secuenciación por medio de comparaciones con secuencias de mayor frecuencia.</li>\n  <li>Mapear secuencias biológicas a su genoma o transcriptoma de referencia.</li>\n  <li>Eliminar duplicados usando UMIs.</li>\n</ul>\n\n<p>Este solía ser un proceso complejo que involucraba múltiples algoritmos, o que se realizaba con métodos dedicados a tecnologías específicas (como la herramienta ‘Cellranger’ para 10X); pero ahora el proceso es más simple gracias al surgimiento de otros métodos. En el momento de seleccionar una metodología para tu proyecto podrías considerar las siguientes herramientas:</p>\n\n<ul>\n  <li><a href=\"https://github.com/alexdobin/STAR\">STARsolo</a> - una variante del popular método de alineamiento de genoma ‘STAR’ que es específica para el análisis de datos de secuenciación de ARN de células únicas basados en técnicas de goteos (dscRNA-Seq). Produce resultados muy cercanos a los de Cellranger (que a su vez utiliza STAR en parte de sus procesos).</li>\n  <li><a href=\"https://www.kallistobus.tools/\">Kallisto/ bustools</a> - desarrollado por los creadores del método de cuantificación de transcriptoma, Kallisto.</li>\n  <li><a href=\"https://salmon.readthedocs.io/en/latest/alevin.html\">Alevin</a> - otro método de análisis de transcriptoma desarrollado por los autores de la herramienta ‘Salmon’.</li>\n</ul>\n\n<p>Utilizaremos Alevin <span class=\"citation\"><a href=\"#article-Alevin\">Srivastava <i>et al.</i> 2019</a></span> con propósitos demostrativos, sin embargo no avalamos ningún método en particular.</p>\n\n<blockquote class=\"comment\">\n  <comment-title>Comentario</comment-title>\n  <ul>\n    <li>Notas sobre la traducción y uso de términos técnicos\nEn este tutorial manejaremos algunos términos en el idioma original ya que simplificará la búsqueda posterior de información sobre el tema. Estas notas aparecerán en este tipo de recuadros y los términos estarán listados con la viñeta “•”.</li>\n    <li>scRNA-Seq,\tsecuenciación de ARN de células únicas</li>\n    <li>dscRNA-Sea, secuenciación de ARN de células únicas</li>\n    <li>basados en técnicas de goteos</li>\n    <li>RNA-Seq,\tSecuenciación de ARN</li>\n    <li>UMIs,\t\tIdentificadores únicos moleculares</li>\n  </ul>\n</blockquote>\n\n<h2 id=\"obtener-datos\">Obtener datos</h2>\n\n<p>Hemos puesto a tu disposición un conjunto de datos de muestra para que practiques con ellos. Estos datos son un subconjunto de lecturas de datos provenientes de ratones con restricción de crecimiento fetal <span class=\"citation\"><a href=\"#Bacon2018\">Bacon <i>et al.</i> 2018</a></span> (ver <a href=\"https://www.ebi.ac.uk/gxa/sc/experiments/E-MTAB-6945/results/tsne\">aquí</a> el estudio de células únicas disponible en la base de datos ‘Expression Atlas’ y <a href=\"https://www.ebi.ac.uk/arrayexpress/experiments/E-MTAB-6945/\">aquí</a> la remisión del proyecto a la plataforma ArrayExpress).</p>\n\n<p>Utilizamos la tecnología Drop-seq para este estudio. Sin embargo, el análisis que abordaremos en este tutorial es casi idéntico al que se realiza al utilizar la tecnología 10x. Estos datos no han sido curados meticulosamente, los datos del tutorial son algo caóticos ya que provienen de un experimento real. Necesitan filtrado urgentemente ya que contienen ARNs que le agregan ruido de fondo, sin embargo, te darán la oportunidad de practicar un análisis como si fuera el tuyo propio.</p>\n\n<p>Puedes descargar las lecturas de muestra y su anotación asociada desde el repositorio Zenodo. También puedes importar <a href=\"https://humancellatlas.usegalaxy.eu/u/wendi.bacon.training/h/input---pre-processing-with-alevin\">este historial de ejemplo</a>. ¿Cómo bajamos la resolución de estos archivos FASTQ? ¡Descubre aquí <a href=\"https://humancellatlas.usegalaxy.eu/u/wendi.bacon.training/h/pre-processing-with-alevin---part-1---how-to-downsample\">la historia</a> de cómo se llevó esto a cabo!\nAdicionalmente, necesitarás un transcriptoma (en formato FASTA) contra el cual podrás mapear tus lecturas, así como la información génica de cada transcrito (en un archivo tipo GTF). Adicionalmente, estos archivos están disponibles en el historial anteriormente mencionado, al igual que en los enlaces de Zenodo mostrados en la parte inferior de este párrafo, así que puede que tarden un buen rato en importarse. Puedes acceder a <a href=\"https://www.ensembl.org/info/data/ftp/index.html\">Ensembl si deseas bajar datos</a> para tu especie de interés.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Cargar datos - Parte 1</hands-on-title>\n\n  <ol>\n    <li>Crear un historial nuevo para este tutorial</li>\n    <li>\n      <p>Importar la tabla de diseño experimental, las lecturas de secuenciación 1 y 2, y los archivos GTF y fasta desde <a href=\"https://zenodo.org/record/4574153\">Zenodo</a></p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>https://zenodo.org/record/4574153/files/Experimental_Design.tabular\nhttps://zenodo.org/record/4574153/files/Mus_musculus.GRCm38.100.gtf.gff\nhttps://zenodo.org/record/4574153/files/Mus_musculus.GRCm38.cdna.all.fa.fasta\nhttps://zenodo.org/record/4574153/files/SLX-7632.TAAGGCGA.N701.s_1.r_1.fq-400k.fastq\nhttps://zenodo.org/record/4574153/files/SLX-7632.TAAGGCGA.N701.s_1.r_2.fq-400k.fastq\n</code></pre></div>      </div>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-importación-por-medio-de-enlaces\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-importación-por-medio-de-enlaces\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Consejo: Importación por medio de enlaces</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Copia los enlaces</li>   <li>     <p>Abre el manejador de carga de datos de Galaxy (<i class=\"fas fa-upload\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-upload</span> en la parte superior derecha del panel de herramientas)</p>   </li>   <li>Selecciona ‘Pegar/Traer datos’ <strong>Paste/Fetch Data</strong></li>   <li>     <p>Copia los enlaces en el campo de textos</p>   </li>   <li>     <p>Presiona ‘Iniciar’ <strong>Start</strong></p>   </li>   <li>     <p><strong>Close</strong> Cierra la ventana.</p>   </li>   <li>Galaxy utiliza los URLs como nombres de forma predeterminada , así que los tendrás que cambiar a algunos que sean más útiles o informativos. the window</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>Cambiar el nombre <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> de los conjuntos de datos</li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"question\">\n  <question-title>Preguntas</question-title>\n\n  <p>Dale un vistazo a los archivos que ahora están en tu historial.</p>\n  <ol>\n    <li>¿Cuál de los archivos FASTQ crees que contiene las secuencias de los códigos de barras?</li>\n    <li>Dada la metodología química que implica este estudio, ¿tienen las lecturas de códigos de barras/UMIs la longitud correcta?</li>\n    <li>¿A que se refiere el término ‘N701’?</li>\n  </ol>\n\n  <blockquote class=\"solution\">\n    <solution-title>Soluciones</solution-title>\n\n    <ol>\n      <li>La lectura 1 (SLX-7632.TAAGGCGA.N701.s_1.r_1.fq-400k)  contiene el código de barras de la célula y el UMI ya que es significativamente más corta (¡solo 20pb!), en comparación con r_2 que es la lectura más larga de transcrito. Cambiaremos de nombre a estos archivos y los llamaremos N701-Read1 y N701-Read2 para hacer más claro el análisis.</li>\n      <li>Puedes ver que la lectura 1 solo tiene 20pb de longitud, ya que el código de barras de Drop-Seq es de 12pb de longitud y el UMI de 8pb. ¡Esto es correcto! Pero ten precaución, la tecnología 10x Chromiun (y muchas otras) cambian sus reactivos (y longitudes de cebadores y adaptadores) con el paso del tiempo. En particular, ten esto en cuenta cuando accedas a datos públicos, verifica y asegurate de que estés utilizando los números correctos.</li>\n      <li>El término ‘N701’ se refiere al índice de la lectura. Esta muestra se tomó junto con otras seis, cada una de ellas se denotó con un índice Nextera (N70X). Posteriormente, esto te proporcionará información del lote del que provienen. Observa el archivo ‘Diseno experimental’ (‘Experimental design’), notarás que la muestra N701 proviene del timo de neonato macho tipo normal (‘wild-type’).</li>\n    </ol>\n  </blockquote>\n</blockquote>\n\n<h2 id=\"generar-un-mapa-de-correspondencia-de-transcritos-a-genes\">Generar un mapa de correspondencia de transcritos a genes</h2>\n\n<p>En el análisis de Secuenciación de ARN de células únicas tomamos por defecto la cuantificación a nivel génico, en lugar de a nivel transcrito. Esto significa que los niveles de expresión de una molécula de ARN con splicing alternativo son combinados con el propósito de generar valores a nivel génico. Las técnicas de scRNA-Seq basadas en goteo solo muestrean un extremo de cada transcrito, por tanto carecen de cobertura completa de moléculas, la cual es requerida para poder cuantificar con exactitud las diversas isoformas de los transcritos.</p>\n\n<p>Para poder generar las cuantificaciones a nivel génico con base en la cuantificación de transcriptoma, la herramienta Alevin y otras similares requieren de la conversión entre identificadores de transcritos e identificadores de genes. Podemos derivar una conversión transcritos-genes a partir de anotaciones génicas disponibles en plataformas de recursos genómicos como Ensembl. Los transcritos en este tipo de listas necesitan coincidir con los que usaremos posteriormente para construir un índice binario de transcriptoma. Si estás utilizando controles tipo ‘spike-in’ necesitarás añadirlos al transcriptoma y al mapeo de transcritos a genes.</p>\n\n<p>Notarás en tus datos de ejemplo que la anotación de referencia murina se obtuvo en formato GTF desde Ensembl. Esta anotación contiene genes, exones, transcritos y todo tipo de información adicional de las secuencias. Utilizaremos esta información para generar el mapeo de correspondencia transcrito/genes. Esto lo haremos por medio del traspaso de información a una herramienta que extrae exclusivamente los identificadores de transcrito que necesitamos.</p>\n\n<blockquote class=\"comment\">\n  <comment-title>Comentario</comment-title>\n  <p>Nota sobre la traducción y uso de términos técnicos</p>\n  <ul>\n    <li>Spike-in,\ttranscrito de ARN de cantidad y secuencia conocida utilizado para calibrar mediciones en ensayos de hibridación de ARN. Nos referiremos a este control con su nombre en el idioma inglés ya que su traducción no es utilizada comúnmente.</li>\n  </ul>\n</blockquote>\n\n<blockquote class=\"question\">\n  <question-title>Preguntas</question-title>\n\n  <p>¿Cuál de los ‘atributos’ en la última columna de los archivos GTF contiene los identificadores de transcrito y de gen?</p>\n\n  <blockquote class=\"tip\">\n    <tip-title>Una pequeña pista</tip-title>\n\n    <p>El archivo está organizado de tal modo que la última columna (con el nombre ‘Group’ en el encabezado) contiene una gran cantidad de información: attribute1 “información asociada con el atributo1”;attribute2 “información asociada con el atributo 2” etc.</p>\n  </blockquote>\n\n  <blockquote class=\"solution\">\n    <solution-title>Solución</solution-title>\n    <p>A gene_id y transcript_id les sigue “ensembl gene_id” y “ensembl transcript_id”</p>\n  </blockquote>\n</blockquote>\n\n<p>Ahora es el momento de analizar el archivo GTF utilizando el paquete de R <a href=\"https://bioconductor.org/packages/release/bioc/html/rtracklayer.html\">rtracklayer</a>. Este análisis proporcionará una tabla de conversión con un listado de identificadores de transcritos y sus genes correspondientes para hacer conteos. Adicionalmente, ya que generaremos nuestro propio índice binario (más sobre esto en secciones posteriores), también necesitaremos proporcionar nuestro archivo FASTA para que pueda ser filtrado y que al final solo contenga la información del transcriptoma que está contenida en el archivo GTF.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Generar un archivo FASTA filtrado y un mapa de correspondencia de transcritos a genes</hands-on-title>\n\n  <ol>\n    <li>Ejecutar la herramienta GTF2GeneList <span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/ebi-gxa/gtf2gene_list/_ensembl_gtf2gene_list/1.42.1+galaxy6\" title=\"GTF2GeneList tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>GTF2GeneList</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.42.1+galaxy6)</span> utilizando los siguiente parámetros:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Ensembl GTF file”</em>: <code class=\"language-plaintext highlighter-rouge\">GTF file in the history</code> <i class=\"fas fa-columns\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-history</span></li>\n        <li><em>“Feature type for which to derive annotation”</em>: <code class=\"language-plaintext highlighter-rouge\">transcript</code> (Tus secuencias provienen de secuenciación de transcriptoma, por tanto este es tu punto inicial)</li>\n        <li><em>“Field to place first in output table”</em>: <code class=\"language-plaintext highlighter-rouge\">transcript_id</code> (Esto da acceso a la columna que identificaste en la parte anterior)</li>\n        <li><em>“Suppress header line in output?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code> (La siguiente herramienta (Alevin) no toma encabezados)</li>\n        <li><em>“Comma-separated list of field names to extract from the GTF (default: use all fields)”</em>: <code class=\"language-plaintext highlighter-rouge\">transcript_id,gene_id</code> (Esto hace que la primera columna sea transpript_id, y la segunda sea gene_id. Por tanto, tu clave puede convertir transcritos a genes)</li>\n        <li><em>“Append version to transcript identifiers?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code> (Por lo general el archivo FASTA de Ensembl contiene esta información, y ya que necesitaremos que el transcriptoma en formato FASTA y la información de genes del archivo GTF trabajen en conjunto, necesitaremos añadir la información de uno al final del otro)</li>\n        <li><em>“Flag mitochondrial features?”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n        <li><em>“Filter a FASTA-format cDNA file to match annotations?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“FASTA-format cDNA/transcript file”</em>: <code class=\"language-plaintext highlighter-rouge\">FASTA file in your history</code> <i class=\"fas fa-columns\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-history</span></li>\n        <li><em>“Annotation field to match with sequences”</em>: <code class=\"language-plaintext highlighter-rouge\">transcript_id</code></li>\n      </ul>\n    </li>\n    <li>\n      <p>Cambiar el nombre <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> de la tabla de anotación a <code class=\"language-plaintext highlighter-rouge\">Map</code></p>\n    </li>\n    <li>Cambiar el nombre <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> del archivo FASTA filtrado - no comprimido a <code class=\"language-plaintext highlighter-rouge\">Filtered FASTA</code></li>\n  </ol>\n</blockquote>\n\n<h2 id=\"generar-el-índice-de-un-transcriptoma-y-cuantificar\">Generar el índice de un transcriptoma y cuantificar</h2>\n\n<p>Alevin reduce a un solo proceso los pasos requeridos para realizar dscRNA-Seq. Dichas herramientas requieren comparar las secuencias de tu muestra a una referencia que contenga todas las secuencias probables de transcritos (un ‘transcriptoma). Esto contendrá las secuencias biológicas de los transcritos conocidos en una especie determinada, y quizás también contendrá secuencias técnicas como ‘spike ins’.</p>\n\n<blockquote class=\"details\">\n  <details-title>¿Cómo trabaja Alevin?</details-title>\n\n  <p>Alevin necesita convertir las secuencias de texto contenidas dentro del formato FASTA a algo con lo que pueda realizar búsquedas rápidamente dentro del transcriptoma, ese ‘algo’ es un archivo llamado ‘índice’ (‘index’). El índice es un archivo binario (un tipo de archivos optimizados para el uso de ordenadores y que no es legible ‘por humanos’), pero permite que Alevin realice búsquedas rápidas. El índice puede variar entre experimentos debido al tipo de secuencias técnicas y biológicas que necesitamos incluir en él, y ya que frecuentemente queremos utilizar las referencias más actualizadas, ya sea que provengan de Ensembl o NCBI, a menudo pudiésemos terminar reconstruyendo los índices. El generar estos índices requiere mucho tiempo. Échale un vistazo al archivo FASTA no comprimido para que veas cómo es la estructura inicial.</p>\n\n</blockquote>\n\n<p>Ahora tenemos:</p>\n\n<ul>\n  <li>Lecturas de códigos de barras/UMIs</li>\n  <li>Lecturas de cDNA</li>\n  <li>Mapeo de correspondencias de transcritos a genes</li>\n  <li>Archivo FASTA filtrado</li>\n</ul>\n\n<p>Ahora podemos ejecutar Alevin. Esta herramienta no aparecerá en las búsquedas dentro de algunas de las instancias públicas. Si esto sucede, haz click sobre la pestaña Single Cell en la parte izquierda de la pantalla y desplázate hacia abajo hasta encontrar la herramienta Alevin. Consejo: Si haces click sobre las herramientas (tools) dentro de la opción ‘tutorial’ de Galaxy siempre tendrás la versión correcta de la herramienta. En este caso: Galaxy Version 1.3.0+galaxy2 - debe ser la versión por defecto; si no lo es, haz click sobre ‘Versiones’ (‘Versions’) y escoge dicha versión.</p>\n\n<figure id=\"figure-1\" style=\"max-width: 90%;\"><img src=\"../../images/scrna-casestudy/wab-tutorial-in-galaxy.png\" alt=\"La opción de tutorial está situada en la parte superior derecha de Galaxy. \" width=\"1513\" height=\"751\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/scrna-casestudy/wab-tutorial-in-galaxy.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figura 1</strong>:</span> La opción de tutorial</figcaption></figure>\n\n<figure id=\"figure-2\" style=\"max-width: 90%;\"><img src=\"../../images/scrna-casestudy/wab-tutorial-option-filler.png\" alt=\"La herramienta en el tutorial de Galaxy tiene un botón. \" width=\"1910\" height=\"920\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/scrna-casestudy/wab-tutorial-option-filler.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figura 2</strong>:</span> Haz click sobre la herramienta en el tutorial de Galaxy</figcaption></figure>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Practica: Ejecutando Alevin</hands-on-title>\n\n  <ol>\n    <li>\n      <p><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/bgruening/alevin/alevin/1.3.0+galaxy2\" title=\"Alevin tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Alevin</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.3.0+galaxy2)</span></p>\n\n      <blockquote class=\"question\">\n        <question-title>Preguntas</question-title>\n\n        <p>Intenta dar valores a los parámetros de Alevin utilizando lo que sabes por el momento.</p>\n\n        <blockquote class=\"tip\">\n          <tip-title>Sobre la direccionalidad de las cadenas de RNA (Strandness)</tip-title>\n\n          <p>La documentación sobre ‘Tipos de bibliotecas de fragmentos’ (‘Fragment Library Types‘) de de la herramienta salmón, el ejecutar el comando de Alevin (<a href=\"https://salmon.readthedocs.io/en/latest/library_type.html]\">salmon.readthedocs.io/en/latest/library_type.html</a> y <a href=\"https://salmon.readthedocs.io/en/latest/alevin.html\">salmon.readthedocs.io/en/latest/alevin.html</a>) nos serán de ayuda en este caso; aunque ten en cuenta que la imagen ahí se dibuja con el ARN 5’ en la parte superior, mientras que en este protocolo de scRNA-Seq el segmento polyA es capturado por su extremo 3’, y, por lo tanto, efectivamente la hebra inferior o inversa.)</p>\n        </blockquote>\n\n        <blockquote class=\"solution\">\n          <solution-title>Solución: valores de los parámetros</solution-title>\n          <ul>\n            <li><em>“Select a reference transcriptome from your history or use a built-in index?”</em>: <code class=\"language-plaintext highlighter-rouge\">Use one from the history</code>\n              <ul>\n                <li>Vas a generar el índice binario utilizando tu archivo FASTA filtrado</li>\n              </ul>\n            </li>\n            <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Transcripts FASTA file”</em>: <code class=\"language-plaintext highlighter-rouge\">Filtered FASTA</code></li>\n            <li><em>“Single or paired-end reads?”</em>: <code class=\"language-plaintext highlighter-rouge\">Paired-end</code></li>\n            <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“file1”</em>: <code class=\"language-plaintext highlighter-rouge\">N701-Read1</code></li>\n            <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“file2”</em>: <code class=\"language-plaintext highlighter-rouge\">N701-Read2</code></li>\n            <li><em>“Relative orientation of reads within a pair”</em>: <code class=\"language-plaintext highlighter-rouge\">Mates are oriented towards each other (IR)</code></li>\n            <li><em>“Specify the strandedness of the reads”</em>: <code class=\"language-plaintext highlighter-rouge\">read comes from the reverse strand (SR)</code></li>\n            <li><em>“Protocol”</em>: <code class=\"language-plaintext highlighter-rouge\">DropSeq Single Cell protocol</code></li>\n            <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Transcript to gene map file”</em>: <code class=\"language-plaintext highlighter-rouge\">Map</code></li>\n            <li><em>“Retrieve all output files”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n            <li>In <em>“Optional commands”</em>:\n              <ul>\n                <li><em>“dumpFeatures”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n                <li><em>“dumpMTX”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n              </ul>\n            </li>\n          </ul>\n        </blockquote>\n      </blockquote>\n    </li>\n  </ol>\n</blockquote>\n\n<blockquote class=\"comment\">\n  <comment-title>Comentario</comment-title>\n  <p>Notas sobre la traducción de algunos de los valores de los parámetros:\nEn este tutorial manejaremos algunos términos en el idioma original ya que simplificará la búsqueda posterior de información sobre el tema. Estas notas aparecerán en estos recuadros y los términos estarán listados con la viñeta “•”.</p>\n  <ul>\n    <li>“Select a reference transcriptome from your history or use a built-in index?”: Use one from the history</li>\n    <li>\n      <ul>\n        <li>“¿Seleccionar un transcriptoma de referencia desde tu historial o utilizar un índice pre-integrado?”: <code class=\"language-plaintext highlighter-rouge\">Utilizar uno del historial</code></li>\n      </ul>\n    </li>\n    <li>“Transcripts FASTA file”: <code class=\"language-plaintext highlighter-rouge\">Filtered FASTA</code></li>\n    <li>\n      <ul>\n        <li>“Archivo FASTA de transcritos”: <code class=\"language-plaintext highlighter-rouge\">FASTA filtrado</code></li>\n      </ul>\n    </li>\n    <li>“Single or paired-end reads?”: <code class=\"language-plaintext highlighter-rouge\">Paired-end</code></li>\n    <li>\n      <ul>\n        <li>“¿Lecturas single-end o paired-end?”: <code class=\"language-plaintext highlighter-rouge\">Paired-end</code></li>\n      </ul>\n    </li>\n    <li>“Relative orientation of reads within a pair”: <code class=\"language-plaintext highlighter-rouge\">Mates are oriented towards each other (IR)</code>`</li>\n    <li>\n      <ul>\n        <li>“Orientación relativa de las lecturas dentro de un par”: <code class=\"language-plaintext highlighter-rouge\">Las lecturas pares están orientadas unas hacia las otras (IR)</code>`</li>\n      </ul>\n    </li>\n    <li>“Specify the strandedness of the reads”: <code class=\"language-plaintext highlighter-rouge\">read comes from the reverse strand (SR)</code>`</li>\n    <li>\n      <ul>\n        <li>“Especificar la direccionalidad de las lecturas”: <code class=\"language-plaintext highlighter-rouge\">las lecturas provienen de las cadenas inversas (SR)</code>`</li>\n      </ul>\n    </li>\n    <li>“Retrieve all output files”: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n    <li>\n      <ul>\n        <li>“Recobrar todos los archivos de salida”: <code class=\"language-plaintext highlighter-rouge\">Sí</code>`</li>\n      </ul>\n    </li>\n  </ul>\n</blockquote>\n\n<blockquote class=\"comment\">\n  <comment-title>¿Qué sucede si estoy procesando una muestra 10x??</comment-title>\n\n  <p>En Alevin, “Protocol” (Protocolo) es el parámetro principal que debe cambiarse para una muestra 10X Chromium. Simplemente selecciona los reactivos correspondientes a la química de 10x en lugar de Drop-seq.</p>\n</blockquote>\n\n<p>Esta herramienta tomará algo de tiempo para ejecutarse. Alevin produce muchos archivos de salida, no utilizaremos todos estos archivos. Puedes consultar la <a href=\"https://salmon.readthedocs.io/en/latest/alevin.html\">documentación de Alevin</a> si deseas saber más sobre estos archivos, sin embargo, los archivos que más nos interesan son:</p>\n\n<ul>\n  <li>La matriz generada (quants_mat.mtx.gz - el conteo de genes y células)</li>\n  <li>Los identificadores de fila <code class=\"language-plaintext highlighter-rouge\">cell/ barcode</code> (quants_mat_rows.txt), y</li>\n  <li>Las etiquetas en la columna <code class=\"language-plaintext highlighter-rouge\">gene</code> (quants_mat_cols.txt).</li>\n</ul>\n\n<p>Este es el formato “matrix market” (MTX).</p>\n\n<blockquote class=\"question\">\n  <question-title>Preguntas</question-title>\n\n  <p>Echa un vistazo a los diversos archivos generados después de ejecutar Alevin. ¿Puedes localizar las siguientes dos cosas?…</p>\n  <ol>\n    <li>¿Cuál es la tasa de mapeo?</li>\n    <li>¿Cuántas células están presentes en la matriz de salida?</li>\n  </ol>\n\n  <blockquote class=\"solution\">\n    <solution-title>Solución</solution-title>\n\n    <ol>\n      <li>Inspecciona <i class=\"far fa-eye\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-eye</span> el archivo <i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> meta_info.json. Puedes ver que la tasa de mapeo es un insignificante <code class=\"language-plaintext highlighter-rouge\">24.75%</code>. Esta tasa es terrible. ¿Por qué sucede esto? Recuerda que este archivo fue submuestreado, siendo específicos, solo tomamos las últimas 400,000 lecturas del archivo FASTQ. La tasa general de mapeo del archivo es de alrededor del 50%, que sigue siendo una tasa muy baja, pero en general se pueden esperar tasas de mapeos ligeramente menores para muestras que fueron procesadas durante los inicios de las técnicas Drop-Seq y la secuenciación de ARN de células únicas. Actualmente las muestras procesadas con la técnica 10x son mucho mejores. Después de todo, los datos que estamos utilizando son reales, no son datos de prueba.</li>\n      <li>Inspecciona <i class=\"far fa-eye\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-eye</span> el archivo <i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> ‘quants_mat_rows.txt’, y podrás ver que contiene <code class=\"language-plaintext highlighter-rouge\">2163</code> líneas. Las filas hacen referencia a las células en la matriz de correspondencia de células a genes. Según esta estimación (aproximada), tu muestra contiene 2163 células.</li>\n    </ol>\n\n  </blockquote>\n\n</blockquote>\n\n<blockquote class=\"warning\">\n  <warning-title>De aquí en adelante selecciona la entrada apropiada.</warning-title>\n  <p>Asegurate de usar el archivo <strong>quants_mat.mtx.gz</strong>, NO EL ARCHIVO <em>quants_tier.mtx.gz</em>.</p>\n</blockquote>\n\n<p><i class=\"far fa-thumbs-up\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">congratulations</span> Felicidades - ¡has generado una matriz de expresión! Podríamos terminar en este punto, pero es necesario verificar la calidad de los datos, y una de las cosas que podemos hacer es visualizar un gráfico de rangos de los códigos de barras.</p>\n\n<h1 id=\"control-de-calidad-básico\">Control de calidad básico</h1>\n\n<p>La pregunta que buscamos contestar aquí es: “En su mayoría, ¿tenemos una sola célula por gota?”. Este es el principal objetivo, pero no es del todo sencillo obtener exactamente una sola célula por cada gota. En algunas ocasiones casi ninguna célula logra depositarse en las gotas, en otras ocasiones tenemos demasiadas células por gota. Cuando menos deberíamos poder distinguir fácilmente las gotas que contienen células de las que no las contienen.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Generar un gráfico inicial de control de calidad (QC)</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/ebi-gxa/droplet_barcode_plot/_dropletBarcodePlot/1.6.1+galaxy2\" title=\"Droplet barcode rank plot tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Droplet barcode rank plot</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.6.1+galaxy2)</span> Gráfico de rangos de códigos de barras obtenido por técnicas de goteo (Droplet barcode rank plot) con los siguientes parámetros:\n      <ul>\n        <li><em>“Input MTX-format matrix?”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“A two-column tab-delimited file, with barcodes in the first column and frequencies in the second”</em>: <code class=\"language-plaintext highlighter-rouge\">raw_cb_frequencies.txt</code></li>\n        <li><em>“Label to place in plot title”</em>: <code class=\"language-plaintext highlighter-rouge\">Barcode rank plot (raw barcode frequencies)</code></li>\n      </ul>\n    </li>\n    <li>Cambiar el nombre <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> a la imagen de salida <code class=\"language-plaintext highlighter-rouge\">Barcode Plot - raw barcode frequencies</code></li>\n  </ol>\n</blockquote>\n\n<figure id=\"figure-3\" style=\"max-width: 90%;\"><img src=\"../../images/scrna-casestudy/wab-raw_barcodes-400k.png\" alt=\"raw droplet barcode plots-400k. \" width=\"1000\" height=\"600\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/scrna-casestudy/wab-raw_barcodes-400k.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figura 3</strong>:</span> Subconjunto de datos crudos, 400k cadenas</figcaption></figure>\n\n<p>La imagen aquí generada (4000k) no es muy informativa - pero ten en cuenta que tan solo estás manejando una fracción de las lecturas. Si procesas la muestra completa (que involucra los mismos pasos mencionados en la parte superior, pero que tardaría mucho más tiempo) obtendrás la imagen siguiente.</p>\n\n<figure id=\"figure-4\" style=\"max-width: 90%;\"><img src=\"../../images/scrna-casestudy/wab-raw_barcodes-total.png\" alt=\"raw droplet barcode plots-total. \" width=\"1000\" height=\"600\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/scrna-casestudy/wab-raw_barcodes-total.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figura 4</strong>:</span> Muestra completa - 32,579,453 lecturas - datos crudos</figcaption></figure>\n\n<p>Esta es la formulación del gráfico de código de barras que basamos en una <a href=\"https://github.com/COMBINE-lab/salmon/issues/362#issuecomment-490160480\">discusión</a> que entablamos con miembros de la comunidad científica. Los gráficos de líneas suaves de la izquierda son los principales; estos gráficos muestran, clasificados de los más bajos a los más altos, los conteos de UMIs para códigos de barras individuales. Esperamos una fuerte caída entre las gotas que contienen células y las gotas vacías o que solo contienen restos celulares. Este no es un conjunto de datos ideal, así que en perspectiva, en un mundo ideal un conjunto de datos muy limpio proveniente de procesados 10x, los datos se asemejarían un poco más a la siguiente imagen del atlas de pulmón (ver <a href=\"https://www.ebi.ac.uk/gxa/sc/experiments/E-MTAB-6653/results/tsne\">aquí</a> el estudio del Atlas de Expresión de Células Únicas y la remisión del proyecto <a href=\"https://www.ebi.ac.uk/arrayexpress/experiments/E-MTAB-6653/\">aquí</a>).</p>\n\n<figure id=\"figure-5\" style=\"max-width: 90%;\"><img src=\"../../images/scrna-casestudy/wab-lung-atlas-barcodes-raw.png\" alt=\"raw droplet barcode plots - lung atlas. \" width=\"1000\" height=\"600\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/scrna-casestudy/wab-lung-atlas-barcodes-raw.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figura 5</strong>:</span> Datos ‘bonitos’ - crudos</figcaption></figure>\n\n<p>En este gráfico puedes ver más claramente una flexión tipo “rodilla”, mostrando el corte entre las gotas vacías y las gotas que contienen células.</p>\n\n<p>A la derecha encontramos los gráficos de densidad de la primera, y los umbrales generados ya sea utilizando <a href=\"https://bioconductor.org/packages/release/bioc/html/DropletUtils.html\">dropletUtils</a> o por medio del método descrito en la discusión que se mencionó con anterioridad (en la parte superior). Podremos utilizar cualquiera de estos umbrales para seleccionar células, asumiendo que cualquier medición con conteos menores es una célula válida. Alevin hace algo similar por defecto, y podemos aprender algo de esto graficando únicamente los códigos de barras que retiene Alevin.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Obtener el gráfico de código de barras de Alevin</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/ebi-gxa/droplet_barcode_plot/_dropletBarcodePlot/1.6.1+galaxy2\" title=\"Droplet barcode rank plot tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Droplet barcode rank plot</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.6.1+galaxy2)</span> Genera el gráfico de código de barras basado en goteos utilizando los siguientes parámetros:\n      <ul>\n        <li><em>“Input MTX-format matrix?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n        <li><em>“Matrix-market format matrix file, with cells by column (overrides –barcode-frequencies if supplied)”</em>: <code class=\"language-plaintext highlighter-rouge\">quants_mat.mtx</code></li>\n        <li><em>“For use with –mtx-matrix: force interpretation of matrix to assume cells are by row, rather than by column (default)”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n        <li><em>“Label to place in plot title”</em>: <code class=\"language-plaintext highlighter-rouge\">Barcode rank plot (Alevin-processed)</code></li>\n        <li><em>“Number of bins used in barcode count frequency distribution”</em>: <code class=\"language-plaintext highlighter-rouge\">50</code></li>\n        <li><em>“Above-baseline multiplier to calculate roryk threshold”</em>: <code class=\"language-plaintext highlighter-rouge\">1.5</code></li>\n      </ul>\n    </li>\n    <li>Cambiar el nombre <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> de la imagen de salida <code class=\"language-plaintext highlighter-rouge\">Barcode Plot - Alevin processed barcodes</code></li>\n  </ol>\n</blockquote>\n\n<figure id=\"figure-6\" style=\"max-width: 90%;\"><img src=\"../../images/scrna-casestudy/wab-alevin-barcodes-400k.png\" alt=\"raw droplet barcode plots - 400k. \" width=\"1000\" height=\"600\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/scrna-casestudy/wab-alevin-barcodes-400k.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figura 6</strong>:</span> 400k sub-muestreo - Alevin procesado</figcaption></figure>\n\n<p>Y la muestra completa se ve como la siguiente figura:</p>\n\n<figure id=\"figure-7\" style=\"max-width: 90%;\"><img src=\"../../images/scrna-casestudy/wab-alevin-barcodes-total.png\" alt=\"raw droplet barcode plots - total. \" width=\"1000\" height=\"600\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/scrna-casestudy/wab-alevin-barcodes-total.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figura 7</strong>:</span> Muestra total - 32,579,453 lecturas - Alevin procesado</figcaption></figure>\n\n<p>Y concluyendo, he aquí el gráfico del atlas de pulmón.</p>\n\n<figure id=\"figure-8\" style=\"max-width: 90%;\"><img src=\"../../images/scrna-casestudy/wab-alevin-barcodes-lung.png\" alt=\"raw droplet barcode plots - total. \" width=\"1000\" height=\"600\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/scrna-casestudy/wab-alevin-barcodes-lung.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figura 8</strong>:</span> Datos bonitos - Alevin procesado</figcaption></figure>\n\n<p>Debes ver una caída casi vertical de la curva, que es donde Alevin truncó la distribución (después de haber excluido muchos códigos de barra celulares que tuvieron &lt;10 UMI, Alevin posteriormente selecciona un umbral basándose en la curva y elimina los códigos de barras con menos UMIs)</p>\n\n<p>Este método de ‘detección intensa’ funciona relativamente bien en experimentos con características relativamente sencillas. Pero algunas poblaciones presentan dificultades (¡como en nuestra muestra!). Por ejemplo, si nos basamos únicamente en los conteos de códigos de barras, puede ocurrir que subpoblaciones de células pequeñas no se puedan distinguir de las gotas vacías. Algunas bibliotecas producen múltiples flexiones tipo “rodilla” para múltiples subpoblaciones. El método <a href=\"https://genomebiology.biomedcentral.com/articles/10.1186/s13059-019-1662-y\">emptyDrops</a> se ha convertido en una forma popular de lidiar con este problema. EmptyDrops retiene los códigos de barras con conteos altos, pero también añade los códigos de barras que pueden ser estadísticamente diferenciados de los perfiles ambientales, incluso si los conteos totales son similares. Para que podamos ejecutar emptyDrops (o cualquier herramienta de tu elección que logre aplicar umbrales biológicamente relevantes), primero necesitamos volver a ejecutar Alevin, pero previniendo que este aplique sus propios umbrales, ya que no son los óptimos.</p>\n\n<p>Para poder utilizar emptyDrops de manera efectiva, necesitamos regresar y volver a ejecutar Alevin previniendo que aplique sus propios umbrales. Haz click sobre el icono de ‘volver a ejecutar’ en cualquier salida de Alevin dentro de tu historial ya que casi todos los parámetros son los mismos que antes, con la excepción de que necesitas cambiar los valores siguientes:</p>\n\n<h2 id=\"generar-una-matriz-sin-procesamiento-en-un-formato-utilizable\">Generar una matriz sin procesamiento en un formato utilizable</h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Prevenir que Alevin utilice sus propios umbrales</hands-on-title>\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/bgruening/alevin/alevin/1.3.0+galaxy2\" title=\"Alevin tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Alevin</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.3.0+galaxy2)</span> (Haz clic sobre la última salida de Alevin para volver a ejecutar)\n      <ul>\n        <li><em>“Optional commands”</em></li>\n        <li><em>“keepCBFraction”</em>: ‘1’ - por ejemplo conservarlos todos</li>\n        <li><em>“freqThreshold”</em>: ‘3’ - Esto solo eliminará los códigos de barras celulares que tengan una frecuencia menor de 3, un criterio bajo de aceptación, pero es una forma útil de evitar procesar un monton de códigos de barras que es casi seguro que estan vacíos.</li>\n      </ul>\n    </li>\n  </ol>\n\n  <!--SNIPPET-->\n  <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-para-volver-a-ejecutar-una-herramienta\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-para-volver-a-ejecutar-una-herramienta\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Consejo: Para volver a ejecutar una herramienta</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ol>   <li><strong>Expande</strong> uno de los conjuntos de datos de la salida de la herramienta haciendo clic sobre él</li>   <li><strong>Selecciona</strong> volver a ejecutar <i class=\"fas fa-redo\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-refresh</span> de la herramienta</li> </ol>   <p>Esto es de utilidad si quieres volver a correr la herramienta variando ligeramente los valores de los parámetros, o si deseas verificar la configuración de parámetros que utilizaste.</p> </blockquote>\n  <p><!--END_SNIPPET--></p>\n</blockquote>\n\n<blockquote class=\"question\">\n  <question-title>Pregunta</question-title>\n\n  <p>¿Cuántas células hay ahora en la salida?</p>\n\n  <blockquote class=\"solution\">\n    <solution-title>Solución</solution-title>\n\n    <ol>\n      <li>¡Ahora hay <code class=\"language-plaintext highlighter-rouge\">22539</code> células en quants_mat_rows! Muchas más que las <code class=\"language-plaintext highlighter-rouge\">2163</code> que Alevin filtró. ¡Esto necesita ser filtrado en serio con emptyDrops!</li>\n    </ol>\n\n  </blockquote>\n\n</blockquote>\n\n<p>Alevin da salida a un formato MTX, el cual puede ser la entrada del paquete dropletUtils y procesarse en emptyDrops. Desafortunadamente la matriz tiene una orientación equivocada. La matriz no puede ser procesada por herramientas cuya entrada son archivos como los que produce el software 10X. Necesitamos ‘transformar’ la matriz de tal forma que las células esten en columnas y los genes en filas.</p>\n\n<blockquote class=\"warning\">\n  <warning-title></warning-title>\n  <p>¡No mezcles los archivos de distintas ejecuciones de Alevin! Utiliza la última ejecución, la cual tiene los números más altos en el historial.</p>\n</blockquote>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Transformación de la matriz</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/ebi-gxa/salmon_kallisto_mtx_to_10x/_salmon_kallisto_mtx_to_10x/0.0.1+galaxy5\" title=\"salmonKallistoMtxTo10x tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>salmonKallistoMtxTo10x</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.0.1+galaxy5)</span> con los siguientes parámetros:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“.mtx-format matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">quants_mat.mtx.gz</code> (la salida de la herramienta <strong>Alevin</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Tab-delimited genes file”</em>: <code class=\"language-plaintext highlighter-rouge\">quants_mat_cols.txt</code> (la salida de la herramienta <strong>Alevin</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Tab-delimited barcodes file”</em>: <code class=\"language-plaintext highlighter-rouge\">quants_mat_rows.txt</code> (la salida de la herramienta <strong>Alevin</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n      </ul>\n    </li>\n    <li>Cambiar el nombre <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> de ‘salmonKallistoMtxTo10x….:genes’ a <code class=\"language-plaintext highlighter-rouge\">Gene table</code></li>\n    <li>Cambiar el nombre <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> de ‘salmonKallistoMtxTo10x….:barcodes’ a <code class=\"language-plaintext highlighter-rouge\">Barcode table</code></li>\n    <li>Cambiar el nombre <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> de ‘salmonKallistoMtxTo10x….:matrix’ a <code class=\"language-plaintext highlighter-rouge\">Matrix table</code></li>\n  </ol>\n</blockquote>\n\n<p>La salida es una matriz que contendrá la orientación correcta para poder ser utilizada por las herramientas en el análisis subsecuente. Sin embargo, nuestra matriz se ve un poco dispersa, por ejemplo, haz clic en <code class=\"language-plaintext highlighter-rouge\">Gene table</code>. No se tú, pero a mí me costaría entablar una buena discusión biológica utilizando únicamente los gene_ids de Ensembl. Lo que en realidad me gustaría es tener información más ‘humanamente entendible’, como la del tipo ‘GAPDH’ o con otro tipo de acrónimos de genes; también me gustaría tener información sobre genes mitocondriales para poder evaluar si mis células están bajo algún tipo de estrés o no. Con el objetivo de preparar nuestros datos para meterlos a emptyDrops, vamos a combinar esta información y depositarla en un objeto; ahora es más sencillo añadir dicha información.</p>\n\n<h2 id=\"añadir-metadatos-de-genes\">Añadir metadatos de genes</h2>\n\n<blockquote class=\"question\">\n  <question-title>Pregunta</question-title>\n\n  <p>¿Dónde podemos encontrar esta información sobre los genes?</p>\n\n  <blockquote class=\"solution\">\n    <solution-title>Solución</solution-title>\n\n    <p>Dentro de un archivo GTF, nuestro viejo amigo.</p>\n\n  </blockquote>\n\n</blockquote>\n\n<blockquote class=\"question\">\n  <question-title>Pregunta</question-title>\n\n  <p>¿Cual de los ‘atributos’ dentro de la última columna del archivo contiene el acrónimo de los genes?</p>\n\n  <blockquote class=\"solution\">\n    <solution-title>Solución</solution-title>\n\n    <p>gene_name</p>\n\n  </blockquote>\n\n</blockquote>\n\n<p>Ahora vamos a volver a ejecutar la herramienta que extrae información contenida dentro de nuestro archivo GTF.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Generar información de genes</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/ebi-gxa/gtf2gene_list/_ensembl_gtf2gene_list/1.42.1+galaxy6\" title=\"GTF2GeneList tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>GTF2GeneList</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.42.1+galaxy6)</span> con los siguientes parámetros:\n      <ul>\n        <li><em>“Feature type for which to derive annotation”</em>: <code class=\"language-plaintext highlighter-rouge\">gene</code></li>\n        <li><em>“Field to place first in output table”</em>: <code class=\"language-plaintext highlighter-rouge\">gene_id</code></li>\n        <li><em>“Suppress header line in output?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n        <li><em>“Comma-separated list of field names to extract from the GTF (default: use all fields)”</em>: <code class=\"language-plaintext highlighter-rouge\">gene_id,gene_name,mito</code></li>\n        <li><em>“Append version to transcript identifiers?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n        <li><em>“Flag mitochondrial features?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code> - nota, esto va a rellenar automáticamente campos con un montón de genes asociados a la mitocondria (que se encontraron en el archivo GTF). ¡Esto es bueno!</li>\n        <li><em>“Filter a FASTA-format cDNA file to match annotations?”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code> - - no lo necesitamos, ¡hemos terminado con nuestro archivo FASTA!</li>\n      </ul>\n    </li>\n    <li>Verifica que el archivo de salida sea del tipo <code class=\"language-plaintext highlighter-rouge\">tabular</code>. Si no lo es, cambia el tipo de archivo haciendo click sobre ‘Editar atributos’<i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> que está en el historial del conjunto de datos (como si estuvieras cambiando el nombre al archivo). Después haz click sobre <code class=\"language-plaintext highlighter-rouge\">Datatypes</code> y teclea <code class=\"language-plaintext highlighter-rouge\">tabular</code>. Haz clic sobre <code class=\"language-plaintext highlighter-rouge\">Change datatype</code>.)</li>\n    <li>Cambiar el nombre <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> de la tabla de anotación a <code class=\"language-plaintext highlighter-rouge\">Gene Information</code></li>\n  </ol>\n</blockquote>\n\n<p>Inspecciona <i class=\"far fa-eye\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-eye</span> el objeto <strong>Gene Information</strong> del historial. Ahora has incluido un nuevo campo para gene_id, esto incluye el nombre de los genes y una columna para información mitocondrial (false = not mitochondrial, true = mitochondrial). Necesitamos añadir esta información a la tabla de salida ‘Gene table’ proveniente de la herramienta salmonKallistoMtxto10x. Sin embargo, necesitamos mantener la tabla ‘Gene table’ en el mismo orden, ya que se hace referencia a ella en las filas de la tabla ‘Matrix table’.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Combinar la tabla de genes MTX con la información de los genes</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"join1\" title=\"Join two Datasets tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Join two Datasets</strong></span> con los siguientes parámetros:\n      <ul>\n        <li><em>“Join”</em>: <code class=\"language-plaintext highlighter-rouge\">Gene Table</code></li>\n        <li><em>“Using column”</em>: <code class=\"language-plaintext highlighter-rouge\">Column: 1</code></li>\n        <li><em>“with”</em>: <code class=\"language-plaintext highlighter-rouge\">Gene Information</code></li>\n        <li><em>“and column”</em>: <code class=\"language-plaintext highlighter-rouge\">Column: 1</code></li>\n        <li><em>“Keep lines of first input that do not join with second input”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n        <li><em>“Keep lines of first input that are incomplete”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n        <li><em>“Fill empty columns”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n        <li><em>“Keep the header lines”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n      </ul>\n\n      <p>Si inspeccionas <i class=\"far fa-eye\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-eye</span> el objeto, verás que hemos unido estas tablas y que ahora tiene algunos pocos gene_id repetidos. Eliminemos estas repeticiones manteniendo a su vez el orden original de la tabla ‘Gene Table’.</p>\n    </li>\n    <li><span class=\"tool\" data-tool=\"Cut1\" title=\"Cut columns from a table tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Cut columns from a table</strong></span> con los siguientes parámetros:\n      <ul>\n        <li><em>“Cut columns”</em>: <code class=\"language-plaintext highlighter-rouge\">c1,c4,c5</code></li>\n        <li><em>“Delimited by”</em>: <code class=\"language-plaintext highlighter-rouge\">Tab</code></li>\n        <li><em>“From”</em>: la salida de la herramienta <strong>Join two Datasets</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span></li>\n      </ul>\n    </li>\n    <li>Cambiar el nombre <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> de la salida a <code class=\"language-plaintext highlighter-rouge\">Annotated Gene Table</code></li>\n  </ol>\n</blockquote>\n\n<p>Inspecciona <i class=\"far fa-eye\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-eye</span> tu tabla <code class=\"language-plaintext highlighter-rouge\">Annotated Gene Table</code>. ¡Esto es más parecido a lo que buscamos! Tenemos <code class=\"language-plaintext highlighter-rouge\">gene_id</code>, <code class=\"language-plaintext highlighter-rouge\">gene_name</code>, y <code class=\"language-plaintext highlighter-rouge\">mito</code>. ¡Ahora regresemos a nuestro trayecto inicial con rumbo hacia emptyDrops y su forma sofisticada de utilizar umbrales para detectar gotas vacías!</p>\n\n<h1 id=\"emptydrops\">emptyDrops</h1>\n\n<p>La herramienta emptyDrops <span class=\"citation\"><a href=\"#article-emptyDrops\">Lun <i>et al.</i> 2019</a></span> trabaja con un tipo específico de objeto R llamado SingleCellExperiment. Necesitamos convertir nuestros archivos transformados MTX a este tipo de objetos, esto lo haremos utilizando la herramienta Read10x de DropletUtils:</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Convertir al formato SingleCellExperiment</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/ebi-gxa/dropletutils_read_10x/dropletutils_read_10x/1.0.3+galaxy2\" title=\"DropletUtils Read10x tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>DropletUtils Read10x</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.0.3+galaxy2)</span> con los siguientes parámetros:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Expression matrix in sparse matrix format (.mtx)”</em>: <code class=\"language-plaintext highlighter-rouge\">Matrix table</code></li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Gene Table”</em>: <code class=\"language-plaintext highlighter-rouge\">Annotated Gene Table</code></li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Barcode/cell table”</em>: <code class=\"language-plaintext highlighter-rouge\">Barcode table</code></li>\n        <li><em>“Should metadata file be added?”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n      </ul>\n    </li>\n    <li>Cambiar el nombre <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> de salida: <code class=\"language-plaintext highlighter-rouge\">SCE Object</code></li>\n  </ol>\n</blockquote>\n\n<p>¡Fantástico! Ya hemos convertido la matriz en el objeto que ocupamos, siendo más específicos, la hemos convertido al formato SingleCellExperiment, ¡Ahora podemos ejecutar emptyDrops! Pero primero deshagámonos de esas gotas que no contienen células.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>emptyDrops</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/ebi-gxa/dropletutils_empty_drops/dropletutils_empty_drops/1.0.3+galaxy1\" title=\"DropletUtils emptyDrops tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>DropletUtils emptyDrops</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.0.3+galaxy1)</span> con los siguientes parámetros:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“SingleCellExperiment rdata object”</em>: <code class=\"language-plaintext highlighter-rouge\">SCE Object</code></li>\n        <li><em>“Should barcodes estimated to have no cells be removed from the output object?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n      </ul>\n    </li>\n    <li>\n      <p>Cambiar el nombre <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> de la salida de <code class=\"language-plaintext highlighter-rouge\">serialised SingleCellExperiment</code> a <code class=\"language-plaintext highlighter-rouge\">Stringent-Object</code></p>\n    </li>\n    <li>Cambiar el nombre <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> de <code class=\"language-plaintext highlighter-rouge\">tabular output</code> a <code class=\"language-plaintext highlighter-rouge\">Stringent-Tabular Output</code></li>\n  </ol>\n</blockquote>\n\n<blockquote class=\"question\">\n  <question-title>Pregunta</question-title>\n\n  <p>¿Cuántos códigos de barras de células quedan después de procesar emptyDrops? ¿Por qué será esto?</p>\n\n  <blockquote class=\"tip\">\n    <tip-title>Pista</tip-title>\n    <p>Si haces clic sobre el <code class=\"language-plaintext highlighter-rouge\">Stringent-Object</code> en el historial <i class=\"fas fa-columns\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-history</span>, el texto de la ventana dice <code class=\"language-plaintext highlighter-rouge\">22 barcodes</code> o algo similar.  ¿Por qué es tan bajo?\nToma en consideración, ¿Es este un conjunto de datos completo?</p>\n  </blockquote>\n\n  <blockquote class=\"solution\">\n    <solution-title>Solución</solution-title>\n\n    <p>Recuerda que este conjunto de datos está submestreado. Si observas detenidamente los parámetros de emptyDrops, verás que la herramienta estableció un umbral mínimo de 100 UMI. Analizando los gráficos de códigos de barras mostrados en este tutorial, para la muestra de 400k lecturas, verás que este umbral es demasiado riguroso para la muestra submuestreada. Saliendo de dudas, este umbral mínimo daría como resultado <code class=\"language-plaintext highlighter-rouge\">3011</code> códigos de barras para la muestra total.</p>\n\n  </blockquote>\n\n</blockquote>\n\n<p>Ejecutemos de nuevo y cambiemos parámetros; volvamos a ejecutar la herramienta con un umbral mínimo más laxo.</p>\n\n<blockquote class=\"details\">\n  <details-title>¿Estás trabajando en equipo? ¡Hora de tomar decisiones!</details-title>\n  <p>Si estáis trabajando en equipo en este punto tenéis la oportunidad de tomar diversas rutas, la primera utilizando un control y el resto variando números para que podáis comparar resultados a lo largo de los tutoriales.</p>\n  <ul>\n    <li>Variable: <strong>UMI count lower bound</strong></li>\n    <li>Control:  <code class=\"language-plaintext highlighter-rouge\">5</code></li>\n    <li>Todos los demás: Tomad en consideración los gráficos de rangos de códigos de barras y seleccionad diversos límites inferiores.</li>\n  </ul>\n</blockquote>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>emptyDrops - ¡Intentemoslo de nuevo!</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/ebi-gxa/dropletutils_empty_drops/dropletutils_empty_drops/1.0.3+galaxy1\" title=\"DropletUtils emptyDrops tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>DropletUtils emptyDrops</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.0.3+galaxy1)</span> con los siguiente parámetros:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“SingleCellExperiment rdata object”</em>: <code class=\"language-plaintext highlighter-rouge\">SCE Object</code></li>\n        <li><em>“UMI count lower bound”</em>: <code class=\"language-plaintext highlighter-rouge\">5</code> - aquí puedes usar diversos valores y ver que sucede</li>\n        <li><em>“Should barcodes estimated to have no cells be removed from the output object?”</em>: <code class=\"language-plaintext highlighter-rouge\">Yes</code></li>\n      </ul>\n    </li>\n    <li>\n      <p>Cambiar el nombre <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> de la salida <code class=\"language-plaintext highlighter-rouge\">serialised SingleCellExperiment</code> a <code class=\"language-plaintext highlighter-rouge\">&lt;pon tu número aquí&gt;UMI-Object</code></p>\n    </li>\n    <li>Cambiar el nombre <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> de la salida <code class=\"language-plaintext highlighter-rouge\">tabular output</code> a <code class=\"language-plaintext highlighter-rouge\">&lt;pon tu número aquí&gt;UMI-Tabular Output</code></li>\n  </ol>\n</blockquote>\n\n<p>¡En este punto debes tener <code class=\"language-plaintext highlighter-rouge\">111</code> códigos de barras! Ahora tienes una matriz de expresión anotada y lista para los procesos y análisis subsecuentes, ¡Bien hecho! Sin embargo, en los siguientes tutoriales nos vincularemos al uso de una herramienta llamada Scanpy. Por tanto, necesitarás convertir este objeto SingleCellExperiment a un formato llamado <code class=\"language-plaintext highlighter-rouge\">annData</code>, el cual es una variante de un archivo que utiliza un formato llamado <code class=\"language-plaintext highlighter-rouge\">hdf5</code>.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Conversión al formato AnnData</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/ebi-gxa/sceasy_convert/sceasy_convert/0.0.5+galaxy1\" title=\"SCEasy convert tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>SCEasy convert</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.0.5+galaxy1)</span> con los siguientes parámetros:\n      <ul>\n        <li><em>“Direction of conversion”</em>: <code class=\"language-plaintext highlighter-rouge\">SingleCellExperiment to AnnData</code></li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Input object in SingleCellExperiment RDS format”</em>: <code class=\"language-plaintext highlighter-rouge\">&lt;pon tu número aquí&gt;UMI-Object</code></li>\n        <li><em>“Name of the assay to be transferred as main layer”</em>: <code class=\"language-plaintext highlighter-rouge\">counts</code></li>\n      </ul>\n    </li>\n    <li>Cambiar el nombre <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> de la salida a <code class=\"language-plaintext highlighter-rouge\">N701-400k-AnnData</code></li>\n  </ol>\n\n</blockquote>\n\n<p><i class=\"far fa-thumbs-up\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">congratulations</span> ¡Felicidades! Tu objeto está listo para el pipeline de Scanpy. Ahora puedes verificar tu trabajo comparándolo con el mostrado en este <a href=\"https://humancellatlas.usegalaxy.eu/u/wendi.bacon.training/h/pre-processing-with-alevin---part-1---answer-key\">historial de ejemplo</a>.</p>\n\n<p>Sin embargo, quizá quieras combinar este objeto con otros parecidos a él. Por ejemplo, es posible que hayas procesado 5 muestras, y que hayas empezado a partir de 10 archivos FASTQ…</p>\n\n<h1 id=\"combinar-archivos-fastq\">Combinar archivos FASTQ</h1>\n\n<p>Esta muestra es una de siete iniciales. Entonces, puedes utilizar un <a href=\"https://humancellatlas.usegalaxy.eu/u/wendi.bacon.training/w/pre-processing-with-alevin---part-1-imported-from-uploaded-file\">flujo de trabajo</a> para procesar los otros <a href=\"https://humancellatlas.usegalaxy.eu/u/wendi.bacon.training/h/alevin-tutorial---all-samples---400k\">12 archivos FASTQ submuestreados</a>. Nota que, por desgracia, la muestra submuestreada N705 contiene mayormente lecturas chatarra; por tanto, emptyDrops no funciona. Debido a esto, yo la procesé con Alevin. Por supuesto, la muestra completa funciona bien con emptyDrops. Va a tomar un buen rato el procesado de todas estas muestras, así que mientras tanto ve por uno, o varios cafecitos… O aún mejor, <a href=\"https://humancellatlas.usegalaxy.eu/u/wendi.bacon.training/h/pre-processing-with-alevin---part-2---input-generation\">yo ya procesé las muestras</a>, y las deposité en un <a href=\"https://humancellatlas.usegalaxy.eu/u/wendi.bacon.training/h/pre-processing-with-alevin---part-2---input\">nuevo historial</a> para que lo puedas importar y empezar con un historial limpio. Alternativamente, puedes obtener estos datos desde el repositorio Zenodo.</p>\n\n<h2 id=\"datos\">Datos</h2>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Cargar datos - Combinar archivos</hands-on-title>\n\n  <ol>\n    <li>Crear un historial huevo para este tutorial (si es que no estás importando el historial mencionado en la parte superior)</li>\n    <li>\n      <p>Importar los diversos archivos AnnData y la tabla de diseño experimental\n desde <a href=\"https://zenodo.org/record/4574153#.YD56YS-l2uU\">Zenodo</a></p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>https://zenodo.org/record/4574153/files/Experimental_Design.tabular\nhttps://zenodo.org/record/4574153/files/N701-400k-AnnData.h5ad\nhttps://zenodo.org/record/4574153/files/N702-400k-AnnData.h5ad\nhttps://zenodo.org/record/4574153/files/N703-400k-AnnData.h5ad\nhttps://zenodo.org/record/4574153/files/N704-400k-AnnData.h5ad\nhttps://zenodo.org/record/4574153/files/N705-400k-AnnData.h5ad\nhttps://zenodo.org/record/4574153/files/N706-400k-AnnData.h5ad\nhttps://zenodo.org/record/4574153/files/N707-400k-AnnData.h5ad\n</code></pre></div>      </div>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-importación-por-medio-de-enlaces-1\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-importación-por-medio-de-enlaces-1\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Consejo: Importación por medio de enlaces</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Copia los enlaces</li>   <li>     <p>Abre el manejador de carga de datos de Galaxy (<i class=\"fas fa-upload\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-upload</span> en la parte superior derecha del panel de herramientas)</p>   </li>   <li>Selecciona ‘Pegar/Traer datos’ <strong>Paste/Fetch Data</strong></li>   <li>     <p>Copia los enlaces en el campo de textos</p>   </li>   <li>     <p>Presiona ‘Iniciar’ <strong>Start</strong></p>   </li>   <li>     <p><strong>Close</strong> Cierra la ventana.</p>   </li>   <li>Galaxy utiliza los URLs como nombres de forma predeterminada , así que los tendrás que cambiar a algunos que sean más útiles o informativos. the window</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n    <li>Cambiar de nombre al conjunto de datos</li>\n    <li>\n      <p>Verifica que el tipo de datos sea <code class=\"language-plaintext highlighter-rouge\">h5ad</code> de lo contrario ¡Necesitarás cambiar cada tipo de datos al formato <code class=\"language-plaintext highlighter-rouge\">h5ad</code>!</p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-cambiar-el-tipo-de-datos\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-cambiar-el-tipo-de-datos\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Consejo: Cambiar el tipo de datos</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Selecciona sobre el <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> <strong>icono del lápiz</strong> para editar los atributos del conjunto de datos</li>   <li>Selecciona en la pestaña <i class=\"fas fa-database\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-chart-select-data</span> <strong>Datatypes</strong> en la parte superior del panel central</li>   <li>Selecciona <code class=\"language-plaintext highlighter-rouge\">datatypes</code></li>   <li>Da clic en el botón <strong>Change datatype</strong></li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>Inspecciona <i class=\"far fa-eye\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-eye</span> el archivo de texto <code class=\"language-plaintext highlighter-rouge\">Experimental Design</code>. Este muestra cómo cada <code class=\"language-plaintext highlighter-rouge\">N70X</code>  corresponde a una muestra, y si dicha muestra proviene de un macho o hembra. Estos serán metadatos importantes para agregar a nuestra muestra, los cuales añadiremos de forma similar a la forma en que añadiste los metadatos <code class=\"language-plaintext highlighter-rouge\">gene_name</code> y <code class=\"language-plaintext highlighter-rouge\">mito</code> en secciones anteriores.</p>\n\n<h2 id=\"concatenación-de-objetos\">Concatenación de objetos</h2>\n<blockquote class=\"hands_on\">\n  <hands-on-title>Concatenación de objetos AnnData</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/anndata_manipulate/anndata_manipulate/0.7.5+galaxy0\" title=\"Manipulate AnnData tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Manipulate AnnData</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.7.5+galaxy0)</span> con los siguientes parámetros:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: <code class=\"language-plaintext highlighter-rouge\">N701-400k-AnnData</code></li>\n        <li><em>“Function to manipulate the object”</em>: ‘Concatenate along the observations axis’</li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix to add”</em>: ‘Select all the other matrix files from bottom to top’</li>\n        <li><em>“Join method”</em>: <code class=\"language-plaintext highlighter-rouge\">Intersection of variables</code></li>\n        <li><em>“Key to add the batch annotation to obs”</em>: <code class=\"language-plaintext highlighter-rouge\">batch</code></li>\n        <li><em>“Separator to join the existing index names with the batch category”</em>: <code class=\"language-plaintext highlighter-rouge\">-</code></li>\n      </ul>\n    </li>\n  </ol>\n</blockquote>\n\n<p>¡Demos un vistazo a lo que hemos hecho! Desafortunadamente, los objetos AnnData son bastante complicados, así que aquí el icono del ojo <i class=\"far fa-eye\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-eye</span> no nos será de mucha ayuda. En lugar de esto, de aquí en adelante vamos a utilizar una herramienta para visualizar nuestro objeto.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Inspección de objetos AnnData</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/anndata_inspect/anndata_inspect/0.7.5+galaxy0\" title=\"Inspect AnnData tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Inspect AnnData</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.7.5+galaxy0)</span> con los siguiente parámetros:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: la salida de la herramienta <strong>Manipulate AnnData</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span></li>\n        <li><em>“What to inspect?”</em>: <code class=\"language-plaintext highlighter-rouge\">General information about the object</code></li>\n      </ul>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/anndata_inspect/anndata_inspect/0.7.5+galaxy0\" title=\"Inspect AnnData tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Inspect AnnData</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.7.5+galaxy0)</span>  con los siguiente parámetros:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: la salida de la herramienta <strong>Manipulate AnnData</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span></li>\n        <li><em>“What to inspect?”</em>: <code class=\"language-plaintext highlighter-rouge\">Key-indexed observations annotation (obs)</code></li>\n      </ul>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/anndata_inspect/anndata_inspect/0.7.5+galaxy0\" title=\"Inspect AnnData tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Inspect AnnData</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.7.5+galaxy0)</span>  con los siguiente parámetros:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: la salida de la herramienta <strong>Manipulate AnnData</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span></li>\n        <li><em>“What to inspect?”</em>: <code class=\"language-plaintext highlighter-rouge\">Key-indexed annotation of variables/features (var)</code></li>\n      </ul>\n    </li>\n  </ol>\n</blockquote>\n\n<p>Ya hemos visualizado las tres salidas de <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> <strong>Inspect AnnData</strong>.</p>\n\n<blockquote class=\"question\">\n  <question-title>Preguntas</question-title>\n\n  <ol>\n    <li>¿Cuántas células tienes ahora?</li>\n    <li>¿Dónde está almacenada la información del lote (<code class=\"language-plaintext highlighter-rouge\">batch</code>)?</li>\n  </ol>\n\n  <blockquote class=\"solution\">\n    <solution-title>Soluciones</solution-title>\n\n    <ol>\n      <li>Si verificas la salida <strong>General information</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>, podrás ver que ahora tienes <code class=\"language-plaintext highlighter-rouge\">4079 células</code>, ya que la matriz ahora tiene 4079 células y 35,734 genes. También puedes observar esto en los tamaños de los archivos <strong>obs</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> (células) and <strong>var</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> (genes).</li>\n      <li>En la anotación de observaciones indexadas por clave <strong>Key-indexed observations annotation (obs)</strong>. Las diferentes versiones de la herramienta ‘Manipulate’ colocarán las columnas del lote (<code class=\"language-plaintext highlighter-rouge\">batch</code>) en diferentes ubicaciones. La versión de la herramienta utilizada en este curso asigna a la novena columna (<code class=\"language-plaintext highlighter-rouge\">9</code>) en la posición de más a la derecha, la cual determina el ‘lote’ (<code class=\"language-plaintext highlighter-rouge\">batch</code>). Lote (batch) se refiere al orden en que se agregaron las matrices. Los archivos se agregan desde la parte inferior del historial hacia arriba, ¡Así que ten cuidado en cómo configuras tus historiales al ejecutar esto!</li>\n    </ol>\n  </blockquote>\n\n</blockquote>\n\n<h1 id=\"añadir-el-lote-de-metadatos-batch-metadata\">Añadir el lote de metadatos (batch metadata)</h1>\n\n<p>Configura el historial de ejemplo con los índices más antiguos en la parte inferior.</p>\n\n<figure id=\"figure-9\" style=\"max-width: 90%;\"><img src=\"../../images/scrna-casestudy/wab-history-files-ascending.png\" alt=\"Ordered history. \" width=\"328\" height=\"642\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/scrna-casestudy/wab-history-files-ascending.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figura 9</strong>:</span> Nota como N701 es el más bajo, en orden ascendente al N707</figcaption></figure>\n\n<p>Por tanto, cuando se concatenan, el lote (<code class=\"language-plaintext highlighter-rouge\">batch</code>) aparece de la siguiente manera:</p>\n\n<table>\n  <thead>\n    <tr>\n      <th>Index</th>\n      <th>Batch</th>\n      <th>Genotype</th>\n      <th>Sex</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>N701</td>\n      <td>0</td>\n      <td>wildtype</td>\n      <td>male</td>\n    </tr>\n    <tr>\n      <td>N702</td>\n      <td>1</td>\n      <td>knockout</td>\n      <td>male</td>\n    </tr>\n    <tr>\n      <td>N703</td>\n      <td>2</td>\n      <td>knockout</td>\n      <td>female</td>\n    </tr>\n    <tr>\n      <td>N704</td>\n      <td>3</td>\n      <td>wildtype</td>\n      <td>male</td>\n    </tr>\n    <tr>\n      <td>N705</td>\n      <td>4</td>\n      <td>wildtype</td>\n      <td>male</td>\n    </tr>\n    <tr>\n      <td>N706</td>\n      <td>5</td>\n      <td>wildtype</td>\n      <td>male</td>\n    </tr>\n    <tr>\n      <td>N707</td>\n      <td>6</td>\n      <td>knockout</td>\n      <td>male</td>\n    </tr>\n  </tbody>\n</table>\n\n<p>Puede ser que los índices no se hayan importado en orden si utilizaste Zenodo para importar tus archivos (por ejemplo, N701 a N707, ascendentes). En ese caso necesitarás manipular de forma apropiada los parámetros de las siguientes herramientas para etiquetar tus lotes correctamente.</p>\n\n<p>Los dos metadatos más críticos en este experimento son <code class=\"language-plaintext highlighter-rouge\">sex</code> y <code class=\"language-plaintext highlighter-rouge\">genotype</code>. Posteriormente, vamos a colorear nuestros gráficos de células según los valores de estos parámetros, así que vamos a añadirlos ya.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Etiquetas de sexo</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_replace_in_column/1.1.3\" title=\"Replace Text in a specific column tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Replace Text in a specific column</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.1.3)</span> con los siguientes parámetros:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“File to process”</em>: la salida de la herramienta <strong>Inspect AnnData: Key-indexed observations annotation (obs)</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li>\n          <p><em>“1. Replacement”</em></p>\n\n          <ul>\n            <li><em>“in column”</em>: <code class=\"language-plaintext highlighter-rouge\">Column: 9</code> - or whichever column <code class=\"language-plaintext highlighter-rouge\">batch</code> is in</li>\n            <li><em>“Find pattern”</em>: <code class=\"language-plaintext highlighter-rouge\">0|1|3|4|5|6</code></li>\n            <li><em>“Replace with”</em>: <code class=\"language-plaintext highlighter-rouge\">male</code></li>\n          </ul>\n        </li>\n        <li><strong>+ Insert Replacement</strong></li>\n        <li>\n          <p><em>“2. Replacement”</em></p>\n\n          <ul>\n            <li><em>“in column”</em>: <code class=\"language-plaintext highlighter-rouge\">Column: 9</code></li>\n            <li><em>“Find pattern”</em>: <code class=\"language-plaintext highlighter-rouge\">2</code></li>\n            <li><em>“Replace with”</em>: <code class=\"language-plaintext highlighter-rouge\">female</code></li>\n          </ul>\n        </li>\n        <li><strong>+ Insert Replacement</strong></li>\n        <li>\n          <p><em>“3. Replacement”</em></p>\n\n          <ul>\n            <li><em>“in column”</em>: <code class=\"language-plaintext highlighter-rouge\">Column: 9</code></li>\n            <li><em>“Find pattern”</em>: <code class=\"language-plaintext highlighter-rouge\">batch</code></li>\n            <li><em>“Replace with”</em>: <code class=\"language-plaintext highlighter-rouge\">sex</code></li>\n          </ul>\n        </li>\n      </ul>\n\n      <p>Ahora queremos únicamente la columna que contiene la información de sexo -  al final agregaremos esto en la anotación celular del objeto AnnData</p>\n    </li>\n    <li><span class=\"tool\" data-tool=\"Cut1\" title=\"Cut columns from a table tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Cut columns from a table</strong></span> con los siguientes parámetros:\n      <ul>\n        <li><em>“Cut columns”</em>: <code class=\"language-plaintext highlighter-rouge\">c9</code></li>\n        <li><em>“Delimited by”</em>: <code class=\"language-plaintext highlighter-rouge\">Tab</code></li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“From”</em>: la salida de la herramienta <strong>Replace text</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span></li>\n      </ul>\n    </li>\n    <li>Cambiar el nombre <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> de la salida a <code class=\"language-plaintext highlighter-rouge\">Sex metadata</code></li>\n  </ol>\n</blockquote>\n\n<p>Estuvo divertido, ahora hagámoslo de nuevo pero para el genotipo.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Etiquetas de genotipo</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_replace_in_column/1.1.3\" title=\"Replace Text in a specific column tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Replace Text in a specific column</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.1.3)</span> con los siguientes parámetros:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“File to process”</em>: la salida de la herramienta <strong>Inspect AnnData: Key-indexed observations annotation (obs)</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span></li>\n        <li>\n          <p><em>“1. Replacement”</em></p>\n\n          <ul>\n            <li><em>“in column”</em>: <code class=\"language-plaintext highlighter-rouge\">Column: 9</code></li>\n            <li><em>“Find pattern”</em>: <code class=\"language-plaintext highlighter-rouge\">0|3|4|5</code></li>\n            <li><em>“Replace with”</em>: <code class=\"language-plaintext highlighter-rouge\">wildtype</code></li>\n          </ul>\n        </li>\n        <li><strong>+ Insert Replacement</strong></li>\n        <li>\n          <p><em>“2. Replacement”</em></p>\n\n          <ul>\n            <li><em>“in column”</em>: <code class=\"language-plaintext highlighter-rouge\">Column: 9</code></li>\n            <li><em>“Find pattern”</em>: <code class=\"language-plaintext highlighter-rouge\">1|2|6</code></li>\n            <li><em>“Replace with”</em>: <code class=\"language-plaintext highlighter-rouge\">knockout</code></li>\n          </ul>\n        </li>\n        <li><strong>+ Insert Replacement</strong></li>\n        <li>\n          <p><em>“3. Replacement”</em></p>\n\n          <ul>\n            <li><em>“in column”</em>: <code class=\"language-plaintext highlighter-rouge\">Column: 9</code></li>\n            <li><em>“Find pattern”</em>: <code class=\"language-plaintext highlighter-rouge\">batch</code></li>\n            <li><em>“Replace with”</em>: <code class=\"language-plaintext highlighter-rouge\">genotype</code></li>\n          </ul>\n        </li>\n      </ul>\n\n      <p>Ahora queremos únicamente la columna que contiene la información de genotipo -  al final agregaremos esto en la anotación celular del objeto AnnData.</p>\n    </li>\n    <li><span class=\"tool\" data-tool=\"Cut1\" title=\"Cut columns from a table tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Cut columns from a table</strong></span> con los siguientes parámetros:\n      <ul>\n        <li><em>“Cut columns”</em>: <code class=\"language-plaintext highlighter-rouge\">c9</code></li>\n        <li><em>“Delimited by”</em>: <code class=\"language-plaintext highlighter-rouge\">Tab</code></li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“From”</em>: la salida de la herramienta <strong>Replace text</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span></li>\n      </ul>\n    </li>\n    <li>Cambiar el nombre <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> de la salida a <code class=\"language-plaintext highlighter-rouge\">Genotype metadata</code></li>\n  </ol>\n</blockquote>\n\n<p>Es posible que desees hacer esto con distintos tipos de metadatos - qué laboratorios manejaron las muestras, en qué día se procesaron, etc. Una vez que hayas agregado todas tus columnas de metadatos, podemos entonces adherirlas unas a otras antes de conectarlas al objeto AnnData.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Combinar las columnas de metadatos</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"Paste1\" title=\"Paste two files side by side tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Paste two files side by side</strong></span> con los siguientes parámetros:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Paste”</em>: <code class=\"language-plaintext highlighter-rouge\">Genotype metadata</code></li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“and”</em>: <code class=\"language-plaintext highlighter-rouge\">Sex metadata</code></li>\n        <li><em>“Delimit by”</em>: <code class=\"language-plaintext highlighter-rouge\">Tab</code></li>\n      </ul>\n    </li>\n    <li>Cambiar el nombre <i class=\"fas fa-pencil-alt\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-pencil</span> de la salida a <code class=\"language-plaintext highlighter-rouge\">Cell Metadata</code></li>\n  </ol>\n</blockquote>\n\n<p>¡Agrégalo al objeto AnnData!</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Añadir los metadatos al objeto AnnData</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/anndata_manipulate/anndata_manipulate/0.7.5+galaxy0\" title=\"Manipulate AnnData tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Manipulate AnnData</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.7.5+galaxy0)</span> con los siguientes parámetros:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: la salida de la herramienta <strong>Manipulate AnnData</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span></li>\n        <li><em>“Function to manipulate the object”</em>: <code class=\"language-plaintext highlighter-rouge\">Add new annotation(s) for observations or variables</code></li>\n        <li><em>“What to annotate?”</em>: <code class=\"language-plaintext highlighter-rouge\">Observations (obs)</code>`</li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Table with new annotations”</em>: <code class=\"language-plaintext highlighter-rouge\">Cell Metadata</code></li>\n      </ul>\n    </li>\n  </ol>\n</blockquote>\n\n<p>¡Perfecto! Ahora puedes ejecutar <strong>Inspect AnnData</strong> para verificación, pero primero limpiemos un poco más este objeto. Sería mucho mejor si “lote” (<code class=\"language-plaintext highlighter-rouge\">batch</code>) significara algo, en lugar de “el orden en el que la herramienta ‘Manipulate AnnData’ agregó mis conjuntos de datos”.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title> Etiquetado de lotes</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/anndata_manipulate/anndata_manipulate/0.7.5+galaxy0\" title=\"Manipulate AnnData tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Manipulate AnnData</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.7.5+galaxy0)</span> con los siguientes parámetros:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Annotated data matrix”</em>: la salida de la herramienta <strong>Manipulate AnnData - Add new annotations</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span></li>\n        <li><em>“Function to manipulate the object”</em>: <code class=\"language-plaintext highlighter-rouge\">Rename categories of annotation</code></li>\n        <li><em>“Key for observations or variables annotation”</em>: <code class=\"language-plaintext highlighter-rouge\">batch</code></li>\n        <li><em>“Comma-separated list of new categories”</em>: <code class=\"language-plaintext highlighter-rouge\">N701,N702,N703,N704,N705,N706,N707</code></li>\n      </ul>\n    </li>\n  </ol>\n</blockquote>\n\n<p>¡Ya casi llegamos a donde queremos! Sin embargo, mientras que nos hemos enfocado en los metadatos de nuestras células (muestra, lote, genotipo, etc.) para etiquetar las ‘observaciones’ en nuestro objeto…</p>\n\n<h1 id=\"lecturas-mitocondriales\">Lecturas mitocondriales</h1>\n\n<p>¿Recuerdas cuando mencionamos mitocondrias en los inicios de este tutorial? Y en muestras de células únicas, ¿Cómo de frecuente el ARN mitocondrial es un indicador de estrés durante la disociación? Probablemente deberíamos hacer algo con nuestra columna de verdadero/falso (true/false) en la anotación de genes, la cual nos provee información sobre las células. Ya sea que hayas combinado los archivos FASTQ o que estés analizando solo un archivo necesitarás hacer esto (saltándose así las secciones 4 y 5).</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Calculando el ARN mitocondrial en las células</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/ebi-gxa/anndata_ops/anndata_ops/0.0.3+galaxy1\" title=\"AnnData Operations tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>AnnData Operations</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 0.0.3+galaxy1)</span> con los siguientes parámetros:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Input object in hdf5 AnnData format”</em>: la salida de la herramienta <strong>Manipulate AnnData - Rename categories</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span></li>\n        <li><em>“Format of output object”</em>: <code class=\"language-plaintext highlighter-rouge\">AnnData format</code></li>\n        <li><em>“Copy AnnData to .raw”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n        <li><em>“Gene symbols field in AnnData”</em>: <code class=\"language-plaintext highlighter-rouge\">NA.</code></li>\n        <li><em>“Flag genes that start with these names”</em>: <code class=\"language-plaintext highlighter-rouge\">Insert Flag genes that start with these names</code></li>\n        <li><em>“Starts with”</em>: <code class=\"language-plaintext highlighter-rouge\">True</code></li>\n        <li><em>“Var name”</em>: <code class=\"language-plaintext highlighter-rouge\">mito</code></li>\n        <li><em>“Number of top genes”</em>: <code class=\"language-plaintext highlighter-rouge\">50</code></li>\n      </ul>\n    </li>\n  </ol>\n</blockquote>\n\n<p><i class=\"far fa-thumbs-up\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">congratulations</span> ¡Bien hecho! Te sugiero encarecidamente que juegues un poco e inspecciones tu objeto <strong>Inspect AnnData</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span> final preprocesado de AnnData (<code class=\"language-plaintext highlighter-rouge\">Pre-processed object</code>) para que puedas ver la gran cantidad de información que ha sido agregada. ¡Ya está todo listo para continuar con el filtrado! Sin embargo, hay un truco que puede ahorrarte tiempo en el futuro…</p>\n\n<h1 id=\"extraer-datos-de-secuenciación-de-arn-de-células-únicas-desde-bases-de-datos-públicas\">Extraer datos de secuenciación de ARN de células únicas desde bases de datos públicas</h1>\n\n<p>Si te interesa analizar datos de acceso público, particularmente del <a href=\"https://www.ebi.ac.uk/gxa/sc/home\">Single Cell Expression Atlas</a>, quizá te interese la herramienta <span class=\"citation\"><a href=\"#Moreno2020.04.08.032698\">Moreno <i>et al.</i> 2020</a></span>, la cual más bien reduce estos pasos en uno. <a href=\"https://www.ebi.ac.uk/gxa/sc/experiments/E-MTAB-6945/downloads\">Aquí</a>  puedes encontrar el conjunto de datos para este tutorial, el cual tiene el número de identificación de experimento <code class=\"language-plaintext highlighter-rouge\">E-MTAB-6945</code>.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Obtener datos de el Atlas de Expresión de Células Únicas</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/ebi-gxa/retrieve_scxa/retrieve_scxa/v0.0.2+galaxy2\" title=\"EBI SCXA Data Retrieval tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>EBI SCXA Data Retrieval</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version v0.0.2+galaxy2)</span> con los siguientes parámetros:\n      <ul>\n        <li><em>“SC-Atlas experiment accession”</em>: <code class=\"language-plaintext highlighter-rouge\">E-MTAB-6945</code></li>\n        <li><em>“Choose the type of matrix to download”</em>: <code class=\"language-plaintext highlighter-rouge\">Raw filtered counts</code></li>\n      </ul>\n\n      <p>Ahora necesitamos transformar estos datos en un objeto tipo AnnData</p>\n    </li>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/ebi-gxa/scanpy_read_10x/scanpy_read_10x/1.6.0+galaxy0\" title=\"Scanpy Read10x tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Scanpy Read10x</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.6.0+galaxy0)</span> con los siguientes parámetros:\n      <ul>\n        <li><em>“Expression matrix in sparse matrix format (.mtx)”</em>: <code class=\"language-plaintext highlighter-rouge\">EBI SCXA Data Retrieval on E-MTAB-6945 matrix.mtx (Raw filtered counts)</code></li>\n        <li><em>“Gene table”</em>:  <code class=\"language-plaintext highlighter-rouge\">EBI SCXA Data Retrieval on E-MTAB-6945 genes.tsv (Raw filtered counts)</code></li>\n        <li><em>“Barcode/cell table”</em>: <code class=\"language-plaintext highlighter-rouge\">EBI SCXA Data Retrieval on E-MTAB-6945 barcodes.tsv (Raw filtered counts)</code></li>\n        <li><em>“Cell metadata table”</em>: <code class=\"language-plaintext highlighter-rouge\">EBI SCXA Data Retrieval on E-MTAB-6945 exp_design.tsv</code></li>\n      </ul>\n    </li>\n  </ol>\n</blockquote>\n\n<p>Es importante tener en cuenta que esta matriz es procesada de cierto modo por medio del pipeline SCXA, que es muy similar a este tutorial, y que contiene todos y cada uno de los metadatos proporcionados por su pipeline, así como sus autores (por ejemplo, más anotaciones celulares o de genes).</p>\n\n<h1 id=\"conclusion\">Conclusion</h1>\n\n<figure id=\"figure-10\" style=\"max-width: 90%;\"><img src=\"../../images/scrna-casestudy/wab-alevin-part1workflow.png\" alt=\"Workflow Part 1. \" width=\"1070\" height=\"884\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/scrna-casestudy/wab-alevin-part1workflow.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figura 10</strong>:</span> Flujo de trabajo - Pasos 1-3</figcaption></figure>\n\n<figure id=\"figure-11\" style=\"max-width: 90%;\"><img src=\"../../images/scrna-casestudy/wab-alevin-part2workflow.png\" alt=\"Workflow Part 2. \" width=\"1255\" height=\"692\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/scrna-casestudy/wab-alevin-part2workflow.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figura 11</strong>:</span> Flujo de trabajo - Pasos 4-6</figcaption></figure>\n\n<p>¡Has llegado al final de esta sesión! Quizá te interese echarle un vistazo a un <a href=\"https://humancellatlas.usegalaxy.eu/u/wendi.bacon.training/h/pre-processing-with-alevin---part-2---answer-key-1\">ejemplo de un historial</a> y a la <a href=\"https://humancellatlas.usegalaxy.eu/u/wendi.bacon.training/w/pre-processing-with-alevin---part-2\">Parte 2 del flujo de trabajo</a>. Nota que según la forma en que ejecutes el flujo de trabajo este requerirá que cambies la columna (<code class=\"language-plaintext highlighter-rouge\">column</code>) que contiene el lote de metadatos. <a href=\"https://humancellatlas.usegalaxy.eu/u/wendi.bacon.training/h/pre-processing-with-alevin---part-2---total-anndata-example\">Aquí</a> puedes encontrar el objeto final que contiene todas las lecturas.</p>\n\n<p>Hemos:</p>\n\n<ul>\n  <li>Tomado lecturas crudas, anotaciones y los archivos de entrada necesarios para cuantificación.</li>\n  <li>Ejecutado Alevin con dos distintas configuraciones de parámetros, ambas permitiendo que la herramienta tome sus propias decisiones sobre qué es lo que constituyen las gotas vacías y, hemos aplicado emptyDrops en su lugar.</li>\n  <li>Desplegado gráficos de rangos de códigos de barras para valorar de manera rápida las señales presentes en los conjuntos de datos generados por técnicas de goteo.</li>\n  <li>Aplicado las conversiones necesarias para pasar estos datos a los procesos subsecuentes.</li>\n  <li>Obtenido datos con análisis parciales desde el Single Cell Expression Atlas.</li>\n</ul>\n\n<p>¡Únete a nuestro canal de Gitter de secuenciación de ARN de células únicas para tomar parte en discusiones con científicos con ideas afines a las tuyas! <a href=\"https://gitter.im/Galaxy-Training-Network/galaxy-single-cell?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge\"><a href=\"https://badges.gitter.im/Galaxy-Training-Network/galaxy-single-cell.svg\" rel=\"noopener noreferrer\"><img src=\"https://badges.gitter.im/Galaxy-Training-Network/galaxy-single-cell.svg\" alt=\"Gitter. \" loading=\"lazy\" /></a></a></p>\n"],"ref_slides":[],"hands_on":true,"slides":false,"mod_date":"2024-06-13 18:07:31 +0000","pub_date":"2022-09-08 14:00:12 +0000","version":35,"workflows":[{"workflow":"Combining-datasets-after-pre-processing.ga","tests":true,"url":"https://training.galaxyproject.org/training-material/topics/single-cell/tutorials/scrna-case_alevin-combine-datasets/workflows/Combining-datasets-after-pre-processing.ga","path":"topics/single-cell/tutorials/scrna-case_alevin-combine-datasets/workflows/Combining-datasets-after-pre-processing.ga","wfid":"single-cell-scrna-case_alevin-combine-datasets","wfname":"combining-datasets-after-pre-processing","trs_endpoint":"https://training.galaxyproject.org/training-material/api/ga4gh/trs/v2/tools/single-cell-scrna-case_alevin-combine-datasets/versions/combining-datasets-after-pre-processing","license":"CC-BY-4.0","creators":[{"class":"Person","identifier":"0009-0001-2017-8805","name":"Julia Jakiela"},{"class":"Person","identifier":"0000-0002-8170-8806","name":"Wendi Bacon"}],"name":"Combining datasets after pre-processing","title":"Combining datasets after pre-processing","test_results":null,"modified":"2024-06-24 07:13:59 +0000","mermaid":"flowchart TD\n  0[\"ℹ️ Input Dataset\\nN701\"];\n  style 0 stroke:#2c3143,stroke-width:4px;\n  1[\"ℹ️ Input Dataset\\nN702\"];\n  style 1 stroke:#2c3143,stroke-width:4px;\n  2[\"ℹ️ Input Dataset\\nN703\"];\n  style 2 stroke:#2c3143,stroke-width:4px;\n  3[\"ℹ️ Input Dataset\\nN704\"];\n  style 3 stroke:#2c3143,stroke-width:4px;\n  4[\"ℹ️ Input Dataset\\nN705\"];\n  style 4 stroke:#2c3143,stroke-width:4px;\n  5[\"ℹ️ Input Dataset\\nN706\"];\n  style 5 stroke:#2c3143,stroke-width:4px;\n  6[\"ℹ️ Input Dataset\\nN707\"];\n  style 6 stroke:#2c3143,stroke-width:4px;\n  7[\"Concatenating Datasets\"];\n  0 -->|output| 7;\n  1 -->|output| 7;\n  2 -->|output| 7;\n  3 -->|output| 7;\n  4 -->|output| 7;\n  5 -->|output| 7;\n  6 -->|output| 7;\n  168d4710-570a-43b1-998a-2164154eebc5[\"Output\\nCombined Object\"];\n  7 --> 168d4710-570a-43b1-998a-2164154eebc5;\n  style 168d4710-570a-43b1-998a-2164154eebc5 stroke:#2c3143,stroke-width:4px;\n  8[\"Inspect AnnData\"];\n  7 -->|anndata| 8;\n  9[\"Inspect AnnData\"];\n  7 -->|anndata| 9;\n  10[\"Inspect AnnData\"];\n  7 -->|anndata| 10;\n  11[\"Replace Text\"];\n  9 -->|obs| 11;\n  12[\"Replace Text\"];\n  9 -->|obs| 12;\n  13[\"Cut\"];\n  11 -->|outfile| 13;\n  8b026c35-f9db-4bcd-8cf5-54b7d6fb5aea[\"Output\\nSex metadata\"];\n  13 --> 8b026c35-f9db-4bcd-8cf5-54b7d6fb5aea;\n  style 8b026c35-f9db-4bcd-8cf5-54b7d6fb5aea stroke:#2c3143,stroke-width:4px;\n  14[\"Cut\"];\n  12 -->|outfile| 14;\n  6f55548b-5ded-42b8-b2f7-c7f1a327a068[\"Output\\nGenotype metadata\"];\n  14 --> 6f55548b-5ded-42b8-b2f7-c7f1a327a068;\n  style 6f55548b-5ded-42b8-b2f7-c7f1a327a068 stroke:#2c3143,stroke-width:4px;\n  15[\"Paste\"];\n  14 -->|out_file1| 15;\n  13 -->|out_file1| 15;\n  2f0ea0f3-f2f7-44b2-b8f0-05d8cbb364a6[\"Output\\nCell metadata\"];\n  15 --> 2f0ea0f3-f2f7-44b2-b8f0-05d8cbb364a6;\n  style 2f0ea0f3-f2f7-44b2-b8f0-05d8cbb364a6 stroke:#2c3143,stroke-width:4px;\n  16[\"Adding in cell metadata\"];\n  7 -->|anndata| 16;\n  15 -->|out_file1| 16;\n  2720386c-7273-49d6-abb0-9bd14f6cb68c[\"Output\\nAnnData with Cell Metadata\"];\n  16 --> 2720386c-7273-49d6-abb0-9bd14f6cb68c;\n  style 2720386c-7273-49d6-abb0-9bd14f6cb68c stroke:#2c3143,stroke-width:4px;\n  17[\"Batching Cell Metadata\"];\n  16 -->|anndata| 17;\n  b950c8db-abe1-4cb0-af58-d291d3b74a83[\"Output\\nBatched Object\"];\n  17 --> b950c8db-abe1-4cb0-af58-d291d3b74a83;\n  style b950c8db-abe1-4cb0-af58-d291d3b74a83 stroke:#2c3143,stroke-width:4px;\n  18[\"Calculating mitochondrial \"];\n  17 -->|anndata| 18;\n  2417284d-8252-43ff-84bf-6f15ef11cd05[\"Output\\nAnnotated AnnData\"];\n  18 --> 2417284d-8252-43ff-84bf-6f15ef11cd05;\n  style 2417284d-8252-43ff-84bf-6f15ef11cd05 stroke:#2c3143,stroke-width:4px;"}],"api":"https://training.galaxyproject.org/training-material/api/topics/single-cell/tutorials/scrna-case_alevin-combine-datasets/tutorial.json","tools":["Cut1","Paste1","toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_replace_in_column/9.3+galaxy0","toolshed.g2.bx.psu.edu/repos/ebi-gxa/anndata_ops/anndata_ops/1.9.3+galaxy0","toolshed.g2.bx.psu.edu/repos/ebi-gxa/retrieve_scxa/retrieve_scxa/v0.0.2+galaxy2","toolshed.g2.bx.psu.edu/repos/ebi-gxa/scanpy_read_10x/scanpy_read_10x/1.8.1+galaxy9","toolshed.g2.bx.psu.edu/repos/iuc/anndata_inspect/anndata_inspect/0.10.3+galaxy0","toolshed.g2.bx.psu.edu/repos/iuc/anndata_inspect/anndata_inspect/0.7.5+galaxy1","toolshed.g2.bx.psu.edu/repos/iuc/anndata_manipulate/anndata_manipulate/0.10.3+galaxy0"],"supported_servers":{"exact":[{"url":"https://usegalaxy.eu","name":"UseGalaxy.eu","usegalaxy":true}],"inexact":[{"url":"https://usegalaxy.org","name":"UseGalaxy.org (Main)","usegalaxy":true},{"url":"https://usegalaxy.org.au","name":"UseGalaxy.org.au","usegalaxy":true}]},"topic_name_human":"Single Cell","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[{"name":"text_processing","owner":"bgruening","revisions":"12615d397df7","tool_panel_section_label":"Text Manipulation","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"anndata_ops","owner":"ebi-gxa","revisions":"a4774b7b2e85","tool_panel_section_label":"Single-cell","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"retrieve_scxa","owner":"ebi-gxa","revisions":"72b6e1747e37","tool_panel_section_label":"Single-cell","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"scanpy_read_10x","owner":"ebi-gxa","revisions":"9afcfcd1d215","tool_panel_section_label":"Single-cell","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"anndata_inspect","owner":"iuc","revisions":"6f0d0c784f09","tool_panel_section_label":"Single-cell","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"anndata_inspect","owner":"iuc","revisions":"ee98d611afc6","tool_panel_section_label":"Single-cell","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"anndata_manipulate","owner":"iuc","revisions":"ed4996a16f7f","tool_panel_section_label":"Single-cell","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"}]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools:\n- name: text_processing\n  owner: bgruening\n  revisions: 12615d397df7\n  tool_panel_section_label: Text Manipulation\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: anndata_ops\n  owner: ebi-gxa\n  revisions: a4774b7b2e85\n  tool_panel_section_label: Single-cell\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: retrieve_scxa\n  owner: ebi-gxa\n  revisions: 72b6e1747e37\n  tool_panel_section_label: Single-cell\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: scanpy_read_10x\n  owner: ebi-gxa\n  revisions: 9afcfcd1d215\n  tool_panel_section_label: Single-cell\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: anndata_inspect\n  owner: iuc\n  revisions: 6f0d0c784f09\n  tool_panel_section_label: Single-cell\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: anndata_inspect\n  owner: iuc\n  revisions: ee98d611afc6\n  tool_panel_section_label: Single-cell\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: anndata_manipulate\n  owner: iuc\n  revisions: ed4996a16f7f\n  tool_panel_section_label: Single-cell\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n","tours":false,"video":false,"slides_recordings":false,"translations":{"tutorial":[],"slides":[],"video":false},"license":"CC-BY-4.0","type":"tutorial","contributors":[{"name":"Wendi Bacon","email":"wendi.bacon@open.ac.uk","twitter":"WendiBacon1","matrix":"nomadscientist:matrix.org","joined":"2020-03","elixir_node":"uk","orcid":"0000-0002-8170-8806","bio":"Lecturer at The Open University","fediverse":"https://mstdn.science/@wendibacon1","fediverse_flavor":"mastodon","affiliations":["elixir-europe"],"id":"nomadscientist","url":"https://training.galaxyproject.org/training-material/api/contributors/nomadscientist.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/nomadscientist/"},{"name":"Jonathan Manning","email":"jmanning@ebi.ac.uk","joined":"2021-02","id":"pinin4fjords","url":"https://training.galaxyproject.org/training-material/api/contributors/pinin4fjords.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/pinin4fjords/"},{"name":"Helena Rasche","orcid":"0000-0001-9760-8992","maintainer_contact":"gitter","matrix":"hexylena:matrix.org","joined":"2017-09","elixir_node":"nl","affiliations":["gallantries","by-covid","erasmusmc","elixir-europe","elixir-converge"],"former_affiliations":["deNBI","avans-atgm","uni-freiburg"],"contact_for_training":false,"location":{"country":"NL","lat":51.91,"lon":4.46},"id":"hexylena","url":"https://training.galaxyproject.org/training-material/api/contributors/hexylena.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/hexylena/"},{"name":"Julia Jakiela","email":"juliajot36@gmail.com","joined":"2022-06","id":"wee-snufkin","url":"https://training.galaxyproject.org/training-material/api/contributors/wee-snufkin.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/wee-snufkin/"}]}