{"layout":"tutorial_hands_on","title":"Single-cell quality control with scater","subtopic":"tricks","priority":1,"redirect_from":["/topics/transcriptomics/tutorials/scrna-scater-qc/tutorial","/short/single-cell/scrna-scater-qc","/short/T00255"],"zenodo_link":"https://zenodo.org/record/3386291","tags":null,"questions":["How to ensure the quality of single-cell RNA-seq data?","What are the confounding factors that may affect the interpretation of downstream analyses?"],"objectives":["Examine scRNA-seq data for low-quality cells","Visualise data with various types of plots","Filtering low-quality cells with the appropriate approach"],"requirements":[{"type":"internal","topic_name":"single-cell","tutorials":["scrna-plates-batches-barcodes"]}],"follow_up_training":[{"type":"internal","topic_name":"single-cell","tutorials":["scrna-raceid"]}],"time_estimation":"1H","key_points":["Single-cell RNA-seq data is often noisy","scater can be used to apply the visualise-filter-visualise paradigm of quality control"],"contributors":[{"name":"Graham Etherington","orcid":"0000-0002-5003-1425","joined":"2019-10","id":"ethering","url":"https://training.galaxyproject.org/training-material/api/contributors/ethering.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/ethering/"},{"name":"Nicola Soranzo","matrix":"nsoranzo:matrix.org","orcid":"0000-0003-3627-5340","twitter":"NicolaSoranzo","joined":"2017-09","elixir_node":"uk","fediverse":"https://mstdn.science/@nsoranzo","fediverse_flavor":"mastodon","linkedin":"nicola-soranzo-7884125","affiliations":["earlham","elixir-europe"],"id":"nsoranzo","url":"https://training.galaxyproject.org/training-material/api/contributors/nsoranzo.json","page":"https://training.galaxyproject.org/training-material/hall-of-fame/nsoranzo/"}],"gitter":"Galaxy-Training-Network/galaxy-single-cell","js_requirements":{"mathjax":null,"mermaid":false},"short_id":"T00255","url":"/topics/single-cell/tutorials/scrna-scater-qc/tutorial.html","topic_name":"single-cell","tutorial_name":"scrna-scater-qc","dir":"topics/single-cell/tutorials/scrna-scater-qc","symlink":null,"id":"single-cell/scrna-scater-qc","ref_tutorials":["<p>Single-cell RNA-seq (scRNA-seq) is emerging as a promising technology for analysing variability in cell populations. However, the combination of technical noise and intrinsic biological variability makes detecting technical artefacts particularly challenging. Removal of low-quality cells and detection of technical artefacts is critical for accurate downstream analysis.</p>\n\n<p>A number of factors should be examined before downstream analyses, many of which we’ll address here:</p>\n\n<ul>\n  <li>\n    <p><strong>Low library size</strong>: When cells are very degraded or absent from the library preparation, the number of reads sequenced from that library will be very low. It’s important to remove these cells from downstream analyses.</p>\n  </li>\n  <li>\n    <p><strong>Low number of expressed genes</strong>: A low number of expressed genes may be a result of poor-quality cells (e.g. dying, degraded, damaged, etc.), followed by high PCR amplification of the remaining RNA. Again, these cells should be removed from downstream analyses.</p>\n  </li>\n  <li>\n    <p><strong>High mitochondrial gene content</strong>: High concentrations of mitochondrial genes is often a result of damaged cells where the endogenous RNA escapes or degrades. As mitochondria has its own cell membranes, it is often the last DNA/RNA in damaged cells to degrade and hence occurs in high quantities during sequencing.</p>\n  </li>\n  <li>\n    <p><strong>Batch effect</strong>: Large scRNA-seq projects usually need to generate data across multiple batches due to logistical constraints. However, the processing of different batches is often subject to variation, e.g., changes in operator, differences in reagent quality and concentration, the sequencing machine used, etc. This results in systematic differences in the observed expression in cells from different batches, which we refer to as “batch effects”. Batch effects are problematic as they can be major drivers of variation in the data, masking the relevant biological differences and complicating interpretation of the results.</p>\n  </li>\n</ul>\n\n<p>We will use <em>scater</em> (<span class=\"citation\"><a href=\"#10.1093/bioinformatics/btw777\">McCarthy <i>et al.</i> 2017</a></span>) to visualise scRNA-seq data, obtaining information about the factors mentioned above, filter out low-quality cells and confirm that filtering has worked. We’ll then look at confounding factors such as batch effect to see if the data is biased to any technical artifacts.</p>\n\n<blockquote class=\"agenda\">\n  <agenda-title></agenda-title>\n\n  <p>In this tutorial, we will cover:</p>\n\n<ol id=\"markdown-toc\">\n  <li><a href=\"#overview\" id=\"markdown-toc-overview\">Overview</a></li>\n  <li><a href=\"#data-upload\" id=\"markdown-toc-data-upload\">Data upload</a></li>\n  <li><a href=\"#visualise-the-data\" id=\"markdown-toc-visualise-the-data\">Visualise the data</a></li>\n  <li><a href=\"#filtering\" id=\"markdown-toc-filtering\">Filtering</a>    <ol>\n      <li><a href=\"#manual-filtering\" id=\"markdown-toc-manual-filtering\">Manual filtering</a></li>\n      <li><a href=\"#automatic-pca-filtering\" id=\"markdown-toc-automatic-pca-filtering\">Automatic (PCA) filtering</a></li>\n    </ol>\n  </li>\n  <li><a href=\"#conclusion\" id=\"markdown-toc-conclusion\">Conclusion</a></li>\n</ol>\n\n</blockquote>\n\n<h1 id=\"overview\">Overview</h1>\n<p>We will use a pre-calculated expression matrix, along with some additional metadata such as lists of mitochondrial genes and annotation of technical information for each sequencing library. We will plot the data and carry out quality control filtering based on the visualise-filter-visualise paradigm of this approach (see workflow below).</p>\n\n<figure id=\"figure-1\" style=\"max-width: 90%;\"><img src=\"../../images/scrna-scater-qc/Figure1.jpg\" alt=\"Workflow. \" width=\"1337\" height=\"642\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/scrna-scater-qc/Figure1.jpg\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 1</strong>:</span> Workflow demonstrating the visualise-filter-visualise paradigm of the software</figcaption></figure>\n\n<h1 id=\"data-upload\">Data upload</h1>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Data upload</hands-on-title>\n\n  <ol>\n    <li>Create a new history for this tutorial</li>\n    <li>\n      <p>Import the files from <a href=\"https://zenodo.org/record/3386291\">Zenodo</a> or from the shared data library</p>\n\n      <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>https://zenodo.org/record/3386291/files/annotation.txt\nhttps://zenodo.org/record/3386291/files/counts.txt\nhttps://zenodo.org/record/3386291/files/mt_controls.txt\n</code></pre></div>      </div>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-importing-via-links\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-importing-via-links\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Importing via links</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <ul>   <li>Copy the link location</li>   <li>     <p>Click <i class=\"fas fa-upload\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-upload</span> <strong>Upload Data</strong> at the top of the tool panel</p>   </li>   <li>Select <i class=\"fa fa-edit\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-wf-edit</span> <strong>Paste/Fetch Data</strong></li>   <li>     <p>Paste the link(s) into the text field</p>   </li>   <li>     <p>Press <strong>Start</strong></p>   </li>   <li><strong>Close</strong> the window</li> </ul> </blockquote>\n      <p><!--END_SNIPPET--></p>\n\n      <!--SNIPPET-->\n      <blockquote class=\"tip\">   <div class=\"box-title tip-title\" id=\"tip-importing-data-from-a-data-library\"><button class=\"gtn-boxify-button tip\" type=\"button\" aria-controls=\"tip-importing-data-from-a-data-library\" aria-expanded=\"true\"><i class=\"far fa-lightbulb\" aria-hidden=\"true\"></i> <span>Tip: Importing data from a data library</span><span class=\"fold-unfold fa fa-minus-square\"></span></button></div>   <p>As an alternative to uploading the data from a URL or your computer, the files may also have been made available from a <em>shared data library</em>:</p>   <ol>   <li>Go into <strong>Shared data</strong> (top panel) then <strong>Data libraries</strong></li>   <li>Navigate to  the correct folder as indicated by your instructor.     <ul>       <li>On most Galaxies tutorial data will be provided in a folder named <strong>GTN - Material –&gt; Topic Name -&gt; Tutorial Name</strong>.</li>     </ul>   </li>   <li>Select the desired files</li>   <li>Click on <strong>Add to History</strong> <i class=\"fas fa-caret-down\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-dropdown</span> near the top and select <strong>as Datasets</strong> from the dropdown menu</li>   <li>     <p>In the pop-up window, choose</p>     <ul>       <li><em>“Select history”</em>: the history you want to import the data to (or create a new one)</li>     </ul>   </li>   <li>Click on <strong>Import</strong></li> </ol> </blockquote>\n      <p><!--END_SNIPPET--></p>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h1 id=\"visualise-the-data\">Visualise the data</h1>\n\n<p>Take a look at the uploaded data by clicking on the <i class=\"far fa-eye\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-eye</span> symbol for each dataset.</p>\n\n<ul>\n  <li>The <code class=\"language-plaintext highlighter-rouge\">counts.txt</code> file is a 40-sample expression matrix. Each sample (Cell_001 - Cell_040) is listed as the column headers and the start of each row is a gene name. The rest of the data refers to the number of reads mapped to each gene/sample.</li>\n  <li><code class=\"language-plaintext highlighter-rouge\">annotation.txt</code> is a file listing experimental information about each cell. Parameters here include <code class=\"language-plaintext highlighter-rouge\">Mutation_Status</code>, <code class=\"language-plaintext highlighter-rouge\">Cell_Cycle</code>, and <code class=\"language-plaintext highlighter-rouge\">Treatment</code>. These will be useful for looking at  batch effects later.</li>\n  <li>The <code class=\"language-plaintext highlighter-rouge\">mt_controls.txt</code> file is a list of mitochondrial genes. This list will be used later to calculate the % of mitochondrial reads in each sequencing library.</li>\n</ul>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Calculate QC metrics</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scater_create_qcmetric_ready_sce/scater_create_qcmetric_ready_sce/1.12.2\" title=\"Scater: Calculate QC metrics tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Scater: Calculate QC metrics</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.12.2)</span>  with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Expression matrix in tabular format”</em>: <code class=\"language-plaintext highlighter-rouge\">counts.txt</code> (Input dataset)</li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Format dataset describing the features in tabular format”</em>: <code class=\"language-plaintext highlighter-rouge\">annotation.txt</code> (Input dataset)</li>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Dataset containing the list of the mitochondrial control genes”</em>: <code class=\"language-plaintext highlighter-rouge\">mt_controls.txt</code> (Input dataset)</li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title></comment-title>\n\n        <p>The output of this tool is a SingleCellExperiment object in <a href=\"http://loompy.org/\">Loom</a> format, which contains all the information from the input files, along with a host of other quality control metrics, calculated from the input data.</p>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>Next, lets take a look at the data by plotting various properties to see what our data looks like.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Plot library QC</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scater_plot_dist_scatter/scater_plot_dist_scatter/1.12.2\" title=\"Scater: plot library QC tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Scater: plot library QC</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.12.2)</span>  with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Input SingleCellLoomExperiment dataset”</em>: <code class=\"language-plaintext highlighter-rouge\">output_loom</code> (output of <strong>Scater: Calculate QC metrics</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><i class=\"far fa-check-square\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-check</span> <em>“Plot on log scale”</em>: <code class=\"language-plaintext highlighter-rouge\">No</code></li>\n      </ul>\n    </li>\n    <li>If we have a large number of cells (500+), set the ‘Plot on log scale’ option to ‘Yes’. This will make it easier to pick cut-offs when dealing with large numbers. When the tool has finished running, click on the <i class=\"far fa-eye\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">galaxy-eye</span> to view the plots. If it doesn’t appear in the browser, you may have to download it and view it externally. You should be presented with plots similar to those below.\n      <figure id=\"figure-2\" style=\"max-width: 90%;\"><img src=\"../../images/scrna-scater-qc/raw_data.png\" alt=\"Raw data QC plots. \" width=\"1237\" height=\"907\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/scrna-scater-qc/raw_data.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 2</strong>:</span> Raw data QC plots</figcaption></figure>\n\n      <blockquote class=\"comment\">\n        <comment-title></comment-title>\n\n        <p>There are four plots, two distribution bar plots and two scatter plots.\nThe first distribution plot is the number of reads in each library (from a single cell).\nThe second plot is the distribution of <em>feature counts</em> per cell. Feature counts in this case refers to the number of genes expressed in each cell.\nThe third plot <strong>Scatterplot of reads vs genes</strong> is a combination of the two barplots, in that it plots both the read count and the expressed gene count for each cell.\nThe final scatterplot is the <strong>% MT genes</strong>, which plots the number of genes expressed verses the percentage of those genes that are mitochondrial genes.</p>\n      </blockquote>\n\n      <p>Let’s look at each plot in turn and see what it tells us.</p>\n      <ul>\n        <li><strong>Read counts</strong>. You can see that there are a few cells that have less than ~200,000 reads, with other cells having up to one million reads. Although 200,000 reads is still quite a lot and we wouldn’t want to get rid of so much data, we might want to think about removing cells that only contain a smaller number of reads (say, 100,000).</li>\n        <li><strong>Feature counts</strong>. Similar to the read counts plot, we see a few cells that have a very low number of expressed genes (&lt;600), then followed by a more even distribution.</li>\n        <li><strong>Scatterplot of reads vs genes</strong>. This takes the information provided in the two distribution plots above and creates a scatterplot from them. The really poor-quality cells are represented by the points near the intersection of the x and y axis, being data with low read count and low gene count. These are the cells we want to remove during filtering.</li>\n        <li><strong>% MT genes</strong>. You can see from the plot that there are a few cells outside the main “cloud” of datapoints. Some of these could be removed by filtering out cells with low feature counts, but others might need to be removed by mitochondrial content, such as the cell around 37.5%</li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<h1 id=\"filtering\">Filtering</h1>\n\n<h2 id=\"manual-filtering\">Manual filtering</h2>\n\n<p>In the <strong>Scater: filter SCE</strong> Galaxy tool there are two filtering methods available. First, there’s an “automatic” filtering method that uses PCA to identify outliers cells and remove them from the data. This is particularly useful for very large datasets (hundreds of samples). Second, there’s a manual filtering method where users can put a range of filtering parameters, informed by the previous plotting tool.\nHere, we’ll use the manual filtering method.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Filtering with scater</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scater_filter/scater_filter/1.12.2\" title=\"Scater: filter SCE tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Scater: filter SCE</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.12.2)</span>  with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Input SingleCellLoomExperiment dataset”</em>: <code class=\"language-plaintext highlighter-rouge\">output_loom</code> (output of <strong>Scater: Calculate QC metrics</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Type of filter”</em>: <code class=\"language-plaintext highlighter-rouge\">manual</code>\n          <ul>\n            <li><em>“Number of reads mapped to a gene for it to be counted as expressed”</em>: <code class=\"language-plaintext highlighter-rouge\">4.0</code></li>\n            <li><em>“Minimum library size (mapped reads) to filter cells on”</em>: <code class=\"language-plaintext highlighter-rouge\">100000</code></li>\n            <li><em>“Minimum number of expressed genes to filter cells on”</em>: <code class=\"language-plaintext highlighter-rouge\">500</code></li>\n            <li><em>“Maximum % of mitochondrial genes expressed per cell”</em>: <code class=\"language-plaintext highlighter-rouge\">35.0</code></li>\n          </ul>\n        </li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title></comment-title>\n\n        <p>Let’s have a look at the parameters and their values:</p>\n        <ol>\n          <li><em>“Number of reads mapped to a gene for it to be counted as expressed”</em>: by default, only one read needs to be mapped to a gene for it to be counted as “expressed”. We can be a little bit more stringent here and increase the number of reads that need to be mapped to a gene for it to be categorised as “expressed”.</li>\n          <li><em>“Minimum library size (mapped reads) to filter cells on”</em>: This value asks how many mapped reads from each cell do you require to be mapped to your genome to be included in downstream analysis. We can see from our plots that we have a few cells that have less than 200,000 reads. 200,000 can still be quite a lot of reads (depending on the experiment), but we can use a smaller number to see what the initial effect of filtering is. Initially, use 100,000 as the value here.</li>\n          <li><em>“Minimum number of expressed genes”</em>: You can see that some cells only express a few hundred genes, so we’ll remove these cells also.</li>\n          <li><em>“Maximum % of mitochondrial genes expressed per cell”</em>. You can see that as well as having one obvious outlier (~37%).</li>\n        </ol>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Plot library QC after filtering</hands-on-title>\n\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scater_plot_dist_scatter/scater_plot_dist_scatter/1.12.2\" title=\"Scater: plot library QC tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Scater: plot library QC</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.12.2)</span>  with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Input SingleCellLoomExperiment dataset”</em>: <code class=\"language-plaintext highlighter-rouge\">output_loom</code> (output of <strong>Scater: filter SCE</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<figure id=\"figure-3\" style=\"max-width: 90%;\"><img src=\"../../images/scrna-scater-qc/post_filter.png\" alt=\"QC plots after manual filtering. \" width=\"1409\" height=\"936\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/scrna-scater-qc/post_filter.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 3</strong>:</span> QC plots after manual filtering</figcaption></figure>\n\n<blockquote class=\"comment\">\n  <comment-title></comment-title>\n\n  <p>How did the filtering go? Do you think it’s done a good job? Have you removed too many cells? Too few cells? About right?</p>\n\n  <p>Often, it’s a matter of trial and error, where you would start off by being quite lenient (low parameters) and then increasing the stringency until you’re happy with the results. Using the initial Calculate QC metrics file, play around with the filtering parameters and visualise the output to see the effect different paramters have.</p>\n\n</blockquote>\n\n<h2 id=\"automatic-pca-filtering\">Automatic (PCA) filtering</h2>\n\n<p>Another filtering approach is to identify outliers in the data and remove them. PCA can be run once a SingleCellExperiment object has been normalised, and outliers cells identified based on the pre-computed quality control metrics within the SingleCellExperiment object.</p>\n\n<p>As we are using a rather small test dataset, it’s unlikely that PCA filtering will make any difference; for a larger, noisier dataset this is what we would perform instead:</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>Task description</hands-on-title>\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scater_filter/scater_filter/1.12.2\" title=\"Scater: filter SCE tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Scater: filter SCE</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.12.2)</span>  with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Input SingleCellLoomExperiment dataset”</em>: <code class=\"language-plaintext highlighter-rouge\">output_loom</code> (output of <strong>Scater: Calculate QC metrics</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Type of filter”</em>: <code class=\"language-plaintext highlighter-rouge\">automatic</code></li>\n      </ul>\n\n      <blockquote class=\"comment\">\n        <comment-title></comment-title>\n\n        <p>The data will be normalised and then PCA ran on it using the following information from the data:</p>\n        <ul>\n          <li><code class=\"language-plaintext highlighter-rouge\">pct_counts_top_100_features</code></li>\n          <li><code class=\"language-plaintext highlighter-rouge\">total_features_by_counts</code></li>\n          <li><code class=\"language-plaintext highlighter-rouge\">pct_counts_feature_control</code></li>\n          <li><code class=\"language-plaintext highlighter-rouge\">total_features_feature_control</code></li>\n          <li><code class=\"language-plaintext highlighter-rouge\">log10_total_counts_endogenous</code></li>\n          <li><code class=\"language-plaintext highlighter-rouge\">log10_total_counts_feature_control</code></li>\n        </ul>\n\n        <p>When using these filtering approaches, it is sometimes good to try running them in reverse - try PCA filtering first and then if that doesn’t remove enough low-quality cells then use the manual filtering. We could actually pipeline them together - use PCA filtering first and then use the output of that to do further manual filtering.</p>\n      </blockquote>\n    </li>\n  </ol>\n\n</blockquote>\n\n<p>As discussed previously, technical artefacts can bias scRNA-seq analyses. Strong batch effects can mask real biological differences in the data, so must be identified and removed from the data. Logging meta-data details such as date of library construction, sequencing batch, sample name, technical replicate, plate number, etc., is essential to identify batch effects in the data. We can use this information to visualise the data to examine it for clustering according to batch, rather than any real biological feature.</p>\n\n<blockquote class=\"hands_on\">\n  <hands-on-title>PCA plot</hands-on-title>\n  <ol>\n    <li><span class=\"tool\" data-tool=\"toolshed.g2.bx.psu.edu/repos/iuc/scater_plot_pca/scater_plot_pca/1.12.2\" title=\"Scater: PCA plot tool\" aria-role=\"button\"><i class=\"fas fa-wrench\" aria-hidden=\"true\"></i> <strong>Scater: PCA plot</strong> (<i class=\"fas fa-cubes\" aria-hidden=\"true\"></i> Galaxy version 1.12.2)</span>  with the following parameters:\n      <ul>\n        <li><i class=\"far fa-file\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">param-file</span> <em>“Input SingleCellLoomExperiment dataset”</em>: <code class=\"language-plaintext highlighter-rouge\">output_loom</code> (output of <strong>Scater: filter SCE</strong> <i class=\"fas fa-wrench\" aria-hidden=\"true\"></i><span class=\"visually-hidden\">tool</span>)</li>\n        <li><em>“Feature (from annotation file) to colour PCA plot points by”</em>: <code class=\"language-plaintext highlighter-rouge\">Mutation_Status</code></li>\n        <li><em>“Feature (from annotation file) to shape PCA plot points by”</em>: <code class=\"language-plaintext highlighter-rouge\">Cell_Cycle</code></li>\n      </ul>\n    </li>\n  </ol>\n\n</blockquote>\n\n<figure id=\"figure-4\" style=\"max-width: 90%;\"><img src=\"../../images/scrna-scater-qc/PCAplot.png\" alt=\"PCA plot. \" width=\"1236\" height=\"617\" loading=\"lazy\" /><a target=\"_blank\" href=\"../../images/scrna-scater-qc/PCAplot.png\" rel=\"noopener noreferrer\"><small>Open image in new tab</small></a><br /><br /><figcaption><span class=\"figcaption-prefix\"><strong>Figure 4</strong>:</span> PCA plot</figcaption></figure>\n\n<blockquote class=\"question\">\n  <question-title></question-title>\n\n  <ol>\n    <li>Do you see any obvious batch effect?</li>\n    <li>Do any of the categories suggesting some sort of technical artefact?</li>\n  </ol>\n\n  <blockquote class=\"solution\">\n    <solution-title></solution-title>\n\n    <ol>\n      <li>We can see that the <strong>S</strong> and <strong>G2M</strong> categories in <strong>Cell_Cycle</strong> cluster away from the rest of the data. Spend some time thinking about whether this might be a batch effect or biologically significant.</li>\n    </ol>\n\n  </blockquote>\n\n</blockquote>\n\n<h1 id=\"conclusion\">Conclusion</h1>\n\n<p>We have gone through the process of filtering low-quality data from an scRNA-seq expression matrix, using the visualise-filter-visualise paradigm, which proves to be a very effective way of quality-controlling scRNA-seq data. Cells that have low read-coverage, low expression values, or high mitochondrial gene expression have been filtered out. We have then examined ways of looking at confounding factors to examine batch effects in our data.\nThe workflow available from the “Supporting Materials” of this tutorial can be directly imported and used or adapted to a specific analysis.</p>\n\n<p>This tutorial is part of the https://singlecell.usegalaxy.eu portal (<span class=\"citation\"><a href=\"#tekman2020single\">Tekman <i>et al.</i> 2020</a></span> and <span class=\"citation\"><a href=\"#etherington2019galaxy\">Etherington <i>et al.</i> 2019</a></span>)</p>\n"],"ref_slides":[],"hands_on":true,"slides":false,"mod_date":"2023-11-03 14:30:27 +0000","pub_date":"2019-10-23 18:48:12 +0000","version":5,"workflows":[{"workflow":"main_workflow.ga","tests":false,"url":"https://training.galaxyproject.org/training-material/topics/single-cell/tutorials/scrna-scater-qc/workflows/main_workflow.ga","path":"topics/single-cell/tutorials/scrna-scater-qc/workflows/main_workflow.ga","wfid":"single-cell-scrna-scater-qc","wfname":"main_workflow","trs_endpoint":"https://training.galaxyproject.org/training-material/api/ga4gh/trs/v2/tools/single-cell-scrna-scater-qc/versions/main_workflow","license":null,"creators":[],"name":"Scater","title":"Scater","test_results":null,"modified":"2024-06-14 09:58:05 +0000","mermaid":"flowchart TD\n  0[\"ℹ️ Input Dataset\\nannotation.txt\"];\n  style 0 stroke:#2c3143,stroke-width:4px;\n  1[\"ℹ️ Input Dataset\\ncounts.txt\"];\n  style 1 stroke:#2c3143,stroke-width:4px;\n  2[\"ℹ️ Input Dataset\\nmt_controls.txt\"];\n  style 2 stroke:#2c3143,stroke-width:4px;\n  3[\"Scater: Calculate QC metrics\"];\n  0 -->|output| 3;\n  1 -->|output| 3;\n  2 -->|output| 3;\n  4[\"Scater: plot library QC\"];\n  3 -->|output_loom| 4;\n  5[\"Scater: filter SCE\"];\n  3 -->|output_loom| 5;\n  6[\"Scater: plot library QC\"];\n  5 -->|output_loom| 6;\n  7[\"Scater: PCA plot\"];\n  5 -->|output_loom| 7;"}],"api":"https://training.galaxyproject.org/training-material/api/topics/single-cell/tutorials/scrna-scater-qc/tutorial.json","tools":["toolshed.g2.bx.psu.edu/repos/iuc/scater_create_qcmetric_ready_sce/scater_create_qcmetric_ready_sce/1.12.2","toolshed.g2.bx.psu.edu/repos/iuc/scater_filter/scater_filter/1.12.2","toolshed.g2.bx.psu.edu/repos/iuc/scater_plot_dist_scatter/scater_plot_dist_scatter/1.12.2","toolshed.g2.bx.psu.edu/repos/iuc/scater_plot_pca/scater_plot_pca/1.12.2"],"supported_servers":{"exact":[{"url":"https://usegalaxy.be/","name":"UseGalaxy.be","usegalaxy":false},{"url":"https://usegalaxy.eu","name":"UseGalaxy.eu","usegalaxy":true},{"url":"https://usegalaxy.no/","name":"UseGalaxy.no","usegalaxy":false},{"url":"https://usegalaxy.org.au","name":"UseGalaxy.org.au","usegalaxy":true}],"inexact":[{"url":"https://usegalaxy.cz/","name":"UseGalaxy.cz","usegalaxy":false}]},"topic_name_human":"Single Cell","admin_install":{"install_tool_dependencies":true,"install_repository_dependencies":true,"install_resolver_dependencies":true,"tools":[{"name":"scater_create_qcmetric_ready_sce","owner":"iuc","revisions":"fd808de478b1","tool_panel_section_label":"Single-cell","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"scater_filter","owner":"iuc","revisions":"b7ea9f09c02f","tool_panel_section_label":"Single-cell","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"scater_plot_dist_scatter","owner":"iuc","revisions":"2e41b35b5bdd","tool_panel_section_label":"Single-cell","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"},{"name":"scater_plot_pca","owner":"iuc","revisions":"46fc6751d746","tool_panel_section_label":"Single-cell","tool_shed_url":"https://toolshed.g2.bx.psu.edu/"}]},"admin_install_yaml":"---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools:\n- name: scater_create_qcmetric_ready_sce\n  owner: iuc\n  revisions: fd808de478b1\n  tool_panel_section_label: Single-cell\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: scater_filter\n  owner: iuc\n  revisions: b7ea9f09c02f\n  tool_panel_section_label: Single-cell\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: scater_plot_dist_scatter\n  owner: iuc\n  revisions: 2e41b35b5bdd\n  tool_panel_section_label: Single-cell\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: scater_plot_pca\n  owner: iuc\n  revisions: 46fc6751d746\n  tool_panel_section_label: Single-cell\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n","tours":false,"video":false,"slides_recordings":false,"translations":{"tutorial":[],"slides":[],"video":false},"license":"CC-BY-4.0","type":"tutorial"}